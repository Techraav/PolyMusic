/*!CK:915136347!*//*1456943244,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["vb1VG"]); }

__d("ChatNotificationConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={NORMAL:0,NO_USER_MESSAGE_NOTIFICATION:1};},null);
__d("ChatTypeaheadEvent",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ABANDONED_QUERY:"abandoned_query",NEW_QUERY:"new_query",RESULT_SELECTED:"result_selected"};},null);
__d("GenderConst",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={NOT_A_PERSON:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11,UNKNOWN:0};},null);
__d("IrisProtocolMessageLifetime",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={TTL_OFF:0,TTL_ON_UNKNOWN:1,TTL_30SECONDS:30000,TTL_1MINUTE:60000,TTL_3MINUTES:180000,TTL_5MINUTES:300000,TTL_10MINUTES:600000,TTL_15MINUTES:900000,TTL_30MINUTES:1800000,TTL_1HOUR:3600000,TTL_2HOURS:7200000,TTL_4HOURS:14400000,TTL_8HOURS:28800000,TTL_12HOURS:43200000,TTL_24HOURS:86400000};},null);
__d("MercuryCommands",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ME:"\/me "};},null);
__d("MercuryMessageSourceTags",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};},null);
__d("MercurySendMessageFields",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AUTO_RETRY_CNT:"auto_retry_cnt",MANUAL_RETRY_CNT:"manual_retry_cnt"};},null);
__d("MercurySyncTopicType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={DELTA:"delta",DELTAFLOW:"deltaflow"};},null);
__d("MercuryTypeaheadConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={COMPOSER_FRIENDS_MAX:4,COMPOSER_FB4C_MAX:4,COMPOSER_NON_FRIENDS_MAX:2,COMPOSER_SHOW_MORE_LIMIT:2,COMPOSER_THREADS_INITIAL_LIMIT:2,COMPOSER_CHATTAB_MAX:5,COMPOSER_PAGES_MAX:4,COMPOSER_WM_MAX:18,USER_TYPE:"user",PAGE_TYPE:"page",THREAD_TYPE:"thread",HEADER_TYPE:"header",FRIEND_TYPE:"friend",NON_FRIEND_TYPE:"non_friend",FB4C_TYPE:"fb4c",MEETING_ROOM_PAGE_TYPE:"meeting_room_page",COMMERCE_PAGE_TYPE:"commerce_page",VALID_EMAIL:"^([A-Z0-9._\u0025+-]+\u0040((?!facebook\\.com))[A-Z0-9.-]+\\.[A-Z]{2,4}|(([A-Z._\u0025+-]+[A-Z0-9._\u0025+-]*)|([A-Z0-9._\u0025+-]+[A-Z._\u0025+-]+[A-Z0-9._\u0025+-]*))\u0040(?:facebook\\.com))$"};},null);
__d("MessagesViewerSetID",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MESSAGES:"messages",MESSAGES_VIEW_ALL_IN_THREAD:"messages:view_all_in_thread"};},null);
__d("MessagingEvent",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads",CHANGE_PAGE_THREAD_FLAG:"change_page_thread_flag",UPDATE_BLOCKER_STATUS:"update_blocker_status",UPDATE_BLOCKEE_STATUS:"update_blockee_status",CREATE_PAGE_ADMIN_NOTE:"create_page_admin_note",NO_OP:"no_op"};},null);
__d("MessengerView",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={DETAIL:{COMPOSE:"detail\/compose",THREAD:"detail\/thread"},MASTER:{GROUPS:"master\/groups",PEOPLE:"master\/people",RECENT:"master\/recent"}};},null);
__d("OzConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AUTHOR_TYPES:{BOT:"bot",TRAINER:"trainer",USER:"user"},ATTS:{COMMAND:"\u0040COMMAND",IMAGE:"image",SUGG:"\u0040SUGG",TEMPLATE:"template",SURVEY:"survey"},SESSION_INFO_EVENT:"iframenonce_fb_session_info",TOKENS:{USER_FIRST_NAME:"user-first-name"},REMINDERS:{RANGE_IN_YEARS:5},M_FBIDS:{M:"881263441913087",M_DEV:"1579802578966277",P:"506060876211905"}};},null);
__d("P2PPaymentLoggerEvent",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ACTN_ADD_CREDIT_CARD:"Actn_AddCreditCard",ACTN_UPDATE_CREDIT_CARD:"Actn_UpdateCreditCard",ACTN_REMOVE_CREDIT_CARD:"Actn_RemoveCreditCard",ACTN_UNLOCK_CREDIT_CARD:"Actn_UnlockCreditCard",ACTN_VALIDATE_CARD:"Actn_ValidateCard",ACTN_TRANSFER_MONEY:"Actn_TransferMoney",ACTN_TRANSFER_MONEY_WITH_CAMPAIGN:"Actn_TransferMoneyWithCampaign",ACTN_TRANSFER_MONEY_WITH_CAMPAIGN_PARENT_CALL:"Actn_TransferMoneyWithCampaignParentCall",ACTN_TRANSFER_MONEY_WITH_CAMPAIGN_POST_SUCCESS:"Actn_TransferMoneyWithCampaignPostSuccess",ACTN_TRANSFER_MONEY_CHECK_NEEDS_REVERT:"Actn_TransferMoneyCheckNeedsRevert",ACTN_TRANSFER_MONEY_REVERT:"Actn_TransferMoneyRevert",ACTN_TRANSFER_MONEY_CREATE_CONTEXT:"Actn_TransferMoneyCreateContext",ACTN_TRANSFER_MONEY_CREATE_PLATFORM_ITEM:"Actn_TransferMoneyCreatePlatformItem",ACTN_ACCEPT_MONEY:"Actn_AcceptMoney",ACTN_DECLINE_MONEY:"Actn_DeclineMoney",ACTN_SET_PRIMARY:"Actn_SetPrimary",ACTN_WITHDRAW_MONEY:"Actn_WithdrawMoney",ACTN_CREATE_MSGR_COMMERCE_CART:"Actn_CreateMsgrCommerceCart",ACTN_PLACE_MSGR_COMMERCE_ORDER:"Actn_PlaceMsgrCommerceOrder",ACTN_SEND_TRANSFER_MESSAGE:"Actn_SendTransferMessage",ACTN_POST_TRANSFER_STEPS:"Actn_PostTransferSteps",ACTN_SEND_EXPIRE_NOTIFICATIONS:"Actn_SendExpireNotifications",ACTN_UNCATEGORIZED_EXCEPTION:"Actn_Uncategorized_Exception",ACTN_INCREASE_CAMPAIGN_COUNTER:"Actn_Increase_Campaign_Counter",ACTN_CREATE_PAYMENT_REQUEST:"Actn_CreatePaymentRequest",ACTN_REMIND_PAYMENT_REQUEST:"Actn_RemindPaymentRequest",ACTN_PAY_PAYMENT_REQUEST:"Actn_PayPaymentRequest",ACTN_DECLINE_PAYMENT_REQUEST:"Actn_DeclinePaymentRequest",ACTN_CANCEL_PAYMENT_REQUEST:"Actn_CancelPaymentRequest",ACTN_EXPIRE_PAYMENT_REQUEST:"Actn_ExpirePaymentRequest",ACTN_SEND_PAYMENT_REQUEST_MESSAGE:"Actn_SendPaymentRequestMessage",ACTN_AUTH_FOR_SENDER_REVIEW:"Actn_AuthForSenderReview",ACTN_COMPLETE_SENDER_REVIEW:"Actn_CompleteSenderReview",ACTN_COMPLETE_RECEIVER_REVIEW:"Actn_CompleteReceiverReview",ACTN_SUBMIT_VERIFICATION_STEP:"Actn_SubmitVerificationStep",ACTN_COMPLETE_SENDER_VERIFICATION:"Actn_CompleteSenderVerification",ACTN_COMPLETE_RECEIVER_VERIFICATION:"Actn_CancelReceiverVerification",ACTN_CANCEL_SENDER_VERIFICATION:"Actn_CancelSenderVerification",ACTN_CANCEL_RECEIVER_VERIFICATION:"Actn_CancelReceiverVerification",ACTN_CANCEL_SENDER_RISK:"Actn_CancelSenderRisk",ACTN_CANCEL_EXPIRE:"Actn_CancelExpire",ACTN_CANCEL_FOR_SAME_CARD:"Actn_CancelForSameCard",ACTN_CANCEL_BY_CUSTOMER_SERVICE:"Actn_CancelByCustomerService",ACTN_CANCEL_RECEIVER_REVIEW:"Actn_CancelReceiverReview",ACTN_CANCEL_SENDER_REVIEW:"Actn_CancelSenderReview",ACTN_CANCEL_ALL_PENDING_TRANSFERS:"Actn_CancelAllPendingTransfers",ACTN_FILTER_LOGMESSAGE:"Actn_FilterLogMessage",ACTN_FILTER_NOTIFICATION:"Actn_FilterNotification",ACTN_SEND_NOTIFICATION:"Actn_SendNotification",ACTN_ADD_PIN:"Actn_AddPIN",ACTN_UPDATE_PIN:"Actn_UpdatePIN",ACTN_REMOVE_PIN:"Actn_RemovePIN",ACTN_RESET_PIN:"Actn_ResetPIN",ACTN_ENABLE_TOUCH_ID:"Actn_EnableTouchID",ACTN_VERIFY_TOUCH_ID:"Actn_VerifyTouchID",ACTN_DISABLE_TOUCH_ID:"Actn_DisableTouchID",ACTN_CHANNEL_NOTIF_CARD_EVENT:"Actn_ChannelNotifCardEvent",ACTN_CHANNEL_NOTIF_TRANSFER_STATUS_EVENT:"Actn_ChannelNotifTransferStatusEvent",ACTN_CHANNEL_NOTIF_PLATFORM_EVENT:"Actn_ChannelNotifPlatformEvent",ACTN_CHANNEL_NOTIF_PAYMENT_REQUEST_STATUS_EVENT:"Actn_ChannelNotifPaymentRequestStatusEvent",ACTN_PLATFORM_BANNER_DISMISSED:"Actn_PlatformBannerDismissed",ACTN_PLATFORM_BANNER_MARK_AS_SOLD:"Actn_PlatformBannerMarkAsSold",ACTN_ADD_ADDRESS:"Actn_AddAddress",ACTN_GET_ADDRESSES:"Actn_GetAddresses",ACTN_GET_CURRENT_USER_PROFILE_DATA:"Actn_GetCurrentUserProfileData",ACTN_CAMPAIGN_CHECK_USER_HAS_NEW_ACTIVITY:"Actn_CampaignCheckUserHasNewActivity",ACTN_CAMPAIGN_SAVE_PROMO_NOTIFICATION_TIME:"Actn_CampaignSavePromoNotificationTime",UI_ACTN_SEND_MONEY_BUTTON_CLICKED:"UI_Actn_Send_Money_Button_Clicked",UI_ACTN_SEND_MONEY_BUTTON_PLACEHOLDER_CLICKED:"UI_Actn_Send_Money_Button_Placeholder_Clicked",UI_ACTN_INITIATE_SEND:"UI_Actn_Initiate_Send",UI_ACTN_CANCEL_SEND:"UI_Actn_Send_Money_Cancelled",UI_ACTN_INITIATE_ADD_CARD:"UI_Actn_Initiate_Add_Card",UI_ACTN_INITIATE_CHOOSE_CARD:"UI_Actn_Initiate_Choose_Card",UI_ACTN_CANCEL_ADD_CARD:"UI_Actn_Cancel_Add_Card",UI_ACTN_CONFIRM_CARD_DETAILS:"UI_Actn_Confirm_Card_Details",UI_ACTN_ACCEPT_MONEY_CANCEL:"UI_Actn_Accept_Money_Cancel",UI_ACTN_ACCEPT_WITH_CARD:"UI_Actn_Accept_With_Card",UI_ACTN_ADD_CARD_SUCCESS:"UI_Actn_Add_Card_Success",UI_ACTN_ADD_CARD_FAIL:"UI_Actn_Add_Card_Fail",UI_ACTN_CONFIRM_SEND:"UI_Actn_Confirm_Send",UI_ACTN_SEND_SUCCESS:"UI_Actn_Send_Success",UI_ACTN_SEND_MONEY_CANCELLED:"UI_Actn_Send_Money_Cancelled",UI_ACTN_SEND_FAIL:"UI_Actn_Send_Fail",UI_ACTN_INITIATE_EDIT_CARD:"UI_Actn_Initiate_Edit_Card",UI_ACTN_CANCEL_EDIT_CARD:"UI_Actn_Cancel_Edit_Card",UI_ACTN_CONFIRM_EDIT_CARD_DETAILS:"UI_Actn_Confirm_Edit_Card_Details",UI_ACTN_EDIT_CARD_SUCCESS:"UI_Actn_Edit_Card_Success",UI_ACTN_EDIT_CARD_FAIL:"UI_Actn_Edit_Card_Fail",UI_ACTN_INITIATE_REMOVE_CARD:"UI_Actn_Initiate_Remove_Card",UI_ACTN_CONFIRM_REMOVE_CARD:"UI_Actn_Confirm_Remove_Card",UI_ACTN_REMOVE_CARD_SUCCESS:"UI_Actn_Remove_Card_Success",UI_ACTN_REMOVE_CARD_FAIL:"UI_Actn_Remove_Card_Fail",UI_ACTN_INITIATE_PASSWORD_PROTECTION_NUX:"UI_Actn_Initiate_Password_Protection_NUX",UI_ACTN_OPT_IN_PASSWORD_PROTECTION_NUX:"UI_Actn_Opt_In_Password_Protection_NUX",UI_ACTN_OPT_OUT_PASSWORD_PROTECTION_NUX:"UI_Actn_Opt_Out_Password_Protection_NUX",UI_ACTN_ENABLED_PASSWORD_PROTECTION_SETTING:"UI_Actn_Enabled_Password_Protection_Setting",UI_ACTN_DISABLED_PASSWORD_PROTECTION_SETTING:"UI_Actn_Disabled_Password_Protection_Setting",UI_ACTN_SEND_CLICKED:"UI_Actn_Send_Clicked",UI_ACTN_VERIFY_CSC:"UI_Actn_Verify_CSC",UI_ACTN_CONFIRM_AMOUNT:"UI_Actn_Confirm_Amount",UI_ACTN_EDIT_CARD:"UI_Actn_Edit_Card",UI_ACTN_CHANGE_CARD:"UI_Actn_Change_Card",UI_ACTN_INITIATE_SEND_TRIGGER:"UI_Actn_Initiate_Send_Trigger",UI_ACTN_INITIATE_GROUP_SEND:"UI_Actn_Initiate_Group_Send",UI_ACTN_GROUP_SEND_CANCELLED:"UI_Actn_Group_Send_Cancelled",UI_ACTN_INITIATE_GROUP_SEND_TRIGGER:"UI_Actn_Initiate_Group_Send_Trigger",UI_ACTN_GROUP_SEND_RECIPIENT_PICKED:"UI_Actn_Group_Send_Recipient_Picked",UI_ACTN_3RD_PARTY_RECEIPT_SHOWN:"UI_Actn_3rd_Party_Receipt_Shown",UI_ACTN_3RD_PARTY_RECEIPT_DISMISSED:"UI_Actn_3rd_Party_Receipt_Dismissed",UI_ACTN_3RD_PARTY_NON_ENABLED_LOG_MESSAGE_CLICKED:"UI_Actn_3rd_Party_Non_Enabled_Log_Message_Clicked",UI_ACTN_3RD_PARTY_NON_ENABLED_LOG_MESSAGE_CANCELLED:"UI_Actn_3rd_Party_Non_Enabled_Log_Message_Cancelled",UI_ACTN_CHAT_THREAD_BANNER_CLICKED:"UI_Actn_Chat_Thread_Banner_Clicked",UI_ACTN_CHAT_THREAD_BANNER_VIEWED:"UI_Actn_Chat_Thread_Banner_Viewed",UI_ACTN_CHAT_THREAD_BANNER_DISMISSED:"UI_Actn_Chat_Thread_Banner_Dismissed",UI_ACTN_INITIATE_MONEYPENNY_ORDER:"UI_Actn_Initiate_Moneypenny_Order",UI_ACTN_CONFIRM_MONEYPENNY_ORDER:"UI_Actn_Confirm_Moneypenny_Order",UI_ACTN_MONEYPENNY_ORDER_FAIL:"UI_Actn_Moneypenny_Order_Fail",UI_ACTN_MONEYPENNY_ORDER_SUCCESS:"UI_Actn_Moneypenny_Order_Success",UI_ACTN_MONEYPENNY_ORDER_CANCEL:"UI_Actn_Moneypenny_Order_Cancel",UI_ACTN_FRIEND_PICKER_SEARCH:"UI_Actn_Friend_Picker_Search",UI_ACTN_FRIEND_PICKER_SELECT:"UI_Actn_Friend_Picker_Select",UI_ACTN_FRIEND_PICKER_SHOWN:"UI_Actn_Friend_Picker_Shown",UI_ACTN_FI_CANCEL:"UI_Actn_FI_Cancel",UI_ACTN_FI_SUCCESS_DIALOG_NEXT:"UI_Action_Success_Dialog_Next",UI_ACTN_FI_BANNER_DISMISSED:"UI_Actn_FI_Banner_Dismissed",UI_ACTN_FI_BANNER_IMPRESSION:"UI_Actn_FI_Banner_Impression",UI_ACTN_INCENTIVE_TRANSFER_SUCCESS:"UI_Actn_Incentive_Transfer_Success",UI_ACTN_INCENTIVE_TRANSFER_FAILURE:"UI_Actn_Incentive_Transfer_Failure",UI_ACTN_PLATFORM_BANNER_SELLER_HIDE_CLICKED:"UI_Actn_Platform_Banner_Seller_Hide_Clicked",UI_ACTN_PLATFORM_BANNER_BUYER_HIDE_CLICKED:"UI_Actn_Platform_Banner_Buyer_Hide_Clicked",UI_ACTN_PLATFORM_BANNER_SOLD_CLICKED:"UI_Actn_Platform_Banner_Sold_Clicked",UI_ACTN_PLATFORM_BANNER_IMAGE_CLICKED:"UI_Actn_Platform_Banner_Image_Clicked",UI_ACTN_PLATFORM_BANNER_TITLE_CLICKED:"UI_Actn_Platform_Banner_Title_Clicked",UI_ACTN_PLATFORM_BANNER_PAY_CLICKED:"UI_Actn_Platform_Banner_Pay_Clicked",UI_ACTN_PLATFORM_BANNER_SELLER_VIEWED:"UI_Actn_Platform_Banner_Seller_Viewed",UI_ACTN_PLATFORM_BANNER_BUYER_VIEWED:"UI_Actn_Platform_Banner_Buyer_Viewed",UI_ACTN_PLATFORM_BANNER_PAY_NUX_SHOWN:"UI_Actn_Platform_Banner_Pay_Nux_Shown",UI_ACTN_INITIATE_REQUEST:"UI_Actn_Initiate_Request",UI_ACTN_REQUEST_CLICKED:"UI_Actn_Request_Clicked",UI_ACTN_CONFIRM_REQUEST:"UI_Actn_Confirm_Request",UI_ACTN_REQUEST_SUCCESS:"UI_Actn_Request_Success",UI_ACTN_REQUEST_FAIL:"UI_Actn_Request_Fail",UI_ACTN_INITIATE_DECLINE_REQUEST:"UI_Actn_Initiate_Decline_Request",UI_ACTN_CONFIRM_DECLINE_REQUEST:"UI_Actn_Confirm_Decline_Request",UI_ACTN_DECLINE_REQUEST_FAIL:"UI_Actn_Decline_Request_Fail",UI_ACTN_DECLINE_REQUEST_SUCCESS:"UI_Actn_Decline_Request_Success",UI_ACTN_INITIATE_CANCEL_REQUEST:"UI_Actn_Initiate_Cancel_Request",UI_ACTN_CONFIRM_CANCEL_REQUEST:"UI_Actn_Confirm_Cancel_Request",UI_ACTN_CANCEL_REQUEST_FAIL:"UI_Actn_Cancel_Request_Fail",UI_ACTN_CANCEL_REQUEST_SUCCESS:"UI_Actn_Cancel_Request_Success",UI_ACTN_INITIATE_CHECKOUT:"UI_Actn_Initiate_Checkout",UI_ACTN_CHECKOUT_CONFIRM:"UI_Actn_Checkout_Confirm",UI_ACTN_INITIATE_ADD_ADDRESS:"UI_Actn_Initiate_Add_Address",UI_ACTN_CANCEL_ADD_ADDRESS:"UI_Actn_Cancel_Add_Address",UI_ACTN_INITIATE_CHOOSE_ADDRESS:"UI_Actn_Initiate_Choose_Address",UI_ACTN_CONFIRM_ADDRESS_DETAILS:"UI_Actn_Confirm_Address_Details",UI_ACTN_ADD_ADDRESS_SUCCESS:"UI_Actn_Add_Address_Success",UI_ACTN_ADD_ADDRESS_FAIL:"UI_Actn_Add_Address_Fail",UI_ACTN_CHECKOUT_FAIL:"UI_Actn_Checkout_Fail",UI_ACTN_CHECKOUT_CART_CREATION_FAIL:"UI_Actn_Checkout_Cart_Creation_Fail",UI_ACTN_CHECKOUT_CANCEL:"UI_Actn_Checkout_Cancel",UI_ACTN_CHECKOUT_SUCCESS:"UI_Actn_Checkout_Success",UI_ACTN_CHECKOUT_CART_CREATION_SUCCESS:"UI_Actn_Checkout_Cart_Creation_Success",UI_ACTN_SEND_MONEY_PAGE_VIEWED:"UI_Actn_Send_Money_Page_Viewed",UI_ACTN_ACCEPT_MONEY_NUX_SHOWN:"UI_Actn_Accept_Money_NUX_Shown",UI_ACTN_ACCEPT_MONEY_NUX_NEXT_CLICK:"UI_Actn_Accept_Money_NUX_Next_Click",UI_ACTN_SEND_MONEY_NUX_SHOWN:"UI_Actn_Send_Money_NUX_Shown",UI_ACTN_SEND_MONEY_NUX_NEXT_CLICK:"UI_Actn_Send_Money_NUX_Next_Click",UI_ACTN_GET_CREDIT_CARDS_EXCEPTION:"UI_ACTN_GET_CREDIT_CARDS_EXCEPTION",UI_ACTN_CREATE_TRANSFER_EXCEPTION:"UI_ACTN_CREATE_TRANSFER_EXCEPTION",UI_ACTN_ADD_CARD_EXCEPTION:"UI_ACTN_ADD_CARD_EXCEPTION",UI_ACTN_GET_TRANSFERS_EXCEPTION:"UI_ACTN_GET_TRANSFERS_EXCEPTION",UI_ACTN_GET_EXTENSIVE_TRANSFERS_EXCEPTION:"UI_ACTN_GET_EXTENSIVE_TRANSFERS_EXCEPTION",UI_ACTN_GET_NUX_TRANSFERS_EXCEPTION:"UI_ACTN_GET_NUX_TRANSFERS_EXCEPTION",UI_ACTN_UPDATE_PRESET_CARD_EXCEPTION:"UI_ACTN_UPDATE_PRESET_CARD_EXCEPTION",UI_ACTN_UPDATE_CARD_EXCEPTION:"UI_ACTN_UPDATE_CARD_EXCEPTION",UI_ACTN_DELETE_CARD_EXCEPTION:"UI_ACTN_DELETE_CARD_EXCEPTION",UI_ACTN_GET_PASSWORD_PROTECTION_EXCEPTION:"UI_ACTN_GET_PASSWORD_PROTECTION_EXCEPTION",UI_ACTN_SET_PASSWORD_PROTECTION_EXCEPTION:"UI_ACTN_SET_PASSWORD_PROTECTION_EXCEPTION",UI_ACTN_DECLINE_TRANSFER_EXCEPTION:"UI_ACTN_DECLINE_TRANSFER_EXCEPTION",UI_ACTN_CANCEL_TRANSFER_EXCEPTION:"UI_ACTN_CANCEL_TRANSFER_EXCEPTION",UI_ACTN_VERIFY_CARD_EXCEPTION:"UI_ACTN_VERIFY_CARD_EXCEPTION",UI_ACTN_VALIDATE_BIN_EXCEPTION:"UI_ACTN_VALIDATE_BIN_EXCEPTION",UI_ACTN_GET_ELIGIBILITY_EXCEPTION:"UI_ACTN_GET_ELIGIBILITY_EXCEPTION",UI_ACTN_GET_FRIEND_LIST_EXCEPTION:"UI_ACTN_GET_FRIEND_LIST_EXCEPTION",UI_ACTN_GET_BANNER_STATES_EXCEPTION:"UI_ACTN_GET_BANNER_STATES_EXCEPTION",UI_ACTN_INCREMENT_BANNER_VIEW_EXCEPTION:"UI_ACTN_INCREMENT_BANNER_VIEW_EXCEPTION",UI_ACTN_INCREMENT_BANNER_DISMISSAL_EXCEPTION:"UI_ACTN_INCREMENT_BANNER_DISMISSAL_EXCEPTION",UI_ACTN_CREATE_M_TRANSFER_EXCEPTION:"UI_ACTN_CREATE_M_TRANSFER_EXCEPTION",UI_ACTN_CREATE_FI_TRANSER_EXCEPTION:"UI_ACTN_CREATE_FI_TRANSER_EXCEPTION",UI_ACTN_GET_PLATFORM_CONTEXT_EXCEPTION:"UI_ACTN_GET_PLATFORM_CONTEXT_EXCEPTION",UI_ACTN_DISMISS_PLATFORM_CONTEXT_EXCEPTION:"UI_ACTN_DISMISS_PLATFORM_CONTEXT_EXCEPTION",UI_ACTN_MARK_SOLD_CONTEXT_EXCEPTION:"UI_ACTN_MARK_SOLD_CONTEXT_EXCEPTION",UI_ACTN_GET_ADDRESSES_EXCEPTION:"UI_ACTN_GET_ADDRESSES_EXCEPTION",UI_ACTN_ADD_ADDRESS_EXCEPTION:"UI_ACTN_ADD_ADDRESS_EXCEPTION",UI_ACTN_CREATE_CART_EXCEPTION:"UI_ACTN_CREATE_CART_EXCEPTION",UI_ACTN_SET_CART_ADDRESS_EXCEPTION:"UI_ACTN_SET_CART_ADDRESS_EXCEPTION",UI_ACTN_GET_PROFILE_EXCEPTION:"UI_ACTN_GET_PROFILE_EXCEPTION",UI_ACTN_CREATE_REQUEST_EXCEPTION:"UI_ACTN_CREATE_REQUEST_EXCEPTION",UI_ACTN_DECLINE_REQUEST_EXCEPTION:"UI_ACTN_DECLINE_REQUEST_EXCEPTION",UI_ACTN_CANCEL_REQUEST_EXCEPTION:"UI_ACTN_CANCEL_REQUEST_EXCEPTION",UI_ACTN_GET_PENDING_REQUESTS_EXCEPTION:"UI_ACTN_GET_PENDING_REQUESTS_EXCEPTION",UI_ACTN_GROUP_SELL_INTEREST_QP_DIALOG_SHOWN:"UI_ACTN_GROUP_SELL_INTEREST_QP_DIALOG_SHOWN",UI_ACTN_GROUP_SELL_INTEREST_QP_DIALOG_NEXT_CLICK:"UI_ACTN_GROUP_SELL_INTEREST_QP_DIALOG_NEXT_CLICK",UI_ACTN_GROUP_SELL_INTEREST_MESSAGE_SELLER_CLICK:"UI_ACTN_GROUP_SELL_INTEREST_MESSAGE_SELLER_CLICK",UI_ACTN_GROUP_SELL_INTEREST_MESSAGE_SEND_CLICK:"UI_ACTN_GROUP_SELL_INTEREST_MESSAGE_SEND_CLICK",UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_SHOWN:"UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_SHOWN",UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_CANCEL_CLICK:"UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_CANCEL_CLICK",UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_PAY_CLICK:"UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_PAY_CLICK",UI_ACTN_PAYMENTS_HISTORY_BLUEBAR_CLICK:"UI_ACTN_PAYMENTS_HISTORY_BLUEBAR_CLICK"};},null);
__d("P2PPaymentLoggerEventFlow",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={UI_FLOW_P2P_SEND:"UI_Flow_P2P_Send",UI_FLOW_P2P_REQUEST:"UI_Flow_P2P_Request",UI_FLOW_P2P_RECEIVE:"UI_Flow_P2P_Receive",UI_FLOW_P2P_SETTINGS:"UI_Flow_P2P_Settings",UI_FLOW_P2P_GROUP_SEND:"UI_Flow_P2P_Group_Send",UI_FLOW_P2P_GROUP_REQUEST:"UI_Flow_P2P_Group_Request",UI_FLOW_MONEYPENNY_CHECKOUT:"UI_Flow_Moneypenny_Checkout",UI_FLOW_FINANCIAL_INCENTIVES:"UI_Flow_Financial_Incentives",UI_FLOW_FINANCIAL_INCENTIVES_ZERO_INDEX_JEWEL:"UI_Flow_Financial_Incentives_Zero_Index_Jewel",UI_FLOW_PLATFORM_BANNER:"UI_Flow_Platform_Banner",UI_FLOW_CHECKOUT:"UI_Flow_Checkout",UI_FLOW_SEND_MONEY_PAGE:"UI_Flow_Send_Money_Page",UI_FLOW_REQUEST_SENDER_NUX_CHAT_THREAD_BANNER:"UI_Flow_Request_Sender_NUX_Chat_Thread_Banner",UI_FLOW_SENDER_NUX_CHAT_THREAD_BANNER:"UI_Flow_Sender_NUX_Chat_Thread_Banner",UI_FLOW_GROUP_SELL_INTEREST_DIALOG:"UI_FLOW_GROUP_SELL_INTEREST_DIALOG",UI_FLOW_SEND_MONEY_BLUEBAR:"UI_FLOW_SEND_MONEY_BLUEBAR",UI_FLOW_PAYMENTS_MENU_BLUEBAR:"UI_FLOW_PAYMENTS_MENU_BLUEBAR",UI_FLOW_BOOKMARK:"UI_FLOW_BOOKMARK"};},null);
__d("SidebarType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SIDEBAR:"sidebar",BUDDYLIST:"buddylist",BUDDYLIST_NUB:"buddylist_nub"};},null);
__d("StickerConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MOBILE_LIKE_STICKER_PACK_ID:"227877430692340",GRAVEYARD_PACK_ID:"604597256247273",LIKE_STICKER_ID:"227878347358915",HOT_LIKE_SMALL_STICKER_ID:"369239263222822",HOT_LIKE_MEDIUM_STICKER_ID:"369239343222814",HOT_LIKE_LARGE_STICKER_ID:"369239383222810",MRU_STICKER_PACK:"599061016853145",SEARCH_PACK_ID:"680229632032514",SPRITE_PADDING:"24",PayloadSource:{VIEW_ACTION:"view-action"},EMOTICON_PACK_ID:"1471127876485636",DEFAULT_FRAME_RATE:83,TRAY_SIZE:64,THREAD_SIZE:120};},null);
__d('AjaxRequest',['ErrorUtils','Keys','PHPQuerySerializer','TimeSlice','URI','UserAgent_DEPRECATED','getSameOriginTransport','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();function p(t,u,v){this.xhr=n();if(!(u instanceof l))u=new l(u);if(v&&t=='GET'){u.setQueryData(v);}else this._params=v;this.method=t;this.uri=u;this.xhr.open(t,u);}var q=window.XMLHttpRequest&&'withCredentials' in new XMLHttpRequest();p.supportsCORS=function(){return q;};p.ERROR='ar:error';p.TIMEOUT='ar:timeout';p.PROXY_ERROR='ar:proxy error';p.TRANSPORT_ERROR='ar:transport error';p.SERVER_ERROR='ar:http error';p.PARSE_ERROR='ar:parse error';p.SERVICE_UNAVAILABLE='ar:noservice';p._inflight=[];function r(){var t=p._inflight;p._inflight=[];t.forEach(function(u){u.abort();});}function s(t){t.onJSON=t.onError=t.onSuccess=null;clearTimeout(t._timer);if(t.xhr&&t.xhr.readyState<4){t.xhr.abort();t.xhr=null;}p._inflight=p._inflight.filter(function(u){return u&&u!=t&&u.xhr&&u.xhr.readyState<4;});}Object.assign(p.prototype,{timeout:60000,streamMode:true,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(t){if(this[t])this[t](this);},_parseStatus:function(){var t;try{this.status=this.xhr.status;t=this.xhr.statusText;}catch(u){if(this.xhr.readyState>=4){this.errorType=p.TRANSPORT_ERROR;this.errorText=u.message;}return;}if(this.status===0&&!/^(file|ftp)/.test(this.uri)){this.errorType=p.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=p.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=p.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=p.SERVER_ERROR;}else if(this.status===503){this.errorType=p.SERVICE_UNAVAILABLE;}else if(this.status>500&&this.status<600){this.errorType=p.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=p.TRANSPORT_ERROR;}else{t='unrecognized status code: '+this.status;this.errorType=p.ERROR;}if(!this.errorText)this.errorText=t;},_parseResponse:function(){var t,u=this.xhr.readyState;try{t=this.xhr.responseText||'';}catch(v){if(u>=4){this.errorType=p.ERROR;this.errorText='responseText not available - '+v.message;}return;}while(this.xhr){var w=this._eol+1,x=this.streamMode?t.indexOf('\n',w):t.length;if(x<0&&u==4)x=t.length;if(x<=this._eol)break;var y=t;if(this.streamMode)y=t.substr(w,x-w).replace(/^\s*|\s*$/g,'');if(w===0&&this.prelude)if(this.prelude.test(y))y=y.replace(this.prelude,'');this._eol=x;if(y){try{this.json=JSON.parse(y);}catch(v){var z=/(<body[\S\s]+?<\/body>)/i.test(t)&&RegExp.$1,aa={message:v.message,'char':w,excerpt:(w===0&&z||y).substr(512)};this.errorType=p.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(aa);return;}h.applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function(){var t=this.xhr&&this.xhr.readyState||0;if(this.status==null&&t>=2)this._parseStatus();if(!this.errorType&&this.status!=null)if(t==3&&this.streamMode||t==4)this._parseResponse();if(this.errorType||t==4){this._time=Date.now()-this._sentAt;this._call(!this.errorType?'onSuccess':'onError');s(this);}},send:function(t){this.xhr.onreadystatechange=k.guard(this._onReadyState.bind(this),'AjaxRequest xhr.onreadystatechange');var u=this.timeout;if(u)this._timer=o(function(){this.errorType=p.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');s(this);}.bind(this),u);p._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(t?j.serialize(t):'');},abort:function(){s(this);},toString:function(){var t='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)t+=' errorType='+this.errorType+' ('+this.errorText+')';return t+']';},toJSON:function(){var t={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};if(this.errorType)t.uri=this.uri;for(var u in t)if(t[u]==null)delete t[u];return t;}});if(window.addEventListener&&m.firefox())window.addEventListener('keydown',function(event){if(event.keyCode===i.ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',r);f.exports=p;},null);
__d('ChannelSubdomain',['Event','JSLogger','Run','setTimeoutAcrossTransitions','LogHistory','WebStorage'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=c('LogHistory').getInstance('channel'),m=c('WebStorage').getLocalStorage(),n=i.create('channel'),o='channel_sub:',p=7,q=100*1000,r=null,s;function t(){if(s){clearTimeout(s);s=null;}if(m&&r!=null)m.removeItem(o+r);r=null;}function u(v,w,x){var y=(v-1)*p;if(x){if(s)clearTimeout(s);r=s=null;}if(w==null)w=Math.floor(Math.random()*y);if(r==null)if(m){var z=[];for(var aa=0;aa<m.length;aa++){var ba=m.key(aa);if(ba.indexOf(o)===0){var ca=parseInt(ba.substr(o.length),10);z[ca]=parseInt(m.getItem(ba),10);}}var da=Date.now()-q;for(aa=0;aa<y;aa++){var ea=(aa+w)%y;if(!z[ea]||z[ea]<da){r=ea;break;}}if(r!=null){var fa=function(){try{m.setItem(o+r,Date.now());}catch(ga){l.warn('subdomain set failed',ga.message);}s=k(fa,q/2);};fa();}else{l.warn('no channel subdomain',z);n.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){h.listen(window,'pagehide',t);}else j.onUnload(t);}else r=w;return r==null?null:r%p;}f.exports={allocate:u,clear:t};},null);
__d('DocRPC',['ErrorUtils'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={_apis:{},_dispatch:function(j){var k;try{j=JSON.parse(j);}catch(l){throw new Error('DocRPC unparsable dispatch: "'+j+'"');}if(i._apis.hasOwnProperty(j.api)){var m=i._apis[j.api];if(m[j.method])k=h.applyWithGuard(m[j.method],m,j.args);}if(k===undefined)k=null;return JSON.stringify(k);},publish:function(j,k){i._apis[k]=j;},proxy:function(j,k,l){var m={};l.forEach(function(n){m[n]=function(){var o={api:k,method:n,args:Array.prototype.slice.call(arguments)},p;try{if(j.closed)throw new Error('DocRPC window closed');p=j.DocRPC._dispatch(JSON.stringify(o));}catch(q){h.reportError(q);return;}if(typeof p=='string')try{p=JSON.parse(p);}catch(q){throw new Error('DocRPC '+k+'.'+n+' unparsable return: "'+p+'"');}return p;};});return m;}};f.exports=b.DocRPC=i;},null);
__d('ChannelTransport',['AjaxRequest','ChannelConstants','DocRPC','LogHistory','TimeSlice','URI','bind','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=k.getInstance('channel');function q(){return (1048576*Math.random()|0).toString(36);}function r(ba,ca){var da=ba.subdomain;da=da===null?'':da+'-';var ea=ba.host;ea=ea===null||ea===undefined?'edge-chat':ba.host;var fa=new m(ca).setDomain(da+ea+'.'+ba.domain).setPort(ba.port).setSecure(new m(window.location.href).isSecure());return fa;}function s(ba){var ca={partition:ba.partition,cb:q(),failure:ba.pingFailuresOnSubdomain};if(ba.sticky_token)ca.sticky_token=ba.sticky_token;if(ba.sticky_pool)ca.sticky_pool=ba.sticky_pool;var da=r(ba,'/p').setQueryData(ca);p.log('start_p',{uri:da.toString()});var ea=new h('GET',da);if(h.supportsCORS())ea.xhr.withCredentials=true;var fa=function(ga){p.log('finish_p',{xhr:ga.toJSON?ga.toJSON():ga,subdomain:ba.subdomain,fullHost:ba.fullHost});};ea.onError=function(ga){fa(ga);if(ba.subdomain===null)return;ba.pingFailuresOnSubdomain++;ba.subdomain++;if(ba.subdomain>6)ba.subdomain=0;};ea.timeout=ba.P_TIMEOUT;ea.onSuccess=fa;ea.send();}function t(ba,ca,da){var ea=new Image(),fa=0,ga=function(ja){ea.abort();return ja?ca():da();};ea.onload=l.guard(function(){p.log('ping_ok',{duration:Date.now()-fa});ga(true);},'ChannelTransport image.onload');ea.onerror=l.guard(function(){s(ba);ga(false);},'ChannelTransport image.onerror');var ha=o(ea.onerror,10000);ea.abort=function(){if(ha){clearTimeout(ha);ha=null;}ea.onload=ea.onerror=null;};var ia={partition:ba.partition,cb:q()};if(ba.sticky_token)ia.sticky_token=ba.sticky_token;if(ba.sticky_pool)ia.sticky_pool=ba.sticky_pool;if(ba.lastRequestErrorReason){ia.reason=ba.lastRequestErrorReason;ba.lastRequestErrorReason=null;}if(ba.uid&&ba.viewerUid){ia.uid=ba.uid;ia.viewer_uid=ba.viewerUid;}fa=Date.now();ea.src=r(ba,'/ping').setQueryData(ia);return ea;}function u(ba,ca){var da={channel:ba.user_channel,partition:ba.partition,clientid:ba.sessionID,cb:q(),cap:0,uid:ba.uid,viewer_uid:ba.viewerUid};if(ba.sticky_token)da.sticky_token=ba.sticky_token;if(ba.sticky_pool)da.sticky_pool=ba.sticky_pool;if(ba.profile)da.profile=ba.profile;if(ba.capabilities)da.cap=ba.capabilities;da.id=ca;var ea=r(ba,'/add_bud').setQueryData(da),fa=new h('GET',ea);if(h.supportsCORS())fa.xhr.withCredentials=true;fa.onError=function(ga){p.warn('add_buddy_error');};fa.onSuccess=function(ga){p.log('add_buddy_ok');};fa.timeout=ba.P_TIMEOUT;fa.send();}function v(ba){var ca={channel:ba.user_channel,partition:ba.partition,clientid:ba.sessionID,cb:q(),cap:0,uid:ba.uid,viewer_uid:ba.viewerUid};if(ba.sticky_token)ca.sticky_token=ba.sticky_token;if(ba.sticky_pool)ca.sticky_pool=ba.sticky_pool;if(ba.is_offline||ba.shouldSuppressPresence){ca.state='offline';}else ca.state='active';if(ca.state===ba.lastPresenceState)return;ba.lastPresenceState=ca.state;if(ba.profile)ca.profile=ba.profile;if(ba.capabilities)ca.cap=ba.capabilities;var da=r(ba,'/active_ping').setQueryData(ca),ea=new h('GET',da);if(h.supportsCORS())ea.xhr.withCredentials=true;ea.onError=function(fa){p.warn('active_ping_error');};ea.onSuccess=function(fa){p.log('active_ping_ok');};ea.timeout=ba.P_TIMEOUT;ea.send();}function w(ba,ca,da,ea){var fa=new Date(),ga=-1;if(ba.userActive>0){ga=(fa-ba.userActive)/1000|0;if(ga<0)p.warn('idle_regression',{idleTime:ga,now:fa.getTime(),userActive:ba.userActive});}var ha={channel:ba.user_channel,seq:ba.seq,partition:ba.partition,clientid:ba.sessionID,cb:q(),idle:ga,qp:'y',cap:0};if(ba.state.aiq)ha.aiq=ba.state.aiq;if(ba.ready)if(ba.seqTurSentAt==-1||ba.seqTurSentAt==ba.seq){ha.tur=ba.timeUntilReady;ha.qpmade=ba.queueMade;ba.seqTurSentAt=ba.seq;}ha.pws=ba.pws;if(ba.sequenceId>0)ha.isq=ba.sequenceId;ha.msgs_recv=ba.estimatedReceived;if(ba.uid&&ba.viewerUid){ha.uid=ba.uid;ha.viewer_uid=ba.viewerUid;}if(ba.sticky_token){ha.sticky_token=ba.sticky_token;}else{ha.request_batch=1;if(ba.msgr_region)ha.msgr_region=ba.msgr_region;}if(ba.sticky_pool)ha.sticky_pool=ba.sticky_pool;if('trace_id' in ba)ha.traceid=ba.trace_id;if(ba.is_offline||ba.shouldSuppressPresence){ha.state='offline';}else if(ba.userActive>0&&ga<60)ha.state='active';ba.lastPresenceState=ha.state;if(ba.streamingCapable){ha.mode='stream';ha.format='json';}if(ba.profile)ha.profile=ba.profile;if(ba.capabilities)ha.cap=ba.capabilities;var ia=r(ba,'/pull').setQueryData(ha),ja='GET',ka=new h(ja,ia);if(h.supportsCORS())ka.xhr.withCredentials=true;ka.timeout=ba.streamingCapable?ba.STREAMING_TIMEOUT:ba.LONGPOLL_TIMEOUT;ka.onJSON=ca;ka.onSuccess=da;ka.onError=function(){var la=this.status==12002&&this._time>=ba.MIN_12002_TIMEOUT||this.status==504&&this._time>=ba.MIN_504_TIMEOUT,ma=la?da:ea;return ma&&ma.apply(this,arguments);};ka.send();ba.inStreaming=ba.streamingCapable;return ka;}function x(ba){this.manager=ba;this.init&&this.init();}function y(ba){x.apply(this,arguments);}Object.assign(y.prototype,{logName:'CORS',enterState:function(ba,ca){if(this._request){this._request.abort();this._request=null;}if(ba=='init')o(n(this.manager,'exitState',{status:i.OK,stateId:ca.stateId}),0);if(!/pull|ping/.test(ba))return;var da=this.manager;if(ba=='ping'){this._request=t(ca,n(da,'exitState',{status:i.OK,stateId:ca.stateId}),n(da,'exitState',{status:i.ERROR,stateId:ca.stateId}));}else if(ba=='pull')this._request=w(ca,n(da,'_processTransportData',ca.stateId),n(da,'exitState',{status:i.OK,stateId:ca.stateId}),n(da,'exitState',{status:i.ERROR,stateId:ca.stateId}));}});function z(ba){p.log('iframe_init_constructor');x.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);j.publish(this,'outerTransport');}Object.assign(z.prototype,{logName:'iframe',_initIframe:function(ba){p.log('iframe_init_start');window.onchanneliframeready=function(){p.log('iframe_resources');return ba.resources;};window.onchanneliframeloaded=function(){p.log('iframe_loaded');};if(ba){this._iframeURI=r(ba,ba.path);if(ba.resources){var ca=this._iframeURI.getDomain();ba.resources=ba.resources.map(function(ea){var fa=new m(ea);if(fa.getPath().startsWith('/intern/rsrc.php')&&fa.getQueryData().origin!==undefined)return fa.addQueryData('origin',ca).toString();return ea;});}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);p.log('iframe_uri_set');}catch(da){p.error('iframe_uri_set_error',da);this.exitState({status:i.ERROR,stateId:ba.stateId},da+'');}},enterState:function(ba,ca){if(ba=='init'){this._initIframe(ca);}else if(/idle|ping|pull/.test(ba)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(ba!='idle')this.exitState({status:i.ERROR,stateId:ca.stateId},'iframe not yet loaded');}else if(ba=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(ba){if(this.manager.state=='init'&&ba.status==i.OK)this._iframeProxy=j.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function aa(){this.init=this.init.bind(this);x.apply(this,arguments);}Object.assign(aa.prototype,{logName:'iframe(inner)',init:function(){j.publish(this,'innerTransport');try{var ca=j.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);Object.assign(this,ca);this.exitState({status:i.OK,stateId:1e+06});}catch(ba){p.error('iframe_inner_init_error',ba);}},enterState:function(ba,ca){if(this._request){this._request.abort();this._request=null;}if(ba=='ping'){this._request=t(ca,n(this,'exitState',{status:i.OK,stateId:ca.stateId}),n(this,'exitState',{status:i.ERROR,stateId:ca.stateId}));}else if(ba=='pull')this._request=w(ca,n(this,'_processTransportData',ca.stateId),n(this,'exitState',{status:i.OK,stateId:ca.stateId}),n(this,'exitState',{status:i.ERROR,stateId:ca.stateId}));}});f.exports={getURI:r,Transport:x,CORSTransport:y,IframeTransport:z,IframeInnerTransport:aa,sendActivePing:v,sendAdditionalBuddyRequest:u};},null);
__d('ChatProxyConnectionState',['Map'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';function i(){'use strict';this.auxiliaryIrisQueues=new h();this.aiq=null;}i.prototype.subscribeIrisQueue=function(j,k){'use strict';this.auxiliaryIrisQueues.set(j,k);this.updateCaches();};i.prototype.unsubscribeIrisQueue=function(j){'use strict';this.auxiliaryIrisQueues['delete'](j);this.updateCaches();};i.prototype.updateCaches=function(){'use strict';var j=[];this.auxiliaryIrisQueues.forEach(function(k,l,m){j.push(l);j.push(k);},this);if(j.length===0){this.aiq=null;}else this.aiq=j.join(',');};f.exports=i;},null);
__d('FBAjaxRequest',['AjaxRequest','getAsyncParams'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(k,l,m){m=babelHelpers['extends']({},i(k),m);var n=new h(k,l,m);n.streamMode=false;var o=n._call;n._call=function(p){if(p=='onJSON'&&this.json){if(this.json.error){this.errorType=h.SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}o.apply(this,arguments);};n.ajaxReqSend=n.send;n.send=function(p){this.ajaxReqSend(babelHelpers['extends']({},p,m));};return n;}f.exports=j;},null);
__d('FBRTCSupport',['ChannelConstants','RTCConfig','UserAgent'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={isSendWebrtcSupported:function(){return i.SendNewVCGK;},isReceiveWebrtcSupported:function(){return i.ReceiveNewVCGK;},isVideoInteropSupported:function(){return i.VideoInteropGK;},isVideoCallBlockingSupported:function(){return i.VideoCallBlockingGK;},isWebrtcSupported:function(){return (j.isBrowser('Chrome >= 28')||j.isBrowser('Firefox >= 25')||j.isBrowser('Opera >= 20'));},isOSSupported:function(){return !j.isPlatform('Android')&&!j.isPlatform('iOS');},getCapabilities:function(){var l=0;if(this.isReceiveWebrtcSupported())l=h.CAPABILITY_VOIP_INTEROP;return l;}};f.exports=k;},null);
__d('FantailLogger',['Bootloader','FantailConfig'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={debug:function(k,l){for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];if(i.enabled)h.loadModules(["FantailLogQueue"],function(p){var q;(q=p.get(k)).debug.apply(q,[l].concat(n));});},info:function(k,l){for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];if(i.enabled)h.loadModules(["FantailLogQueue"],function(p){var q;(q=p.get(k)).info.apply(q,[l].concat(n));});},warn:function(k,l){for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];if(i.enabled)h.loadModules(["FantailLogQueue"],function(p){var q;(q=p.get(k)).warn.apply(q,[l].concat(n));});},error:function(k,l){for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];if(i.enabled)h.loadModules(["FantailLogQueue"],function(p){var q;(q=p.get(k)).error.apply(q,[l].concat(n));});}};f.exports=j;},null);
__d("MovingStat",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){i=i||60000;var j={t:new Date(),count:0,v:0},k=j,l=0,m=0;function n(){var o=new Date()-i;while(k&&k.next&&k.t<o){l-=k.v;m-=k.count;k=k.next;}}this.add=function(o){l+=o;m++;var p=new Date();if(p-j.t<1000){j.v+=o;j.count++;}else{j.next={t:p,v:o,count:1};j=j.next;n();}};this.tally=function(o){o=o||1000;n();return {sum:l,count:m,timeAverage:l*o/i};};}f.exports=h;},null);
__d('Dcode',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h,i={},j={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var l=[];for(var m in j){i[j[m]]=m;l.push(j[m]);}l.reverse();h=new RegExp(l.join("|"),'g');})();var k={encode:function(l){return encodeURIComponent(l).replace(/([_A-Z])|%../g,function(m,n){return n?'%'+n.charCodeAt(0).toString(16):m;}).toLowerCase().replace(h,function(m){return i[m];});},decode:function(l){return decodeURIComponent(l.replace(/[_A-Z]/g,function(m){return j[m];}));}};f.exports=k;},null);
__d('PresenceCookieManager',['Cookie','CurrentUser','Dcode','ErrorUtils','JSLogger','PresenceInitialData','PresenceUtil','URI'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=m.cookieVersion,q='presence',r={},s=null,t=null,u=l.create('presence_cookie');function v(){try{var z=h.get(q);if(s!==z){s=z;t=null;if(z&&z.charAt(0)=='E')z=j.decode(z.substring(1));if(z)t=JSON.parse(z);}if(t){if(t.user&&t.user!==i.getID())return null;if(t.v!==p)return null;return t;}}catch(y){u.warn('getcookie_error',y);}return null;}function w(){return parseInt(Date.now()/1000,10);}var x={register:function(y,z){r[y]=z;},store:function(){var y=v();if(y&&y.v&&p<y.v){u.debug('stale_cookie',p);return;}var z={v:p,time:w(),user:i.getID()};for(var aa in r)z[aa]=k.applyWithGuard(r[aa],r,[y&&y[aa]],function(ea){ea.presence_subcookie=aa;});var ba='E'+j.encode(JSON.stringify(z));if(n.hasUserCookie()){var ca=ba.length;if(ca>1024)u.warn('big_cookie',ca);var da=o.getRequestURI(false).isSecure()&&!!h.get('csm');h.set(q,ba,null,null,da);}},clear:function(){h.clear(q);},getSubCookie:function(y){var z=v();if(!z)return null;return z[y];}};f.exports=x;},null);
__d('PresenceState',['Arbiter','ErrorUtils','JSLogger','PresenceCookieManager','debounceAcrossTransitions','setIntervalAcrossTransitions','PresenceInitialData'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=n.cookiePollInterval||2000,p=n.shouldSuppress||false,q=[],r=[],s=null,t=null,u=0,v=null,w=0,x=['sb2','t2','lm2','uct2','tr','tw','at','wml'],y=j.create('presence_state');function z(){return k.getSubCookie('state');}function aa(){u=Date.now();k.store();ea(t);}var ba=l(aa,0);function ca(ja){if(typeof ja=='undefined'||isNaN(ja)||ja==Number.POSITIVE_INFINITY||ja==Number.NEGATIVE_INFINITY)ja=0;return ja;}function da(ja){var ka={};if(ja){x.forEach(function(na){ka[na]=ja[na];});if(u<ja.ut)y.error('new_cookie',{cookie_time:ja.ut,local_time:u});}ka.ut=u;for(var la=0,ma=q.length;la<ma;la++)i.applyWithGuard(q[la],null,[ka]);t=ka;return t;}function ea(ja){w++;u=ca(ja.ut);if(!s)s=m(ha,o);t=ja;if(v===null)v=ja;for(var ka=0,la=r.length;ka<la;ka++)i.applyWithGuard(r[ka],null,[ja]);w--;}function fa(ja){if(ja&&ja.ut)if(u<ja.ut){return true;}else if(ja.ut<u)y.error('old_cookie',{cookie_time:ja.ut,local_time:u});return false;}function ga(){var ja=z();if(fa(ja))t=ja;return t;}function ha(){var ja=z();if(fa(ja))ea(ja);}k.register('state',da);h.subscribe(j.DUMP_EVENT,function(ja,ka){ka.presence_state={initial:babelHelpers['extends']({},v),state:babelHelpers['extends']({},t),update_time:u,sync_paused:w,poll_time:o};});(function(){var ja=ga();if(ja){ea(ja);}else{y.debug('no_cookie_initial');ea(da());return;}})();var ia={doSync:function(ja){if(w)return;if(ja){aa();}else ba();},registerStateStorer:function(ja){q.push(ja);},registerStateLoader:function(ja){r.push(ja);},get:function(){return ga();},getInitial:function(){return v;},shouldSuppress:function(){return p;},verifyNumber:ca};f.exports=ia;},null);
__d('RTISession',['URI','AjaxRequest','invariant','ErrorUtils'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l='.facebook.com';function m(n,o,p,q,r,s,t,u,v){!n?j(0):undefined;!q?j(0):undefined;!r?j(0):undefined;this.domain=n;this.port=o;this.edgePoolName=p;this.stickyToken=q;this.loggedInId=r;this.accountId=s;this.clientProfile=t||'desktop';this.clientId=u;this.capabilities=v;}m.prototype.issueRequest=function(n,o,p,q,r){!n?j(0):undefined;!o?j(0):undefined;!q?j(0):undefined;var s=this.domain.length-l.length,t=s>0&&this.domain.indexOf(l,s)!==-1,u=t?this.domain:this.domain+l,v=(1048576*Math.random()|0).toString(36),w={cb:v,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var x in w)!!o[x]?j(0):undefined;Object.assign(w,o);var y=new h(n).setDomain(u).setPort(this.port).setSecure(new h(window.location.href).isSecure()).setQueryData(w),z=p?'POST':'GET',aa=new i(z,y);aa.timeout=r?r*1000:30000;if(aa.xhr)aa.xhr.withCredentials=true;var ba={};aa.onSuccess=function(){};aa.onJSON=function(){ba.data=aa.json;ba.error=null;k.applyWithGuard(q,this,[ba]);}.bind(this);aa.onError=function(){ba.data=null;ba.error=aa.errorType||'error';k.applyWithGuard(q,this,[ba]);}.bind(this);aa.send(JSON.stringify(p));};f.exports=m;},null);
__d('ChannelManager',['AjaxRequest','Arbiter','AsyncRequest','ChannelClientID','ChannelConstants','ChannelInitialData','ChannelSubdomain','ChannelTransport','ChatConfig','ChatVisibility','DTSG','Env','FantailLogger','FBAjaxRequest','FBRTCSupport','ISB','JSLogger','LogHistory','MessagingRealtimeConstants','MovingStat','PresenceCookieManager','PresenceState','PresenceUtil','RTISession','Run','SystemEvents','URI','UserActivity','ChatProxyConnectionState','errorCode','requestAnimationFrameAcrossTransitions','setIntervalAcrossTransitions','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na){if(c.__markCompiled)c.__markCompiled();var oa,pa=x.create('channel'),qa=y.getInstance('channel_manager'),ra=null;function sa(fb){ra=fb;}var ta={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},ua={state:new ja(),userActive:Date.now(),created:Date.now(),ready:false,seqTurSentAt:-1,queueMade:'',sequenceId:0,lastPresenceState:null,lastRequestErrorReason:null,seq:0,pingFailuresOnSubdomain:0,pws:'fresh',estimatedReceived:0,sessionID:k.getID(),capabilities:v.getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:ca.shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false},va=1,wa={},xa=0;function ya(){return j.lastSuccessTime?Math.round((Date.now()-j.lastSuccessTime)/1000):-1;}function za(){var fb={};if(oa.getConfig('host'))fb[oa.getConfig('user_channel')]=oa.getConfig('seq',0);return fb;}function ab(){var fb=Date.now(),gb=Date.now(),hb={total:0},ib='idle',jb=false;ga.subscribe([ga.USER,ga.ONLINE,ga.TIME_TRAVEL],function(mb,nb){cb(true);gb=null;oa.lastPullTime=Date.now();var ob;switch(mb){case ga.USER:ob=ga.isPageOwner()?l.SYS_OWNER:l.SYS_NONOWNER;break;case ga.ONLINE:ob=nb?l.SYS_ONLINE:l.SYS_OFFLINE;break;case ga.TIME_TRAVEL:if(0<nb&&nb<180000&&ua.reduceTimeTravel){t.warn(l.FANTAIL_SERVICE,'skipping time travel failure. %d',nb);return;}ob=l.SYS_TIMETRAVEL;break;}oa.exitState({status:ob,stateId:va});});var kb=function(mb,nb){var ob=Date.now(),pb=null;if(nb){fb=ob;pb=nb.nextState||nb.state;}else pb=ib;ga.checkTimeTravel();if(gb){var qb=Math.round((ob-gb)/1000);if(qb>0){hb[ib]=(hb[ib]||0)+qb;hb.total+=qb;}}ib=pb;gb=ob;if(!mb){hb.lastSuccessTime=ya();hb.online=ga.isOnline();qa.log('rollup',JSON.stringify(hb));}};i.subscribe(l.ON_ENTER_STATE,kb);ma(kb,60000);i.subscribe(x.DUMP_EVENT,function(mb,nb){nb.channelRollup=hb;});var lb=function(){if(oa.isShutdown()||oa.shouldIdle())return;ga.checkTimeTravel();var mb=Date.now()-(oa.lastPullTime||s.start);if(!jb&&mb>ua.STALL_THRESHOLD){var nb=ya();qa.error('stall',JSON.stringify({lastSuccessTime:nb,rollupState:ib}));jb=true;}var ob=Date.now()-fb;if(oa.state=='pull'&&ob>ua.JUMPSTART_THRESHOLD){fb=null;qa.warn('jumpstart',JSON.stringify({state:oa.state,dormant:ob}));oa.enterState('init');}};ma(lb,10000);}function bb(){var fb=Date.now(),gb=1;function hb(){na(hb,gb*1000);var mb=oa.state;if(mb=='idle'&&oa.shouldIdle())return;pa.bump('conn_t',gb);if(mb=='pull')pa.bump('conn_t_pull',gb);}hb();var ib=[15,30,60,120,240],jb=false,kb=false;function lb(mb){na(function(){pa.rate('pullenter_'+mb,jb);pa.rate('pullexit_'+mb,kb);},mb*1000);}while(ib.length)lb(ib.shift());i.subscribe(l.ON_ENTER_STATE,function(mb,nb){if(nb.state=='pull')jb=true;fb=Date.now();});i.subscribe(l.ON_EXIT_STATE,function(mb,nb){if(nb.state!='pull'||!fb)return;var ob='other';if(nb.status==l.OK){kb=true;ob='ok';}else if(nb.xhr&&nb.xhr.errorType){ob=/ar:(\w+)/.test(nb.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(nb.status))return;var pb=(Date.now()-fb)/1000;if(pb<0){return;}else if(pb>3600)pb=3600;pa.bump('conn_num');pa.bump('conn_exit',pb);pa.bump('conn_num_'+ob);pa.bump('conn_exit_'+ob,pb);});}function cb(fb){if(fb){xa=0;wa={};}else xa++;}function db(){var fb=!h.supportsCORS()||ua.forceIframe;if(ua.subdomain===null||fb){ua.fullHost=ua.host;}else ua.fullHost=ua.subdomain+'-'+ua.host;}oa={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:sa,backoff:false,sessionRegistered:false,init:function(fb,gb){this.init=function(){};i.subscribe(l.GET_RTI_SESSION_REQUEST,function(event,kb){this.informCurrentSession();}.bind(this));la(function(){t.info(l.FANTAIL_SERVICE,'client initialized');t.info(l.FANTAIL_SERVICE,'using session id: %s at seq: %d with sticky: %s/%s',ua.sessionID,ua.sequenceId,ua.sticky_token,ua.sticky_pool);ia.subscribe(function(){ua.userActive=Date.now();o.sendActivePing(ua);});});ba.register('ch',za);var hb=this.getConfig('max_conn',2);ua.subdomain=n.allocate(hb);this._transportRate=new aa(30000);var ib=h.supportsCORS()&&!ua.forceIframe?'CORSTransport':'IframeTransport';this.transport=new o[ib](this);if(fb)this.enterState(fb,gb);la(function(){i.subscribe(x.DUMP_EVENT,function(event,kb){kb.transportRate=this._transportRate.tally();kb.transportType=ib;kb.transportVersion=2;}.bind(this));ab();bb();}.bind(this));if(oa.getConfig('tryStreaming')&&oa.getConfig('host')&&h.supportsCORS()&&!ua.forceIframe){var jb=ua.MIN_INIT_PROBE_DELAY+Math.random()*ua.INIT_PROBE_DELAY_RANDOMIZE_RANGE;na(this._probeTest,jb);}},configure:function(){for(var fb=arguments.length,gb=Array(fb),hb=0;hb<fb;hb++)gb[hb]=arguments[hb];qa.log('configure',JSON.stringify(gb));gb.forEach(function(ib){return Object.assign(ua,ib);});db();i.inform(l.ON_CONFIG,this);},getConfig:function(fb,gb){return fb in ua?ua[fb]:gb;},getCompleteConfig:function(){return ua;},subscribeIrisQueue:function(fb,gb){ua.state.subscribeIrisQueue(fb,gb);this.exitState({status:l.OK,stateId:va});},unsubscribeIrisQueue:function(fb){ua.state.unsubscribeIrisQueue(fb);},informCurrentSession:function(){var fb=null;if(this.sessionRegistered&&ua&&ua.fullHost&&ua.sticky_token&&ua.uid)fb=new ea(ua.fullHost,ua.port,ua.sticky_pool,ua.sticky_token,ua.uid,ua.viewerUid,ua.profile,ua.sessionID,ua.capabilities);i.inform(l.RTI_SESSION,fb);},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(ga.isPageOwner()&&ga.isOnline());},_sendIframeError:function(fb){var gb=new j().setURI('/ajax/presence/reconnect.php').setData({reason:fb,fb_dtsg:r.getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);gb.specifiesWriteRequiredParams()&&gb.send();},_getDelay:function(){var fb=Math.min(ua.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,xa-1)),ua.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in ua)fb=ua.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(fb*(1+Math.random()*.5));},enterState:function(){if(this._inEnterState)qa.warn('enterstate_recursion','{}');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(fb){this._inEnterState=false;throw fb;}},_enterState:function(fb){var gb=this.backoff?this._getDelay():0;this.backoff=false;if(this.isShutdown()){t.warn(l.FANTAIL_SERVICE,'not executing state due to shutdown mode: %s',fb);return;}if(fb!='idle!'&&this.shouldIdle()){t.warn(l.FANTAIL_SERVICE,'forced idleness');return;}va++;ua.stateId=va;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(fb)){var hb=this._transportRate.tally().timeAverage,ib=oa.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(hb>=ib){if(!this._throttled){this._throttled=true;qa.warn('throttled','{}');}pa.bump('throttle');gb=1000/ib;}}else if(!(/#$/.test(fb)))gb=this._getDelay();fb=fb.replace(/\W*$/,'');if(!ta[fb]){t.error(l.FANTAIL_SERVICE,'invalid state: %s',fb);throw new Error('invalid state:'+fb);}var jb=Array.from(arguments),kb;if(gb<=0){kb={state:fb};this._transportRate.add(1);this.state=fb;var lb=this['_enter_'+this.state];if(lb){jb.shift();lb.apply(this,jb);}if(/init|idle|pull|ping/.test(this.state)){if(ua.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];ua.is_offline=!q.isOnline();ua.capabilities=v.getCapabilities();t.info(l.FANTAIL_SERVICE,'entering transport state: %s',this.state);this.transport.enterState(this.state,ua);if(this.state=='ping'){kb.url=o.getURI(ua).toString();kb.port=ua.port||'undefined';}}}else{this.state='idle';this.nextState=fb;kb={state:this.state,delay:gb,nextState:fb};jb[0]=fb+'#';this._deferredTransition=na(function(){this._deferredTransition=null;this.enterState.apply(this,jb);}.bind(this),gb);}if(/pull/.test(fb)){kb.client_id=ua.sessionID;kb.streaming=ua.inStreaming;}i.inform(l.ON_ENTER_STATE,kb);},exitState:function(fb,gb){var hb=fb.stateId,ib=fb.status;if(this.isShutdown()||hb<va)return;var jb=this.state,kb=Array.from(arguments);kb[0]=fb.status;var lb={state:jb,status:ib};if(/pull/.test(jb)){lb.client_id=ua.sessionID;lb.streaming=ua.inStreaming;}if(/ping/.test(jb)&&ib!=l.OK)lb.url=o.getURI(ua).toString();if(this.nextState)lb.nextState=this.nextState;if(gb&&gb.errorType){ua.lastRequestErrorReason=gb.errorType;lb.xhr=gb.toJSON?gb.toJSON():gb;if(gb.errorType==h.SERVICE_UNAVAILABLE){t.error(l.FANTAIL_SERVICE,'got 5xx http status code, setting long delay');this.proxyDown=true;}delete lb.xhr.json;}else if(ib!=l.OK)ua.lastRequestErrorReason=ib;if(gb&&gb.json){if(gb.json.t)lb.t=gb.json.t;if(gb.json.reason)lb.reason=gb.json.reason;if(gb.json.seq)lb.seq=gb.json.seq;}i.inform(l.ON_EXIT_STATE,lb);var mb=this['_exit_'+jb];if(mb)ib=mb.apply(this,kb)||ib;if(ib!=l.OK){cb();wa[jb]=(wa[jb]||0)+1;}var nb=ta[this.nextState||jb][ib]||ta._all[ib],ob=nb&&nb.replace(/!*$/,'');if(!ob){qa.error('terminal_transition',JSON.stringify(lb));this._shutdownHint=l.HINT_INVALID_STATE;nb='shutdown!';t.error(l.FANTAIL_SERVICE,'entering shutdown state');}this._lastState=jb;this._lastStatus=ib;this.enterState(nb);},_processTransportData:function(fb,gb){this._processTransportData0(fb,gb,gb.json);},_processTransportData0:function(fb,gb,hb){var ib=hb.t;if('s' in hb){hb.seq=hb.s;delete hb.s;}if(hb.u&&ua.user&&hb.u!=ua.user){qa.warn('misguided_msg',JSON.stringify({user:ua.user,target:hb.u}));this._reportProxyMisguidedMsg(hb.u,ua.user);return;}var jb=ua.seq;if('seq' in hb){ua.seq=hb.seq;ca.doSync();}switch(ib){case 'continue':if(ua.inStreaming&&this.heartbeats.length<1){ua.streamingCapable=false;qa.log('switch_to_longpoll','{}');na(this._probeTest,ua.PROBE_DELAY);}cb(true);if(!ua.inStreaming||ua.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:l.OK,stateId:fb});break;case 'refresh':case 'refreshDelay':t.info(l.FANTAIL_SERVICE,'got refresh with reason: %s',hb.reason);this.exitState({status:'refresh_'+(hb.reason||0),stateId:fb},gb);break;case 'backoff':t.warn(l.FANTAIL_SERVICE,'server told client to back off');cb();this.backoff=true;break;case 'lb':var kb=hb.lb_info;if(kb){ua.sticky_token=kb.sticky;if('pool' in kb)ua.sticky_pool=kb.pool;if('sd' in kb)ua.subdomain=kb.subdomain;if('vip' in kb)ua.host=kb.vip;db();}else qa.error('missing_lb_info','{}');break;case 'test_streaming':na(this._probeTest,500);break;case 'fullReload':ba.clear();qa.log('full_reload','{}');this.sessionRegistered=true;this.informCurrentSession();i.inform(l.ON_INVALID_HISTORY);cb(true);t.info(l.FANTAIL_SERVICE,'full reload incurred');var lb=l.OK;this.exitState({status:lb,stateId:fb},gb);if('ms' in hb)this._processMessages(hb,jb);break;case 'msg':cb(true);this._processMessages(hb,jb);break;case 'heartbeat':if(ua.inStreaming){var mb=Date.now();if(this.heartbeats.length>0)var nb=mb-this.heartbeats[this.heartbeats.length-1];qa.log('heartbeat_interval',JSON.stringify({client_id:ua.sessionID,interval:nb}));this.heartbeats.push(mb);}break;case 'batched':var ob=hb.batches,pb;for(pb=0;pb<ob.length;pb++)this._processTransportData0(fb,gb,ob[pb]);break;default:t.error(l.FANTAIL_SERVICE,'got an unknown protocol message: %s',ib);qa.error('unknown_msg_type',JSON.stringify({type:ib}));break;}},_processMessages:function(fb,gb){var hb,ib,jb,kb;if('tr' in fb)ua.trace_id=fb.tr;ib=fb.ms;jb=ua.seq-ib.length;for(hb=0;hb<ib.length;hb++,jb++){ua.estimatedReceived++;if(jb>=gb){kb=ib[hb];if(kb.type){var lb=l.getArbiterType(kb.type);if(kb.type==='messaging'){var mb={type:'messaging',event:kb.event};if(kb.message){mb.inbox_unread=kb.unread_counts&&kb.unread_counts.inbox;mb.tid=kb.message.tid;mb.mid=kb.message.mid;t.info(l.FANTAIL_SERVICE,'got message with id: %s',kb.message.mid);}}else if(kb.type==='pages_messaging'){if(kb.unread_counts&&kb.unread_counts.inbox)i.inform(l.getArbiterType('pages_inbox_count_update'),{page_id:kb[z.VIEWER_FBID],inbox_unread:kb.unread_counts.inbox});}else if(kb.type==='skywalker'){lb=l.SKYWALKER;}else if(kb.type==='qprimer'){kb.first=!ua.ready;if(kb.first){ua.ready=true;ua.timeUntilReady=Date.now()-ua.created;ua.queueMade=kb.made;}lb=l.CHANNEL_ESTABLISHED;}else if(kb.type==='pws'){ua.pws=kb.pws;}else if(kb.type==='delta')ua.sequenceId=kb.iseq;i.inform(lb,{obj:kb});}}else qa.warn('seq_regression',JSON.stringify({last_seq:gb,messages:ib.length,seq:jb}));}},_enter_init:function(){if(wa.init>=oa.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:l.ERROR_MAX,stateId:va}),0);this._initTimer=na(this.exitState.bind(this,{status:l.ERROR,stateId:va},'timeout'),ua.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(fb){qa.warn('enter_reconnect',fb);t.info(l.FANTAIL_SERVICE,'entered reconnect with reason: %s',fb);var gb=va;if(!da.hasUserCookie()){t.warn(l.FANTAIL_SERVICE,'user has no cookie???');qa.warn('no_user_cookie','{}');setTimeout(function(){oa._shutdownHint=l.HINT_AUTH;oa.exitState({status:l.ERROR_SHUTDOWN,stateId:gb});},0);return;}var hb={reason:fb,fb_dtsg:r.getToken()};if(w.token)hb.fb_isb=w.token;if(ra)ra(hb);var ib=new u('GET','/ajax/presence/reconnect.php',hb);ib.onSuccess=function(){oa.configure(ib.json);ba.store();this.exitState({status:l.OK,stateId:gb});}.bind(this);ib.onError=function(){var jb=ib.json&&ib.json.error;t.error(l.FANTAIL_SERVICE,'reconnect error: %s',ib.errorType);if(ib.errorType==h.TRANSPORT_ERROR||ib.errorType==h.PROXY_ERROR||ib.errorType==h.SERVICE_UNAVAILABLE)this._shutdownHint=l.HINT_CONN;if(jb&&jb==1356007){this._shutdownHint=l.HINT_MAINT;}else if(jb==1357001||jb==1357004||jb==1348009){this._shutdownHint=l.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?l.ERROR_SHUTDOWN:l.ERROR,stateId:gb},ib);}.bind(this);ib.send();},_enter_shutdown:function(){i.inform(l.ON_SHUTDOWN,{reason:this._shutdownHint});if('shutdown_recovery_interval_seconds' in ua&&ua.shutdown_recovery_interval_seconds>0){var fb=ua.shutdown_recovery_interval_seconds*1000;na(function(){i.inform(l.ATTEMPT_RECONNECT);this.state='reconnect!';this.enterState('reconnect!');}.bind(this),fb);}},_exit_init:function(fb){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(fb==l.ERROR_MAX)this._sendIframeError(l.reason_IFrameLoadGiveUp);},_exit_pull:function(fb,gb){var hb=fb==l.OK;if(hb){this.lastPullTime=Date.now();}else{var ib='exit status: '+fb;if(gb&&gb.errorType)ib+=' ajax request error: '+gb.errorType;t.error(l.FANTAIL_SERVICE,'pull failed with status: %s',ib);}},_exit_ping:function(fb){if(fb==l.OK){var gb=Date.now()-(this.lastPullTime||s.start);if(gb>ua.STALL_THRESHOLD){t.error(l.FANTAIL_SERVICE,'didnt complete a successful pull for too long');return l.ERROR_STALE;}}else t.error(l.FANTAIL_SERVICE,'ping failed with status: %s',fb);},_reportProxyMisguidedMsg:function(fb,gb){t.error(l.FANTAIL_SERVICE,'misguided message to %d meant for %d',gb,fb);var hb=Date.now();if(hb-this.lastReportOnMisguidedMsgTime<=ua.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=hb;var ib={received_uid:fb,expected_uid:gb};if(ua.sticky_token)ib.sticky_token=ua.sticky_token;var jb=new ha('/err_misguided_msg').setDomain(ua.host+'.'+ua.domain).setPort(ua.port).setSecure(new ha(window.location.href).isSecure()).setQueryData(ib),kb=new h('GET',jb);if(h.supportsCORS())kb.xhr.withCredentials=true;kb.onSuccess=function(lb){};kb.onError=function(lb){};kb.onJSON=function(lb,mb){};kb.send();},_probeTest:function(){ua.streamingCapable=false;var fb=[],gb={mode:'stream',format:'json'};if(ua.sticky_token)gb.sticky_token=ua.sticky_token;var hb=new ha('/probe').setDomain(ua.host+'.'+ua.domain).setPort(ua.port).setSecure(new ha(window.location.href).isSecure()).setQueryData(gb),ib=new h('GET',hb);ib.onJSON=function(jb,kb){if(jb&&jb.json&&jb.json.t==='heartbeat'){fb.push(Date.now());if(fb.length>=2){var lb=fb[1]-fb[0];if(lb>=ua.PROBE_HEARTBEATS_INTERVAL_LOW&&lb<=ua.PROBE_HEARTBEATS_INTERVAL_HIGH){ua.streamingCapable=true;qa.log('switch_to_streaming','{}');}}}};ib.onSuccess=function(jb){if(fb.length!=2){ua.streamingCapable=false;qa.error('probe_error',JSON.stringify({error:'beats.length = '+fb.length}));}qa.log('probe_success','{}');};ib.onError=function(jb){ua.streamingCapable=false;qa.error('probe_error',JSON.stringify(jb));};ib.send();}};f.exports=oa;function eb(){if(m.channelConfig){oa.configure(m.channelConfig);if(/shutdown/.test(m.state))oa._shutdownHint=l[m.reason];oa.init(m.state,m.reason);}}if(p.get('early_channel',false)){eb();}else fa.onAfterLoad(eb);},6);
__d('ChannelConnection',['Arbiter','Run','SystemEvents','ChannelConstants','ChannelManager','JSLogger','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=m.create('channel_connection'),p=null,q=null,r=null,s=null,t=0,u=Object.assign(new h(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});i.onBeforeUnload(function(){});function v(){if(q){clearTimeout(q);q=null;}}function w(){v();o.log('unmute_warning');u.inform(u.UNMUTE_WARNING);}function x(ca){v();q=n(w,ca);o.log('mute_warning',{time:ca});u.inform(u.MUTE_WARNING);}function y(){if(r){clearTimeout(r);r=null;}}function z(ca,da){y();if(ca===k.ON_ENTER_STATE&&(da.nextState||da.state)==='pull'){if(s!==u.CONNECTED){o.log('connected');var ea=!s;s=u.CONNECTED;t=0;u.inform(u.CONNECTED,{init:ea});}}else if(ca===k.ON_ENTER_STATE&&((da.nextState||da.state)==='ping'||!da.nextState&&da.state==='idle')){r=n(function(){var fa=null;if(!(da.state==='idle'&&!da.nextState))fa=da.delay||0;o.log('reconnecting',{delay:fa});if(u.disconnected())o.log('reconnecting_ui',{delay:fa});s=u.RECONNECTING;da.state==='idle'&&t++;if(t>1){u.inform(u.RECONNECTING,fa);}else if(!da.nextState&&da.state==='idle')z(ca,da);},500);}else if(ca===k.ON_SHUTDOWN){o.log('shutdown',{reason:da.reason});s=u.SHUTDOWN;t=0;u.inform(u.SHUTDOWN,da.reason);}}function aa(){if(l.isShutdown()){z(k.ON_SHUTDOWN,l._shutdownHint);}else z(k.ON_ENTER_STATE,{state:l.state,nextState:l.nextState,delay:0});}i.onAfterLoad(aa);Object.assign(u,{disconnected:function(){return s===u.SHUTDOWN||s===u.RECONNECTING&&!q&&t>1;},isShutdown:function(){return s===u.SHUTDOWN;},reconnect:function(ca){if(l.state==='ping'||l.isShutdown())return;o.log('reconnect',{now:ca});u.inform(u.RECONNECTING,0);if(!!ca){if(p!==null){clearTimeout(p);p=null;}l.enterState('ping!');}else if(!p)p=n(function(){l.enterState('ping!');p=null;},k.CHANNEL_MANUAL_RECONNECT_DEFER_MSEC);},unmuteWarning:w});function ba(){h.subscribe([k.ON_ENTER_STATE,k.ON_SHUTDOWN],z);h.subscribe(k.ATTEMPT_RECONNECT,function(){if(u.disconnected())u.reconnect();});j.subscribe(j.TIME_TRAVEL,function(){u.reconnect();x(k.MUTE_WARNING_TIME_MSEC);});i.onBeforeUnload(y,false);}i.onAfterLoad(ba);u.mockAfterLoad=function(){aa();ba();};f.exports=u;},6);
__d('ChatOpenTabEventLogger',['Banzai','ChatImpressionLogger','MercuryIDs'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k='messaging_tracking',l={log:function(m,n,o,p){var q={referrer:m||'',message_thread_id:n,message_view:'chat',timestamp_send:Date.now(),message_target_ids:null};if(o!==undefined)q.message_target_ids=[o];i.logImpression(m,o,p);h.post(k,q,{delay:0,retry:true});var r=j.getUserIDFromThreadID(String(n));h.post('page_message_button_click',{page_id:r,ref:m});}};f.exports=l;},null);
__d('ChatWelcomeMessage',['ImmutableObject'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(){this.$ChatWelcomeMessage1={};}i.prototype.setWelcomeMessage=function(k,l,m){this.$ChatWelcomeMessage1[k]=new h({timestamp:Date.now(),thread_id:k,author:l,body:m});};i.prototype.getWelcomeMessage=function(k){return this.$ChatWelcomeMessage1[k];};var j=new i();f.exports=j;},null);
__d('GroupChatMessageBlockAlert',['DialogX','GenderConst','MercuryParticipants','React','XUIDialogBody.react','XUIDialogButton.react','XUIDialogFooter.react','XUIDialogTitle.react','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q={show:function(r,s,t){var u=new h({width:445},k.createElement('div',null,k.createElement(o,null,p._("See Conversations?")),k.createElement(l,null,this.dialogBodyText(r)),k.createElement(n,null,k.createElement(m,{action:'cancel',label:this.leaveGroupButton(),onClick:function(){return t();}}),k.createElement(m,{use:'confirm',action:'cancel',label:this.openChatButton(),onClick:function(){return s();}}))));u.show();},openChatButton:function(){return p._("Voir la conversation");},leaveGroupButton:function(){return p._("Quitter le groupe");},dialogBodyText:function(r){if(r.length!==1){return p._("Des personnes bloqu\u00e9es participent \u00e0 cette conversation. Si vous la voyez, vous recevrez leurs messages dans le groupe.");}else{var s='';j.get(r.pop(),function(t){switch(t.gender){case i.FEMALE_SINGULAR:s=p._("{name} est dans cette discussion de groupe, mais vous l\u2019avez bloqu\u00e9e. Si vous voyez cette conversation, vous verrez ses messages au groupe et elle verra les v\u00f4tres.",[p.param('name',t.short_name)]);break;case i.MALE_SINGULAR:s=p._("{name} est dans cette discussion de groupe, mais vous l\u2019avez bloqu\u00e9. Si vous voyez cette conversation, vous verrez ses messages au groupe et il verra les v\u00f4tres.",[p.param('name',t.short_name)]);break;default:s=p._("{name} est dans cette discussion de groupe, mais vous l\u2019avez bloqu\u00e9. Si vous voyez cette conversation, vous verrez ses messages au groupe et il verra les v\u00f4tres.",[p.param('name',t.short_name)]);}});return s;}}};f.exports=q;},null);
__d('MercuryBlockedParticipants',['MercuryIDs','MercuryActionType','MercuryDispatcher','MercurySingletonProvider','Set'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();m.getForFBID=function(o){return n.getForFBID(o);};m.get=function(){return n.get();};function m(o){this.$MercuryBlockedParticipants1=o;this.$MercuryBlockedParticipants2=new l();this.$MercuryBlockedParticipants3=j.getForFBID(this.$MercuryBlockedParticipants1);this.$MercuryBlockedParticipants3.subscribe('update-blocked-users',function(p,q){if(q.message_blocked_ids)this.$MercuryBlockedParticipants2=new l(q.message_blocked_ids);var r=q.actions||q.global_actions;for(var s=r,t=Array.isArray(s),u=0,s=t?s:s[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var v;if(t){if(u>=s.length)break;v=s[u++];}else{u=s.next();if(u.done)break;v=u.value;}var w=v;if(w.action_type!==i.UPDATE_BLOCKER_STATUS)continue;if(w.message_blocked){this.$MercuryBlockedParticipants4(w.thread_fbid);}else this.$MercuryBlockedParticipants5(w.thread_fbid);}}.bind(this));}m.prototype.getFBID=function(){return this.$MercuryBlockedParticipants1;};m.prototype.setIDs=function(o){this.$MercuryBlockedParticipants2=o;};m.prototype.getIDs=function(){return this.$MercuryBlockedParticipants6();};m.prototype.$MercuryBlockedParticipants6=function(){return this.$MercuryBlockedParticipants2;};m.prototype.$MercuryBlockedParticipants4=function(o){this.$MercuryBlockedParticipants2.add(h.getParticipantIDFromUserID(o));};m.prototype.$MercuryBlockedParticipants5=function(o){this.$MercuryBlockedParticipants2['delete'](h.getParticipantIDFromUserID(o));};m.prototype.isMessageBlocked=function(o){if(!o.is_canonical)return false;var p=o.participants.filter(function(q){return q!=h.getParticipantIDFromUserID(this.getFBID());}.bind(this));return !p.every(function(q){return !this.$MercuryBlockedParticipants2.has(q);}.bind(this));};m.prototype.isPresentInGroupThread=function(o){if(!o.is_canonical&&this.$MercuryBlockedParticipants7(o).length>0)return true;return false;};m.prototype.inGroupThread=function(o){if(o.is_canonical)return [];return this.$MercuryBlockedParticipants7(o);};m.prototype.$MercuryBlockedParticipants7=function(o){var p=o.participants.filter(function(r){return r!=h.getParticipantIDFromUserID(this.getFBID());}.bind(this)),q=p.filter(function(r){return this.$MercuryBlockedParticipants2.has(r)!==false;}.bind(this));return q;};var n=new k(m);f.exports=m;},null);
__d('MercuryLocalIDs',['PresenceUtil','randomInt'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j={generateMessageID:function(l){var m=l||Date.now(),n=i(0,4294967295),o=h.getSessionID();return '<'+m+':'+n+'-'+o+'@mail.projektitan.com>';},generateThreadID:function(l){return 'root:'+j.generateOfflineThreadingID(l);},generateOfflineThreadingID:function(l){var m=l||Date.now(),n=i(0,4294967295),o=('0000000000000000000000'+n.toString(2)).slice(-22),p=m.toString(2)+o;return k(p.slice(-63));}};function k(l){var m='';while(l!='0'){var n=0,o='';for(var p=0;p<l.length;p++){n=2*n+parseInt(l[p],10);if(n>=10){o+='1';n-=10;}else o+='0';}m=n.toString()+m;l=o.slice(o.indexOf('1'));}return m;}f.exports=j;},null);
__d('MercuryMessageObject',['BanzaiODS','MercuryActionStatus','MercuryActionType','MercuryIDs','MercuryLocalIDs','MercuryMessageClientState','MercuryMessageSourceTags','MercurySingletonProvider','MercurySourceType','MercuryThreads','MercuryTimePassed','MercurySendMessageFields','fbt','formatDate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();v.getForFBID=function(z){'use strict';return y.getForFBID(z);};v.get=function(){'use strict';return y.get();};function v(z){'use strict';this.$MercuryMessageObject1=z;this.$MercuryMessageObject2=q.getForFBID(z);}v.prototype.constructUserGeneratedMessageObject=function(z,aa,ba,ca,da){'use strict';var ea=w(this.$MercuryMessageObject1,j.USER_GENERATED_MESSAGE,aa,ba);if(typeof z=='string')z=z.replace(/^\s+/,'').replace(/\s+$/,'');ea.body=z;ea.has_attachment=false;ea.html_body=false;ea.attachments=[];ea.specific_to_list=ca||[];ea.creator_info=da;return ea;};v.prototype.constructStickerMessageObject=function(z,aa,ba){'use strict';var ca=w(this.$MercuryMessageObject1,j.USER_GENERATED_MESSAGE,aa,ba);ca.has_attachment=true;ca.html_body=false;ca.attachments=[];ca.sticker_id=z;ca.specific_to_list=[];return ca;};v.prototype.constructAttachmentMessageObject=function(z,aa){'use strict';var ba=w(this.$MercuryMessageObject1,j.USER_GENERATED_MESSAGE,z,aa);ba.attachments=[];ba.specific_to_list=[];return ba;};v.prototype.constructLogMessageObject=function(z,aa,ba,ca){'use strict';var da=w(this.$MercuryMessageObject1,j.LOG_MESSAGE,z,aa);da.log_message_type=ba;da.log_message_data=ca;if(ca&&ca.untypedData&&ca.untypedData.ttl)da.ephemeral_ttl_mode=ca.untypedData.ttl;return da;};v.prototype.normalizeNewMessage=function(z){'use strict';if(z.status===undefined)z.status=i.UNSENT;z.timestamp_absolute=t._("Aujourd\u2019hui").toString();z.offline_threading_id=z.offline_threading_id||l.generateOfflineThreadingID(z.timestamp);if(!z.offline_threading_id)h.bumpEntityKey('chat.web','invalid_otid_generated');z.message_id=z.message_id||z.offline_threading_id;var aa=k.getParticipantIDFromUserID(this.$MercuryMessageObject1);z.specific_to_list=z.specific_to_list||[];if(z.specific_to_list.length&&z.specific_to_list.indexOf(aa)===-1)z.specific_to_list.push(aa);if(!z.thread_id){z.thread_id='root:'+z.offline_threading_id;}else{var ba=this.$MercuryMessageObject2.getThreadMetaNow(z.thread_id);if(ba&&ba.ephemeral_ttl_mode!==null&&z.ephemeral_ttl_mode===undefined)z.ephemeral_ttl_mode=ba.ephemeral_ttl_mode;}if(z.specific_to_list.length==1){z.thread_id='user:'+this.$MercuryMessageObject1;}else if(z.specific_to_list.length==2){var ca=z.specific_to_list[0]==aa?z.specific_to_list[1]:z.specific_to_list[0];z.thread_id=k.getThreadIDFromParticipantID(ca);}if(!z.specific_to_list.length){var da=k.tokenize(z.thread_id),ea=da.type,fa=da.value;if(ea=='user')z.specific_to_list=['fbid:'+fa,aa];}if(!z[s.MANUAL_RETRY_CNT])z[s.MANUAL_RETRY_CNT]=0;};v.prototype.normalizeResendMessage=function(z){'use strict';z.status=i.RESENDING;z.timestamp=Date.now();z[s.MANUAL_RETRY_CNT]+=1;};v.prototype.normalizeAddAttachmentPlaceholder=function(z,aa,ba){'use strict';if(ba.preview_attachments.length>0){z.has_attachment=true;z.preview_attachments=ba.preview_attachments;}z.client_state=m.DO_NOT_SEND_TO_SERVER;z.status=i.RESENDING;z.upload_id=aa;};function w(z,aa,ba,ca){var da=x(ba)?[n.CHAT]:[],ea=Date.now(),fa=u(new Date(ea),'g:ia'),ga={action_type:aa,thread_id:ca,author:k.getParticipantIDFromUserID(z),author_email:null,timestamp:ea,timestamp_absolute:new Date(ea).toLocaleDateString(),timestamp_relative:fa,timestamp_time_passed:r.TODAY,is_unread:false,is_forward:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,is_spoof_warning:false,source:ba,source_tags:da};return ga;}function x(z){switch(z){case p.CHAT_WEB:case p.CHAT_JABBER:case p.CHAT_IPHONE:case p.CHAT_MEEBO:case p.CHAT_ORCA:case p.CHAT_TEST:case p.CHAT:case p.DESKTOP:return true;default:return false;}}var y=new o(v);f.exports=v;},null);
__d('MercuryMessageActions',['AsyncRequest','MessagingTag','MercuryActionType','MercuryDispatcher','MercuryMessageObject','MercuryPayloadSource','MercuryServerRequests','MercurySingletonMixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();function p(q){this.$MercuryMessageActions1=q;this.$MercuryMessageActions2=l.getForFBID(this.$MercuryMessageActions1);this.__serverRequests=n.getForFBID(this.$MercuryMessageActions1);this.__dispatcher=k.getForFBID(this.$MercuryMessageActions1);}p.prototype.send=function(q,r,s){r=r||Function.prototype;this.$MercuryMessageActions2.normalizeNewMessage(q);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers['extends']({},q),m.CLIENT_SEND_MESSAGE));this.__serverRequests.sendNewMessage(q,s);r(q.thread_id);};p.prototype.resend=function(q,r){var s=babelHelpers['extends']({},q);this.$MercuryMessageActions2.normalizeResendMessage(s);this.send(s,undefined,r);};p.prototype.addAttachmentPlaceholder=function(q,r,s){this.$MercuryMessageActions2.normalizeAddAttachmentPlaceholder(q,r,s);this.$MercuryMessageActions2.normalizeNewMessage(q);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers['extends']({},q),m.CLIENT_SEND_MESSAGE));};p.prototype.cancelAttachmentPlaceholder=function(q,r){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:q,upload_data:r,action_type:j.CANCEL_ATTACHMENT_PLACEHOLDER},m.CLIENT_SEND_MESSAGE));};p.prototype.confirmAttachmentPlaceholder=function(q,r){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:q,upload_data:r,action_type:j.CONFIRM_ATTACHMENT_PLACEHOLDER},m.CLIENT_SEND_MESSAGE));};p.prototype['delete']=function(q,r,s){this.__dispatcher.handleUpdate(this.$MercuryMessageActions3(q,r,j.DELETE_MESSAGES,s||m.CLIENT_DELETE_MESSAGES));};p.prototype.unwrap=function(q){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({thread_id:q.thread_id,unwrapped_message_id:q.message_id,action_type:j.UNWRAP_MESSAGE},m.CLIENT_UNWRAP_MESSAGE));};p.prototype.__constructClientSingleMessagePayload=function(q,r){return {actions:[q],from_client:true,payload_source:r};};p.prototype.$MercuryMessageActions4=function(q,r){return {actions:[q],from_client:false,payload_source:r};};p.prototype.$MercuryMessageActions3=function(q,r,s,t){return {actions:[{action_type:s,action_id:null,thread_id:q,message_ids:r}],from_client:true,payload_source:t};};Object.assign(p,o);f.exports=p;},null);
__d('MercuryViewer',['CurrentUser','MercuryAssert'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j='fbid:'+h.getID(),k={getID:function(){return j;},isViewer:function(l){i.isParticipantID(l);return l===j;}};f.exports=k;},null);
__d("XMercuryThreadLikeIconController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/like_icon\/",{emoji:{type:"String",defaultValue:""}});},null);
__d("XMessagingSaveNicknameController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/save_thread_nickname\/",{source:{type:"Enum",required:true,enumType:1}});},null);
__d("XMessagingSaveThreadColorController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/save_thread_color\/",{source:{type:"Enum",required:true,enumType:1}});},null);
__d("XMessagingSaveThreadEmojiController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/save_thread_emoji\/",{source:{type:"Enum",required:true,enumType:1}});},null);
__d("XMessengerNotificationsSettingsDialogController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/notifications\/settings\/dialog\/",{thread_key_id:{type:"String",required:true},modify:{type:"Bool",defaultValue:false},__asyncDialog:{type:"Int"}});},null);
__d("XNFXMessengerBlockActionController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/nfx\/block_messages\/",{thread_fbid:{type:"Int",required:true},av:{type:"Int"},location:{type:"Enum",required:true,enumType:1},__asyncDialog:{type:"Int"}});},null);
__d('MercuryThreadActions',['AsyncDialog','AsyncRequest','EmojiLikeConstants','IrisProtocolMessageLifetime','MercuryActionType','MercuryAPIArgsSource','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessengerBlockingUtils','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonMixin','MercurySourceType','MercuryViewer','MessagingGenericAdminTextType','MessagingTag','XNFXMessengerBlockActionController','URI','XMercuryThreadLikeIconController','XMessagingSaveNicknameController','XMessagingSaveThreadColorController','XMessagingSaveThreadEmojiController','MercuryAssert','XMessengerNotificationsSettingsDialogController','cssVar','MercuryMessageActions','MercuryMessageObject','MercuryThreads','MercuryThreadIDMap'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){'use strict';if(c.__markCompiled)c.__markCompiled();var ia=c('MercuryMessageActions').get(),ja=c('MercuryMessageObject').get(),ka=c('MercuryThreads').get(),la=c('MercuryThreadIDMap').get();function ma(na){this.$MercuryThreadActions1=na;this.__serverRequests=t.getForFBID(this.$MercuryThreadActions1);this.__dispatcher=n.getForFBID(this.$MercuryThreadActions1);this.__payloadPreprocessor=s.getForFBID(this.$MercuryThreadActions1);}ma.prototype.markRead=function(na,oa){this.batchMarkRead([na],oa);};ma.prototype.batchMarkRead=function(na,oa){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(na,true,oa));};ma.prototype.markUnread=function(na,oa){this.batchMarkUnread([na],oa);};ma.prototype.batchMarkUnread=function(na,oa){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(na,false,oa));};ma.prototype.markSeen=function(na,oa){this.__dispatcher.handleUpdate(this.__constructClientPayload([na],l.MARK_THREAD_SEEN,r.CLIENT_MARK_THREAD_SEEN,{persistent:oa}));};ma.prototype.archive=function(na,oa){this.batchArchive([na],oa);};ma.prototype.batchArchive=function(na,oa){na.forEach(function(pa){this.__serverRequests.changeThreadArchivedStatus(pa,true,oa);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(na,true));};ma.prototype.unarchive=function(na,oa){this.batchUnarchive([na],oa);};ma.prototype.batchUnarchive=function(na,oa){na.forEach(function(pa){this.__serverRequests.changeThreadArchivedStatus(pa,false,oa);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(na,false));};ma.prototype.markSpam=function(na,oa){this.batchMarkSpam([na],oa);};ma.prototype.batchMarkSpam=function(na,oa){na.forEach(function(pa){this.__serverRequests.markThreadSpam(pa,oa);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(na,y.SPAM));};ma.prototype.unmarkSpam=function(na,oa){this.batchUnmarkSpam([na],oa);};ma.prototype.batchUnmarkSpam=function(na,oa){na.forEach(function(pa){this.__serverRequests.unmarkThreadSpam(pa,oa);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(na,y.INBOX));};ma.prototype.changeFolder=function(na,oa){this.batchChangeFolder([na],oa);};ma.prototype.batchChangeFolder=function(na,oa){na.forEach(function(pa){this.__serverRequests.changeThreadFolder(pa,oa);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(na,oa));};ma.prototype['delete']=function(na,oa){this.batchDelete([na],oa);};ma.prototype.batchDelete=function(na,oa){na.forEach(function(pa){this.__serverRequests.deleteThread(pa,oa);}.bind(this));this.__dispatcher.handleUpdate(this.__constructClientPayload(na,l.DELETE_THREAD,r.CLIENT_DELETE_THREAD));};ma.prototype.openNotificationSettings=function(na){fa.isThreadID(na);this.__threadIDMap.getServerIDFromClientID(na,function(oa){var pa=ga.getURIBuilder().setString('thread_key_id',oa).setBool('modify',false).getURI();new i().setURI(pa).send();});};ma.prototype.unmute=function(na){this.updateMuteSetting(na,0);};ma.prototype.updateMuteSetting=function(na,oa){this.__serverRequests.changeMutingOnThread(na,oa);this.__dispatcher.handleUpdate(this.__constructClientPayload([na],l.CHANGE_MUTE_SETTINGS,r.CLIENT_CHANGE_MUTE_SETTINGS,{mute_settings:oa}));};ma.prototype.blockMessages=function(na){var oa=z.getURIBuilder().setInt('thread_fbid',o.getUserIDFromThreadID(na)).setEnum('location','www_chat_head').getURI();h.send(new i(oa));};ma.prototype.unblockMessages=function(na){var oa=JSON.stringify({reportable_ent_token:o.getUserIDFromThreadID(na),initial_action_name:q.block_messages});new i(new aa('/ajax/nfx/messenger_undo_block').addQueryData({story_location:'messenger',context:oa})).send();};ma.prototype.turnOffSecretMode=function(na){if(ka.isEmptyLocalThread(na))return;ia.send(ja.constructLogMessageObject(v.TITAN_WEB,na,p.GENERIC_ADMIN_TEXT,{message_type:x.THREAD_EPHEMERAL_SEND_MODE,untypedData:{ttl:k.TTL_OFF}}),null,m.WEBMESSENGER);};ma.prototype.turnOnSecretMode=function(na){if(ka.isEmptyLocalThread(na))return;ia.send(ja.constructLogMessageObject(v.TITAN_WEB,na,p.GENERIC_ADMIN_TEXT,{message_type:x.THREAD_EPHEMERAL_SEND_MODE,untypedData:{ttl:k.TTL_1HOUR}}),null,m.WEBMESSENGER);};ma.prototype.leaveGroup=function(na){if(!ka.isEmptyLocalThread(na))ia.send(ja.constructLogMessageObject(v.TITAN_WEB,na,p.UNSUBSCRIBE,{removed_participants:[w.getID()]}),null,m.WEBMESSENGER);};ma.prototype.changeThreadColor=function(na,oa,pa){if(ka.isEmptyLocalThread(na))return;la.getServerIDFromClientID(na,function(qa){var ra={};if(oa!="#0084ff")ra.color_choice=oa;ra.thread_or_other_fbid=qa;var sa=da.getURIBuilder().setEnum('source',pa).getURI();new i(sa).setMethod('POST').setData(ra).send();});};ma.prototype.changeThreadEmoji=function(na,oa,pa){if(ka.isEmptyLocalThread(na))return;la.getServerIDFromClientID(na,function(qa){var ra={};if(oa!=j.THUMBS_UP_EMOJI)ra.emoji_choice=oa;ra.thread_or_other_fbid=qa;var sa=ea.getURIBuilder().setEnum('source',pa).getURI();new i(sa).setMethod('POST').setData(ra).send();});};ma.prototype.changeThreadNicknames=function(na,oa,pa,qa){if(ka.isEmptyLocalThread(na))return;la.getServerIDFromClientID(na,function(ra){var sa={thread_or_other_fbid:ra,participant_id:oa,nickname:pa},ta=ca.getURIBuilder().setEnum('source',qa).getURI();new i(ta).setMethod('POST').setData(sa).send();});};ma.prototype.addParticipants=function(na,oa){this.__dispatcher.handleUpdate(this.__constructClientPayload([na],l.ADD_PARTICIPANTS,r.CLIENT_ADD_PARTICIPANTS,{participants:oa}));};ma.prototype.unpinThread=function(na){this.__serverRequests.unpinThread(na);this.__dispatcher.handleUpdate(this.__constructClientPayload([na],l.UNPIN_THREAD,r.CLIENT_UNPIN_THREAD));};ma.prototype.updateCustomLike=function(na,oa){var pa=ba.getURIBuilder().setString('emoji',oa).getURI();new i().setURI(pa).setHandler(function(qa){this.__dispatcher.handleUpdate(this.__constructClientPayload([na],l.UPDATE_CUSTOM_LIKE,r.CLIENT_CHANGE_CUSTOM_LIKE,{custom_like:qa.getPayload()}));}.bind(this)).send();};ma.prototype.movePendingToInbox=function(na){this.__dispatcher.handleUpdate(this.__constructClientPayload([na],l.MOVE_PENDING_TO_INBOX,r.CLIENT_MOVE_PENDING_TO_INBOX));};ma.prototype.updateSnippet=function(na,oa){this.__dispatcher.handleUpdate(this.__constructClientPayload([na],l.UPDATE_SNIPPET,r.CLIENT_UPDATE_SNIPPET,{deleted_ids:oa}));};ma.prototype.$MercuryThreadActions2=function(na,oa,pa){return this.__constructClientPayload(na,l.CHANGE_READ_STATUS,r.CLIENT_CHANGE_READ_STATUS,{mark_as_read:oa,source:pa});};ma.prototype.$MercuryThreadActions3=function(na,oa){return this.__constructClientPayload(na,l.CHANGE_ARCHIVED_STATUS,r.CLIENT_CHANGE_ARCHIVED_STATUS,{archived:oa});};ma.prototype.$MercuryThreadActions4=function(na,oa){return this.__constructClientPayload(na,l.CHANGE_FOLDER,r.CLIENT_CHANGE_FOLDER,{new_folder:oa});};ma.prototype.__constructClientPayload=function(na,oa,pa,qa){return {actions:na.map(function(ra){return babelHelpers['extends']({action_type:oa,action_id:null,thread_id:ra},qa);}),from_client:true,payload_source:pa};};Object.assign(ma,u);f.exports=ma;},null);
__d('ChatOpenTabImpl',['ChatApp','ChatOpenTabEventLogger','ChatWelcomeMessage','DOM','GroupChatMessageBlockAlert','LogHistory','MercuryIDs','Toggler','csx','requireWeak','MercuryBlockedParticipants','MercuryThreadActions','MercuryThreadIDMap','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=c('MercuryBlockedParticipants').get(),s=c('MercuryThreadActions').get(),t=c('MercuryThreadIDMap').get(),u=c('MercuryThreads').get(),v=null;q('ChatTabModel',function(x){return v=x;});var w={canOpenTab:function(){return !!(h&&!h.isHidden());},openEmptyTab:function(x,y,z){if(this.canOpenTab()&&v){var aa=v.getEmptyTab();this._openClientTab(aa,null);this._logChatOpenTabEvent(y,aa,null,z);this._closeJewelFlyout();}},openThreadTab:function(x,y,z,aa,ba){if(!n.isValid(x)){t.getClientIDFromServerID(x,function(ca){w.openThreadTabImpl(ca,y,z,aa,ba);});}else w.openThreadTabImpl(x,y,z,aa,ba);},openThreadTabImpl:function(x,y,z,aa,ba){u.getThreadMeta(x,function(ca){if(r.isPresentInGroupThread(ca)){l.show(r.inGroupThread(ca),function(){this.openClientTab(x,y,z,aa,ba);}.bind(this),function(){s.leaveGroup(x);});}else this.openClientTab(x,y,z,aa,ba);}.bind(this));},openClientTab:function(x,y,z,aa,ba){this._openClientTab(x,aa,ba);this._logChatOpenTabEvent(y,x,null,z);this._closeJewelFlyout();},openUserTab:function(x,y,z){var aa=n.getThreadIDFromUserID(x);this._openClientTab(aa);this._logChatOpenTabEvent(y,aa,x,z);},openPageTab:function(x,y,z){var aa=n.getThreadIDFromUserID(y);u.getThreadMeta(aa,function(ba){if(x&&x.length>0){var ca=(Date.now()-ba.timestamp)/1000,da=ca/3600;if(ba.message_count===0||da>24)j.setWelcomeMessage(aa,n.getParticipantIDFromUserID(y),x);}});this._openClientTab(aa);this._logChatOpenTabEvent(z,aa,y);},_closeJewelFlyout:function(){var x=k.scry(document,"div._1z4y")[0],y=o.getInstance(x);if(y&&y.getActive())y.hide();},_openClientTab:function(x,y,z){u.getThreadMeta(x,function(aa){if(!this.canOpenTab())m.getInstance('mercury').error('Unable to open chat tab',x);h.tabController.openTab(x,h.tabsViewport,y,!!z);}.bind(this));},_logChatOpenTabEvent:function(x,y,z,aa){i.log(x,y,z,aa);}};f.exports=w;},null);
__d('ChatDispatcher',['ExplicitRegistrationDispatcher','LogHistory'],function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=i.getInstance('chat_dispatcher');j=babelHelpers.inherits(m,h);k=j&&j.prototype;m.prototype.dispatch=function(n){l.debug('action',n.type);k.dispatch.call(this,n);};function m(){j.apply(this,arguments);}f.exports=new m({strict:false});},null);
__d('ChatSidebarActionTypes',['keyMirror'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=h({INIT:null,LOADED:null,SET_ENABLED:null,SHOW:null,TOGGLE:null});},null);
__d('ChatSidebarStore',['ChatDispatcher','ChatOptionsInitialData','ChatSidebarActionTypes','FluxStore','SidebarType','performanceAbsoluteNow'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';var n,o;if(c.__markCompiled)c.__markCompiled();n=babelHelpers.inherits(p,k);o=n&&n.prototype;function p(){o.constructor.call(this,h);this.$ChatSidebarStore2={initialized:false,initTime:m(),loaded:false,enabled:!!i.sidebar_mode,visible:null};this.$ChatSidebarStore1={};}p.prototype.__onDispatch=function(q){var r=q.type;this.$ChatSidebarStore1=babelHelpers['extends']({},this.$ChatSidebarStore2);switch(r){case j.INIT:if(!this.$ChatSidebarStore1.initialized)this.$ChatSidebarStore2.initTime=m();this.$ChatSidebarStore2.initialized=true;break;case j.LOADED:this.$ChatSidebarStore2.loaded=true;break;case j.SHOW:this.$ChatSidebarStore2.visible=q.sidebarType;break;case j.SET_ENABLED:this.$ChatSidebarStore2.enabled=q.enabled;this.$ChatSidebarStore2.visible=q.sidebarType;break;case j.TOGGLE:this.$ChatSidebarStore2.enabled=!this.$ChatSidebarStore2.enabled;this.$ChatSidebarStore2.visible=this.$ChatSidebarStore2.enabled?q.visible:l.BUDDYLIST;break;}for(var s in this.$ChatSidebarStore2)if(this.$ChatSidebarStore2.hasOwnProperty(s))if(this.$ChatSidebarStore2[s]!==this.$ChatSidebarStore1[s]){this.__emitChange();break;}};p.prototype.getPrevState=function(){return this.$ChatSidebarStore1;};p.prototype.getState=function(){return this.$ChatSidebarStore2;};p.prototype.isInitialized=function(){return this.$ChatSidebarStore2.initialized;};p.prototype.isLoaded=function(){return this.$ChatSidebarStore2.loaded;};p.prototype.isEnabled=function(){return this.$ChatSidebarStore2.enabled;};p.prototype.getInitTime=function(){return this.$ChatSidebarStore2.initTime;};p.prototype.getVisibleType=function(){return this.$ChatSidebarStore2.visible;};f.exports=new p();},null);
__d('OrderedFriendsList',['AvailableListConstants','MercuryIDs','PresenceStatus','SearchableEntry','ShortProfiles','WorkModeConfig','createArrayFromMixed','isValidUniqueID','InitialChatFriendsList'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=[],q=[],r={},s=[],t={},u=[];function v(x){return i.isValid(x)?x:i.getParticipantIDFromUserID(x);}var w={contains:function(x){return x in r;},getList:function(){if(m.is_work_user)return n(p);w.reRank();var x=n(p);x=x.filter(function(y){var z=l.getNowUnsafe(y);return !z||z.type=='friend'||z.is_nonfriend_messenger_contact;});return x;},getSearchableEntries:function(x,y){var z=w.getList();l.getMulti(z.slice(0,x),function(aa){var ba=[];for(var ca in aa)ba.push(w.normalizeProfileEntry(aa[ca],ca));var da=w.getGroups().map(w.normalizeThreadEntry);y(ba.concat(da).filter(function(ea){return !!ea;}).sort(function(ea,fa){return ea.getOrder()-fa.getOrder();}));});},normalizeProfileEntry:function(x,y){var z=x.searchTokens||[],aa=x.name,ba=null;if(x.threadNickname){aa=x.threadNickname;ba=x.name;}return new k({uniqueID:x.id||y,keywordString:z.join(' '),order:w.getRank(x.id||y),photo:x.thumbSrc,title:aa,subtitle:ba,type:x.type,uri:x.uri,auxiliaryData:{isMessengerUser:x.is_messenger_user}});},normalizeThreadEntry:function(x,y){var z=x.mercury_thread,aa=x.participants_to_render.map(function(fa){return babelHelpers['extends']({},fa,{id:v(fa.id)});});z.participants=z.participants.map(v);var ba=x.text,ca=null;if(!ba)ba=z.name;var da=aa.map(function(fa){return fa.name;}).join(', ');if(!ba){ba=da;}else ca=da;var ea=x.uid;if(!ba||!o(ea))return null;return new k({uniqueID:ea,order:y,photo:z.image_src,title:ba,subtitle:ca,type:'thread',auxiliaryData:{participantsToRender:aa,thread:z}});},getRank:function(x){return x in r?r[x]:p.length;},getActiveList:function(){if(s.length>0)return s;return w.getList();},getActiveRank:function(x){return x in t?t[x]:w.getRank(x);},reRank:function(){p=[];var x=0;u.forEach(function(y){var z=y.slice(0,-2),aa=y.slice(-1);if(j.get(z)==aa){p[x]=z;r[z]=x++;}});},rankActive:function(){var x=0;u.forEach(function(y){var z=y.slice(0,-2),aa=y.slice(-1);if(aa==h.ACTIVE){s[x]=z;t[z]=x++;}});},getGroups:function(){return q;}};(function(){var x=c('InitialChatFriendsList');p=x.list.length?x.list:[];q=x.groups||[];if(x.shortProfiles)l.setMulti(x.shortProfiles);if(!m.is_work_user){u=p.slice();w.rankActive();w.reRank();}else p.forEach(function(y,z){r[y]=z;});})();f.exports=b.OrderedFriendsList||w;},null);
__d('ChatSidebarVisibility',['ChatConfig','ChatSidebarStore','OrderedFriendsList','getViewportDimensions'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=h.get('sidebar.min_friends'),m=h.get('sidebar.minimum_width'),n={getViewport:function(){return k.withoutScrollbars();},hasLowFriendCount:function(){return j.getActiveList().length<=l;},isViewportCapable:function(o){o=o||n.getViewport();return o.width>m;},shouldShowSidebar:function(o){return i.isEnabled()&&n.shouldShowSidebarIgnoreEnabled(o);},shouldShowSidebarIgnoreEnabled:function(o){return n.isViewportCapable(o)&&!n.hasLowFriendCount();}};f.exports=n;},null);
__d('ChatSidebarActions',['ChatDispatcher','ChatSidebarActionTypes','ChatSidebarVisibility','SidebarType'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();function l(o){if(j.shouldShowSidebar(o))return k.SIDEBAR;return k.BUDDYLIST;}function m(){if(j.shouldShowSidebarIgnoreEnabled())return k.SIDEBAR;return k.BUDDYLIST;}var n={init:function(){h.dispatch({type:i.INIT});},loaded:function(){h.dispatch({type:i.LOADED});},disable:function(){h.dispatch({type:i.SET_ENABLED,enabled:false,sidebarType:k.BUDDYLIST});},enable:function(){h.dispatch({type:i.SET_ENABLED,enabled:true,sidebarType:m()});},show:function(o){h.dispatch({type:i.SHOW,sidebarType:l(o)});},toggle:function(){h.dispatch({type:i.TOGGLE,sidebarType:l()});}};f.exports=n;},null);
__d('FBRTCDispatcher',['Dispatcher_DEPRECATED'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);
__d('FBRTCStore',['FBRTCDispatcher','FluxStore'],function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();j=babelHelpers.inherits(l,i);k=j&&j.prototype;function l(){k.constructor.call(this,h);}l.prototype.__emitChange=function(){this.__emitter.emit(this.__changeEvent);};f.exports=l;},null);
__d('FBRTCCallBlockingStore',['Arbiter','AsyncRequest','BanzaiLogger','ChannelConstants','FBRTCDispatcher','FBRTCStore','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';var o,p;if(c.__markCompiled)c.__markCompiled();var q=false,r=0,s=null,t='call_block_setting_changed';o=babelHelpers.inherits(u,m);p=o&&o.prototype;u.prototype.init=function(v){this.$FBRTCCallBlockingStore1(v);h.subscribe(k.getArbiterType('videocall_block_setting'),this.$FBRTCCallBlockingStore2.bind(this));};u.prototype.__onDispatch=function(v){if(v.type!==t)return;this.$FBRTCCallBlockingStore1(v.data);};u.prototype.$FBRTCCallBlockingStore1=function(v){switch(v){case 0:q=false;this.$FBRTCCallBlockingStore3();break;case -1:q=true;this.$FBRTCCallBlockingStore3();break;default:q=true;this.$FBRTCCallBlockingStore4(v);}this.__emitChange();};u.prototype.$FBRTCCallBlockingStore4=function(v){if(s===null)s=n(this.turnOnVideoCalling.bind(this),v*1000);};u.prototype.getBlockingStatus=function(){return q;};u.prototype.turnOnVideoCalling=function(){new i('/ajax/chat/settings.php').setHandler(this.$FBRTCCallBlockingStore5.bind(this)).setData({call_blocked_until:0}).send();};u.prototype.turnOffVideoCalling=function(v){r=v;new i('/ajax/chat/settings.php').setHandler(this.$FBRTCCallBlockingStore6.bind(this)).setData({call_blocked_until:v}).send();};u.prototype.$FBRTCCallBlockingStore3=function(){if(s){clearTimeout(s);s=null;}};u.prototype.$FBRTCCallBlockingStore5=function(){l.dispatch({type:t,data:0});j.log('VideoCallLoggerConfig',{event:t,message:'enable'});};u.prototype.$FBRTCCallBlockingStore6=function(){l.dispatch({type:t,data:r});j.log('VideoCallLoggerConfig',{event:t,message:'disable_'+r});};u.prototype.$FBRTCCallBlockingStore2=function(v,w){l.dispatch({type:t,data:w.obj.value});};function u(){o.apply(this,arguments);}f.exports=new u();},null);
__d('ChatOptions',['Arbiter','ChannelConstants','ChatSidebarActions','FBRTCCallBlockingStore','JSLogger','PresenceUtil','ChatOptionsInitialData'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=l.create('chat_options'),o={};(function(){var q=c('ChatOptionsInitialData');for(var r in q){var s=q[r];if(r==='call_blocked_until'){k.init(s);}else o[r]=!!s;}})();var p=Object.assign(new h(),{getSetting:function(q){return o[q];},setSetting:function(q,r,s){if(q==='sidebar_mode'){r?j.enable():j.disable();return;}if(this.getSetting(q)==r)return;if(s){s='from_'+s;n.log(s,{name:q,new_value:r,old_value:this.getSetting(q)});}o[q]=!!r;h.inform('chat/option-changed',{name:q,value:r});}});h.subscribe(i.getArbiterType('setting'),function(q,r){var s=r.obj;if(s.window_id===m.getSessionID())return;p.setSetting(s.setting,!!s.value,'channel');});h.subscribe(l.DUMP_EVENT,function(q,r){r.chat_options=o;});f.exports=p;},null);
__d('ChatPerfInstrumentation',['Promise','BanzaiLogger','ChatPerfEvent','emptyFunction','performanceAbsoluteNow'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m={_startTime:(Number),init:function(){this._startTime=l();return new h(function(n){return n();});},_log:function(event){i.log('ChatPerfLoggerConfig',{event:event,duration:l()-this._startTime});},logTTI:function(){this.logTTI=k;this._log(j.TTI);},logCHAT_CONVERSATION_TTI:function(){this.logCHAT_CONVERSATION_TTI=k;this._log(j.CHAT_CONVERSATION_TTI);}};f.exports=m;},null);
__d('ChatActivity',['Arbiter','Event','JSLogger','MercuryConfig','PresenceState','UserActivity'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=k.activity_limit||60000,o=k.idle_limit||1800000,p=k.idle_poll_interval||300000,q=j.create('chat_activity'),r=Date.now(),s=true;function t(){var x=Date.now();return !!(s&&x-r<n);}var u=Object.assign(new h(),{isActive:t});function v(){var x=r;r=Date.now();if(r-x>o){q.debug('idle_to_active',x);l.doSync();}u.inform('activity');}i.listen(window,'focus',function(){s=true;v();});i.listen(window,'blur',function(){s=false;});m.subscribe(function(){v();});function w(x){var y=x&&x.at&&l.verifyNumber(x.at);if(typeof y!=='number')y=null;return y||0;}setInterval(function(){var x=Date.now(),y=w(l.get()),z=Math.max(r,y);if(x-z>o){q.debug('idle',{cookie:y,local:r});u.inform('idle',x-z);}},p);l.registerStateStorer(function(x){var y=w(x);if(y<r)x.at=r;return x;});h.subscribe(j.DUMP_EVENT,function(x,y){y.chat_activity={activity_limit:n,idle_limit:o,idle_poll_interval:p,last_active_time:r};});f.exports=u;},null);
__d('ChatMentionsNotifications',['fbt','CurrentUser','MercuryParticipants'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={notifyIfMessageToMe:function(l){var m='fbid:'+i.getID(),n=l.body;j.get(m,function(o){var p=new RegExp(o.short_name,"i");if(p.test(n))k._notify(l);});},_notify:function(l){var m=48,n=l.body;if(n.length>m)n=n.substr(0,m-3)+"...";new Notification(h._("Vous avez \u00e9t\u00e9 identifi\u00e9(e) dans un message\u00a0!"),{body:n,icon:"http://facebook.com//images/icons-large/fb-xl.png"});}};f.exports=k;},null);
__d('ChatBehavior',['Arbiter','AvailableList','AvailableListConstants','ChatNotificationConstants'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=false,m=i.getWebChatNotification&&i.getWebChatNotification(),n=l,o=true,p=Object.assign(new h(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return m!==k.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return n;},showsTabUnreadUI:function(){return o;}});function q(){p.inform(p.ON_CHANGED);}i.subscribe&&i.subscribe(j.ON_CHAT_NOTIFICATION_CHANGED,function(){var r=m,s=i.getWebChatNotification();m=s;if(r!=s)q();});h.subscribe('chat/set_does_page_occlude_tabs',function(r,s){n=!!s;q();});h.subscribe('chat/set_show_tab_unread_ui',function(r,s){o=!!s;q();});f.exports=p;},null);
__d('ChatCookieInterface',['ChatConfig','InitialServerTime','MercuryIDs','LogHistory','PresenceState','PresenceUtil'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=k.getInstance('chat_cookie'),o=i.serverTime,p=h.get('tab_max_load_age')||3600000,q=o-p,r={store:function(v,w){if(v.uct2==w.lastChangeTime)return v;var x=u(v,w),y={};if(!x){y.old_tabs=v&&v.t2&&JSON.stringify(v.t2);y.old_promoted=v&&v.lm2;y.old_time=v&&v.uct2;y.old_reason=v&&v.tr;y.old_window=v&&v.tw;var z=[];w.tabs.forEach(function(aa){if(!aa.fragile||aa.server_id){var ba={i:aa.fragile?j.getThreadIDFromThreadFBID(aa.server_id):aa.id,si:aa.server_id};if(aa.raised)ba.r=1;z.push(ba);}});v.t2=z;v.lm2=w.promotedID;v.uct2=w.lastChangeTime;v.tr=w.lastChangeReason;v.tw=m.getSessionID();n.debug('store','{}');}else n.warn('store_bad_state','{}');return v;},load:function(v,w){if(!v){n.warn('load_bad_state','{}');return false;}var x=u(v,w);if(!x||x===w.lastChangeTime)return false;w.lastChangeTime=x;w.lastChangeReason='load';var y=s(w,v.t2,v.lm2||null),event='load';if(!w.isInitialized)event+='_init';n.log(event,'{}');return y;},tabsChanged:function(){return t.apply(undefined,arguments);}};function s(v,w,x){var y;if(!t(v,w,x))return false;var z=v.tabs.filter(function(ca){return !!ca.fragile;}),aa={};v.promotedID=null;v.tabs=w.map(function(ca){var da={id:ca.i,server_id:ca.si};if(da.id==x)v.promotedID=da.id;if(ca.r)da.raised=true;aa[da.id]=da;return da;});v.tabs=v.tabs.filter(function(ca){return !!ca;});if(v.localRaised)for(var ba in v.localRaised)if(!aa[ba]||!aa[ba].raised)delete v.localRaised[ba];z=z.filter(function(ca){return !aa[ca.id];});(y=v.tabs).push.apply(y,z);return true;}function t(v,w,x){if(x&&x!=v.promotedID)return true;var y=v.tabs.filter(function(ba){return !ba.fragile||ba.server_id;});if(w.length!=y.length)return true;for(var z=0,aa=w.length;z<aa;z++)if(!!w[z].r!==y[z].raised||!w[z].si&&w[z].i!==y[z].id||w[z].si&&w[z].si!==y[z].server_id)return true;return false;}function u(v,w){var x=l.verifyNumber(v.uct2);if(!x||typeof x!=='number'){n.warn('bad_cookie_version','{}');return null;}if(x<w.lastChangeTime||x<q)return null;return x;}f.exports=r;},null);
__d('ChatTabActions',['ChatDispatcher','keyMirror'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=i({CLOSE_TAB:null,CLOSE_ALL_TABS:null,CLOSE_FRAGILE_TABS:null,LOWER_TAB:null,OPEN_FRAGILE_TAB:null,OPEN_TAB:null,PERSIST_LOCAL_STATE:null,PROMOTE_TAB:null,RAISE_TAB:null}),k={Types:j,closeTab:function(l,m){h.dispatch({actionType:j.CLOSE_TAB,reason:m,threadID:l});},closeAllTabs:function(){h.dispatch({actionType:j.CLOSE_ALL_TABS});},closeFragileTabs:function(){h.dispatch({actionType:j.CLOSE_FRAGILE_TABS});},lowerTab:function(l){h.dispatch({actionType:j.LOWER_TAB,threadID:l});},openFragileTab:function(l){h.dispatch({actionType:j.OPEN_FRAGILE_TAB,threadID:l});},openTab:function(l){h.dispatch({actionType:j.OPEN_TAB,threadID:l});},persistLocalState:function(){h.dispatch({actionType:j.PERSIST_LOCAL_STATE});},promoteTab:function(l){h.dispatch({actionType:j.PROMOTE_TAB,threadID:l});},raiseTab:function(l,m,n){h.dispatch({actionType:j.RAISE_TAB,signatureID:n,threadID:l,userAction:m});}};f.exports=k;},null);
__d('MercuryTimestampTracker',['MercuryActionType','MercuryPayloadSource','MercurySingletonMixin','MercuryDispatcher'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();function l(m){this._fbid=m;this._dispatcher=k.getForFBID(this._fbid);this._lastTimestamp=0;this._dispatcher.subscribe('update-messages',function(n,o){if(!o.actions||!o.actions.length)return;if(o.payload_source==i.CLIENT_SEND_MESSAGE||o.payload_source==i.UNKNOWN)return;for(var p=0;p<o.actions.length;p++){var q=o.actions[p],r=q.action_type;if(r==h.USER_GENERATED_MESSAGE&&q.thread_id&&q.timestamp>this._lastTimestamp)this._lastTimestamp=q.timestamp;}}.bind(this));}Object.assign(l.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});Object.assign(l,j);f.exports=l;},null);
__d('ChatTabModel',['Arbiter','ChatBehavior','ChatDispatcher','ChatConfig','ChatCookieInterface','ChatTabActions','EventEmitter','InitialServerTime','LogHistory','JSLogger','MercuryAssert','MercuryIDs','MercuryLocalIDs','PresenceState','PresenceUtil','MercuryThreadIDMap','MercuryThreads','MercuryTimestampTracker'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=c('MercuryThreadIDMap').get(),x=c('MercuryThreads').get(),y=c('MercuryTimestampTracker').get(),z=o.serverTime,aa=k.get('tab_max_load_age')||3600000,ba=20,ca=new n(),da=p.getInstance('chat_tab_model'),ea={tabs:[],promotedID:null,lastChangeTime:0,lastChangeReason:null,isInitialized:false,localRaised:null};function fa(bb){var cb=l.load(bb,ea);cb&&ja();return cb;}function ga(bb,cb,db){var eb=fa(u.get());if(cb===undefined||cb>ea.lastChangeTime){if(bb()){eb=true;ea.lastChangeReason=db||null;ia(cb);}}else da.error('rejected',JSON.stringify({change_time:cb,state_time:ea.lastChangeTime}));eb&&ha();}function ha(){if(ea.isInitialized)ca.emit('change');}function ia(bb){if(bb===undefined)bb=Math.max(y.getLastUserMessageTimestamp()||1,ea.lastChangeTime+1);ea.lastChangeTime=bb;u.doSync();}function ja(bb){var cb=ea.tabs.length-ba;if(cb>0)ea.tabs=ea.tabs.filter(function(db){return db.raised||db.id==bb||cb--<=0;});if(cb>0)ea.tabs=ea.tabs.filter(function(db){return (db.id==ea.promotedID||db.id==bb||cb--<=0);});}function ka(bb){for(var cb=0;cb<ea.tabs.length;cb++)if(ea.tabs[cb].id==bb)return cb;return -1;}function la(bb,cb){var db=x.getThreadMetaNow(bb);if(!db)return false;if(db.is_canonical_user){return oa(bb,cb);}else{var eb=na(bb);if(eb)w.getServerIDFromClientID(bb,function(fb){if(ra(bb,fb)){ia();ha();}});return eb;}}function ma(bb){r.isThreadID(bb);if(na(bb))ha();}function na(bb){if(ka(bb)===-1){ea.tabs.push({id:bb,fragile:true});da.log('open_fragile_tab',JSON.stringify({tabs:JSON.stringify(ea.tabs),opened:bb,window_id:v.getSessionID()}));return true;}return false;}function oa(bb,cb){var db=ka(bb);if(db!=-1)if(ea.tabs[db].fragile){ea.tabs.splice(db,1);}else{cb&&(ea.tabs[db].signatureID=cb);return true;}for(var eb=0;eb<=ea.tabs.length;eb++)if(eb==ea.tabs.length||ea.tabs[eb].fragile){ea.tabs.splice(eb,0,{id:bb,signatureID:cb});ja(bb);da.log('open_tab',JSON.stringify({tabs:JSON.stringify(ea.tabs),opened:bb,window_id:v.getSessionID()}));return true;}}function pa(bb,cb,db){r.isThreadID(bb);var eb=false;if(ea.localRaised&&cb){ea.localRaised[bb]=true;eb=true;}ga(function(){if(la(bb,db))eb=true;var fb=ka(bb);if(fb!=-1&&!ea.tabs[fb].raised){ea.tabs[fb].raised=true;eb=true;da.log('raise_tab',JSON.stringify({tabs:JSON.stringify(ea.tabs),raised:bb,window_id:v.getSessionID()}));}return eb;});}function qa(bb){if(ka(bb)!==-1&&ea.promotedID!==bb){ea.promotedID=bb;return true;}return false;}function ra(bb,cb){var db=ka(bb);if(db!=-1&&ea.tabs[db].fragile){var eb=ea.tabs[db];eb.fragile=s.isLocalThread(bb);eb.server_id=cb;var fb=[];ea.tabs.forEach(function(gb){if(gb.id!=bb){if(eb&&gb.fragile){fb.push(eb);eb=null;}fb.push(gb);}});if(eb)fb.push(eb);ea.tabs=fb;da.log('make_permanent',JSON.stringify({tabs:JSON.stringify(ea.tabs),tab_id:bb,window_id:v.getSessionID()}));return true;}return false;}function sa(bb,cb){r.isThreadID(bb);var db=false;if(ea.localRaised){delete ea.localRaised[bb];db=true;}ga(function(){if(ta(bb))db=true;return db;},undefined,cb);}function ta(bb){var cb=ka(bb);if(bb==ea.promotedID)ea.promotedID=null;if(cb!=-1){ea.tabs.splice(cb,1);da.log('close_tab',JSON.stringify({tabs:JSON.stringify(ea.tabs),closed:bb,window_id:v.getSessionID()}));return true;}return false;}function ua(){if(ea.tabs.length){da.log('close_all_tabs',JSON.stringify({closed_tabs:JSON.stringify(ea.tabs),window_id:v.getSessionID()}));ea.tabs=[];ea.promotedID=null;if(ea.localRaised)ea.localRaised={};ia();ha();}}function va(){var bb=[];for(var cb=0;cb<ea.tabs.length;cb++)if(ea.tabs[cb].fragile&&!x.isNewEmptyLocalThread(ea.tabs[cb].id)){bb.push(ea.tabs[cb]);ea.tabs.splice(cb);ha();break;}da.log('close_fragile_tabs',JSON.stringify({tabs:JSON.stringify(ea.tabs),fragile_closed:bb,window_id:v.getSessionID()}));}function wa(bb){r.isThreadID(bb);var cb=false;if(ea.localRaised){delete ea.localRaised[bb];cb=true;}ga(function(){var db=ka(bb);if(db!=-1&&ea.tabs[db].raised){delete ea.tabs[db].raised;da.log('lower_tab',JSON.stringify({tabs:JSON.stringify(ea.tabs),lowered:bb,window_id:v.getSessionID()}));cb=true;}return cb;});}function xa(){if(ea.localRaised){ga(function(){var bb=false;ea.tabs.forEach(function(cb){if(cb.raised!=ea.localRaised[cb.id]){bb=true;if(ea.localRaised[cb.id]){cb.raised=true;}else delete cb.raised;}});return bb;});da.log('persist_local_raise',JSON.stringify({tabs:JSON.stringify(ea.tabs),window_id:v.getSessionID()}));}}u.registerStateStorer(function(bb){return l.store(bb,ea);});u.registerStateLoader(function(bb){if(fa(bb))ha();});var ya=null,za={getDispatchToken:function(){return ya;},isTabPromoted:function(bb){if(bb)return bb==ea.promotedID;return false;},indexOf:function(bb){return ka(bb);},getTab:function(bb){r.isThreadID(bb);var cb=this.indexOf(bb);if(cb>-1){var db=ea.tabs[cb];return babelHelpers['extends']({},db);}return null;},getEmptyTab:function(){var bb;for(var cb=0;cb<ea.tabs.length;cb++){bb=ea.tabs[cb].id;if(x.isNewEmptyLocalThread(bb))return bb;}bb=t.generateThreadID();x.createNewLocalThread(bb,[]);return bb;},get:function(){var bb=ea.tabs.map(function(cb){var db=babelHelpers['extends']({},cb);delete db.fragile;if(ea.localRaised)db.raised=ea.localRaised[db.id];return db;});return {tabs:bb,promoted:ea.promotedID};},promoteThreadInPlaceOfThread:function(bb,cb,db,eb){r.isThreadID(bb);r.isThreadID(cb);ga(function(){var fb=ka(bb),gb=ka(cb);if(eb){ea.promotedID=bb;}else if(ea.promotedID===cb)return true;var hb=ea.tabs[fb];if(db){r.isThreadID(db);var ib=ka(db),jb=ea.tabs[gb];ea.tabs[gb]=hb;ea.tabs.splice(fb,1);ea.tabs.splice(ib,0,jb);}else{ea.tabs[fb]=ea.tabs[gb];ea.tabs[gb]=hb;}return true;});},addListener:function(bb){return ca.addListener('change',bb);}};h.subscribe(q.DUMP_EVENT,function(bb,cb){cb.chat_tabs={promoted:ea.promotedID,tabs:ea.tabs.map(function(db){return babelHelpers['extends']({},db);}),time:ea.lastChangeTime,max_load_age:aa};});function ab(){var bb=i.ignoresRemoteTabRaise();if(bb&&!ea.localRaised){da.log('start_ignore_remote_raise','{}');ea.localRaised={};ha();}else if(!bb&&ea.localRaised){da.log('stop_ignore_remote_raise','{}');ea.localRaised=null;ha();}}ya=j.register(function(bb){switch(bb.actionType){case m.Types.CLOSE_TAB:sa(bb.threadID,bb.reason);break;case m.Types.CLOSE_ALL_TABS:ua();break;case m.Types.CLOSE_FRAGILE_TABS:va();break;case m.Types.LOWER_TAB:wa(bb.threadID);break;case m.Types.OPEN_FRAGILE_TAB:ma(bb.threadID);break;case m.Types.OPEN_TAB:r.isThreadID(bb.threadID);ga(function(){return la(bb.threadID);});break;case m.Types.PERSIST_LOCAL_STATE:xa();break;case m.Types.PROMOTE_TAB:r.isThreadID(bb.threadID);ga(qa.bind(null,bb.threadID));break;case m.Types.RAISE_TAB:pa(bb.threadID,bb.userAction,bb.signatureID);break;}});i.subscribe(i.ON_CHANGED,ab);ab();fa(u.getInitial(),true);if(ea.lastChangeTime===0)ea.lastChangeTime=z-600000;ea.isInitialized=true;f.exports=za;},null);
__d('ChatTabViewInstances',['Map'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);
__d('MercuryMessages',['BanzaiODS','EventEmitter','ImmutableObject','LogHistory','Map','MercuryActionStatus','MercuryActionType','MercuryAssert','MercuryDispatcher','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySingletonMixin','MercuryMessageActions','MercuryMessageIDs','MessagingGiftWrapConstants','RangedCallbackManager','MercurySendMessageFields','MercuryServerRequests','MercuryThreadActions','MercuryThreadInformer','MercuryThreads','URI','invariant','isMessengerDotComURI','mergeDeep','setImmediate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){'use strict';if(c.__markCompiled)c.__markCompiled();var ia=new i(),ja=k.getInstance('mercury_messages');function ka(ta,ua){var va=ua;if(ta._localIdsMap[ua])va=ta._localIdsMap[ua];return ta._messages.get(va);}function la(ta){switch(ta){case s.UNKNOWN:case s.SERVER_INITIAL_DATA:case s.SERVER_FETCH_THREAD_INFO:case s.SERVER_THREAD_SYNC:return true;}return false;}function ma(ta,ua){if(!ta._threadsToMessages[ua])ta._threadsToMessages[ua]=new x(function(va){return ka(ta,va).timestamp;},function(va,wa){return wa-va;});return ta._threadsToMessages[ua];}function na(ta,ua,va){ua.forEach(function(wa){var xa=ma(ta,wa);xa.setReachedEndOfArray();ta._emitReorderedChange(wa,va);});}function oa(ta){this._fbid=ta;this._messageActions=u.getForFBID(this._fbid);this._serverRequests=z.getForFBID(this._fbid);this._threadInformer=ba.getForFBID(this._fbid);this._threads=ca.getForFBID(this._fbid);this._threadActions=aa.getForFBID(this._fbid);this._dispatcher=p.getForFBID(this._fbid);this._didChange=false;this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new l();this._localIdsMap={};this._dispatcher.subscribe('update-messages',function(ua,va){var wa=(va.actions||[]).filter(function(ya){var za=ya.action_type,ab=(ya.is_forward||ya.thread_id)&&(za==n.LOG_MESSAGE||za==n.USER_GENERATED_MESSAGE||za==n.SEND_MESSAGE||za==n.DELETE_THREAD||za==n.DELETE_MESSAGES||za==n.MARK_MESSAGES_SPAM),bb=ya.upload_id&&ya.upload_data&&(za==n.CANCEL_ATTACHMENT_PLACEHOLDER||za==n.CONFIRM_ATTACHMENT_PLACEHOLDER),cb=ya.note&&za==n.CREATE_PAGE_ADMIN_NOTE,db=ya.replaced_message_id&&za==n.REPLACE_MESSAGE,eb=ya.unwrapped_message_id&&za==n.UNWRAP_MESSAGE;return ab||bb||cb||db||eb;}),xa=la(va.payload_source);this.handleUpdates(wa,xa,va.payload_source,va.from_client);if(va.end_of_history)na(this,va.end_of_history,va.payload_source);if(this._didChange){this._didChange=false;ia.emit('change');}}.bind(this));this._dispatcher.subscribe('invalidate-thread-state',function(ua,va){this._invalidateThreadState(va);}.bind(this));this._dispatcher.subscribe('invalidate-global-state',function(){return this.invalidateGlobalState();}.bind(this));ja.debug('constructed',JSON.stringify({fbid:this._fbid}));}Object.assign(oa.prototype,{getMessagesFromIDs:function(ta){return (ta||[]).map(ka.bind(null,this)).filter(function(ua){return ua;});},getServerMessageID:function(ta){var ua=ta;if(this._localIdsMap[ta])ua=this._localIdsMap[ta];return ua;},hasLoadedNMessages:function(ta,ua){var va=ma(this,ta);return va.hasReachedEndOfArray()||va.getCurrentArraySize()>=ua;},hasLoadedExactlyNMessages:function(ta,ua){var va=ma(this,ta);return va.getCurrentArraySize()==ua;},invalidateGlobalState:function(){this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new l();this._localIdsMap={};},getThreadMessagesRange:function(ta,ua,va,wa,xa,ya){var za=ma(this,ta),ab=function(kb){wa(pa(this,kb));}.bind(this),bb=za.executeOrEnqueue(ua,va,ab),cb=za.getUnavailableResources(bb),db=this._failedHistoryFetchThreads[ta];if(cb.length&&!db){var eb=za.getCurrentArraySize(),fb=this._localTitanMessagesCount[ta]||0,gb=eb-fb,hb=cb.length+fb,ib=this.getCurrentlyLoadedMessages(ta),jb=ib.length?ib[0].timestamp:null;ja.debug('fetch_missing_messages',JSON.stringify({threadID:ta,offset:ua,limit:va,timestamp:jb,missingIndices:cb,messageCount:eb,localMessageCount:fb}));this._serverRequests.fetchThreadMessages(ta,gb,hb,jb,xa,ya);}else this._failedHistoryFetchThreads[ta]=false;return bb;},getThreadMessagesRangeNow:function(ta,ua,va){var wa=ma(this,ta),xa=[];for(var ya=ua;ya<ua+va;ya++){var za=wa.getResourceAtIndex(ya),ab=ka(this,za);ab&&xa.push(ab);}return xa;},getThreadMessagesSinceTimestamp:function(ta,ua){var va=ma(this,ta),wa=va.getElementsUntil(ua);return pa(this,wa);},hasLoadedAllMessages:function(ta){return ma(this,ta).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(ta){var ua=ma(this,ta).getAllResources();return pa(this,ua);},unsubscribe:function(ta,ua){o.isThreadID(ua);var va=ma(this,ua);va.unsubscribe(ta);},_addNewMessage:function(ta,ua){sa(ua);this._messages.set(ta,new j(ua));},_addNewPageAdminNote:function(ta,ua){var va=this._messages.get(ta);if(va){var wa=va.page_admin_notes?va.page_admin_notes.slice():[],xa=false,ya=true;for(var za=0;za<wa.length;++za)if(wa[za].id===ua.id){xa=true;ya=false;break;}else if((wa[za].id===null||wa[za].id===undefined)&&wa[za].body===ua.body){xa=true;wa[za]=ua;}if(!xa)wa.push(ua);if(ya){var ab={};ab.page_admin_notes=wa;this._updateMessage(ta,va,ab);}}},_updateMessage:function(ta,ua,va){var wa=j.set(ua,va);this._messages.set(ta,wa);return wa;},_shouldSortOutOfOrderMessages:function(ta,ua,va){if(ta==s.CLIENT_CHANNEL_MESSAGE){var wa=this.getThreadMessagesSinceTimestamp(ua,va);if(wa.length>0){h.bumpEntityKey('chat.web','channel.messages_reordered');return true;}}else if(ta===s.SERVER_INVALIDATE_THREAD_STATE||ta===s.SERVER_INVALIDATE_GLOBAL_STATE)return true;return false;},_preprocessIncomingAction:function(ta,ua){var va=ta.action_type;if(ua==s.CLIENT_CHANNEL_MESSAGE&&va==n.USER_GENERATED_MESSAGE&&ta.offline_threading_id&&this._localIdsMap[ta.offline_threading_id]===ta.offline_threading_id){ta.client_message_id=ta.offline_threading_id;ta.status=m.SUCCESS;ta.action_type=n.SEND_MESSAGE;va=ta.action_type;}if(ua===s.CLIENT_CHANNEL_MESSAGE&&va==n.USER_GENERATED_MESSAGE){var wa=this._threads.getThreadMetaNow(ta.thread_id);if(wa&&wa.folder)ta.folder=wa.folder;}return ta;},handleUpdates:function(ta,ua,va,wa){var xa,ya={};for(var za=0;za<ta.length;za++){var ab=this._preprocessIncomingAction(ta[za],va),bb=ab.action_type,cb=ka(this,ab.message_id);if(bb==n.LOG_MESSAGE)if(this.isLocalMessage(ab))continue;if(ab.is_forward||va==s.SERVER_SEARCH){if(!this._messages.has(ab.message_id))this._addNewMessage(ab.message_id,ab);continue;}else if(ab.client_state===r.SEND_TO_SERVER){this._addNewMessage(ab.message_id,ab);continue;}else if(bb==n.SEND_MESSAGE){var db=ab.client_message_id;if(db&&this._localIdsMap[db]&&ab.status){var eb=ka(this,db),fb=eb.status;if(eb.status==m.SUCCESS)continue;if(!ya[ab.thread_id])ya[ab.thread_id]=[];this._updateLocalMessage(ab);if(typeof fb!==undefined||ab.status==m.FAILED_UNKNOWN_REASON||ab.status==m.UNABLE_TO_CONFIRM||ab.status==m.SUCCESS||ab.status==m.ERROR)this._emitUpdatedChange(ab.thread_id,ka(this,db).message_id,va);}continue;}else if(bb==n.DELETE_THREAD){ma(this,ab.thread_id).removeAllResources();continue;}else if(bb==n.DELETE_MESSAGES){this._deleteMessages(ab.thread_id,ab.message_ids,va);ha(function(){this._threadActions.updateSnippet(ab.thread_id,ab.message_ids);}.bind(this));continue;}else if(bb==n.CREATE_PAGE_ADMIN_NOTE){this._addNewPageAdminNote(ab.message_id,ab.note);this._emitUpdatedChange(ab.thread_id,ab.message_id,'link_shim');continue;}else if(ab.offline_threading_id&&this._localIdsMap[ab.offline_threading_id]||cb&&!cb.is_forward){if(cb&&ab.ranges&&ab.ranges.length>0){var gb=cb.message_id;this._updateMessage(this._localIdsMap[gb]||gb,cb,{ranges:ta.ranges});this._emitUpdatedChange(cb.thread_id,cb.message_id,'link_shim');}continue;}else if(bb===n.CONFIRM_ATTACHMENT_PLACEHOLDER){this._confirmAttachmentPlaceholder(ab.upload_id,ab.upload_data);continue;}else if(bb===n.CANCEL_ATTACHMENT_PLACEHOLDER){this._cancelAttachmentPlaceholder(ab.upload_id,ab.upload_data);continue;}else if(bb==n.REPLACE_MESSAGE){if(this._replaceMessage(ab)){if(!ya[ab.thread_id])ya[ab.thread_id]=[];ya[ab.thread_id].push(ab.message_id);this._emitUpdatedChange(ab.thread_id,ab.replaced_message_id,va);this._emitUpdatedChange(ab.thread_id,ab.message_id,va);ua=true;}continue;}else if(bb==n.UNWRAP_MESSAGE){if(this._unwrapMessage(ab))this._emitUpdatedChange(ab.thread_id,ab.unwrapped_message_id,va);}else{if(va===s.CLIENT_SEND_MESSAGE){this._localIdsMap[ab.message_id]=ab.message_id;if(ab.thread_id=='root:'+ab.offline_threading_id)ma(this,ab.thread_id).setReachedEndOfArray();}if(bb==n.LOG_MESSAGE&&ab.log_message_type==q.SERVER_ERROR)this._failedHistoryFetchThreads[ab.thread_id]=true;if(ab.client_state===r.DO_NOT_SEND_TO_SERVER&&ab.upload_id)this._uploadMessages[ab.upload_id]=ab;if(!ya[ab.thread_id])ya[ab.thread_id]=[];ya[ab.thread_id].push(ab.message_id);this._addNewMessage(ab.message_id,ab);if(ab.offline_threading_id&&ab.offline_threading_id!=ab.message_id){this._localIdsMap[ab.offline_threading_id]=ab.message_id;v.addServerID(ab.offline_threading_id,ab.message_id);if(ab.threading_id)v.addServerID(ab.threading_id,ab.message_id);}if(ab[y.MANUAL_RETRY_CNT]>0){xa=ma(this,ab.thread_id);xa.resortResources([ab.message_id]);this._emitReorderedChange(ab.thread_id,s.CLIENT_SEND_MESSAGE);}ua=ua||this._shouldSortOutOfOrderMessages(va,ab.thread_id,ab.timestamp);if(!ua)this._emitReceivedChange(ka(this,ab.message_id));continue;}}for(var hb in ya){xa=ma(this,hb);var ib=xa.getAllResources(),jb=ib.filter(function(kb){var lb=this._messages.get(kb);if(!lb)return true;return lb.action_type==n.LOG_MESSAGE&&lb.log_message_type==q.SERVER_ERROR;}.bind(this));xa.removeResources(jb);if(wa)qa(this,hb,ya[hb]);if(ua){xa.addResources(ya[hb]);this._emitReorderedChange(hb,va);}else xa.addResourcesWithoutSorting(ya[hb].reverse(),0);this._threadInformer.updatedThread(hb);}this._didChange&&ja.debug('handle_updates',JSON.stringify({localMessageCounts:this._localTitanMessagesCount}));},isFirstMessage:function(ta){var ua=ma(this,ta.thread_id);if(ua.getCurrentArraySize()===0)return false;var va=ua.getResourceAtIndex(ua.getCurrentArraySize()-1),wa=ka(this,va).message_id,xa=ka(this,ta.message_id).message_id;return ua.hasReachedEndOfArray()&&wa==xa;},isLocalMessage:function(ta){if(ta.offline_threading_id!==null&&ta.offline_threading_id===ta.message_id)return true;if(ta.threading_id!==null&&ta.threading_id===ta.message_id)return true;return false;},_deleteMessages:function(ta,ua,va){if(!ua.length)return;this._deleteIndividualMessages(ta,ua,va);if(va!==s.CLIENT_CHANNEL_MESSAGE)this._serverRequests.deleteMessages(ta,ua);},_deleteIndividualMessages:function(ta,ua,va){var wa=ua.map(function(ya){return ka(this,ya).message_id;},this),xa=ma(this,ta);xa.removeResources(wa);this._emitReorderedChange(ta,va);},_updateLocalMessage:function(ta){var ua=ka(this,ta.client_message_id),va={};va.status=ta.status;if(ta.status===m.SUCCESS||ta.error_data)va.error_data=ta.error_data;var wa=ta.message_id,xa=ta.client_message_id;if(this._messages.has(wa)){this._updateMessage(wa,ua,va);return false;}if(ta.threading_id)va.threading_id=ta.threading_id;if(ta.timestamp)va.timestamp=ta.timestamp;if(ta.log_message_data)va.log_message_data=ta.log_message_data;if(ta.ranges&&ta.ranges.length){sa(ta);va.ranges=ta.ranges;}if(ta.attachments&&ta.attachments.length){va.raw_attachments=null;va.attachments=ta.attachments;}this._localIdsMap[xa]=wa;v.addServerID(xa,wa);var ya=this._updateMessage(wa,ua,va);this._messages.set(xa,new j());if(ra(ya))this._localTitanMessagesCount[ya.thread_id]--;return true;},_replaceMessage:function(ta){var ua=ta.replaced_message_id,va=ka(this,ua);if(!va)return false;var wa={};wa.status=ta.status;if(ta.timestamp)wa.timestamp=ta.timestamp;if(ta.log_message_data)wa.log_message_data=ta.log_message_data;if(ta.ranges&&ta.ranges.length){sa(ta);wa.ranges=ta.ranges;}if(ta.attachments&&ta.attachments.length){wa.raw_attachments=null;wa.attachments=ta.attachments;}if(ta.body)wa.body=ta.body;var xa=ta.message_id;v.addServerID(xa,xa);this._updateMessage(xa,va,wa);this._messages['delete'](ua);return true;},_unwrapMessage:function(ta){var ua=ka(this,ta.unwrapped_message_id);if(!ua||!ua.tags)return false;var va=ua.tags.slice(0);va.push(w.UNWRAPPED_TAG);var wa={tags:va};this._updateMessage(ta.unwrapped_message_id,ua,wa);return true;},getNumberLocalMessages:function(ta){return this._localTitanMessagesCount[ta]||0;},_uploadMessages:{},_confirmAttachmentPlaceholder:function(ta,ua){var va=this._popPendingAttachmentMessage(ta,ua);delete va.preview_attachments;this._serverRequests.sendNewMessage(va);},_cancelAttachmentPlaceholder:function(ta,ua){var va=this._popPendingAttachmentMessage(ta,ua);this._deleteIndividualMessages(va.thread_id,[va.message_id]);if(this._localTitanMessagesCount[va.thread_id])this._localTitanMessagesCount[va.thread_id]--;},_popPendingAttachmentMessage:function(ta,ua){var va=this._uploadMessages[ta];!va?ea(0):undefined;va.image_ids=ua.image_ids;va.file_ids=ua.file_ids;va.audio_ids=ua.audio_ids;va.gif_ids=ua.gif_ids;va.video_ids=ua.video_ids;va.client_state=r.SEND_TO_SERVER;delete this._uploadMessages[ta];return va;},_emitUpdatedChange:function(ta,ua,va){this._didChange=true;this._threadInformer.updatedMessage(ta,ua,va);},_emitReceivedChange:function(ta){this._didChange=true;this._threadInformer.receivedMessage(ta);},_emitReorderedChange:function(ta,ua){this._didChange=true;this._threadInformer.reorderedMessages(ta,ua);},_invalidateThreadState:function(ta){if(!this._threadsToMessages[ta])return;var ua=this._threadsToMessages[ta].getAllResources();ua.forEach(function(va){var wa=ka(this,va).offline_threading_id;this._messages['delete'](va);var xa=this._localIdsMap[wa];if(xa)this._messages['delete'](xa);delete this._localIdsMap[va];delete this._localIdsMap[wa];}.bind(this));delete this._threadsToMessages[ta];}});Object.assign(oa,t,{addListener:function(ta,ua){return ia.addListener(ta,ua);}});function pa(ta,ua){var va=ua.map(ka.bind(null,ta));return va.reverse();}function qa(ta,ua,va){var wa=va.filter(function(xa){return ra(ka(ta,xa));});if(!ta._localTitanMessagesCount[ua])ta._localTitanMessagesCount[ua]=0;ta._localTitanMessagesCount[ua]+=wa.length;}function ra(ta){var ua=ta.action_type;if(ua==n.USER_GENERATED_MESSAGE)return true;switch(ta.log_message_type){case q.SUBSCRIBE:case q.UNSUBSCRIBE:case q.SERVER_ERROR:case q.LIVE_LISTEN:return false;default:return true;}}function sa(ta){if(!ta.ranges)return;ta.ranges.forEach(function(ua){if(!ua.entity||ua.entity.external||!ua.entity.url)return;var va=new da(ua.entity.url);if(fa(da.getRequestURI())&&!va.getDomain()){va.setProtocol('https').setDomain('www.facebook.com');ua.entity.url=va.toString();}});}f.exports=oa;},null);
__d('MercuryNotificationRenderer',['MercuryAssert','MercuryIDs','MercuryParticipants','MercuryViewer','fbt','MercuryMessages','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=c('MercuryMessages').get(),n=c('MercuryThreads').get();function o(p,q){h.isThreadID(p);n.getThreadMeta(p,function(r){m.getThreadMessagesRange(p,0,1,function(s){var t=s.length&&s[s.length-1];if(t&&t.author!=k.getID()){j.get(t.author,function(u){var v=u.short_name;if(r.custom_nickname){var w=i.getUserIDFromParticipantID(u.id);if(r.custom_nickname[w])v=r.custom_nickname[w];}if(r.name){q(l._("{senderName} a envoy\u00e9 un message \u00e0 {groupName}",[l.param('senderName',v),l.param('groupName',r.name)]));}else if(i.isGroupChat(p)){q(l._("{name} a envoy\u00e9 un message \u00e0 votre groupe",[l.param('name',v)]));}else q(l._("{name} vous a envoy\u00e9 un message",[l.param('name',v)]));});}else q(l._("Nouveau message\u00a0!"));});});}f.exports={renderDocumentTitle:o};},null);
__d('ChatTitleBarBlinker',['ChatActivity','ChatConfig','DocumentTitle','JSLogger','MercuryNotificationRenderer','PresenceState','MercuryThreadInformer','MercuryTimestampTracker'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=c('MercuryThreadInformer').get(),o=c('MercuryTimestampTracker').get(),p=k.create('chat_title'),q=null,r=0,s=false;function t(){if(q){q.stop();q=null;return true;}return false;}function u(z){var aa=z||o.getLastUserMessageTimestamp();if(r<=aa){r=aa;if(t()||s)m.doSync();}}var v={blink:function(z,aa){if(!q&&r<aa)l.renderDocumentTitle(z,function(ba){if(!q)q=j.blink(ba);});},stopBlinking:function(){u();},blinkingElsewhere:function(){s=true;}};function w(z){var aa=m.verifyNumber(z.sb2);if(!aa||aa<=r)return null;return aa;}function x(z){var aa=z&&w(z);if(aa){r=aa;p.debug('load',r);t();s=false;}}function y(z){var aa=w(z);if(!aa){p.debug('store',r);z.sb2=r;s=false;}return z;}m.registerStateStorer(y);m.registerStateLoader(x);n.subscribe('thread-read-changed',function(z,aa){var ba=o.getLastUserMessageTimestamp(),ca=0;for(var da in aa)if(aa[da].mark_as_read&&aa[da].timestamp>=ba&&aa[da].timestamp>ca)ca=aa[da].timestamp;ca&&u(ca);});h.subscribe('activity',function(){u();});(function(){var z=m.getInitial();if(z)r=w(z)||0;})();f.exports=v;},null);
__d('MercuryGroupThreadMentions',['CurrentUser','ShortProfiles'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={messageMentionsViewer:function(k,l){i.get(h.getID(),function(m){l(new RegExp('@'+m.firstName,'i').test(k.body));});}};f.exports=j;},null);
__d('Sound',['SoundInitialData','SoundPlayer','SoundRPC','SoundSynchronizer','URI','UserAgent_DEPRECATED','Visibility','isFacebookURI'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=null,q=false,r={init:function(v){if(!p)i.init(v);},play:function(v,w,x){if(p){j.playRemote(p.contentWindow,v,w,false);}else j.playLocal(v,w,x);q=true;},hasPlayedSoundBefore:function(){return q;},playOnlyIfImmediate:function(v,w,x){if(!q&&n.isHidden())return;this.play(v,w,x);},stop:function(v){if(!p)i.stop(v);}},s=new l(location.href);if(s.getSubdomain()&&s.getSubdomain()!=='www')s.setSubdomain('www');var t=s.getDomain();function u(){if(m.ie()<9)return false;if(h.RPC_DISABLED)return false;return k.isSupported()&&j.supportsRPC();}if(o(s)&&location.host!==t&&u()){p=document.createElement('iframe');p.setAttribute('src','//'+t+'/sound_iframe.php');p.style.display='none';document.body.appendChild(p);}f.exports=r;},null);
__d('MercuryBrowserAlerts',['ArbiterMixin','ChatActivity','ChatConfig','ChatOptions','ChatTitleBarBlinker','MercuryConfig','MercuryGroupThreadMentions','MercuryThreadInfo','MercuryViewer','MessagingTag','Sound','UserActivity','MercuryBlockedParticipants','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=c('MercuryBlockedParticipants').get(),u=c('MercuryThreads').get();r.init(['audio/ogg','audio/mpeg']);function v(){return !s.isOnTab()&&!s.hasBeenInactive();}function w(y){if(k.getSetting('sound')&&!v())r.play([j.get('sound.notif_ogg_url'),j.get('sound.notif_mp3_url')],y,false);}var x={messageReceived:function(y){if(p.isViewer(y.author)||!y.is_unread||y.folder!=q.INBOX&&y.folder!=q.ARCHIVED)return;var z=y.thread_id,aa=i.isActive();if(aa){var ba=false;x.inform('before-alert',{threadID:z,cancelAlert:function(){ba=true;}});}u.getThreadMeta(z,function(ca){var da=o.isMuted(ca);n.messageMentionsViewer(y,function(ea){if(da&&(!m.GroupChatMentionsGK||!ea))return;if(t.isPresentInGroupThread(ca))return;var fa=y.timestamp;if(aa){!ba&&w(fa);}else{l.blink(z,fa);w(fa);}l.blinkingElsewhere();});});}};f.exports=Object.assign(x,h);},null);
__d('ChatNewMessageHandler',['ChatActivity','ChatMentionsNotifications','ChatTabModel','ChatTabViewInstances','JSLogger','MercuryAssert','MercuryBrowserAlerts','UserActivity','MercuryConfig','MercuryThreadlistConstants'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r=l.create('chat_new_message'),s={_notify:function(t,u,v){if(p.DesktopNotificationsGK)i.notifyIfMessageToMe(u);var w=k.get(t);v.view_is_visible=w&&w.isVisible();v.view_is_focused=w&&w.isFocused();if(!v.view_is_visible)r.log('message_to_hidden');v.is_active=h.isActive();n.messageReceived(u);},newMessage:function(t,u){m.isThreadID(t);var v=j.getTab(t),w={thread_id:t,message_id:u.message_id,to_new_tab:!v,to_raised_tab:v?!!v.raised:true};this._notify(t,u,w);r.log('message',w);}};n.subscribe('before-alert',function(t,event){var u=event.threadID,v=k.get(u),w=j.getTab(u),x=q.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;if(w&&w.raised&&v&&v.isVisible()&&v.isFocused()&&o.isActive(x)){v.tryMarkAsRead();event.cancelAlert();}});f.exports=s;},null);
__d('ChatTabLRUManager',['ChatTabViewInstances','ChatTabModel','InitialServerTime','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryThreads').get(),l={getLRUVisibleTab:function(m){if(m.hasRoomForRaisedTab())return undefined;var n=Object.keys(m.getTabsToShow()||{}),o=1*60,p=null,q=Infinity;for(var r=0;r<n.length;r++){var s=n[r],t=k.getThreadMetaNow(s);if(i.isTabPromoted(s))continue;if(!h.get(s).hasEmptyInput()||!t)continue;var u=(j.serverTime-t.timestamp)/1000;if(!t.timestamp||t.timestamp&&t.timestamp<q&&u>o){p=t.thread_id;q=t.timestamp;}}return p;}};f.exports=l;},null);
__d('ChatTabPresence',['AvailableList','ChatTabModel','MercuryIDs'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={};function l(m){var n=j.getUserIDFromThreadID(m);if(n)h.updateForID(n);}i.addListener(function(){var m=i.get();m.tabs.forEach(function(n){if(n.raised&&!k[n.id])l(n.id);});k={};m.tabs.forEach(function(n){if(n.raised)k[n.id]=true;});});f.exports={};},null);
__d('ChatTabViewEvents',['Arbiter'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);
__d('MercuryParticipantListRenderer',['fbt','MercuryIDs'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(){this.$MercuryParticipantListRenderer1=false;this.$MercuryParticipantListRenderer2=false;this.$MercuryParticipantListRenderer3=false;this.$MercuryParticipantListRenderer4=0;this.$MercuryParticipantListRenderer5=null;this.$MercuryParticipantListRenderer6=function(t){if(this.$MercuryParticipantListRenderer5){var u=i.getUserIDFromParticipantID(t.id);if(this.$MercuryParticipantListRenderer5[u])return this.$MercuryParticipantListRenderer5[u];}return this.$MercuryParticipantListRenderer2?t.short_name:t.name;}.bind(this);}j.prototype.renderParticipantList=function(t){var u=t.map(this.$MercuryParticipantListRenderer6);switch(u.length){case 0:return k(this.$MercuryParticipantListRenderer1);case 1:return l(u);case 2:return this.$MercuryParticipantListRenderer3?n(u):m(u);case 3:return this.$MercuryParticipantListRenderer3?p(u):o(u);default:return this.$MercuryParticipantListRenderer3?r(u,this.$MercuryParticipantListRenderer4):q(u,this.$MercuryParticipantListRenderer4);}};j.prototype.setIsNewThread=function(t){this.$MercuryParticipantListRenderer1=t;return this;};j.prototype.setNameRenderer=function(t){this.$MercuryParticipantListRenderer6=t;return this;};j.prototype.setUseShortName=function(t){this.$MercuryParticipantListRenderer2=t;return this;};j.prototype.setNickname=function(t){this.$MercuryParticipantListRenderer5=t;return this;};j.prototype.setUseAndSeparator=function(t){this.$MercuryParticipantListRenderer3=t;return this;};j.prototype.setTotalParticipantCount=function(t){this.$MercuryParticipantListRenderer4=t;return this;};function k(t){if(t){return h._("Nouveau message");}else return h._("Aucun participant");}function l(t){return t[0];}function m(t){return h._("{participant1}, {participant2}",[h.param('participant1',t[0]),h.param('participant2',t[1])]);}function n(t){return h._("{participant1} et {participant2}",[h.param('participant1',t[0]),h.param('participant2',t[1])]);}function o(t){return h._("{participant1}, {participant2}, {participant3}",[h.param('participant1',t[0]),h.param('participant2',t[1]),h.param('participant3',t[2])]);}function p(t){return h._("{participant1}, {participant2} et {participant3}",[h.param('participant1',t[0]),h.param('participant2',t[1]),h.param('participant3',t[2])]);}function q(t,u){return h._("{participant1}, {participant2}, {participant3}, {others_link}",[h.param('participant1',t[0]),h.param('participant2',t[1]),h.param('participant3',t[2]),h.param('others_link',s((u||t.length)-3))]);}function r(t,u){return h._("{participant1}, {participant2} et {others_link}",[h.param('participant1',t[0]),h.param('participant2',t[1]),h.param('others_link',s((u||t.length)-2))]);}function s(t){if(t>1){return h._({"*":"{others_count} autres personnes"},[h.param('others_count',t,[0])]);}else return h._("1 autre");}f.exports=j;},null);
__d('MercuryThreadTitle.react',['MercuryIDs','MercuryParticipantListRenderer','MercuryParticipants','React','TextWithEmoticons.react','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=k.PropTypes,o=k.createClass({displayName:'MercuryThreadTitle',propTypes:{isNewThread:n.bool,thread:n.object.isRequired,viewer:n.string.isRequired,showUnreadCount:n.bool,useShortName:n.bool,useAndSeparator:n.bool},getDefaultProps:function(){return {isNewThread:false,showUnreadCount:false,useShortName:false,useAndSeparator:false};},getInitialState:function(){return {participantNames:''};},componentDidMount:function(){this._renderParticipantsList(this.props);},componentWillReceiveProps:function(p){this._renderParticipantsList(p);},render:function(){return (k.createElement('span',{className:this.props.className},this.props.thread.name?this._renderThreadTitle():this.state.participantNames,this.props.children));},getTitle:function(){return this.state.participantNames;},_renderThreadTitle:function(){var p=this.props.thread,q=k.createElement(l,{renderEmoticons:true,renderEmoji:true,text:p.name});if(!p.unread_count||!this.props.showUnreadCount)return q;return this._renderTitleWithUnreadCount(q,p.unread_count);},_renderParticipantsList:function(p){if(p.thread.name)return;var q=h.getParticipantIDFromUserID(p.viewer),r=p.thread.participants;if(r.length>1)r=r.filter(function(s){return s!=q;});j.getMulti(r,function(s){if(!this.isMounted())return;var t=r.map(function(x){return s[x];}),u=p.thread.custom_nickname?p.thread.custom_nickname:null,v=new i().setUseShortName(p.useShortName).setUseAndSeparator(p.useAndSeparator).setIsNewThread(p.isNewThread).setNickname(u).renderParticipantList(t),w=p.showUnreadCount&&p.thread.unread_count?this._renderTitleWithUnreadCount(v,p.thread.unread_count):v;this.setState({participantNames:w});}.bind(this));},_renderTitleWithUnreadCount:function(p,q){return m._("{conversation-title} ({unread-count})",[m.param('conversation-title',p),m.param('unread-count',q)]);}});f.exports=o;},null);
__d('NubController',['ArbiterMixin','Dock'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(){}Object.assign(j.prototype,h,{init:function(k){this.el=k;i.registerNubController(k,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){i.hide(this.el);},show:function(){i.show(this.el);}});f.exports=j;},null);
__d('ChatTabViewSelector',['Arbiter','ArbiterMixin','CSS','ChatTabActions','CurrentUser','DOM','DataStore','Event','MenuDeprecated','MercuryThreadTitle.react','NubController','React','ReactDOM','ChatTabTemplates','Toggler','MercuryThreadInformer','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=c('MercuryThreadInformer').get(),x=c('MercuryThreads').get();function y(z){var aa=u[':fb:chat:tab:selector'].build(),ba=aa.getRoot(),ca=aa.getNode('menu'),da=m.find(ca,'.uiMenuInner'),ea={},fa=new r().init(ba);j.hide(ba);m.insertBefore(z,ba);function ga(ja){var ka=0;for(var la in ea){var ma=ea[la],na=x.getThreadMetaNow(la),oa=ma.getNode('unreadCount'),pa=na&&na.unread_count||0;ka+=pa;if(pa>9)pa='+';j.conditionClass(oa,'invisible_elem',!pa);m.setContent(oa,pa);}var qa=aa.getNode('numMessages');j.conditionShow(qa,ka);m.setContent(qa,ka);}this.setTabData=function(ja){var ka=ea;ea={};if(ja.length<1){j.hide(ba);return;}j.show(ba);m.empty(da);ja.forEach(function(na){var oa=u[':fb:chat:tab:selector:item'].build(),pa=oa.getNode('content');ea[na.id]=oa;x.getThreadMeta(na.id,function(ra){t.render(s.createElement(q,{thread:ra,useAndSeparator:true,viewer:l.getID()}),pa);});m.prependContent(da,oa.getRoot());n.set(oa.getRoot(),'threadID',na.id);var qa=oa.getNode('closeButton');o.listen(qa,'click',function(event){k.closeTab(na.id,'selector/close-tab');event.kill();});});for(var la in ka)if(ka.hasOwnProperty(la)){var ma=ka[la].getNode('content');ma&&t.unmountComponentAtNode(ma);}fa.flyoutContentChanged();m.setContent(aa.getNode('numTabs'),ja.length);ga();};function ha(event,ja){if(ja.menu!=ca)return;var ka=n.get(ja.item,'threadID');y.inform('selected',ka);v.hide(ba);}function ia(event,ja){p.register(ca);}p.subscribe('select',ha.bind(this));v.listen('show',ba,function(){h.inform('layer_shown',{type:'ChatTabSelector'});ia();});v.listen('hide',ba,function(){h.inform('layer_hidden',{type:'ChatTabSelector'});});w.subscribe('threads-updated',ga);}Object.assign(y,i);f.exports=y;},null);
__d('ChatTypeaheadBehavior',['BanzaiLogger','ChatOpenTab','ChatTypeaheadConstants','ChatTypeaheadEvent','CSS','MercuryTypeaheadConstants','Parent','Rect','URI','csx','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();function s(u,v){var w=n.bySelector(u,"._4oes");if(w)l.conditionClass(w,"_5q83",v);}function t(u){'use strict';this._typeahead=u;this._loggedQuery=false;}t.prototype.enable=function(){'use strict';var u=this._typeahead;this._subscriptions=[u.subscribe('focus',function(){this._loggedQuery=false;u.getData().refreshData();s(u.getElement(),true);}.bind(this)),u.subscribe('blur',function(v){if(this._loggedQuery)h.log('ChatTypeaheadLoggerConfig',{event:k.ABANDONED_QUERY,max_results:u.getData().getMaxResults(),num_friend_results:u.getView().results.filter(function(w){return w.render_type===m.FRIEND_TYPE;}).length,query:u.getCore().value});u.getCore().reset();s(u.getElement(),false);this._loggedQuery=false;}.bind(this)),u.subscribe('respond',function(v,w){if(!this._loggedQuery&&u.getCore().getValue().length>0){h.log('ChatTypeaheadLoggerConfig',{event:k.NEW_QUERY});this._loggedQuery=true;}if(w.value&&w.value===u.getCore().getValue()){if(!w.results.length){var x=w.value.toLowerCase(),y=u.getData().getQueryCache();if(!w.isAsync&&!y.hasOwnProperty(x))return;u.getView().showNoResults();}l.addClass(u.getElement(),'hasValue');}}.bind(this)),u.subscribe('reset',function(){l.removeClass(u.getElement(),'hasValue');}),u.subscribe('select',function(v,w){var x=w.selected.uid;if(w.selected.mercury_thread&&!w.selected.mercury_thread.is_canonical)x=w.selected.mercury_thread.thread_fbid;u.getView().hide();h.log('ChatTypeaheadLoggerConfig',{event:k.RESULT_SELECTED,max_results:u.getData().getMaxResults(),result_type:w.selected.render_type,query:u.getCore().value});this._loggedQuery=false;if(w.selected.render_type===j.MEETING_ROOM_PAGE_TYPE){window.open(new p('/'+x.toString()),'_self',false);}else i.openTabByType(x,w.selected.type,'typeahead');}.bind(this)),u.subscribe('highlight',function(v,w){if(w.index>=0){var x=u.getView().getItems()[w.index];if(x){var y=new o(x),z=x.offsetParent,aa=y.boundWithin(new o(z)).getPositionVector();y.getPositionVector().sub(aa).scrollElementBy(z);}}})];};t.prototype.disable=function(){'use strict';this._subscriptions.forEach(function(u){this._typeahead.unsubscribe(u);},this);this._subscriptions=null;};Object.assign(t.prototype,{_subscriptions:null});f.exports=t;},null);
__d('ChatTabController',['Arbiter','BanzaiLogger','Bootloader','ChatActivity','ChatConfig','ChatNewMessageHandler','ChatTabActions','ChatTabLRUManager','ChatTabModel','ChatTabPolicy','ChatTabViewEvents','ChatTabViewInstances','ChatTabViewSelector','JSLogger','MercuryViewer','Style','UserAgent_DEPRECATED','ChatTabPresence','ChatTypeaheadBehavior','MercuryThreadInformer','MercuryThreadActions','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();c('ChatTabPresence');c('ChatTypeaheadBehavior');var y=c('MercuryThreadInformer').get(),z=c('MercuryThreadActions').get(),aa=c('MercuryThreads').get(),ba=l.get('tab_auto_close_timeout')||7200000,ca=u.create('tab_controller');function da(oa,pa,qa){var ra=p.get().tabs,sa=ra[oa],ta,ua;if(ra.length<2)return false;var va=ra.slice(oa+1),wa=ra.slice(0,oa),xa=va.concat(wa);if(!pa)xa.reverse();if(sa)xa.push(sa);for(var ya=0;ya<xa.length;ya++){ta=xa[ya];ua=s.get(ta.id);if(ua&&ua.isVisible()&&(!qa||ta.raised)){ua.focus();return true;}}return false;}function ea(oa,pa){var qa=pa&&pa.getRightmostHiddenTab();if(qa===oa)return null;return qa;}function fa(){return Math.floor(Math.random()*2147483648).toString(16);}function ga(oa,pa,qa,ra){n.raiseTab(oa,true,qa);var sa=pa&&pa.getLeftmostVisibleTab(),ta=pa&&pa.getTabsToShow();if(ta&&!ta[oa]&&sa){p.promoteThreadInPlaceOfThread(oa,sa,ea(oa,pa),true);}else n.promoteTab(oa);h.inform('chat/open-tab',oa);if(ra)return;var ua=s.get(oa);ua&&ua.focus();}function ha(oa,pa){if(!p.getTab(oa))n.raiseTab(oa,false);var qa=pa&&o.getLRUVisibleTab(pa),ra=pa&&pa.getTabsToShow();if(ra&&!ra[oa]&&qa)p.promoteThreadInPlaceOfThread(oa,qa,ea(oa,pa));}function ia(oa){t.subscribe('selected',function(ra,sa){ga(sa,oa);});h.subscribe('page_transition',function(ra,sa){n.closeFragileTabs();});h.subscribe('chat-visibility/go-offline',function(){n.closeAllTabs();});k.subscribe('idle',function(ra,sa){if(sa>ba){var ta=p.get().tabs;ta.forEach(function(ua){var va=ua.id;aa.getThreadMeta(va,function(wa){if(!wa.unread_count){ca.log('autoclose_idle_seen',{thread_id:va,idleness:sa});n.closeTab(va,'autoclose_idle_seen');}});});}});r.subscribe('nub-activated',function(ra,sa){ga(sa,oa);});r.subscribe('focus-tab',function(ra,sa){var ta=p.getTab(sa);if(ta&&ta.raised)ga(sa,oa,ta.signatureID,false);});function pa(ra,sa){i.log('VideoCallLoggerConfig',{event:'chat_tab_call_click'});j.loadModules(["FBRTCCore"],function(ta){ta.startOutgoingCall(sa.userID,sa.clickSource,sa.audioOnly);});}r.subscribe('video-call-clicked',pa);function qa(ra,sa){j.loadModules(["FBRTCCore"],function(ta){ta.startGroupCall(sa);});}r.subscribe('group-call-clicked',qa);r.subscribe('interaction-with-tab',function(ra,sa){var ta=p.getTab(sa);ta&&ta.raised&&z.markSeen(sa);});r.subscribe('esc-pressed',function(ra,sa){ca.log('close_esc',{thread_id:sa});var ta=p.indexOf(sa);n.closeTab(sa,'close_esc');setTimeout(function(){da(ta-1,true,true);},0);});y.subscribe('messages-received',function(ra,sa){for(var ta in sa){var ua=sa[ta];for(var va=0;va<ua.length;va++){var wa=ua[va];if(wa.author!=v.getID()){if(!wa.is_unread){ca.log('message_already_read',{action_id:wa.action_id,thread_id:wa.thread_id});continue;}aa.getThreadMeta(ta,function(xa){q.messageIsAllowed(xa,wa,function(){ha(ta,oa);m.newMessage(ta,wa);});});}}}});y.subscribe('thread-read-changed',function(ra,sa){for(var ta in sa)if(!sa[ta].mark_as_read){ca.log('autoclose_marked_unread',{thread_id:ta});n.closeTab(ta,'autoclose_marked_unread');}});r.subscribe('tab-pressed',function(ra,sa){return !da(p.indexOf(sa.id),sa.shiftPressed);});h.subscribe(u.DUMP_EVENT,function(ra,sa){sa.chat_controller={auto_close_timeout:ba};});this.openTab=function(ra,sa,ta,ua){ga(ra,sa,fa(),ua);if(ta)ta(s.get(ra));};}if(x.firefox()){var ja=function(){return w.get(document.body,'overflowX')+' '+w.get(document.body,'overflowY');},ka=ja(),la=function(){var oa=ja();if(oa!==ka){ka=oa;h.inform('overflow-applied-to-body');}};if('MutationObserver' in window){var ma=new MutationObserver(la),na={attributes:true,attributeFilter:['class','style']};ma.observe(document.documentElement,na);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))la();},false);}f.exports=ia;},null);
__d('ChatNubLogger',['BanzaiLogger','ScriptPath','pageID'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k='TimeSpentChatNubLoggerConfig',l={INPUT_ACTIVE:'active',INPUT_INACTIVE:'inactive'},m={ENTER:'enter',LEAVE:'leave'},n=l.INPUT_INACTIVE,o=0,p=false;function q(){if(n==l.INPUT_ACTIVE&&!p){n=l.INPUT_INACTIVE;r(m.LEAVE);o=0;}else if(n==l.INPUT_INACTIVE&&p){n=l.INPUT_ACTIVE;o=Date.now();r(m.ENTER);}}function r(event){var t=h.create({retry:true}),u=Date.now();t.log(k,{event:event,client_event_time_ms:u,active_time_ms:event==m.LEAVE?u-o:0,page_id:j,script_path:i.getScriptPath(),page_data:i.getPageInfo()?i.getPageInfo().extraData:{}});}var s={processEvent:function(t){switch(t){case 'focus':p=true;break;case 'blur':p=false;break;default:break;}q();}};f.exports=s;},null);
__d('ChatPhotoUploader.react',['Promise','Bootloader','Image.react','InlineBlock.react','Link.react','MercuryConfig','React','ReactDOM','SubscriptionsHandler','cx','emptyFunction','fbt','ix','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';if(c.__markCompiled)c.__markCompiled();var v=n.PropTypes,w=n.createClass({displayName:'ChatPhotoUploader',propTypes:{actionURI:v.string,allowCrossPage:v.bool,customUI:v.bool,disabled:v.bool,imageClassName:v.string,imagesOnly:v.bool,linkClassName:v.string,onSubmit:v.func,onAllUploadsComplete:v.func,onLastUploadFail:v.func,onLastUploadCancel:v.func,onMount:v.func,onUploadError:v.func},getDefaultProps:function(){return {actionURI:m.upload_url,allowCrossPage:true,costomUI:false,disabled:false,imageClassName:"_509w",imagesOnly:true,linkClassName:'',onSubmit:r,onAllUploadsComplete:r,onLastUploadFail:r,onLastUploadCancel:r};},shouldComponentUpdate:function(x,y){return x.actionURI!=this.props.actionURI||x.disabled!==this.props.disabled;},componentDidMount:function(){if(this.props.onMount)this.props.onMount(this);},componentDidUpdate:function(x,y){if(this._uploader)this._uploader.setAllowCrossPage(this.props.allowCrossPage);},componentWillUnmount:function(){if(!this.isUploading()||!this.props.allowCrossPage)this._cleanup();},render:function(){var x=this.props.imagesOnly?s._("Ajouter des photos"):s._("Ajouter des fichiers"),y=u("_4q61"+(!this.props.customUI?' '+"_5f0v":'')+(!this.props.customUI?' '+"_509v":''),this.props.linkClassName);return (n.createElement('form',{action:this.props.actionURI,className:"_vzk",title:x,method:'post',onClick:function(z){z.stopPropagation();if(this.props.disabled)z.preventDefault();}.bind(this),ref:'form'},n.createElement('input',{type:'hidden',name:'attach_id',ref:'attachID'}),n.createElement('input',{type:'hidden',name:'images_only',value:this.props.imagesOnly}),n.createElement(k,{onClick:this._bootloadChatAutoSendPhotoUploader,className:u(this.props.className,"_m _4q60 _3rzn")},n.createElement('input',{disabled:this.props.disabled,type:'file',className:"_n _2__f",name:'attachment[]',multiple:'true',accept:this.props.imagesOnly?'image/*':'*',ref:'input',title:x}),n.createElement(l,{className:y,tabIndex:-1},n.createElement('i',{className:this.props.imageClassName,alt:s._("Appareil photo")})))));},_handleSubmit:function(x,y){this.props.onSubmit(x,y);},_handleAllUploadsCompleted:function(x,y){this.props.onAllUploadsComplete(x,y);if(!this.isMounted())this._cleanup();},_handleLastUploadFailed:function(x,y){this.props.onLastUploadFail(x,y);if(!this.isMounted())this._cleanup();},_handleLastUploadCanceled:function(x,y){this.props.onLastUploadCancel(x,y);if(!this.isMounted())this._cleanup();},_handleUploadError:function(x,y){this.props.onUploadError(y);if(!this.isMounted())this._cleanup();},isUploading:function(){return (this._uploader&&this._uploader.isUploading()||this._uploaderPromiseIsResolving);},_bootloadChatAutoSendPhotoUploader:function(){if(!this._uploaderPromise){this._uploaderPromiseIsResolving=true;this._uploaderPromise=new h(function(x){i.loadModules(["ChatAutoSendPhotoUploader"],function(y){this._uploaderPromiseIsResolving=false;this._uploader=new y(o.findDOMNode(this.refs.form),o.findDOMNode(this.refs.input),o.findDOMNode(this.refs.attachID));this._uploader.setAllowCrossPage(this.props.allowCrossPage);this._subscriptions=new p();this._subscriptions.addSubscriptions(this._uploader.subscribe('submit',this._handleSubmit),this._uploader.subscribe('all-uploads-completed',this._handleAllUploadsCompleted),this._uploader.subscribe('last-upload-failed',this._handleLastUploadFailed),this._uploader.subscribe('last-upload-canceled',this._handleLastUploadCanceled),this._uploader.subscribe('file-upload-error',this._handleUploadError));x(this._uploader);}.bind(this));}.bind(this));}return this._uploaderPromise;},uploadFiles:function(x){this._bootloadChatAutoSendPhotoUploader().then(function(y){y.uploadFiles(x);});},uploadURL:function(x){this._bootloadChatAutoSendPhotoUploader().then(function(y){y.uploadURL(x);});},_cleanup:function(){this._subscriptions&&this._subscriptions.release();this._uploader&&this._uploader.destroy();}});f.exports=w;},null);
__d('ChatDateBreak.react',['React','cx','formatDate','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=h.PropTypes,m=h.createClass({displayName:'ChatDateBreak',propTypes:{date:l.instanceOf(Date).isRequired},shouldComponentUpdate:function(n){return this.props.date.getTime()!==n.date.getTime();},render:function(){var n=j(this.props.date,{today:'g:ia',withinWeek:'D g:ia',thisYear:'M jS, g:ia',older:'m/d/Y g:ia'});return (h.createElement('time',{className:k(this.props.className,"_5w-5")},h.createElement('span',{className:"_5w-6"},n)));}});f.exports=m;},null);
__d('ChatAnimatedGifs',['URI'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={shouldHideBody:function(j){if(!j.has_attachment)return false;for(var k=0;k<j.attachments.length;k++){var l=j.attachments[k];if(l.preview_url){var m=i.getRawUrlFromSafeUrl(l.preview_url);if(j.body==m)return true;}}return false;},getRawUrlFromSafeUrl:function(j){return new h(j).getQueryData().url;}};f.exports=i;},null);
__d('ChatAttachmentProgressBar.react',['Animation','React','cx'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=i.PropTypes,l=34,m=i.createClass({displayName:'ChatAttachmentProgressBar',propTypes:{ephemeralTTLMode:k.number.isRequired,timestamp:k.number.isRequired,isMessageAuthor:k.bool},componentDidMount:function(){if(!this.refs.progressBar)return;var n=l,o=this.props.ephemeralTTLMode,p=n/o*(Date.now()-this.props.timestamp),q=this._getRemainingTime();if(q>0&&p<n){var r=this.props.isMessageAuthor?'left':'right';new h(this.refs.progressBar).from(r,p).to(r,n).duration(q).go();}},_getRemainingTime:function(){return this.props.ephemeralTTLMode-(Date.now()-this.props.timestamp);},render:function(){return (i.createElement('a',{className:"_4yo"},i.createElement('span',{className:"_1gxq"}),i.createElement('span',{className:"_1gxr",ref:'progressBar'},i.createElement('span',{className:"_4yu"}))));}});f.exports=m;},null);
__d('ChatProgressBar.react',['React','cx'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=h.PropTypes,k=2000,l=250,m=h.createClass({displayName:'ChatProgressBar',_timer:null,propTypes:{isMessageAuthor:j.bool,onDone:j.func,setExpiredAnimation:j.func,timestamp:j.number.isRequired,ttl:j.number.isRequired},getInitialState:function(){return {percentage:this._getRemainingPercentage()};},componentDidMount:function(){if(this._getRemainingTime()>0){this._animateProgressBar();}else this.props.setExpiredAnimation&&this.props.setExpiredAnimation();},componentWillUnmount:function(){this._timer&&clearTimeout(this._timer);},render:function(){return (h.createElement('div',{className:"_3pcc"+(this._getRemainingTime()<0?' '+"_3pcd":''),ref:'item',style:{width:this.state.percentage.toString()+'%'}}));},_getRemainingTime:function(){return this.props.ttl-(Date.now()-this.props.timestamp)-k;},_getRemainingPercentage:function(){return 100-(Date.now()-this.props.timestamp)/(this.props.ttl-k)*100;},_animateProgressBar:function(){this._timer=setInterval(function(){if(this.isMounted())this.setState({percentage:this._getRemainingPercentage()});if(this._getRemainingTime()<0){clearTimeout(this._timer);this.props.onDone&&this.props.onDone();}}.bind(this),l);}});f.exports=m;},null);
__d('EmojiOnlyMessage.react',['React','cx'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=h.PropTypes,k=h.createClass({displayName:'EmojiOnlyMessage',propTypes:{sourceURIs:j.arrayOf(j.shape({type:j.string.isRequired,title:j.string,url:j.string.isRequired})).isRequired},render:function(){var l=this.props.sourceURIs,m=0,n=l.map(function(o){m++;return h.createElement('span',{className:"_5qi2",key:m,style:{backgroundImage:'url('+o.url+')'},title:o.title});});return (h.createElement('div',{className:this.props.className,tabIndex:'0'},n));}});f.exports=k;},null);
__d('EmployeeLinkMatcher',['CurrentUser'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=new RegExp('^[\\s.,:]'),j=new RegExp('(?:[\\s.,:]|^)([DTP]\\d{4,})(?:[\\s.,:?]|$)','im'),k=function(n){if(!h.isEmployee())return null;var o=j.exec(n);if(o==null)return null;return {lnk:o[1],idx:o.index+(i.exec(o[0])?1:0)};},l=function(n){var o=h.isEmployee()&&j.exec(n)!=null;return o;},m={match:k,isMatch:l};f.exports=m;},null);
__d('EmployeeLinkRanges',['EmployeeLinkMatcher'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={PHABRICATOR_PREFIX:'https://phabricator.fb.com/',TASKS_PREFIX:'https://our.intern.facebook.com/intern/tasks/?t=',get:function(j){var k=arguments.length<=1||arguments[1]===undefined?0:arguments[1],l=j.substr(k),m=h.match(l);if(!m)return [];var n=m.lnk;k+=m.idx;var o='';switch(n[0].toLowerCase()){case 'd':case 'p':o=this.PHABRICATOR_PREFIX+n.toUpperCase();break;case 't':o=this.TASKS_PREFIX+n.substr(1);break;default:return [];}var p=n.length,q=[{offset:k,length:p,entity:{url:o}}];return q.concat(this.get(j,k+p));}};f.exports=i;},null);
__d('P2PTriggersUtils',['P2PGKValues'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=/\$((\d{1,3}(,\d{3})*)|\d+)(\.\d{1,2})?(?=\s|\.\s|\,\s|$|\.$|\,$|\?|\!|\")/,j={canSeeTriggers:function(k){if(!h.P2PEnabled)return false;return true;},getMatches:function(k){return k.match(i);}};f.exports=j;},null);
__d('getURLRanges',['URI','URLScraper'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(k){var l=arguments.length<=1||arguments[1]===undefined?0:arguments[1],m=k.substr(l),n=i.match(m);if(!n)return [];var o=n;if(!/^[a-z][a-z0-9\-+.]+:\/\//i.test(n))o='http://'+n;if(!h.isValidURI(o))return [];l+=m.indexOf(n);var p=n.length,q=[{offset:l,length:n.length,entity:{url:o}}];return q.concat(j(k,l+p));}f.exports=j;},null);
__d('MercuryMessageBody.react',['BootloadedComponent.react','EmoticonsList','EmployeeLinkMatcher','JSResource','Link.react','P2PTriggersUtils','ReactComponentWithPureRenderMixin','React','SupportedEmoji','TextWithEntities.react','URI','URLMatcher','cancelAnimationFrame','cx','EmployeeLinkRanges','fbt','getURLRanges','isFacebookURI','requestAnimationFrame'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){if(c.__markCompiled)c.__markCompiled();var aa=o.PropTypes,ba=o.createClass({displayName:'MercuryMessageBody',mixins:[n],propTypes:{body:aa.string,ranges:aa.array,threadID:aa.string,customLike:aa.object},getInitialState:function(){return {richText:false};},_shouldRenderP2PTriggers:false,componentDidMount:function(){this._raf=z(this.setIsRichText);},targetBlankLinkInterpolator:function(ca,da){if(da.entity&&da.entity.url){var ea=new r(da.entity.url);if(y(ea)&&!ea.getFragment())da.entity.url=ea.addQueryData({__mref:'message_bubble'}).toString();da.entity.url=/.*[^#]/.exec(da.entity.url)[0];}return (o.createElement(l,{href:da.entity.url,shimhash:da.entity.shimhash,s:da.entity.s,target:'_blank'},ca));},setIsRichText:function(){delete this._raf;var ca=this.props,da=ca.body,ea=ca.ranges;da=da||'';this._shouldRenderP2PTriggers=!!(this.props.threadID&&m.canSeeTriggers(this.props.threadID)&&m.getMatches(da));if(ea&&ea.length||i.noncapturingRegexp.test(da)||p.findEmoji(da)||s.match(da)||j.isMatch(da)||this._shouldRenderP2PTriggers)this.setState({richText:true});},componentWillUnmount:function(){this._raf&&t(this._raf);},render:function(){var ca=this.props.body||'';if(ca.startsWith('?OTR'))return (o.createElement('span',{className:"_89h"},w._("[message chiffr\u00e9]")));ca=ca.replace(/\s+$/,'');if(ca.length===0)return null;if(!this.state.richText)return o.createElement('span',{className:this.props.className},ca);var da=this.props.ranges;if(da==undefined)da=x(ca);if(da==undefined){da=v.get(ca);}else{da=da.concat(v.get(ca));da=da.filter(function(ga){return ga!=undefined;});}var ea={className:this.props.className,interpolator:this.targetBlankLinkInterpolator,text:ca,ranges:da,renderEmoticons:true,renderEmoji:true},fa=o.createElement(q,ea);if(this._shouldRenderP2PTriggers){return (o.createElement(h,babelHelpers['extends']({bootloadPlaceholder:fa,bootloadLoader:k('TextWithEntitiesAndP2P.react')},ea,{threadID:this.props.threadID})));}else return fa;}});f.exports=ba;},null);
__d('MessageBubbleMixin',['DOMDimensions','ReactDOM'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=2,k={getInitialState:function(){return {bubbleWidth:null};},componentDidMount:function(){this._restyleBubble(this.props);},componentDidUpdate:function(l){if(l.maxWidth!==this.props.maxWidth||l.body!==this.props.body||!l.attachments&&this.props.attachments)this._restyleBubble(l);},_restyleBubble:function(l){if(this.props.attachments){this.setState({bubbleWidth:null});return;}var m=i.findDOMNode(this.refs.bubble);if(l.maxWidth!==this.props.maxWidth||h.getElementDimensions(m).width>this.props.maxWidth){var n=this.props.maxWidth;this.setState({bubbleWidth:n},this._shrinkBubble);return;}this._shrinkBubble();},_shrinkBubble:function(){var l=i.findDOMNode(this.refs.bubble),m=h.getElementDimensions(l).width,n=i.findDOMNode(this.refs.content),o=n?h.getElementDimensions(n).width+h.measureElementBox(i.findDOMNode(this.refs.contentWrapper),'width',true,false,false):0,p=o+j;if(o>0&&p<this.props.maxWidth&&m-p-this.getBoxWidth()>0)this.setState({bubbleWidth:p});}};f.exports=k;},null);
__d('MessagingGiftWrap.react',['CurrentEnvironment','ReactComponentWithPureRenderMixin','React','cx','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=j.PropTypes,n=j.createClass({displayName:'MessagingGiftWrap',mixins:[i],propTypes:{isSticker:m.bool,onUnwrap:m.func},getDefaultProps:function(){return {onUnwrap:l};},getInitialState:function(){return {unwrapped:false};},render:function(){var o=h.messengerdotcom;return (j.createElement('div',{className:"_4p0m"+(this.state.unwrapped?' '+"_4p0o":'')+(o?' '+"_mxz":'')+(o?' '+"_4br2":'')+(!o?' '+"_3_om":'')+(this.props.isSticker?' '+"_52vq":''),onClick:this._handleClick},j.createElement('div',{className:"_4p0r"}),j.createElement('div',{className:"_4p0s _4p0t"}),j.createElement('div',{className:"_4p0s _4p0u"})));},_handleClick:function(o){o.stopPropagation();this.setState({unwrapped:true});this.props.onUnwrap&&this.props.onUnwrap();}});f.exports=n;},null);
__d('ChatBubble.react',['Animation','ChatProgressBar.react','DOMDimensions','EmojiLikeUtils','EmojiOnlyMessage.react','MercuryAttachment','MercuryMessageBody.react','MercuryTagHelper','MessageBubbleMixin','MessagingGiftWrap.react','React','ReactDOM','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';if(c.__markCompiled)c.__markCompiled();var v=r.PropTypes,w=1000,x=r.createClass({displayName:'ChatBubble',_boxWidth:0,mixins:[p],propTypes:{attachments:v.node,body:v.string,customLike:v.object,isEmojiLike:v.bool,isGiftWrapped:v.bool,isMessageAuthor:v.bool,maxWidth:v.number.isRequired,onUnwrap:v.func,threadID:v.string,timestamp:v.number,ttl:v.number},getInitialState:function(){return {emojis:undefined,ephemeralExpiring:false,ephemeralExpired:false};},componentDidMount:function(){if(this.props.attachments&&!this.props.isEmojiLike)return;if(!this.props.emojis){var y=this.props.body||'',z=k.richContent(y);if(z)this.setState({emojis:z});}},render:function(){var y=this.props.body||'';return (r.createElement('div',babelHelpers['extends']({},this.props,{className:u("_5w1r"+(this._isEpehmeralStylePreferred()?' '+"_4gx-":'')+(this.state.ephemeralExpiring?' '+"_1xti":'')+(this.state.ephemeralExpired?' '+"_1xtj":'')+(!this.state.emojis?' '+"_3_om":'')+(!!this.state.emojis?' '+"_31xx":''),this.props.className),ref:'bubble',style:{maxWidth:this.props.maxWidth,width:this.state.emojis?null:this.state.bubbleWidth,wordWrap:y.length>=15?'break-word':'inherit'}}),this._renderProgressBar(),r.createElement('div',{className:"_4gx_",ref:'inner'},this._renderContent(),this.props.attachments),this.props.isGiftWrapped?r.createElement(q,{onUnwrap:this.props.onUnwrap}):null));},_renderContent:function(){if(!this.props.body||this.props.isEmojiLike)return null;if(this.state.emojis){var y=k.getSourceURIs(this.state.emojis),z=r.createElement(l,{sourceURIs:y});}else z=r.createElement(n,{body:this.props.body,ranges:this.props.ranges,threadID:this.props.threadID,customLike:this.props.customLike});return (r.createElement('div',{className:"_d97"+(!!this.state.emojis?' '+"_31xy":''),ref:'contentWrapper'},r.createElement('span',{className:"_5yl5",ref:'content'},z)));},_isEpehmeralStylePreferred:function(){if(!this.props.ttl)return false;if(!this.props.attachments)return true;return this.props.attachments.props.attachments.every(function(y){return m.isEphemeralTextStyle(y);});},_onProgressBarAnimationDone:function(){if(this.isMounted()){this.setState({ephemeralExpiring:true});new h(this.refs.inner).to('opacity',0).duration(w).go();}},_setExpiredAnimation:function(){if(this.isMounted()){this.setState({ephemeralExpiring:true});this.setState({ephemeralExpired:true});}},_renderProgressBar:function(){if(!this.props.timestamp||!this.props.ttl||!this._isEpehmeralStylePreferred()||this.state.emojis&&this.state.emojis.length>0)return null;return (r.createElement(i,{ttl:this.props.ttl,timestamp:this.props.timestamp,isMessageAuthor:this.props.isMessageAuthor,onDone:this._onProgressBarAnimationDone,setExpiredAnimation:this._setExpiredAnimation}));},contentWraps:function(){var y=s.findDOMNode(this.refs.content),z=y.getClientRects(),aa=j.getElementDimensions(y).height;return z&&z.length>1&&z[0].height<aa;},getBoxWidth:function(){if(!this._boxWidth)this._boxWidth=j.measureElementBox(s.findDOMNode(this.refs.bubble),'width',true,true,false);return this._boxWidth;}});f.exports=x;},null);
__d('MercuryMessageDeliveryState',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={SENDING:1,SENT:2,DELIVERED:3,ERROR:0,UNKNOWN:-1};f.exports=h;},null);
__d('MercuryMessageInfo',['MercuryActionStatus','MercuryMessageDeliveryState','MercuryViewer'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k={isOutbound:function(l){return l.author===j.getID();},isInbound:function(l){return !k.isOutbound(l);},isSending:function(l){return (l.status===h.UNSENT||l.status===h.UNCONFIRMED||l.status===h.UNABLE_TO_CONFIRM||l.status===h.RESENDING);},isSent:function(l){return (l.status===undefined||l.status===h.SUCCESS);},hasError:function(l){return (l.status===h.FAILED_UNKNOWN_REASON||l.status===h.UNABLE_TO_CONFIRM||l.status===h.ERROR);},getDeliveryState:function(l,m){if(this.hasError(l))return i.ERROR;if(this.isSending(l))return i.SENDING;if(this.isSent(l)){if(l.timestamp<=m)return i.DELIVERED;return i.SENT;}return i.UNKNOWN;}};f.exports=k;},null);
__d('MercuryErrorInfo',['MercuryErrorType','MercuryMessageInfo','fbt'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={getMessage:function(l){var m='';if(k.isConnectionError(l)){m=j._("Ce message n\u2019a pas \u00e9t\u00e9 envoy\u00e9.");if(k.isTransient(l))m=j._("{message} V\u00e9rifiez votre connexion Internet et cliquez pour r\u00e9essayer.",[j.param('message',m)]);}else{if(l&&l.description){m=l.description;}else m=j._("Le message n\u2019a pas pu \u00eatre envoy\u00e9.");if(k.isTransient(l))m=j._("{message} Cliquez pour renvoyer.",[j.param('message',m)]);}return m;},isConnectionError:function(l){if(l&&l.type==h.TRANSPORT)return l.code===1001||l.code===1004||l.code===1006;return false;},isTransient:function(l){return l&&l.is_transient;},isPermanent:function(l){return l?!this.isTransient(l):false;},hasErrorStatus:function(l){return i.hasError(l);}};f.exports=k;},null);
__d('MercuryMessageError.react',['CurrentUser','ImmutableObject','MercuryErrorInfo','MercuryMessageActions','React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=l.PropTypes,p=l.createClass({displayName:'MercuryMessageError',propTypes:{authorFBID:o.string,message:o.instanceOf(i).isRequired},getDefaultProps:function(){return {authorFBID:h.getID()};},render:function(){var q=this.props.message,r=q.error_data;return (l.createElement('div',babelHelpers['extends']({},this.props,{className:n(this.props.className,this._getClassNameFromStatus(q)),tabIndex:j.isTransient(r)?0:null,onClick:j.isTransient(r)?this.messageResend:null}),l.createElement('div',{className:"_2fs1"}),l.createElement('span',{dangerouslySetInnerHTML:{__html:this._getTextFromStatus(q)}})));},messageResend:function(){k.getForFBID(this.props.authorFBID).resend(this.props.message);},_getClassNameFromStatus:function(q){if(j.hasErrorStatus(q)){return "_2fs2"+(' '+"_2fs3")+(j.isTransient(q.error_data)?' '+"_2fs4":'')+(j.isPermanent(q.error_data)?' '+"_2fs5":'');}else return "_2fs6 _2fs2";},_getTextFromStatus:function(q){var r='',s=q.error_data;if(j.hasErrorStatus(q))r=j.getMessage(s);if(typeof r==='object'&&r.__html)r=r.__html;return r;}});f.exports=p;},null);
__d('MercuryTimestamp',['fbt','formatDate','MercuryTimePassed'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=86400000,l=6*k,m={getFormatedTimestamp:function(n){var o=n/1000;return m.getFormattedTimestampByBucket(o,this.getTimeBucket(n));},getFormattedTimestampByBucket:function(n,o){switch(o){case j.TODAY:return {absolute:h._("Aujourd\u2019hui"),relative:i(n,'g:ia')};case j.WEEK_AGO:return {absolute:i(n,'l'),relative:i(n,'D')};case j.CURRENT_YEAR:return {absolute:i(n,'F j'),relative:i(n,'M j')};default:return {absolute:i(n,'F j, Y'),relative:i(n,'n/j/y')};}},getTimeBucket:function(n){var o=new Date(n),p=new Date(),q=new Date(p.getFullYear(),p.getMonth(),p.getDate());if(q<o){return j.TODAY;}else if(q-l<o){return j.WEEK_AGO;}else if(q.getFullYear()===o.getFullYear()){return j.CURRENT_YEAR;}else return j.OTHER_YEAR;},getPreciseTimestamp:function(n){return i(new Date(n),m.getPreciseFormat(n));},getPreciseFormat:function(n){var o=m.getTimeBucket(n);switch(o){case j.TODAY:return 'g:ia';case j.WEEK_AGO:return 'l g:ia';case j.CURRENT_YEAR:return 'F jS, g:ia';case j.OTHER_YEAR:default:return 'F j, Y g:i a';}}};f.exports=m;},null);
__d('ChatMessage.react',['BootloadedComponent.react','ChatAnimatedGifs','ChatAttachmentProgressBar.react','ChatBubble.react','EmojiLikeUtils','MercuryTimestamp','CSS','CurrentUser','ImmutableObject','JSResource','MercuryAttachment','MercuryErrorInfo','MercuryIDs','MercuryMessageActions','MercuryMessageError.react','MercuryMessageInfo','MercuryThreads','MessagingGiftWrapChecker','MercuryDisplayTimeFilterMessageRenderer','React','ReactDOM','XUISpinner.react','cssVar','cx','fbt','isRTL','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){'use strict';if(c.__markCompiled)c.__markCompiled();var ia=aa.PropTypes,ja=aa.createClass({displayName:'ChatMessage',propTypes:{message:ia.instanceOf(p).isRequired,maxBubbleWidth:ia.number.isRequired,onAttachmentLoad:ia.func,onStickerClick:ia.func},componentDidMount:function(){n.conditionClass(ba.findDOMNode(this),"_2cnu",this.isOneLine());},isOneLine:function(){var ka=this.props.message;return (w.isInbound(ka)&&!this.refs.attachmentsInside&&this.refs.bubble&&!this.refs.bubble.contentWraps());},shouldComponentUpdate:function(ka,la){return ka.message!==this.props.message;},render:function(){var ka=this.props.message,la=r.get(ka).length>0,ma=w.isInbound(ka),na=t.isGroupChat(ka.thread_id),oa=ga(ka.body),pa=s.hasErrorStatus(ka),qa="_5wd4"+(ma?' '+"_1nc7":'')+(!ma?' '+"_1nc6":'')+(la?' '+"_2_-t":'')+(ma&&na?' '+"_5ysy":'')+(pa?' '+"_1zcs":'')+(oa?' '+"direction_rtl":'')+(!oa?' '+"direction_ltr":'');return (aa.createElement('div',{className:ha(this.props.className,qa)},this._renderInner(),this._renderUndertext()));},_renderInner:function(){var ka=this.props.message,la={};if(w.isOutbound(ka)){var ma=fa._("{time}",[fa.param('time',m.getPreciseTimestamp(ka.timestamp))]);la['data-hover']='tooltip';la['data-tooltip-position']='right';la['data-tooltip-content']=ma;}if(ka.is_filtered_content)return (aa.createElement('div',babelHelpers['extends']({className:"_5wd9 _5wdc uiBoxYellow clearfix",ref:'inner'},la),z.renderFilteredContent(ka)));return (aa.createElement('div',babelHelpers['extends']({className:"_5wd9",ref:'inner'},la),this._renderBubble(),this._renderAttachments('outside')));},_renderUndertext:function(){if(this.props.message.is_filtered_content)return null;return (aa.createElement('div',{className:"_3ry4",ref:'undertext'},aa.createElement(v,{className:"_5wda clearfix",message:this.props.message,ref:'status'}),this._renderSpoofWarning()));},_renderSpoofWarning:function(){return (this.props.message.is_spoof_warning?aa.createElement(h,{bootloadPlaceholder:aa.createElement('span',null),bootloadLoader:q('MercurySpoofWarning.react'),authorID:this.props.message.author,className:"_5wdb"}):null);},_getAttachmentPlaceholder:function(){return (aa.createElement('div',{style:{padding:'20px',text_align:'center'}},aa.createElement(ca,null)));},_renderProgressBar:function(){var ka=this.props.message;if(!ka.ephemeral_ttl_mode||!ka.timestamp)return null;return (aa.createElement(j,{ephemeralTTLMode:ka.ephemeral_ttl_mode,timestamp:ka.timestamp,isMessageAuthor:!w.isInbound(ka)}));},_renderAttachments:function(ka){var la=this.props.message,ma=x.getForFBID(o.getID()).getThreadMetaNow(la.thread_id),na=ma?ma.custom_like_icon:null,oa=ka=='inside'?'attachmentsInside':'attachmentsOutside',pa=r.get(la).filter(function(ra){var sa=r.isBubblePreferred(ra);return sa&&ka==='inside'||!sa&&ka==='outside';}),qa=la.attachments.length>0&&la.attachments.every(function(ra){return r.isEphemeralAttachmentStyle(ra);});if(pa.length>0)return (aa.createElement(h,{bootloadPlaceholder:this._getAttachmentPlaceholder(),bootloadLoader:q('MercuryAttachments.react'),className:(ka==='outside'?"_3e7u":'')+(!!la.body?' '+"_16ys":'')+(!!la.ephemeral_ttl_mode?' '+"_3-rb":'')+(' '+"_n4o"),attachments:pa,customLike:na,isChat:true,isGiftWrapped:y.shouldRenderWithGiftWrap(la)&&ka==='outside',maxWidth:this.props.maxBubbleWidth,message:la,onUnwrap:this._handleUnwrap,renderProgressBar:qa?this._renderProgressBar:null,onAttachmentLoad:this.props.onAttachmentLoad,onStickerClick:this.props.onStickerClick,ref:oa}));},_renderBubble:function(){var ka=this.props.message,la=ka.body,ma=this._renderAttachments('inside'),na=w.isInbound(ka);if(i.shouldHideBody(ka))la='';if(la||ma)return (aa.createElement('div',{className:"_5wde _n4o"},aa.createElement(k,{attachments:ma,body:la,className:"_5wdf",isMessageAuthor:!na,maxWidth:this.props.maxBubbleWidth,ranges:ka.ranges,ref:'bubble',isEmojiLike:l.isEmojiLike(ka),isGiftWrapped:y.shouldRenderWithGiftWrap(ka),onUnwrap:this._handleUnwrap,threadID:ka.thread_id,ttl:ka.ephemeral_ttl_mode,timestamp:ka.timestamp,customLike:ka.customLike})));},_handleUnwrap:function(){var ka="2500ms";setTimeout(function(){return this._persistUnwrapping();}.bind(this),ka.substring(0,ka.length-2));},_persistUnwrapping:function(){u.get().unwrap(this.props.message);}});f.exports=ja;},null);
__d('ChatMessageGroup.react',['ChatConfig','ChatDateBreak.react','ChatMessage.react','Image.react','immutable','ImmutableObject','MercuryIDs','MercuryParticipants','MercuryTimestamp','React','StoreAndPropBasedStateMixin','cx','fbt','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){'use strict';if(c.__markCompiled)c.__markCompiled();var u=c('MercuryThreads').get(),v=q.PropTypes,w=new m({name:'',href:'#',image_src:''}),x=h.get('chattab_rounded_profile',false),y=q.createClass({displayName:'ChatMessageGroup',mixins:[r(o)],propTypes:{activeMessageID:v.string,author:v.string,hasDateBreak:v.bool,isCanonical:v.bool,isFromViewer:v.bool,isPageMessage:v.bool,maxBubbleWidth:v.number,messages:v.instanceOf(l.List).isRequired,onAttachmentLoad:v.func,onStickerClick:v.func,threadID:v.string},statics:{calculateState:function(aa){return {participants:z(aa)};}},shouldComponentUpdate:function(aa,ba){return (this.props.activeMessageID!==aa.activeMessageID||this.props.isFromViewer!==aa.isFromViewer||!l.is(this.props.messages,aa.messages)||!l.is(this.state.participants,ba.participants));},render:function(){return (q.createElement('div',{className:"_4tdt"},this._renderProfileColumn(),this._renderName(),q.createElement('div',{className:"_4tdv"},this._renderMessages())));},_renderProfileColumn:function(){if(this.props.isFromViewer)return null;var aa=this.state.participants.get(this.props.author)||w,ba=t._("{name} {time}",[t.param('name',aa.name),t.param('time',p.getPreciseTimestamp(this.props.messages.last().timestamp))]),ca=aa.image_src?q.createElement(k,{src:aa.image_src}):null;return (q.createElement('div',{className:"_31o4"+(x?' '+"_3njy":'')},q.createElement('a',{'aria-label':ba,className:"_4tdw",'data-hover':'tooltip','data-tooltip-content':ba,'data-tooltip-position':'left',href:aa.href,ref:'link'},ca)));},_renderName:function(){if(this.props.isCanonical||this.props.isFromViewer)return null;var aa=this.state.participants.get(this.props.messages.first().author);if(!aa)return null;var ba=u.getThreadMetaNow(this.props.threadID),ca=aa.short_name;if(ba&&ba.custom_nickname){var da=n.getUserIDFromParticipantID(aa.id);if(ba.custom_nickname[da])ca=ba.custom_nickname[da];}return (q.createElement('div',{className:"_4tdx"},ca));},_renderMessages:function(){var aa=this.props.messages.size,ba=[];this.props.messages.forEach(function(ca,da,ea){var fa=ca.message_id===this.props.activeMessageID;if(fa&&!(da===0&&this.props.hasDateBreak))ba.push(q.createElement(i,{date:new Date(ca.timestamp),key:'db:'+ca.message_id}));ba.push(q.createElement(j,{isFromViewer:this.props.isFromViewer,key:ca.message_id,maxBubbleWidth:this.props.maxBubbleWidth,message:ca,nextTimestamp:this._getNextTimestamp(ea,aa,da),onAttachmentLoad:this.props.onAttachmentLoad,onStickerClick:this.props.onStickerClick}));}.bind(this));return ba;},_getNextTimestamp:function(aa,ba,ca){return ca<ba-1?aa.get(ca+1).timestamp:this.props.nextTimestamp;}});function z(aa){return l.Map().withMutations(function(ba){aa.readReceipts.forEach(function(ca,da){ba.set(da,o.getOrFetch(da));});ba.set(aa.author,o.getOrFetch(aa.author));});}f.exports=y;},null);
__d('MNCommerceActionTypes',['keyMirrorRecursive'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=h({RECEIPT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},SHIPMENT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},DIALOG:{SHOW:null,HIDE:null},RETAIL_ITEM:{LOADED:null,LOAD_ERROR:null,RELOAD:null},PROMOTION_STATE:{LOADED:null,LOAD_ERROR:null,RELOAD:null}});f.exports=i;},null);
__d('MessengerDispatcher',['Dispatcher_DEPRECATED'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);
__d('MercuryXMATRenderer',['MercuryIDs','MercuryParticipants','MessagingGenericAdminTextType','MNAdsMessageUtils','React','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n={renderText:function(o){var p=o.log_message_body;switch(o.log_message_data.message_type){case j.TURN_ON_PUSH:var q=o.log_message_data.untypedData&&o.log_message_data.untypedData.recipient_id,r=q&&i.getNow(h.getParticipantIDFromUserID(q)),s=h.getUserIDFromParticipantID(o.author),t=i.getNow(h.getParticipantIDFromUserID(s));if(s!==o.other_user_fbid){if(r){p=m._("Vous avez demand\u00e9 \u00e0 {admin-text-message} d\u2019activer les notifications pour Messenger sur mobile.",[m.param('admin-text-message',r.name)]);}else p=m._("You asked a contact to turn on notifications for Messenger on mobile.");}else if(t){p=m._("{admin-text-message} vous a demand\u00e9 d\u2019activer les notifications pour Messenger sur mobile.",[m.param('admin-text-message',t.name)]);}else p=m._("A contact asked you to turn on notifications for Messenger on mobile.");break;case j.JOURNEY_PROMPT_COLOR:p=m._("Vous devez avoir install\u00e9 la derni\u00e8re version de Messenger sur un appareil mobile pour choisir une couleur pour cette conversation.");break;case j.JOURNEY_PROMPT_NICKNAME:var u=null,v=h.getUserIDFromParticipantID(o.author);if(o.other_user_fbid&&v!==o.other_user_fbid){var w=h.getParticipantIDFromUserID(o.other_user_fbid);u=i.getOrFetch(w);}if(u&&u.short_name){p=m._("You need to be on the latest version of Messenger on a mobile device to set a nickname for {admin-text-message} .",[m.param('admin-text-message',u.short_name)]);}else p=m._("Vous devez avoir install\u00e9 la derni\u00e8re version de Messenger sur un appareil mobile pour vous donner un surnom.");break;case j.JOURNEY_PROMPT_LIKE:p=m._("Vous devez avoir install\u00e9 la derni\u00e8re version de Messenger sur un appareil mobile pour choisir un \u00e9motic\u00f4ne pour cette conversation.");break;case j.JOURNEY_PROMPT_BOT:p=m._("Vous devez avoir install\u00e9 la derni\u00e8re version de Messenger sur un appareil mobile pour ajouter un abonnement \u00e0 cette conversation.");break;case j.AD_MANAGE_MESSAGE:if(k.isAdsAdminMessage(o))p=k.getAdsPageManage(o,false);break;default:break;}return l.createElement('span',null,p);}};f.exports=n;},null);
__d('PhotoStoreCore',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={actions:{UPDATE:'update'},_photoCache:{},_postCreateCallbacks:{},getPhotoCache:function(i){if(!this._photoCache[i])throw new Error('Photo cache requested for unknown set ID');return this._photoCache[i];},hasBeenCreated:function(i){return !!this._photoCache[i];},clearSetCache:function(i){delete this._photoCache[i];delete this._postCreateCallbacks[i];},getByIndex:function(i,j,k){this.getPhotoCache(i).getItemAtIndex(j,k);},getByIndexImmediate:function(i,j){if(this._photoCache[i])return this._photoCache[i].getItemAtIndexImmediate(j);return undefined;},getItemsInAvailableRange:function(i){var j=this.getAvailableRange(i),k=[];for(var l=j.offset;l<j.length;l++)k.push(this.getByIndexImmediate(i,l));return k;},getItemsAfterIndex:function(i,j,k,l){var m=this.getCursorByIndexImmediate(i,j);this.fetchForward(i,m,k,l);},getAllByIDImmediate:function(i){var j=Object.keys(this._photoCache);return j.map(function(k){return this.getByIndexImmediate(k,this.getIndexForID(k,i));}.bind(this)).filter(function(k){return !!k;});},getIndexForID:function(i,j){if(this._photoCache[i])return this._photoCache[i].getIndexForID(j);return undefined;},getEndIndex:function(i){var j=this.getAvailableRange(i);return j.offset+j.length-1;},getCursorByIndexImmediate:function(i,j){var k=this.getByIndexImmediate(i,j);if(k)return this._photoCache[i].getCursorForID(k.id);return undefined;},hasNextPage:function(i){var j=this.getCursorByIndexImmediate(i,this.getEndIndex(i));return this.getPhotoCache(i).hasNextPage(j);},getAvailableRange:function(i){return this.getPhotoCache(i).getAvailableRange();},hasLooped:function(i){return this.getPhotoCache(i).hasLooped();},fetchForward:function(i,j,k,l){this.getPhotoCache(i).getItemsAfterCursor(j,k,l);},fetchBackward:function(i,j,k,l){this.getPhotoCache(i).getItemsBeforeCursor(j,k,l);},executePostCreate:function(i,j){if(this._photoCache[i]){j&&j();}else this._postCreateCallbacks[i]=j;},runPostCreateCallback:function(i){var j=this._postCreateCallbacks[i];if(j){j();delete this._postCreateCallbacks[i];}},setPreFetchCallback:function(i,j){this.getPhotoCache(i).setPreFetchCallback(j);},updateData:function(i){var j=i.set_id;if(!this._photoCache[j]){this._photoCache[j]=new i.cache_class(i);this.runPostCreateCallback(j);}else if(i.query_metadata.action==h.actions.UPDATE){this._photoCache[j].updateData(i);}else this._photoCache[j].addData(i);},updateFeedbackData:function(i){var j=Object.keys(i);j.forEach(function(k){return h.getAllByIDImmediate(k).forEach(function(l){l.feedback=i[k].feedback;});});},reset:function(){Object.keys(this._photoCache).forEach(function(i){return this.clearSetCache(i);}.bind(this));}};f.exports=h;},null);
__d('PhotoStore',['Arbiter','PhotoStoreCore'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();h.subscribe('update-photos',function(j,k){i.updateData(k);});f.exports=i;},null);
__d('MessagesViewer',['AsyncRequest','Bootloader','DOM','MessagesViewerSetID','PhotoStore','React','ReactDOM','Run','emptyFunction','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r={bootstrapWithElem:function(u){r.bootstrapWithConfig({fbid:u.getAttribute('data-fbid'),dimensions:u.getAttribute('data-dimensions'),src:u.getAttribute('href'),endpoint:u.getAttribute('data-endpoint'),disablePaging:u.getAttribute('data-disablepaging')},u);},bootstrapWithConfig:function(u,v){var w=u.setID;if(!w)w=k.MESSAGES;t(function(x,y){s(m.createElement(x,{actorid:u.actorid,dimensions:[u.dimensions],disablepaging:u.disablePaging,disableForward:u.disableForward,open:true,photoid:u.fbid,reverse:false,rootClassName:u.rootClassName,setid:w,snapToPhoto:u.snapToPhoto,thumbsrc:u.src}));if(!l.hasBeenCreated(w)&&u.endpoint){var z=new h(u.endpoint);if(v)z.setRelativeTo(v);z.send();}});},renderVideo:function(u){t(function(v,w){s(m.createElement(w,u));});},preload:function(){o.onAfterLoad(function(){return t(p);});}};function s(u){var v=q('messages_viewer');if(!v){v=j.create('div',{id:'messages_viewer'});document.body.appendChild(v);}u=n.render(u,v);u.subscribeOnce('close',function(){n.unmountComponentAtNode(v);});}function t(u){i.loadModules(["SpotlightMessagesViewer","MessagingVideoViewer.react"],u);}f.exports=r;},null);
__d('MercuryLogMessageRenderer',['Bootloader','CSS','HovercardLink','Image.react','MercuryViewer','MercuryXMATRenderer','MessagesViewer','MercuryLogMessageType','MercuryParticipants','React','ReactDOM','TextWithEntities.react','TooltipLink.react','UserAgent','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();var y={renderText:function(na,oa,pa){switch(na.log_message_type){case o.SUBSCRIBE:ba(na,pa);break;case o.UNSUBSCRIBE:ga(na,pa);break;case o.THREAD_NAME:ha(na,oa,pa);break;case o.THREAD_IMAGE:ia(na,oa,pa);break;case o.WALLPAPER:ja(na,pa);break;case o.GENERIC_ADMIN_TEXT:ka(na,pa);break;default:h.loadModules(["MercurySpecialLogMessageRenderer"],function(qa){qa.renderText(na,pa);});break;}},renderIcon:function(na){return (q.createElement(k,{className:z(na),src:x('images/spacer.gif')}));},renderLegacy:function(na,oa,pa,qa){z(qa).split(' ').forEach(function(ra){return ra&&i.addClass(na,ra);});this.renderText(qa,null,function(ra){r.render(q.createElement('span',null,ra),oa);});this.renderAttachmentLegacy(pa,qa);},renderAttachmentLegacy:function(na,oa){if(oa.log_message_type==o.THREAD_IMAGE){var pa=oa.log_message_data.image;if(pa&&pa.preview_url){r.render(q.createElement(k,{className:"_z6a",onClick:function(){return aa(pa);},src:pa.preview_url}),na);i.show(na);}}}};f.exports=y;function z(na){var oa=na.log_message_type,pa=na.log_message_data;return "_5wzu"+(oa==o.SUBSCRIBE?' '+"_5wzj":'')+(oa==o.UNSUBSCRIBE?' '+"_5wzk":'')+(oa==o.THREAD_NAME?' '+"_5wzl":'')+(oa==o.THREAD_IMAGE?' '+"_5wzm":'')+(oa==o.VIDEO_CALL&&pa.answered?' '+"_5wzn":'')+(oa==o.VIDEO_CALL&&!pa.answered?' '+"_5wzo":'')+(oa==o.PHONE_CALL&&pa.answered?' '+"_5wzp":'')+(oa==o.PHONE_CALL&&!pa.answered?' '+"_5wzq":'')+(oa==o.SERVER_ERROR?' '+"_5wzr":'');}function aa(na){n.bootstrapWithConfig({src:na.preview_url,endpoint:na.url,fbid:na.metadata.fbid,dimensions:na.metadata.dimensions,disablePaging:true},null);}function ba(na,oa){var pa=ma(na.log_message_data.added_participants);switch(pa.length){case 1:ca(na,oa,pa);break;case 2:da(na,oa,pa);break;case 3:ea(na,oa,pa);break;default:fa(na,oa,pa);break;}}function ca(na,oa,pa){var qa=[na.author,pa[0]];p.getMulti(qa,function(ra){if(na.author==l.getID()){oa(w._("Vous avez ajout\u00e9 {subscriber1}.",[w.param('subscriber1',la(ra[pa[0]]))]));}else if(pa[0]==l.getID()){oa(w._("{actor} vous a ajout\u00e9(e).",[w.param('actor',la(ra[na.author]))]));}else oa(w._("{actor} a ajout\u00e9 {subscriber1}.",[w.param('actor',la(ra[na.author])),w.param('subscriber1',la(ra[pa[0]]))]));});}function da(na,oa,pa){var qa=[na.author].concat(pa);p.getMulti(qa,function(ra){if(na.author==l.getID()){oa(w._("Vous avez ajout\u00e9 {subscriber1} et {subscriber2}.",[w.param('subscriber1',la(ra[pa[0]])),w.param('subscriber2',la(ra[pa[1]]))]));}else if(pa[0]==l.getID()){oa(w._("{actor} vous a ajout\u00e9(e), avec {subscriber2}.",[w.param('actor',la(ra[na.author])),w.param('subscriber2',la(ra[pa[1]]))]));}else oa(w._("{actor} a ajout\u00e9 {subscriber1} et {subscriber2}.",[w.param('actor',la(ra[na.author])),w.param('subscriber1',la(ra[pa[0]])),w.param('subscriber2',la(ra[pa[1]]))]));});}function ea(na,oa,pa){var qa=[na.author].concat(pa);p.getMulti(qa,function(ra){if(na.author==l.getID()){oa(w._("Vous avez ajout\u00e9 {subscriber1}, {subscriber2} et {subscriber3}.",[w.param('subscriber1',la(ra[pa[0]])),w.param('subscriber2',la(ra[pa[1]])),w.param('subscriber3',la(ra[pa[2]]))]));}else if(pa[0]==l.getID()){oa(w._("{actor} vous a ajout\u00e9(e), avec {subscriber2} et {subscriber3}.",[w.param('actor',la(ra[na.author])),w.param('subscriber2',la(ra[pa[1]])),w.param('subscriber3',la(ra[pa[2]]))]));}else oa(w._("{actor} a ajout\u00e9 {subscriber1}, {subscriber2} et {subscriber3}.",[w.param('actor',la(ra[na.author])),w.param('subscriber1',la(ra[pa[0]])),w.param('subscriber2',la(ra[pa[1]])),w.param('subscriber3',la(ra[pa[2]]))]));});}function fa(na,oa,pa){var qa=[na.author].concat(pa);p.getMulti(qa,function(ra){function sa(ua){var va=q.createElement('div',null,ua.map(function(wa){return q.createElement('div',null,wa.name);}));return (q.createElement(t,{alignH:'center',position:'above',tooltip:va},w._({"*":"{num} de plus"},[w.param('num',ua.length,[0])])));}var ta=pa.map(function(ua){return ra[ua];});if(na.author==l.getID()){oa(w._("Vous avez ajout\u00e9 {subscriber1}, {subscriber2} et {more_people}.",[w.param('subscriber1',la(ta[0])),w.param('subscriber2',la(ta[1])),w.param('more_people',sa(ta.slice(2)))]));}else if(pa[0]==l.getID()){oa(w._("{actor} vous a ajout\u00e9(e), avec {subscriber2} et {more_people}.",[w.param('actor',la(ra[na.author])),w.param('subscriber2',la(ta[1])),w.param('more_people',sa(ta.slice(2)))]));}else oa(w._("{actor} a ajout\u00e9 {subscriber1}, {subscriber2} et {more_people}.",[w.param('actor',la(ra[na.author])),w.param('subscriber1',la(ta[0])),w.param('subscriber2',la(ta[1])),w.param('more_people',sa(ta.slice(2)))]));});}function ga(na,oa){var pa=[na.author],qa=na.log_message_data.removed_participants,ra;if(qa.length===1){ra=qa[0];pa.push(ra);}p.getMulti(pa,function(sa){var ta=sa[na.author],ua=sa[ra];if(na.author==l.getID()){if(!ra||ra==na.author){oa(w._("Vous avez quitt\u00e9 la conversation."));}else oa(w._("Vous avez retir\u00e9 {name} de la conversation.",[w.param('name',la(ua))]));}else if(!ra||ra==na.author){oa(w._("{actor} a quitt\u00e9 la conversation.",[w.param('actor',la(ta))]));}else if(ra==l.getID()){oa(w._({"*":"{actor} vous a retir\u00e9 de la conversation.","33554432":"{actor} vous a retir\u00e9e de la conversation.","__vcg":1},[w.param('actor',la(ta))]));}else oa(w._("{actor} a retir\u00e9 {name} de la conversation.",[w.param('actor',la(ta)),w.param('name',la(ua))]));});}function ha(na,oa,pa){var qa=na.log_message_data.name,ra="_5wzs"+(u.isBrowser('Chrome')?' '+"_4fbd":'');if(na.author==l.getID()){if(qa){pa(w._("Vous avez nomm\u00e9 la conversation\u00a0: {name}.",[w.param('name',q.createElement('span',{className:ra},q.createElement(s,{renderEmoticons:true,renderEmoji:true,text:qa})))]));}else pa(w._("Vous avez supprim\u00e9 le nom de la conversation."));}else p.get(na.author,function(sa){var ta=la(sa,oa);if(qa){pa(w._("{actor} a nomm\u00e9 la conversation\u00a0: {name}.",[w.param('actor',ta),w.param('name',q.createElement('span',{className:ra},q.createElement(s,{renderEmoticons:true,renderEmoji:true,text:qa})))]));}else pa(w._("{actor} a supprim\u00e9 le nom de la conversation.",[w.param('actor',ta)]));});}function ia(na,oa,pa){if(na.author==l.getID()){if(na.log_message_data.image){pa(w._("Vous avez chang\u00e9 l\u2019image de la conversation."));}else pa(w._("Vous avez supprim\u00e9 l\u2019image de la conversation."));}else p.get(na.author,function(qa){var ra=la(qa,oa);if(na.log_message_data.image){pa(w._("{actor} a chang\u00e9 l\u2019image de la conversation.",[w.param('actor',ra)]));}else pa(w._("{actor} a supprim\u00e9 l\u2019image de la conversation.",[w.param('actor',ra)]));});}function ja(na,oa){if(na.author==l.getID()){oa(w._("Vous avez chang\u00e9 le fond d\u2019\u00e9cran."));}else p.get(na.author,function(pa){var qa=la(pa);oa(w._("{actor} a chang\u00e9 le fond d\u2019\u00e9cran.",[w.param('actor',qa)]));});}function ka(na,oa){var pa=m.renderText(na);oa(pa);}function la(na,oa){var pa=na.fbid,qa=j.constructEndpoint({id:pa}),ra=oa&&oa.custom_nickname&&oa.custom_nickname[pa],sa=ra?ra:na.name;if(na.href)return (q.createElement('a',{className:"_5wzt",href:na.href,'data-hovercard':qa},sa));return sa;}function ma(na){var oa=na.indexOf(l.getID());if(oa>0){var pa=na.filter(function(qa){return qa!==l.getID();});return [l.getID()].concat(pa);}return na;}},null);
__d('MercuryLogMessage.react',['DOM','DOMDimensions','Event','ImmutableObject','MercuryLogMessageRenderer','MercuryLogMessageType','React','ReactDOM','cx','fbt','cancelAnimationFrame','emptyFunction','formatDate','joinClasses','requestAnimationFrame'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){'use strict';if(c.__markCompiled)c.__markCompiled();var w=n.PropTypes,x=n.createClass({displayName:'MercuryLogMessage',propTypes:{loadMoreMessages:w.func,maxWidth:w.number,message:w.instanceOf(k).isRequired,onImageLoad:w.func,thread:w.object},getDefaultProps:function(){return {onImageLoad:s};},getInitialState:function(){return {messageText:null};},componentDidMount:function(){this.componentWillReceiveProps(this.props);},componentWillUnmount:function(){if(this._raf)r(this._raf);},_renderErrorMessage:function(){return (n.createElement('a',{onClick:this._loadMoreMessages},q._("Afficher les messages pr\u00e9c\u00e9dents.")));},_loadMoreMessages:function(){var y=this.props.loadMoreMessages&&this.props.loadMoreMessages();if(y){this.setState({messageText:this._renderErrorMessage()});}else{var z=q._("Messages pr\u00e9c\u00e9dents introuvables.");this.setState({messageText:z});}},componentWillReceiveProps:function(y){if(y.message.log_message_type===m.SERVER_ERROR){this._loadMoreMessages();return;}l.renderText(y.message,y.thread,function(z){this.setState({messageText:z});}.bind(this));},shouldComponentUpdate:function(y,z){return (this.state.messageText!=z.messageText||y.maxWidth!==this.props.maxWidth);},componentDidUpdate:function(){this._informAttachmentLoaded();if(!this.refs.attachment)return;l.renderAttachmentLegacy(this.refs.attachment,this.props.message);h.scry(this.refs.wrap,'img').forEach(function(y){var z=j.listen(y,'load',function(){this._informAttachmentLoaded();z.remove();}.bind(this));}.bind(this));},render:function(){return (n.createElement('div',babelHelpers['extends']({},this.props,{className:u(this.props.className,"_5ye6"),ref:'wrap',style:babelHelpers['extends']({},this.props.style,this._getStyle()),title:t(new Date(this.props.message.timestamp),'g:ia')}),n.createElement('div',{className:"_5ye7"},l.renderIcon(this.props.message),this.state.messageText),n.createElement('div',{className:"_5ye8",ref:'attachment'})));},_getStyle:function(){return this.props.maxWidth?{maxWidth:this.props.maxWidth}:null;},_informAttachmentLoaded:function(){if(this._raf)r(this._raf);this._raf=v(function(){this.props.onImageLoad&&this.props.onImageLoad(i.getElementDimensions(this.refs.wrap).height);delete this._raf;}.bind(this));}});f.exports=x;},null);
__d('MercuryShareAttachmentRenderLocations',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={CHAT:'chat',CHAT_PREVIEW:'chat_preview',MESSENGER:'messenger',WEB_INBOX:'web_inbox',getValues:function(){return [h.CHAT,h.CHAT_PREVIEW,h.MESSENGER,h.WEB_INBOX];},isPreview:function(i){return i===h.CHAT_PREVIEW;}};f.exports=h;},null);
__d('FBRTCExperiment',['FBRTCExperimentsConfig','QE'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();j.gen=function(k){var l={params:{},in_experiment:false,auto_exposure:false},m=h[k]||l,n=new j(k,m.params,m.in_experiment);if(m.auto_exposure)n.logExposure(k);return n;};function j(k,l,m){this.$FBRTCExperiment2=k;this.$FBRTCExperiment3=l;this.$FBRTCExperiment1=m;}j.prototype.logExposure=function(){if(this.$FBRTCExperiment1)i.logExposure(this.$FBRTCExperiment2);};j.prototype.getParam=function(k,l){if(this.$FBRTCExperiment3[k])return this.$FBRTCExperiment3[k].toString();return l;};j.prototype.getInt=function(k,l){if(this.$FBRTCExperiment3[k])return parseInt(this.$FBRTCExperiment3[k],10);return l;};j.prototype.getBool=function(k,l){var m=this.$FBRTCExperiment3;if(m[k])return m[k]==='1'||m[k]===1||m[k]==='true';return l;};f.exports=j;},null);
__d('MercuryMeMessageProcessor',['ImmutableObject','MercuryActionType','MercuryConfig','MercuryLogMessageType','MercuryParticipants','MercuryCommands'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();function n(r){if(!r)return false;if(r.action_type!==i.USER_GENERATED_MESSAGE)return false;var s=r.body;return o(s);}function o(r){if(!j.MessengerRenderMeAsAdminMessageGK)return false;if(typeof r==='string'&&r.startsWith(m.ME))return true;return false;}function p(r){var s=q(r.body,r.author);return h.set(r,{action_type:i.LOG_MESSAGE,body:s,log_message_body:s,log_message_data:{message_type:'',untypedData:{}},log_message_type:k.GENERIC_ADMIN_TEXT});}function q(r,s){var t=l.getOrFetch(s),u=t?t.short_name:m.ME;return r.replace(m.ME,u+' ');}f.exports={transform:p,transformSnippet:q,shouldTransform:n,shouldTransformSnippet:o};},null);
__d('MercuryMessageGroup',['MercuryActionType','MercuryAttachmentType','MercuryMeMessageProcessor','MercuryShareAttachmentRenderLocations','MercuryThreadlistConstants','enumerate'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n={calculateMessageGroups:function(q,r){var s=[],t=null,u={value:null},v=m(q),w;while(!(w=v.next()).done){var x=n.canAppendMessageToLastGroup(u.value,w.value,r);if(!x){t=[];s.push(t);}t.push(w.value);u=w;}return s;},canAppendMessageToLastGroup:function(q,r,s){var t=l.GROUPING_THRESHOLD;if(!q||o(q,s)||o(r,s)||q.author!=r.author||q.timestamp<r.timestamp-t||q.is_spoof_warning!==r.is_spoof_warning||q.page_admin_notes)return false;return true;}};function o(q,r){var s=q.has_attachment;if(s&&(r===k.MESSENGER||r===k.CHAT))s=p(q);return !!(q.action_type==h.LOG_MESSAGE||j.shouldTransform(q)||s||q.forward_count||q.html_body||q.body&&q.body.length>l.MAX_CHARS_BEFORE_BREAK);}function p(q){var r=q.attachments[0];return (!r||r.attach_type===i.STICKER||r.attach_type===i.ANIMATED_IMAGE);}f.exports=n;},null);
__d('MessengerDomIDs',['uniqueID'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={COMPOSER_INPUT_DESCRIPTION:h(),CONVERSATION:h(),MAIN_LABEL:h(),MUTE_DIALOG_TITLE:h(),THREAD_INFO_PANEL:h(),THREAD_TITLE:h()};f.exports=i;},null);
__d('MessageList.react',['immutable','ImmutableObject','MercuryActionType','MercuryIDs','MercuryMeMessageProcessor','MercuryMessageGroup','MercuryShareAttachmentRenderLocations','MessengerDomIDs','ReactComponentWithPureRenderMixin','React','ReactDOM','FBRTCExperiment','MercuryLogMessageType','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';if(c.__markCompiled)c.__markCompiled();var v=q.PropTypes,w=1000*60*60,x=q.createClass({displayName:'MessageList',mixins:[p],propTypes:{DateBreak:v.func.isRequired,deliveryTimestamp:v.number.isRequired,isCanonical:v.bool,isPageMessage:v.bool,location:v.string.isRequired,LogMessage:v.func.isRequired,loadMoreMessages:v.func,MessageGroup:v.func.isRequired,messages:v.instanceOf(h.List).isRequired,onAttachmentLoad:v.func,onStickerClick:v.func,readReceipts:v.instanceOf(h.OrderedMap).isRequired,viewer:v.string.isRequired,thread:v.object,threadID:v.string},getInitialState:function(){return {activeMessageID:null,messageGroups:m.calculateMessageGroups(this.props.messages,this.props.location)};},componentWillReceiveProps:function(da){if(da.messages!==this.props.messages)this.setState({messageGroups:m.calculateMessageGroups(da.messages,da.location)});},render:function(){var da=this.props,ea=da.DateBreak,fa=da.location,ga=da.MessageGroup,ha=[],ia=this.state.activeMessageID,ja=this.state.messageGroups,ka=ja.length,la=this.props.readReceipts,ma=la.last()||0,na=k.getParticipantIDFromUserID(this.props.viewer);for(var oa=0;oa<ka;oa++){var pa=oa>0?ja[oa-1]:null,qa=pa&&pa.length>0?pa[pa.length-1]:null,ra=ja[oa],sa=ra[0],ta=ra[ra.length-1],ua=false;if(!qa||sa.timestamp-qa.timestamp>w){ua=true;ha.push(q.createElement(ea,{date:new Date(sa.timestamp),key:'db:'+sa.message_id,ref:'db:'+sa.message_id}));}if(sa.action_type==j.LOG_MESSAGE){if((fa===n.CHAT||fa===n.MESSENGER)&&(sa.log_message_type===t.VIDEO_CALL||sa.log_message_type===t.PHONE_CALL)){var va=s.gen('rtc_www_xmas'),wa=va.getParam('show_xmas','0');if(wa==='1'){var xa=this._createRTCMessageGroup(sa,na,ja,ka,oa,la,ma,ta);ha.push(xa);}else{var ya=this._createLogMessageGroup(sa);ha.push(ya);}}else{var za=this._createLogMessageGroup(sa);ha.push(za);}continue;}if(l.shouldTransform(sa)){var ab=l.transform(sa);ha.push(this._createLogMessageGroup(ab));continue;}ra=h.List(ra);var bb=z(ja,ka,oa),cb=!ba(la,ra,bb),db=aa(ma,ta),eb=ca(this.props.deliveryTimestamp,ta);ha.push(q.createElement(ga,{activeMessageID:y(ia,ra),author:ra.first().author,deliveryTimestamp:eb,hasDateBreak:ua,isCanonical:this.props.isCanonical,isFromViewer:na===sa.author,isPageMessage:this.props.isPageMessage,key:'mg:'+sa.message_id,lastReadTimestamp:db,maxBubbleWidth:this.props.maxBubbleWidth,messages:ra,nextTimestamp:bb,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this._handleMessageDeselect,onMessageSelect:this._handleMessageSelect,onStickerClick:this.props.onStickerClick,readReceipts:cb?la:h.OrderedMap(),ref:'mg:'+sa.message_id,thread:this.props.thread,threadID:this.props.threadID}));}return (q.createElement('div',{id:fa===n.MESSENGER?o.CONVERSATION:null},ha));},getMessageElement:function(da,ea){if(ea){var fa=this.refs['db:'+da];if(fa)return r.findDOMNode(fa);}var ga=this.state.messageGroups.find(function(ja){return ja.some(function(ka){return ka.message_id===da;});});if(!ga)return null;var ha=ga[0].message_id,ia=this.refs['mg:'+ha];if(!ia)return null;if(ea&&ha===da)return r.findDOMNode(ia);return ia.getMessageElement(da);},_handleMessageDeselect:function(da){this.setState(function(ea){return {activeMessageID:ea.activeMessageID===da?null:ea.activeMessageID};});},_handleMessageSelect:function(da){this.setState({activeMessageID:da});},_createRTCMessageGroup:function(da,ea,fa,ga,ha,ia,ja,ka){var la=this.props.MessageGroup,ma={attach_type:'share',share:{style_list:['rtc_call_log','fallback'],log_message_body:da.log_message_body,log_message_data:da.log_message_data,log_message_type:da.log_message_type,timestamp:da.timestamp}},na=i.setProperty(da,'attachments',[ma]);na=i.setProperty(na,'body','');var oa=h.List([na]),pa=z(fa,ga,ha),qa=!ba(ia,oa,pa),ra=aa(ja,ka),sa=ca(this.props.deliveryTimestamp,ka);return (q.createElement(la,{author:oa.first().author,deliveryTimestamp:sa,isFromViewer:ea===da.author,key:da.message_id,lastReadTimestamp:ra,maxBubbleWidth:this.props.maxBubbleWidth,messages:oa,nextTimestamp:pa,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this._handleMessageDeselect,onMessageSelect:this._handleMessageSelect,onStickerClick:this.props.onStickerClick,readReceipts:qa?ia:h.OrderedMap(),thread:this.props.thread,threadID:this.props.threadID}));},_createLogMessageGroup:function(da){var ea=this.props.LogMessage;return (q.createElement(ea,{className:this.props.location===n.CHAT?"_5w0o":null,key:da.message_id,loadMoreMessages:this.props.loadMoreMessages,message:da,onImageLoad:this.props.onAttachmentLoad,viewer:this.props.viewer,thread:this.props.thread}));}});function y(da,ea){return ea.find(function(fa){return fa.message_id===da;})?da:null;}function z(da,ea,fa){return fa<ea-1?da[fa+1][0].timestamp:Infinity;}function aa(da,ea){return ea.timestamp>da?da:Infinity;}function ba(da,ea,fa){return (ea.isEmpty()||da.last()<ea.first().timestamp||da.first()>=fa);}function ca(da,ea){return ea.timestamp>da?da:Infinity;}f.exports=x;},null);
__d('ChatConversation.react',['ChatDateBreak.react','ChatMessageGroup.react','ChatMessage.react','immutable','MercuryActionType','MercuryLogMessage.react','MessageList.react','React','MercuryShareAttachmentRenderLocations','cancelAnimationFrame','invariant','requestAnimationFrame'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';if(c.__markCompiled)c.__markCompiled();var t=o.PropTypes,u=o.createClass({displayName:'ChatConversation',_raf:(undefined,Number),_onMountTimeout:(undefined,Number),propTypes:{contextBanner:t.object,isCanonical:t.bool.isRequired,loadMoreMessages:t.func,maxBubbleWidth:t.number.isRequired,messages:t.instanceOf(k.List).isRequired,onAttachmentLoad:t.func,onMount:t.func,onStickerClick:t.func,viewer:t.string.isRequired,thread:t.object,threadID:t.string},componentDidMount:function(){this._raf=s(function(){this._onMountTimeout=setTimeout(function(){this.props.onMount&&this.props.onMount();delete this._onMountTimeout;}.bind(this),0);delete this._raf;}.bind(this));},componentWillUnmount:function(){if(this._raf)q(this._raf);clearTimeout(this._onMountTimeout);},componentWillReceiveProps:function(v){!(v.maxBubbleWidth===this.props.maxBubbleWidth)?r(0):undefined;},render:function(){return (o.createElement('div',null,this.props.contextBanner,o.createElement(n,{DateBreak:h,LogMessage:m,MessageGroup:i,deliveryTimestamp:0,isCanonical:this.props.isCanonical,location:p.CHAT,loadMoreMessages:this.props.loadMoreMessages,maxBubbleWidth:this.props.maxBubbleWidth,messages:this.props.messages,onAttachmentLoad:this.props.onAttachmentLoad,onStickerClick:this.props.onStickerClick,readReceipts:k.OrderedMap(),viewer:this.props.viewer,thread:this.props.thread,threadID:this.props.threadID})));}});f.exports=u;},null);
__d('MercuryTypingAnimation.react',['React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=h.PropTypes,l=h.createClass({displayName:'MercuryTypingAnimation',propTypes:{color:k.oneOf(['light','dark'])},getDefaultProps:function(){return {color:'dark'};},render:function(){var m="_4a0v"+(this.props.color==='light'?' '+"_4a0w":'')+(this.props.color==='dark'?' '+"_4a0x":'');return (h.createElement('div',{className:j(this.props.className,m)},h.createElement('div',{className:"_4b0g"},h.createElement('div',{className:"_5pd7"}),h.createElement('div',{className:"_5pd7"}),h.createElement('div',{className:"_5pd7"}))));}});f.exports=l;},null);
__d('ChatTypingIndicator.react',['ChatConfig','Image.react','MercuryParticipants','MercuryTypingAnimation.react','ReactComponentWithPureRenderMixin','React','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=m.PropTypes,q=h.get('chattab_rounded_profile',false),r=m.createClass({displayName:'ChatTypingIndicator',mixins:[l],propTypes:{userID:p.string,showName:p.bool},render:function(){var t=undefined;if(this.props.userID)t=j.getNow(this.props.userID);if(!t)return null;return (m.createElement('div',{className:"_4tdt"},s(t),this._renderBubble()));},getBubble:function(){return this.refs.bubble;},_renderBubble:function(){var t=this.props.showName;return (m.createElement('div',{className:"_4tdv"},m.createElement('div',{className:"_5wd4"+(' '+"_1nc7")+(' '+"_2cnu")+(t?' '+"_5ysy":'')},m.createElement('div',{className:"_5wd9"+(' '+"_n4o")},m.createElement('div',{className:"_5w1r"+(' '+"_5wdf")+(' '+"_3_om")},m.createElement(k,{className:"_5x7x",ref:'bubble'}))))));}});function s(t){var u=o._("{name}",[o.param('name',t.name)]);return (m.createElement('div',{className:"_31o4"+(q?' '+"_3njy":'')},m.createElement('a',{'aria-label':u,className:"_4tdw",'data-hover':'tooltip','data-tooltip-content':u,'data-tooltip-position':'left',href:t.href||'#',ref:'link'},m.createElement(i,{src:t.image_src,ref:'image'}))));}f.exports=r;},null);
__d('MercuryTypingReceiver',['Arbiter','ChannelConstants','FBID','MercuryActionType','MercuryIDs','MercuryPayloadSource','MercuryDispatcher','MercurySingletonMixin','MercuryViewer','TypingStates','isEmpty','mixInEventEmitter','setTimeoutAcrossTransitions','MercuryThreadIDMap'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=c('MercuryThreadIDMap').get(),v=30000;function w(x){'use strict';this.$MercuryTypingReceiver1=null;this.$MercuryTypingReceiver2={};this.$MercuryTypingReceiver3=n.getForFBID(x);this.$MercuryTypingReceiver3.subscribe('update-typing-state',function(z,aa){var ba=aa.payload_source;if(ba!=m.CLIENT_CHANNEL_MESSAGE)return;var ca=aa.actions;if(!ca||!ca.length)return;var da=k.USER_GENERATED_MESSAGE;ca.forEach(function(ea){if(ea.action_type==da&&ea.author!=p.getID())this.$MercuryTypingReceiver4(ea.thread_id,ea.author);}.bind(this));}.bind(this));var y;if(j.isUser(x)){y=[i.getArbiterType('typ'),i.getArbiterType('ttyp')];}else y=[i.getArbiterType('page_typing')];h.subscribe(y,function(z,aa){var ba=aa.obj,ca=this.$MercuryTypingReceiver5(ba);if(ca){var da=l.getParticipantIDFromUserID(ba.from);if(ba.st==q.TYPING){this.$MercuryTypingReceiver2[ca]=this.$MercuryTypingReceiver2[ca]||{};var ea=this.$MercuryTypingReceiver2[ca][da];this.$MercuryTypingReceiver2[ca][da]=Date.now();if(!this.$MercuryTypingReceiver1)this.$MercuryTypingReceiver1=t(function(){this.$MercuryTypingReceiver6();}.bind(this),3000);!ea&&this.$MercuryTypingReceiver7(ca);}else if(ba.st==q.INACTIVE)this.$MercuryTypingReceiver4(ca,da);}}.bind(this));}w.prototype.$MercuryTypingReceiver8=function(x){'use strict';var y=this.$MercuryTypingReceiver2[x]||{},z=Object.keys(y);z.sort(function(aa,ba){return y[aa]-y[ba];});return z;};w.prototype.$MercuryTypingReceiver6=function(){'use strict';this.$MercuryTypingReceiver1=null;var x=Date.now(),y={},z=false;for(var aa in this.$MercuryTypingReceiver2){var ba=false;for(var ca in this.$MercuryTypingReceiver2[aa]||{})if(this.$MercuryTypingReceiver2[aa][ca]<x-v){delete this.$MercuryTypingReceiver2[aa][ca];ba=true;}else z=true;if(ba)y[aa]=this.$MercuryTypingReceiver8(aa);}if(!r(y))this.$MercuryTypingReceiver9(y);if(z)this.$MercuryTypingReceiver1=t(function(){this.$MercuryTypingReceiver6();}.bind(this),3000);};w.prototype.$MercuryTypingReceiver4=function(x,y){'use strict';if(x in this.$MercuryTypingReceiver2)if(y in this.$MercuryTypingReceiver2[x]){delete this.$MercuryTypingReceiver2[x][y];this.$MercuryTypingReceiver7(x);}};w.prototype.$MercuryTypingReceiver9=function(x){'use strict';this.releaseHeldEventType('state-changed');this.emitAndHold('state-changed',x);};w.prototype.$MercuryTypingReceiver7=function(x){'use strict';var y={};y[x]=this.$MercuryTypingReceiver8(x);this.$MercuryTypingReceiver9(y);};w.prototype.$MercuryTypingReceiver5=function(x){'use strict';if(x.thread_fbid)return u.getClientIDFromServerIDNow(x.thread_fbid.toString());if(x.type==='typ'||x.type==='page_typing')return l.getThreadIDFromUserID(x.from);return null;};s(w,{'state-changed':true});Object.assign(w,o);f.exports=w;},null);
__d('ChatTypingIndicators.react',['ChatTypingIndicator.react','DOM','MercuryIDs','MercuryThreadInformer','MercuryTypingReceiver','MercuryParticipants','React','ReactDOM','SubscriptionsHandler','TooltipData','createObjectFrom','emptyFunction','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=n.PropTypes,v=n.createClass({displayName:'ChatTypingIndicators',propTypes:{indicatorClass:u.func,indicatorsWillShow:u.func,indicatorsDidShow:u.func,rootClassName:u.string,threadID:u.string.isRequired,viewer:u.string.isRequired},getDefaultProps:function(){return {indicatorClass:h,indicatorsWillShow:s,indicatorsDidShow:s};},getInitialState:function(){return {typingUserIDs:[]};},componentDidMount:function(){var w=k.getForFBID(this.props.viewer),x=l.getForFBID(this.props.viewer);this._subscriptions=new p();this._subscriptions.addSubscriptions(x.addRetroactiveListener('state-changed',this.typingStateChanged),w.subscribe('messages-received',this.messagesReceived));},componentWillReceiveProps:function(w){if(w.threadID!=this.props.threadID)this.setState({typingUserIDs:[]});},componentWillUpdate:function(w,x){if(x.typingUserIDs.length>0)this.props.indicatorsWillShow();},componentDidUpdate:function(){if(this.state.typingUserIDs.length>0)this.props.indicatorsDidShow();m.getMulti(this.state.typingUserIDs,function(w){if(this.isMounted())this.state.typingUserIDs.forEach(function(x){var y=w[x],z=this.refs[x]&&this.refs[x].getBubble();if(z&&y)q.set(o.findDOMNode(z),this.renderTooltip(y.short_name),'above','left');}.bind(this));}.bind(this));},componentWillUnmount:function(){this._subscriptions.release();},render:function(){var w=j.isGroupChat(this.props.threadID);return (n.createElement('div',{className:this.props.rootClassName},this.state.typingUserIDs.map(function(x){return (this._renderTypingIndicator(x,!!w));}.bind(this))));},_renderTypingIndicator:function(w,x){var y=this.props.indicatorClass;return (n.createElement(y,{key:w,ref:w,showName:x,userID:w}));},renderTooltip:function(w){var x=i.create('span');o.render(n.createElement('span',null,t._("{name} est en train d\u2019\u00e9crire...",[t.param('name',w)])),x);return x;},typingStateChanged:function(w){if(this.props.threadID in w)this.setState({typingUserIDs:w[this.props.threadID].slice().sort()});},messagesReceived:function(w,x){if(this.props.threadID in x){var y=x[this.props.threadID],z=r(y.map(function(aa){return aa.author;}));this.setState({typingUserIDs:this.state.typingUserIDs.filter(function(aa){return !z[aa];}).sort()});}}});f.exports=v;},null);
__d('MercuryRoger',['Arbiter','ArbiterMixin','immutable','JSLogger','MercuryActionStatus','MercuryDispatcher','MercurySingletonProvider','MercuryThreads','mixin','mapObject'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r,s;if(c.__markCompiled)c.__markCompiled();var t=l.SUCCESS;r=babelHelpers.inherits(u,p(i));s=r&&r.prototype;u.getForFBID=function(y){'use strict';return v.getForFBID(y);};u.get=function(){'use strict';return v.get();};function u(y){'use strict';s.constructor.call(this);this.$MercuryRoger1={};this.$MercuryRoger2=[];this.$MercuryRoger3=y;this.$MercuryRoger4=m.getForFBID(this.$MercuryRoger3);this.$MercuryRoger5=o.getForFBID(this.$MercuryRoger3);this.$MercuryRoger4.subscribe('update-roger',function(z,aa){for(var ba in aa){var ca=this.$MercuryRoger1[ba]||j.OrderedMap();ca=ca.withMutations(function(da){for(var ea in aa[ba]){var fa=this.$MercuryRoger5.getThreadMetaNow(ba);if(fa&&fa.participants)if(fa.participants.indexOf(ea)==-1){this.$MercuryRoger2.push(x(this.$MercuryRoger1));continue;}var ga=da.get(ea),ha=aa[ba][ea];if(!ga||ha>ga)da.set(ea,ha);}}.bind(this));this.$MercuryRoger1[ba]=ca.sort();}aa&&this.inform('change',aa);}.bind(this));this.$MercuryRoger4.subscribe('invalidate-global-state',function(){this.$MercuryRoger6();}.bind(this));h.subscribe(k.DUMP_EVENT,function(z,aa){aa.bad_read_receipts={receipts:this.$MercuryRoger2};}.bind(this));}u.prototype.getSeenBy=function(y,z){'use strict';if(!y)return [];var aa=[],ba=this.$MercuryRoger1[y.thread_id];if(!ba)return aa;ba.forEach(function(ca,da){if(w(y,ca,da,z))aa.push(da);});return aa;};u.prototype.wasSeenByAll=function(y){'use strict';if(!y)return false;var z=this.$MercuryRoger1[y.thread_id];if(!z)return false;return z.every(function(aa,ba){return w(y,aa,ba);});};u.prototype.getSeenTimestamps=function(y){'use strict';var z=this.$MercuryRoger1[y];if(!z){z=j.OrderedMap();this.$MercuryRoger1[y]=z;}return z;};u.prototype.getSeenTimestamp=function(y,z){'use strict';var aa=this.$MercuryRoger1[y];return aa?aa.get(z):null;};u.prototype.$MercuryRoger6=function(){'use strict';this.$MercuryRoger1={};this.$MercuryRoger2=[];};var v=new n(u);function w(y,z,aa,ba){return !!(z>=y.timestamp&&(y.status===undefined||y.status===t)&&(!ba||aa!=y.author));}function x(y){return q(y,function(z){return z.toJS();});}f.exports=u;},null);
__d('MercuryDelayedRoger',['ArbiterMixin','LiveTimer','MercuryActionStatus','MercuryConfig','setTimeoutAcrossTransitions','MercuryMessages','MercuryRoger','MercuryThreadInformer','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=c('MercuryMessages').get(),n=c('MercuryRoger').get(),o=c('MercuryThreadInformer').get(),p=c('MercuryThreads').get(),q={},r={},s=k['roger.seen_delay'],t={getSeenBy:function(z,aa){if(r[z])return [];return n.getSeenBy(u(z),aa);},wasSeenByAll:function(z){if(r[z])return false;return n.wasSeenByAll(u(z));}};Object.assign(t,h);function u(z){if(!q[z]){var aa=p.getThreadMetaNow(z);if(aa)q[z]={thread_id:z,author:aa.participants[0],timestamp:aa.timestamp};}return q[z];}function v(z){var aa=false;m.getThreadMessagesRange(z,0,1,function(ba){var ca=ba[0];if(!ca)return;var da=ca.timestamp;if(ca.action_id||ca.status==j.SUCCESS)da-=i.getServerTimeOffset();var ea=t.getSeenBy(z);if(r[z]){clearTimeout(r[z]);delete r[z];}var fa=da+s,ga=fa-Date.now();if(ga>0)r[z]=l(function(){delete r[z];w(z);},ga);q[z]=ca;var ha=t.getSeenBy(z);if(ea.length||ha.length)aa=true;});return aa;}function w(z){var aa={};aa[z]=true;x(aa);}function x(z){t.inform('state-changed',z);t.inform('change');}function y(event,z){var aa={};for(var ba in z)if(v(ba))aa[ba]=true;for(var ca in aa){x(aa);break;}}n.subscribe('change',function(z,aa){for(var ba in aa)!r[ba]&&w(ba);});o.subscribe('messages-received',y);o.subscribe('messages-reordered',y);o.subscribe('messages-updated',y);f.exports=t;},null);
__d('MercuryIndicatorController',['ArbiterMixin','DOM','MercuryActionType','MercuryDelayedRoger','MercuryIDs','MercuryMessageSourceTags','MercuryParticipants','MercuryViewer','WorkModeConfig','arrayContains','formatDate','removeFromArray','fbt','MercuryRoger','MercuryThreads','MercuryTypingReceiver'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=c('MercuryRoger').get(),v=c('MercuryThreads').get(),w=c('MercuryTypingReceiver').get(),x=[];function y(z){this._threadID=z;this._canonicalUser=l.getUserIDFromThreadID(z);x.push(this);}Object.assign(y.prototype,h,{destroy:function(){s(x,this);},setLastMessage:function(z){this._lastMsg=z;this._handleStateChange();},_informStateChanged:function(z){if(z.activity=='none'&&this._currentActivity=='none')return;if(this._lastMsg&&o.isViewer(this._lastMsg.author))z.self_authored=true;this._currentActivity=z.activity;this.inform('state-changed',z);},_notifySentFrom:function(){var z,aa,ba=this._lastMsg.source_tags||[];if(q(ba,m.MESSENGER)){if(!p.is_work_user){z=i.create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},t._("Envoy\u00e9 depuis Messenger"));}else z=i.create('a',{href:'/mobile','class':'fcg',target:'_blank'},t._("Sent from Work Chat"));aa='sentFromMobile';}else if(q(ba,m.MOBILE)){z=i.create('a',{href:'/mobile','class':'fcg',target:'_blank'},t._("Envoy\u00e9 depuis un mobile"));aa='sentFromMobile';}else if(q(ba,m.EMAIL)){z=t._("Envoy\u00e9 par e-mail");aa='sentFromEmail';}else{this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:aa,text:z});},_notifySeenTimestamp:function(z){var aa=u.getSeenTimestamp(this._threadID,z[0])*.001,ba=Date.now()*.001,ca;if(aa<ba-518400){ca='M j';}else if(aa<ba-86400){ca='D g:ia';}else ca='g:ia';this._informStateChanged({activity:'seen-timestamp',text:t._("Vu\u00a0: {timestamp}",[t.param('timestamp',r(aa,ca))])});},_nameNormalizer:function(z){var aa;n.getMulti(z,function(ba){function ca(ea){if(ba[ea]!==undefined&&ba[ea].short_name){return ba[ea].short_name.toLowerCase();}else return ea;}var da=z.map(ca);aa=function(ea){var fa=ca(ea),ga=da.indexOf(fa)!==da.lastIndexOf(fa);return ga?ba[ea].name:ba[ea].short_name;};});return aa;},_seenByEveryone:function(z,aa,ba){var ca=ba?ba.participants.length:0,da=z.length;if(aa.author!=o.getID()&&(!ba||ba.participants.indexOf(aa.author)>-1))da++;return ca>2&&da>=ca-1;},_notifySeenBy:function(z){var aa=this._lastMsg,ba=true;n.getMulti(z,function(ca){ba=false;if(this._lastMsg!=aa)return;var da=v.getThreadMetaNow(this._threadID),ea=null;if(da&&da.custom_nickname)ea=da.custom_nickname;var fa=[];for(var ga in ca){var ha=ca[ga],ia=ha.short_name;if(ea&&ea[ha.fbid])ia=ea[ha.fbid];fa[ga]=ia;}var ja,ka=false;if(this._seenByEveryone(z,aa,da)){ja=t._("Vu par tout le monde");}else if(z.length==1){ja=t._("Vu par {user}",[t.param('user',fa[z[0]])]);}else if(z.length==2){ja=t._("Vu par {user1}, {user2}",[t.param('user1',fa[z[0]]),t.param('user2',fa[z[1]])]);}else if(z.length==3){ja=t._("Vu par {user1}, {user2}, {user3}",[t.param('user1',fa[z[0]]),t.param('user2',fa[z[1]]),t.param('user3',fa[z[2]])]);}else if(z.length>3){var la=Object.keys(ca).length-2,ma=t._({"*":"{num} autres"},[t.param('num',la,[0])]),na=i.create('span',{className:'more'},ma);ja=t._("Vu par {user1}, {user2}, {=num more link}",[t.param('user1',fa[z[0]]),t.param('user2',fa[z[1]]),t.param('=num more link',na)]);ka=true;}this._informStateChanged({activity:'seen-by',text:ja,seenBy:z,tooltip:ka});}.bind(this));ba&&this._informStateChanged({activity:'none'});},_notifyTyping:function(z){var aa=this._lastMsg,ba=true;n.getMulti(z,function(ca){ba=false;if(this._lastMsg!=aa)return;var da=v.getThreadMetaNow(this._threadID),ea=da?da.participants.length:0,fa;if(da)fa=this._nameNormalizer(da.participants);if(!fa)fa=function(la){return ca[la].short_name;};var ga,ha=false;if(ea>2&&z.length>=ea-1){ga=t._("Tout le monde est au clavier...");}else if(z.length==1){ga=t._("{name} est en train d\u2019\u00e9crire...",[t.param('name',ca[z[0]].short_name)]);}else if(z.length==2){ga=t._("{user1} et {user2} sont au clavier...",[t.param('user1',ca[z[0]].short_name),t.param('user2',ca[z[1]].short_name)]);}else if(z.length==3){ga=t._("{user1}, {user2} et {user3} sont au clavier...",[t.param('user1',ca[z[0]].short_name),t.param('user2',ca[z[1]].short_name),t.param('user3',ca[z[2]].short_name)]);}else if(z.length>3){var ia=Object.keys(ca).length-2,ja=t._({"*":"{num} de plus"},[t.param('num',ia,[0])]),ka=i.create('a',{href:'#'},ja);ga=t._("{user1}, {user2} et {=num more link} sont au clavier...",[t.param('user1',ca[z[0]].short_name),t.param('user2',ca[z[1]].short_name),t.param('=num more link',ka)]);ha=true;}this._informStateChanged({activity:'typing',text:ga,typing:z,tooltip:ha});}.bind(this));ba&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var z=j.LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==z){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=o.getID()){this._notifySentFrom();return;}var aa=k.getSeenBy(this._threadID,true);if(aa.length)if(this._canonicalUser){this._notifySeenTimestamp(aa);return;}else{this._notifySeenBy(aa);return;}this._informStateChanged({activity:'none'});}});w.addRetroactiveListener('state-changed',function(z){x.forEach(function(aa){var ba=z[aa._threadID];if(ba!==undefined){aa._typing=ba;aa._handleStateChange();}});});k.subscribe('state-changed',function(z,aa){x.forEach(function(ba){aa[ba._threadID]&&ba._handleStateChange();});});f.exports=y;},null);
__d('MercuryLastMessageIndicator.react',['DOM','MercuryIndicatorController','MercuryParticipants','React','ReactDOM','TooltipData','cx','emptyFunction','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=k.PropTypes,r=k.createClass({displayName:'MercuryLastMessageIndicator',propTypes:{hideTyping:q.bool,indicatorWillShow:q.func,indicatorDidShow:q.func,lastMessage:q.object,threadID:q.string.isRequired},getDefaultProps:function(){return {indicatorWillShow:o,indicatorDidShow:o};},getInitialState:function(){return {data:{}};},componentDidMount:function(){this._setup(this.props);},componentWillReceiveProps:function(s){if(s.threadID!=this.props.threadID){this._destroy();this._setup(s);}else if(s.lastMessage!=this.props.lastMessage)this._controller.setLastMessage(s.lastMessage);},componentWillUpdate:function(s,t){if(this.isVisible(s,t))this.props.indicatorWillShow();},componentDidUpdate:function(){if(!this.isVisible())return;this.setText();this.setTooltip();this.props.indicatorDidShow();},componentWillUnmount:function(){this._destroy();},render:function(){return (k.createElement('div',{className:this.getRootClass()},k.createElement('div',{className:"_510h"}),k.createElement('span',{className:"_510f",ref:'text'},'')));},getRootClass:function(){var s="_510g"+(this.state.data.self_authored?' '+"_510e":''),t=this.state.data.activity,u=null;if(String(t).startsWith('seen')){u='seen';}else if(t=='typing'){u=this.props.hideTyping?null:t;}else u=t;return p(s,u,this.props.className);},isVisible:function(s,t){s=s||this.props;t=t||this.state;return (t.data&&t.data.activity!='none'&&!(s.hideTyping&&t.data.activity=='typing'));},setText:function(){if(this.state.data.text)h.setContent(l.findDOMNode(this.refs.text),this.state.data.text);},setTooltip:function(){if(this.state.data.activity=='seen-by'&&this.state.data.tooltip)j.getMulti(this.state.data.seenBy,function(s){var t=h.create('div',null,this.state.data.seenBy.map(function(u){return h.create('div',null,s[u].name);}));m.set(h.find(l.findDOMNode(this),'span.more'),t,'above','center');}.bind(this));},_setup:function(s){this._controller=new i(s.threadID);this._subscription=this._controller.subscribe('state-changed',function(t,u){return this.setState({data:u});}.bind(this));s.lastMessage&&this._controller.setLastMessage(s.lastMessage);},_destroy:function(){this._subscription.unsubscribe();this._controller.destroy();}});f.exports=r;},null);
__d('MercuryMessageList',['immutable','LogHistory','Map','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=i.getInstance('mercury_message_list');function m(o){this.$MercuryMessageList1=h.List(o||[]);this.$MercuryMessageList2();}m.prototype.append=function(o){var p;this.$MercuryMessageList1=(p=this.$MercuryMessageList1).push.apply(p,o);this.$MercuryMessageList2();n('append',o);};m.prototype.prepend=function(o){var p;this.$MercuryMessageList1=(p=this.$MercuryMessageList1).unshift.apply(p,o);this.$MercuryMessageList2();n('prepend',o);};m.prototype.update=function(o){var p=o.filter(function(q){return this.contains(q);}.bind(this));if(p.length===0)return;this.$MercuryMessageList1=this.$MercuryMessageList1.withMutations(function(q){p.forEach(function(r){var s=this.$MercuryMessageList3.get(r.message_id);if(s!==undefined)q.set(s,r);}.bind(this));}.bind(this));n('update',p);};m.prototype.reorder=function(o){this.$MercuryMessageList1=h.List(o);this.$MercuryMessageList2();n('reorder',o);};m.prototype.at=function(o){return this.$MercuryMessageList1.get(o);};m.prototype.contains=function(o){return this.$MercuryMessageList3.has(o.message_id);};m.prototype.toArray=function(){return this.$MercuryMessageList1.toArray();};m.prototype.toMap=function(){return new j(h.Seq(this.$MercuryMessageList1).map(function(o){return [o.message_id,o];}));};m.prototype.$MercuryMessageList2=function(){this.$MercuryMessageList3=new j(h.Seq(this.$MercuryMessageList1).map(function(o,p){return [o.message_id,p];}));};function n(event,o){k(function(){l.debug(event,JSON.stringify({messageIDs:o.map(function(p){return p.message_id;})}));},0);}f.exports=m;},null);
__d('MercuryMessageStore',['MercuryAPIArgsSource','LogHistory','MercuryMessages','MercuryViewer','MercuryMessageList','SubscriptionsHandler','MercuryThreadInformer','MercuryThreadlistConstants','mixInEventEmitter','setImmediate','setTimeoutAcrossTransitions','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){'use strict';if(c.__markCompiled)c.__markCompiled();var s=c('MercuryThreads').get(),t=i.getInstance('mercury_message_store');function u(w,x,y){this.$MercuryMessageStore1=w;this.$MercuryMessageStore2=new l();this.$MercuryMessageStore3=y?j.getForFBID(y):j.get();this.$MercuryMessageStore4=1;this.$MercuryMessageStore5=null;this.$MercuryMessageStore6=0;this.$MercuryMessageStore7=x||o.RECENT_MESSAGES_LIMIT;this.$MercuryMessageStore8=y?n.getForFBID(y):n.get();this.$MercuryMessageStore9=new m();this.$MercuryMessageStore9.addSubscriptions(this.$MercuryMessageStore8.subscribe('messages-received',function(z,aa){return this.$MercuryMessageStore10(aa);}.bind(this)),this.$MercuryMessageStore8.subscribe('messages-updated',function(z,aa){return aa[this.$MercuryMessageStore1]&&this.$MercuryMessageStore11(aa[this.$MercuryMessageStore1]);}.bind(this)),this.$MercuryMessageStore8.subscribe('messages-reordered',function(z,aa){return aa[this.$MercuryMessageStore1]&&this.$MercuryMessageStore12();}.bind(this)));t.debug('constructed',JSON.stringify({threadID:this.$MercuryMessageStore1}));this.$MercuryMessageStore13();}u.prototype.setNewThreadID=function(w){this.$MercuryMessageStore14=w;};u.prototype.destroy=function(){this.$MercuryMessageStore9&&this.$MercuryMessageStore9.release();t.debug('destroyed',JSON.stringify({threadID:this.$MercuryMessageStore1}));};u.prototype.subscribe=function(w){return this.addRetroactiveListener('updated',w);};u.prototype.fetchMoreMessages=function(){if(this.hasFetchedAll())return false;this.$MercuryMessageStore13();return true;};u.prototype.hasFetchedAll=function(){if(this.$MercuryMessageStore3.hasLoadedExactlyNMessages(this.$MercuryMessageStore1,this.$MercuryMessageStore6)&&this.$MercuryMessageStore3.hasLoadedAllMessages(this.$MercuryMessageStore1))return true;return s.isNewEmptyLocalThread(this.$MercuryMessageStore1);};u.prototype.$MercuryMessageStore13=function(){var w=this.$MercuryMessageStore6+this.$MercuryMessageStore7*this.$MercuryMessageStore4;t.debug('fetching',JSON.stringify({threadID:this.$MercuryMessageStore1,limit:w}));this.$MercuryMessageStore3.getThreadMessagesRange(this.$MercuryMessageStore1,0,w,this.$MercuryMessageStore15.bind(this),null,h.MERCURY);if(this.$MercuryMessageStore4<10)this.$MercuryMessageStore4+=1;if(this.$MercuryMessageStore3.hasLoadedNMessages(this.$MercuryMessageStore1,w))q(function(){this.$MercuryMessageStore12();}.bind(this));};u.prototype.$MercuryMessageStore15=function(w){if(w&&w.length){this.$MercuryMessageStore5=w[0].timestamp;this.$MercuryMessageStore6=w.length;t.debug('fetched',JSON.stringify({threadID:this.$MercuryMessageStore1,earliestMessageTimestamp:this.$MercuryMessageStore5,count:this.$MercuryMessageStore6}));}else if(w&&!w.length&&!this.$MercuryMessageStore6)this.$MercuryMessageStore16(u.THREAD_IS_EMPTY);};u.prototype.$MercuryMessageStore10=function(w){var x=[],y=w[this.$MercuryMessageStore1];if(y&&y.length)x=x.concat(y);if(this.$MercuryMessageStore14){var z=w[this.$MercuryMessageStore14];if(z&&z.length){x=x.concat(z);this.$MercuryMessageStore14=null;}}if(x.length){this.$MercuryMessageStore2.append(x);this.$MercuryMessageStore6+=x.length;var aa=x.every(function(ba){return ba.author!=k.getID();});this.$MercuryMessageStore16(u.MESSAGES_RECEIVED,{allFromOthers:aa});}};u.prototype.$MercuryMessageStore11=function(w){this.$MercuryMessageStore2.update(this.$MercuryMessageStore3.getMessagesFromIDs(Object.keys(w)));this.$MercuryMessageStore17();this.$MercuryMessageStore16(u.MESSAGES_CHANGED);};u.prototype.$MercuryMessageStore12=function(){if(!this.$MercuryMessageStore5)return;this.$MercuryMessageStore2.reorder(this.$MercuryMessageStore3.getThreadMessagesSinceTimestamp(this.$MercuryMessageStore1,this.$MercuryMessageStore5));this.$MercuryMessageStore17();this.$MercuryMessageStore16(u.MESSAGES_REORDERED);};u.prototype.$MercuryMessageStore16=function(w,x){var y=this.$MercuryMessageStore2.toArray();this.releaseHeldEventType('updated');this.emitAndHold('updated',babelHelpers['extends']({messages:y,eventType:w},x));v(this.$MercuryMessageStore1,w,y);};u.prototype.$MercuryMessageStore17=function(){var w=this.$MercuryMessageStore2.at(0);if(w)this.$MercuryMessageStore5=w.timestamp;};function v(w,x,y){r(function(){t.debug('update:'+x,JSON.stringify({threadID:w,messageIDs:y.map(function(z){return z.message_id;})}));},0);}Object.assign(u,{MESSAGES_FETCHED:'fetched',MESSAGES_CHANGED:'changed',MESSAGES_RECEIVED:'received',MESSAGES_REORDERED:'reordered',THREAD_IS_EMPTY:'thread-is-empty'});p(u,{updated:true});f.exports=u;},null);
__d('MessengerContextBannerBootloader',['BootloadedComponent.react','CurrentUser','DOM','JSResource','React','ReactDOM'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();function n(q,r,s,t,u){var v=j.create('div');o(q,r,function(w){m.render(w,v,s(v));},t,u);}function o(q,r,s,t,u,v){v=babelHelpers['extends']({left:0,position:'absolute',right:0,top:0},v);p({otherUserFBIDs:t&&[t],threadID:q,style:v},r,s,u);}function p(q,r,s,t){s(l.createElement(h,babelHelpers['extends']({bootloadPlaceholder:l.createElement('div',{style:{height:80}}),bootloadLoader:k('MessengerContextBannerContainer.react'),location:r,onResize:t,viewer:i.getID()},q)));}f.exports={bootload:n,getBootloadedComponent:o};},null);
__d('MessengerHotLikePreviewEvents',['mixInEventEmitter'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={START:'start',STOP:'stop',POP:'pop',REMOVE:'remove',FINISH_ANIMATION:'finish_animation'};h(i,{start:true,stop:true,pop:true,remove:'remove',finish_animation:'finish_animation'});f.exports=i;},null);
__d('StickersDispatcher',['Dispatcher_DEPRECATED','StickerConstants'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=Object.assign(new h(),{_handleUpdate:function(k,l){var m=babelHelpers['extends']({payloadSource:k},l);this.dispatch(m);},handleUpdateFromViewActions:function(k){this._handleUpdate(i.PayloadSource.VIEW_ACTION,k);}});f.exports=j;},null);
__d('StickerActions',['BanzaiLogger','StickersDispatcher','keyMirror'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=j({ADD_PACK:null,CLICKED_STICKER_IN_THREAD:null,HIDE_TRAY:null,REMOVE_PACK:null,REPLACE_STICKER_STATE:null,RESET_NUM_NEW_PACKS:null,SELECT_PACK:null,SELECT_STORE_PACK:null,SHOW_TRAY:null,UPDATE_TRAY_DATA:null,TRAY_DATA_READY:null}),l={Types:k,addPack:function(m){i.dispatch({type:k.ADD_PACK,packID:m});},removePack:function(m){i.dispatch({type:k.REMOVE_PACK,packID:m});},selectPack:function(m,n){if(!n)h.log('StickersLoggerConfig',{event:'select_pack',packid:m});i.dispatch({type:k.SELECT_PACK,packID:m});},selectStorePack:function(m){i.dispatch({type:k.SELECT_STORE_PACK,packID:m});},resetNumNewPacks:function(){i.dispatch({type:k.RESET_NUM_NEW_PACKS});},handleStickerClick:function(m,n){i.dispatch({packID:m,threadID:n,type:l.Types.CLICKED_STICKER_IN_THREAD});},showStickerTray:function(m){i.dispatch({type:l.Types.SHOW_TRAY,threadID:m});},hideStickerTray:function(){i.dispatch({type:l.Types.HIDE_TRAY});},updateTrayData:function(){i.dispatch({type:l.Types.UPDATE_TRAY_DATA});},loadedTrayData:function(){i.dispatch({type:l.Types.TRAY_DATA_READY});}};f.exports=l;},null);
__d("XStickerPackImagesController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/{pack_id}\/images\/",{pack_id:{type:"Int",required:true},sticker_size:{type:"Int",defaultValue:50}});},null);
__d("XStickerQueryImagesController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/query\/images\/",{query:{type:"String",required:true},sticker_interface:{type:"String"}});},null);
__d("XStickerStateInitialDataController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/state\/",{});},null);
__d("XStickerStatePackDataController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/state\/pack\/",{pack_id:{type:"Int",required:true}});},null);
__d("XStickerStateStoreDataController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/state\/store\/",{});},null);
__d("XStickersAddPackController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/addpack\/",{pack_id:{type:"Int"},size:{type:"String"},redirect_uri:{type:"String"},is_promoted:{type:"Bool",defaultValue:false},no_async_dom:{type:"Bool",defaultValue:false}});},null);
__d("XStickersRemovePackController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/removepack\/",{pack_id:{type:"Int"},size:{type:"String"},redirect_uri:{type:"String"},no_async_dom:{type:"Bool",defaultValue:false}});},null);
__d('StickerServerRequests',['Promise','AsyncRequest','XStickerPackImagesController','XStickersAddPackController','XStickersRemovePackController','XStickerStateInitialDataController','XStickerStatePackDataController','XStickerStateStoreDataController','XStickerQueryImagesController'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q={addPack:function(s,t,u){var v=k.getURIBuilder().setInt('pack_id',s).setBool('is_promoted',t).getURI();new i(v).setHandler(function(w){return u(w.payload);}).send();},removePack:function(s,t){var u=l.getURIBuilder().setInt('pack_id',s).getURI();new i(u).setHandler(function(v){return t(v.payload);}).send();},getStickersForPack:function(s,t){var u=j.getURIBuilder().setInt('pack_id',s).setInt('sticker_size',t).getURI();return new h(function(v,w){return (new i().setURI(u).setMethod('GET').setReadOnly(true).setHandler(function(x){return v(x.payload);}).send());});},getStickersForQuery:function(s,t,u){new i().setURI(p.getURIBuilder().setString('query',s).setString('sticker_interface',t).getURI()).setMethod('GET').setReadOnly(true).setHandler(function(v){return u(v);}).send();},fetchTrayData:function(s){return r(m.getURIBuilder().getURI(),s,true);},fetchStoreData:function(s){return r(o.getURIBuilder().getURI(),s);},fetchPackData:function(s,t){return r(n.getURIBuilder().setInt('pack_id',s).getURI(),t);}};function r(s,t,u){return new h(function(v,w){return (new i(s).setHandler(function(x){return v(x.getPayload());}).setAllowCrossPageTransition(u).send());}).then(t);}f.exports=q;},null);
__d('StickerImages',['StickerServerRequests'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={},j={},k={requestStickersForPack:function(l,m,n){if(!l)return;if(!j[l]){j[l]=h.getStickersForPack(l,m);j[l].then(function(o){o.forEach(function(p){return this.cacheSticker(p);}.bind(this));}.bind(this));}j[l].then(function(o){return n(o);});},cacheSticker:function(l){i[l.id]=l;},getSticker:function(l){return i[l];}};f.exports=k;},null);
__d('StickerState',['ImmutableObject','StickerConfig','PresenceState','StickerActions','StickerConstants','StickerImages','StickerServerRequests'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o={},p,q,r,s=null,t=0,u={},v=[],w=[],x=[],y=null,z=null,aa=j.get();if(aa)y=aa.tray_pack_id;var ba=i.ShowStickerReplyNUX,ca={onTrayDataReady:function(ea){if(!q)q=n.fetchTrayData(function(fa){v=fa.packs.map(function(ga){return da(ga);});r=fa.mru;t=fa.num_new_packs;x=fa.tags;});q.then(function(){ea();k.loadedTrayData();});},onStoreDataReady:function(ea){if(!p)p=n.fetchStoreData(function(fa){w=fa.packs.map(function(ga){return da(ga);});});p.then(ea);},onPackDataReady:function(ea,fa){if(!o[ea])o[ea]=n.fetchPackData(ea,function(ga){da(ga);});o[ea].then(fa);},getPacksInTrayAllInterfaces:function(){return v;},getPacksInTray:function(){var ea=[],fa;for(var ga=0;ga<v.length;ga++)if(v[ga].id==l.EMOTICON_PACK_ID){fa=v[ga];}else if(v[ga].isMessengerCapable)ea.push(v[ga]);fa&&ea.push(fa);return ea;},getPacksInCommentsTray:function(){var ea=[],fa=[],ga;for(var ha=0;ha<v.length;ha++)if(v[ha].id==l.EMOTICON_PACK_ID){ga=v[ha];}else if(v[ha].isCommentsCapable){ea.push(v[ha]);}else fa.push(v[ha]);var ia=ea.concat(fa);if(ga)ia.push(ga);return ia;},getPacksInComposerTray:function(){return v.filter(function(ea){return ea.isComposerCapable;});},getPacksInFramesTray:function(){return v.filter(function(ea){return ea.isFramePack;});},getPackIDsInTray:function(){return v.map(function(ea){return ea.id;});},getPacksInStore:function(){return w.filter(function(ea){return ea.isMessengerCapable;});},getComposerPacksInStore:function(){return w.filter(function(ea){return ea.isComposerCapable;});},getPack:function(ea){return u[ea];},getNumNewPacks:function(){return t;},getFeaturedTags:function(){return x;},resetNumNewPacks:function(){t=0;},addMRUPack:function(){if(r){this._addPackToTray(r);r=null;}},addPack:function(ea){var fa=false;if(u[ea])fa=u[ea].isPromoted;n.addPack(ea,fa,function(ga){this._addPackToTray(ga);}.bind(this));},removePack:function(ea){n.removePack(ea,function(fa){v=v.filter(function(ga){return ga.id!==fa;});u[fa]=h.set(u[fa],{isInTray:false});w=w.map(function(ga){return u[ga.id];});k.updateTrayData();});},setTrayPackID:function(ea){y=ea;j.doSync();},getTrayPackID:function(ea){if(ea&&ea.length>0&&!ea.some(function(fa){return fa.id===y;})){return ea[0].id;}else return y;},setStorePackID:function(ea){z=ea;},getStorePackID:function(){return z;},shouldShowStickerReplyNUX:function(){return ba;},clearShowStickerReplyNUX:function(){ba=false;},_addPackToTray:function(ea,fa){da(ea);u[ea.id]=h.set(u[ea.id],{isPurchased:!fa,isInTray:true});var ga=v.filter(function(ia){return ia.id===ea.id;}).length>0;if(!ga){var ha;if(!fa){ha=v.filter(function(ia){return ia.isMRU||ia.isSearch;}).length;}else ha=v.filter(function(ia){return ia.id!==l.EMOTICON_PACK_ID;}).length;v.splice(ha,0,u[ea.id]);}w=w.map(function(ia){return u[ia.id];});k.updateTrayData();},_addRecentlyUsedSticker:function(ea){for(var fa=0;fa<s.length;++fa)if(s[fa].id===ea.id){s.splice(fa,1);break;}s.unshift(ea);},getMRUStickerPack:function(ea){if(!s)s=ea;return s;},updateRecentlyUsed:function(ea){if(!s){this.addMRUPack();return;}this._addRecentlyUsedSticker(m.getSticker(ea));}};j.registerStateStorer(function(ea){ea.tray_pack_id=y;});function da(ea){var fa=ea.id;if(!u[fa]){return u[fa]=new h(ea);}else return u[fa]=h.set(u[fa],ea);}f.exports=ca;},null);
__d('AbstractDialogFitHeight',['CSS','DOM','Event','Style','SubscriptionsHandler','Vector','csx','cx','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=450,r=100,s=67,t=67;function u(v){'use strict';this.$AbstractDialogFitHeight1=v;}u.prototype.enable=function(){'use strict';this.$AbstractDialogFitHeight2=new l();this.$AbstractDialogFitHeight2.addSubscriptions(this.$AbstractDialogFitHeight1.subscribe('beforeshow',this.$AbstractDialogFitHeight3.bind(this)),j.listen(window,'resize',p(this.$AbstractDialogFitHeight3.bind(this))));this.$AbstractDialogFitHeight4=i.find(this.$AbstractDialogFitHeight1.getRoot(),"._4-i2");h.addClass(this.$AbstractDialogFitHeight4,"_5pfh");this.$AbstractDialogFitHeight5=r;if(i.scry(this.$AbstractDialogFitHeight1.getRoot(),"._4-i0").length)this.$AbstractDialogFitHeight5+=s;if(i.scry(this.$AbstractDialogFitHeight1.getRoot(),"._5a8u").length)this.$AbstractDialogFitHeight5+=t;};u.prototype.disable=function(){'use strict';this.$AbstractDialogFitHeight2.release();this.$AbstractDialogFitHeight2=null;h.removeClass(this.$AbstractDialogFitHeight4,"_5pfh");};u.prototype.$AbstractDialogFitHeight3=function(){'use strict';var v=m.getViewportDimensions().y,w=v-this.$AbstractDialogFitHeight5;k.set(this.$AbstractDialogFitHeight4,this.getHeightProperty(),Math.max(q,w)+'px');this.$AbstractDialogFitHeight1.updatePosition();};f.exports=u;},null);
__d('DialogFitHeight',['AbstractDialogFitHeight'],function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,h);j=i&&i.prototype;k.prototype.getHeightProperty=function(){'use strict';return 'height';};function k(){'use strict';i.apply(this,arguments);}f.exports=k;},null);
__d('StickerStoreController',['Bootloader','DialogFitHeight','DOM','LayerAutoFocus','LayerFadeOnHide','LayerHideOnEscape','React','ReactComponentRenderer','StickerActions','XUIDialog.react','XUIDialogBody.react','XUISpinner.react','cx','isSocialPlugin','requestAnimationFrame'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){'use strict';if(c.__markCompiled)c.__markCompiled();var w=n.PropTypes,x=688,y=320,z=null,aa=n.createClass({displayName:'StoreLayer',propTypes:{isComposer:w.bool,shown:w.bool},getDefaultProps:function(){return {isComposer:false,shown:false};},getInitialState:function(){return {renderStore:function(){return (n.createElement('div',{className:"_5r5e"},n.createElement(s,{background:'light',size:'large'})));}};},componentDidMount:function(){h.loadModules(["StickerStore.react"],function(da){this.setState({renderStore:function(){return (n.createElement(da,{isComposer:this.props.isComposer,shown:this.props.shown}));}.bind(this)});}.bind(this));},_onToggle:function(da){v(function(){if(z)z.setProps({shown:da});});},render:function(){var da=u()&&document.body.offsetWidth<x?y:x;return (n.createElement(q,{behaviors:{DialogFitHeight:i,LayerAutoFocus:k,LayerFadeOnHide:l,LayerHideOnEscape:m},onToggle:this._onToggle,shown:this.props.shown,width:da},n.createElement(r,{className:"_5rq- autofocus"},this.state.renderStore())));}});function ba(da){var ea=j.create('div');j.appendContent(document.body,ea);z=new o(aa,ea);z.setProps({isComposer:da,shown:true});}var ca={showStore:function(da,ea){if(!z){ba(!!ea);}else z.setProps({shown:true,isComposer:!!ea});p.selectStorePack(da);}};f.exports=ca;},null);
__d('ChatTabMessagesView',['Animation','Arbiter','BanzaiLogger','CSS','ChatConversation.react','ChatPerfInstrumentation','ChatTabViewEvents','ChatTypingIndicators.react','ChatWelcomeMessage','CurrentUser','DOM','Event','immutable','MercuryLastMessageIndicator.react','LiveTimer','MercuryIDs','MercuryViewer','MercuryMessageStore','MessengerContextBannerBootloader','MessengerHotLikePreviewEvents','React','ReactDOM','ReactComponentRenderer','MercuryShareAttachmentRenderLocations','Scroll','ServerTime','StickerActions','StickerState','StickerStoreController','Style','SubscriptionsHandler','UserAgent_DEPRECATED','arrayContains','getElementPosition','throttle','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa){'use strict';if(c.__markCompiled)c.__markCompiled();var qa=c('MercuryThreads').get(),ra=64,sa=null,ta=20;function ua(wa){if(sa===null){var xa=wa.childNodes[0];ka.set(wa,'overflow','scroll');sa=xa.clientWidth-ra;ka.set(wa,'overflow','');}return sa;}function va(wa,xa,ya,za,ab,bb,cb,db,eb){this.loadingIcon=ab;this.threadID=wa;this.sheetController=xa;this.scrollContainer=ya;this.conversationElem=za;this.contextBannerEligible=eb;this.contextBannerElem=null;this.tabView=db;v.restart(ga.get()/1000);this._loadingMoreMessages=false;this._initialLoadFinished=false;function fb(){n.inform('interaction-with-tab',wa);}this._subscriptions=new la();this._subscriptions.addSubscriptions(i.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this)),s.listen(this.scrollContainer,'mousedown',fb));if(ma.firefox()){var gb='WheelEvent' in window?'wheel':'DOMMouseScroll';this.scrollContainer.addEventListener(gb,fb,false);}else this._subscriptions.addSubscriptions(s.listen(this.scrollContainer,'mousewheel',fb));this._subscriptions.addSubscriptions(s.listen(this.scrollContainer,'scroll',pa(this.scrolling,50,this)));var hb;ca.render(ba.createElement(o,{threadID:this.threadID,indicatorsWillShow:function(){return (hb=this.isScrolledToBottom());}.bind(this),indicatorsDidShow:function(){return (hb&&this.scrollToBottom(true));}.bind(this),viewer:q.getID()}),cb);var ib;this.lastMessageIndicatorNode=bb;this.lastMessageIndicator=new da(u,this.lastMessageIndicatorNode);this.lastMessageIndicator.setProps({threadID:this.threadID,hideTyping:true,indicatorWillShow:function(){return ib=this.isScrolledToBottom();}.bind(this),indicatorDidShow:function(){return ib&&this.scrollToBottom(true);}.bind(this)});this.initializeConversation();}Object.assign(va.prototype,{initializeConversation:function(){this._store=new y(this.threadID);this._conversation=new da(l,this.conversationElem);this._conversation.setProps({isCanonical:w.isCanonical(this.threadID),loadMoreMessages:this._loadMoreMessages.bind(this),maxBubbleWidth:ua(this.scrollContainer),messages:t.List(),onAttachmentLoad:function(wa){var xa=this.scrollContainer,ya=fa.getTop(xa)+xa.clientHeight;if(ya+wa>=xa.scrollHeight-ta||this._shouldScrollToBottom){this._shouldScrollToBottom=true;this.scrollToBottom();}}.bind(this),onMount:this.scrollToBottom.bind(this),onStickerClick:this._onStickerClick.bind(this),viewer:q.getID(),threadID:this.threadID});qa.getThreadMeta(this.threadID,function(wa){return this._conversation.setProps({thread:wa});}.bind(this));this._subscriptions.addSubscriptions(this._store.subscribe(this._updateMessageFromStore.bind(this)),aa.addListener(aa.START,function(wa,xa){if(this.threadID!==xa)return;this._likePreview=wa;this._conversation.setProps({messages:this._getNormalizedMessages()},this.scrollToBottom.bind(this));this.scrollToBottom();clearInterval(this._scrollToBottomInterval);this._scrollToBottomInterval=setInterval(this.scrollToBottom.bind(this),50);}.bind(this)),aa.addListener(aa.STOP,function(wa){if(this.threadID!==wa)return;this._likePreview=null;}.bind(this)),aa.addListener(aa.FINISH_ANIMATION,function(wa){clearInterval(this._scrollToBottomInterval);}.bind(this)),aa.addListener(aa.REMOVE,function(wa){if(this.threadID!==wa)return;clearInterval(this._scrollToBottomInterval);this._likePreview=null;this._conversation.setProps({messages:this._getNormalizedMessages()});}.bind(this)));},_updateMessageFromStore:function(wa){if(wa.eventType==y.MESSAGES_RECEIVED&&wa.allFromOthers&&!this.isScrolledToBottom()){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}if(wa.eventType==y.MESSAGES_REORDERED){this._loadingMoreMessages=false;k.hide(this.loadingIcon);}var xa=this.isScrolledToBottom(),ya=this._getLoadingHeight(),za=this.scrollContainer.scrollHeight,ab=fa.getTop(this.scrollContainer);this._messages=wa.messages;var bb=p.getWelcomeMessage(this.threadID);if(bb)this._messages.push(bb);this._conversation.setProps({messages:this._getNormalizedMessages()},function(){if(xa||this._shouldScrollToBottom){this.scrollToBottom();this.setShouldScrollToBottom(false);}else if(wa.eventType==y.MESSAGES_REORDERED)this.scrollToPosition(this.scrollContainer.scrollHeight-za-ya+ab);if(!this._initialLoadFinished){this._initialLoadFinished=true;m.logCHAT_CONVERSATION_TTI();}if(this._store.hasFetchedAll()&&this.contextBannerEligible)this.renderContextBanner(this.threadID);}.bind(this));this.lastMessageIndicator.setProps({lastMessage:this._messages.length>0?this._messages[this._messages.length-1]:null});if(wa.eventType==y.MESSAGES_RECEIVED&&this._shouldShowStickerReplyNUX(this._messages)&&this.tabView&&this.tabView.isFocused())this.tabView.showStickerReplyNUX();if(wa.eventType==y.MESSAGES_CHANGED)this._checkToAnimateSticker();},setShouldScrollToBottom:function(wa){this._shouldScrollToBottom=wa;},scrolling:function(){this._checkToAnimateSticker();if(this.isScrolledNearTop()&&!this._loadingMoreMessages&&!this.isScrolledToBottom()&&!this.tabView._isDragDropActive)if(this._store.fetchMoreMessages()){k.show(this.loadingIcon);this._loadingMoreMessages=true;}if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},getScrollTop:function(){return this.scrollContainer&&fa.getTop(this.scrollContainer);},getThreadID:function(){return this.threadID;},destroy:function(){r.scry(this.conversationElem,'.stickerContainer').forEach(function(wa){return ca.unmountComponentAtNode(wa);});this.unmountContextBanner();ca.unmountComponentAtNode(this.conversationElem);this._subscriptions&&this._subscriptions.release();ca.unmountComponentAtNode(this.lastMessageIndicatorNode);delete this.lastMessageIndicator;this._store&&this._store.destroy();this.destroyed=true;},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},_shouldShowStickerReplyNUX:function(wa){if(!ia.shouldShowStickerReplyNUX()||!wa.length)return false;var xa=wa[wa.length-1];if(xa.author===x.getID())return false;if(xa.has_attachment)return xa.attachments.some(function(ya){return ya.attach_type==='sticker';});return false;},isScrolledToBottom:function(wa){var xa=this.scrollContainer;wa=wa||ta;return fa.getTop(xa)+xa.clientHeight>=xa.scrollHeight-wa;},isScrolledNearTop:function(){return fa.getTop(this.scrollContainer)<this.scrollContainer.clientHeight;},scrollToBottom:function(wa){this.scrollToPosition(this.scrollContainer.scrollHeight,wa);},scrollToPosition:function(wa,xa){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(xa===true){this._scrollTopAnimation=new h(this.scrollContainer).to('scrollTop',wa).ease(h.ease.end).duration(400).go();}else fa.setTop(this.scrollContainer,wa);},_loadMoreMessages:function(){return this._store.fetchMoreMessages();},_onStickerClick:function(wa,xa){if(!wa)return;j.log('StickersLoggerConfig',{event:'click_sticker',packid:wa,stickerid:xa});var ya=this.tabView;ia.onTrayDataReady(function(){if(na(ia.getPackIDsInTray(),wa)){var za=ia.getPack(wa);if(za&&za.isPromoted)ha.addPack(wa);ya.setStickersFlyoutPackID(wa);}else ja.showStore(wa);});},_checkToAnimateSticker:function(){var wa=oa(this.scrollContainer);i.inform('chatScrolled/'+this.threadID,{scrollTop:fa.getTop(this.scrollContainer),top:wa.y,viewHeight:wa.height});},setNewThreadID:function(wa){this._store.setNewThreadID(wa);},_getNormalizedMessages:function(){if(this._likePreview){this._messages.push(this._likePreview);}else this._messages=this._messages.filter(function(wa){return !wa.is_like_preview;});return t.List(this._messages);},renderContextBanner:function(wa,xa){z.getBootloadedComponent(wa,ea.CHAT,function(ya){ka.set(this.conversationElem,'padding-top','80px');this._conversation.setProps({contextBanner:ya});}.bind(this),xa,function(ya){ka.set(this.conversationElem,'padding-top',ya+'px');}.bind(this));},unmountContextBanner:function(){if(this._conversation)this._conversation.setProps({contextBanner:null});}});f.exports=va;},null);
__d('ChatTabSheetListener',['ChatPrivacyActionController','MercuryIDs','MercuryParticipants','MercuryThreadInformer','MercuryThreads','MercuryViewer'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();function n(o,p){this.$ChatTabSheetListener1=p;this.$ChatTabSheetListener3=o;this.$ChatTabSheetListener4=i.getUserIDFromThreadID(this.$ChatTabSheetListener3);k.get().subscribe('threads-updated',function(){return this.$ChatTabSheetListener5();}.bind(this));if(this.$ChatTabSheetListener4)this.$ChatTabSheetListener2=new h(this.$ChatTabSheetListener4,function(q){return this.$ChatTabSheetListener6(q);}.bind(this));}n.prototype.destroy=function(){this.$ChatTabSheetListener2&&this.$ChatTabSheetListener2.destroy();};n.prototype.$ChatTabSheetListener5=function(){var o=l.get();o.getThreadMeta(this.$ChatTabSheetListener3,function(p){var q=m.getID(),r=p.participants.filter(function(s){return s!==q;});r.length<1&&!o.isNewEmptyLocalThread(this.$ChatTabSheetListener3)?this.$ChatTabSheetListener1.openNoRecipientsSheet():this.$ChatTabSheetListener1.closeNoRecipientsSheet();}.bind(this));};n.prototype.$ChatTabSheetListener6=function(o){switch(o){case h.OFFLINE:this.$ChatTabSheetListener1.closeUserBlockedSheet();this.$ChatTabSheetListener1.openOfflineSheet();break;case h.NORMAL:this.$ChatTabSheetListener1.closeUserBlockedSheet();this.$ChatTabSheetListener1.closeOfflineSheet();break;case h.BLOCKED:this.$ChatTabSheetListener1.closeOfflineSheet();j.get(i.getParticipantIDFromUserID(this.$ChatTabSheetListener4),function(p){p.is_friend?this.$ChatTabSheetListener1.openUserBlockedSheet():this.$ChatTabSheetListener1.closeUserBlockedSheet();}.bind(this));break;}};f.exports=n;},null);
__d('ChatTabSheetController',['Bootloader','ChatTabSheetListener','Deferred','MercuryIDs'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=function(m,n,o,p){this._threadID=m;this._rootElement=n;this._tabElement=o;this._view=p;this._deferred=new j();this._isLoading=false;this._listener=new i(this._threadID,this);};Object.assign(l.prototype,{openAddFriendsSheet:function(){this._load(function(){this._addFriendsTabSheet.open();}.bind(this));},openMessageBlockedTabSheet:function(){this._load(function(){this._threadIsMessageBlockedSheet.open();}.bind(this));},getAddFriendsParticipants:function(){return this._addFriendsTabSheet?this._addFriendsTabSheet.getParticipants():[];},openNameConversationSheet:function(m){this._load(function(){this._nameConversationTabSheet.open(m);}.bind(this));},openReadOnlySheet:function(){this._load(function(){this._readOnlyTabSheet.open();}.bind(this));},openNewMessagesSheet:function(){this._load(function(){this._newMessagesTabSheet.open();}.bind(this));},openUploadWarningTabSheet:function(){this._load(function(){this._uploadWarningTabSheet.open();}.bind(this));},openThreadIsMutedTabSheet:function(){this._load(function(){this._threadIsMutedTabSheet.open();}.bind(this));},openEmployeeAwaySheet:function(){this._load(function(){this._employeeAwaySheet.open();}.bind(this));},openOfflineSheet:function(){this._load(function(){this._offlineTabSheet.open();}.bind(this));},openUserBlockedSheet:function(){this._load(function(){this._userBlockedTabSheet.open();}.bind(this));},openNoRecipientsSheet:function(){this._load(function(){this._noRecipientsTabSheet&&this._noRecipientsTabSheet.open();}.bind(this));},openSecretModeSheet:function(){this._load(function(){this._secretModeSheet.open();}.bind(this));},closeAddFriendsSheet:function(){this._lazy(function(){this._addFriendsTabSheet.close();}.bind(this));},closeAutomaticNameConversationSheet:function(){this._lazy(function(){if(this._nameConversationTabSheet&&this._nameConversationTabSheet.isAutomatic())this._nameConversationTabSheet.close();}.bind(this));},closeMessageBlockedTabSheet:function(){this._lazy(function(){this._threadIsMessageBlockedSheet.close();}.bind(this));},closeThreadIsMutedTabSheet:function(){this._lazy(function(){this._threadIsMutedTabSheet.close();}.bind(this));},closeNewMessagesSheet:function(){this._lazy(function(){this._newMessagesTabSheet.close();}.bind(this));},closeUploadWarningTabSheet:function(){this._lazy(function(){this._uploadWarningTabSheet.close();}.bind(this));},closeOfflineSheet:function(){this._lazy(function(){this._offlineTabSheet.close();}.bind(this));},closeUserBlockedSheet:function(){this._lazy(function(){this._userBlockedTabSheet.close();}.bind(this));},closeSecretModeSheet:function(){this._lazy(function(){this._secretModeSheet.close();}.bind(this));},onClickMessagesBlockedSheet:function(m){this._lazy(function(){this._unblockMessagesSub=this._threadIsMessageBlockedSheet.subscribe('clicked',m);}.bind(this));},closeNoRecipientsSheet:function(){this._lazy(function(){this._noRecipientsTabSheet&&this._noRecipientsTabSheet.close();}.bind(this));},onClickNewMessagesSheet:function(m){this._lazy(function(){this._newMessageClickSub=this._newMessagesTabSheet.subscribe('clicked',m);}.bind(this));},onClickThreadIsMutedSheet:function(m){this._lazy(function(){this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',m);}.bind(this));},onClickSecretModeSheet:function(m){this._lazy(function(){this._secretModeClickSub=this._secretModeSheet.subscribe('clicked',m);}.bind(this));},onResize:function(m){this._lazy(function(){this._sheetView.subscribe('resize',m);}.bind(this));},onTokensChanged:function(m){this._lazy(function(){this._addFriendsTabSheet.subscribe('chat/tokens-changed',m);}.bind(this));},onEscape:function(m){this._lazy(function(){this._addFriendsTabSheet.subscribe('esc-pressed',m);}.bind(this));},destroy:function(){this._listener&&this._listener.destroy();this._sheetView&&this._sheetView.destroy();this._offlineTabSheet&&this._offlineTabSheet.destroy();this._userBlockedTabSheet&&this._userBlockedTabSheet.destroy();this._newMessageClickSub&&this._newMessageClickSub.unsubscribe();this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();},_load:function(m){this._bootload();this._deferred.then(m);},_lazy:function(m){this._deferred.then(m);},_bootload:function(){if(this._isLoading)return;this._isLoading=true;h.loadModules(["ChatAddFriendsTabSheet","ChatEmployeeAwaySheet","ChatNameConversationTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatReadOnlyTabSheet","ChatThreadIsMessageBlockedSheet","ChatThreadIsMutedTabSheet","ChatThreadSecretModeSheet","ChatUploadWarningTabSheet","ChatUserBlockedTabSheet","MercurySheetView"],function(m,n,o,p,q,r,s,t,u,v,w,x,y){this._sheetView=new y(this._threadID,this._rootElement,this._tabElement);var z=this._threadID,aa=this._rootElement,ba=this._sheetView,ca=this._view;this._addFriendsTabSheet=new m(z,aa,ba,ca);this._employeeAwaySheet=new n(z,aa,ba);this._nameConversationTabSheet=new o(z,aa,ba);this._newMessagesTabSheet=new p(z,aa,ba);this._offlineTabSheet=new r(z,aa,ba);this._readOnlyTabSheet=new s(z,aa,ba);this._threadIsMessageBlockedSheet=new t(z,aa,ba);this._threadIsMutedTabSheet=new u(z,aa,ba);this._secretModeSheet=new v(z,aa,ba);this._uploadWarningTabSheet=new w(z,aa,ba);this._userBlockedTabSheet=new x(z,aa,ba);if(!k.getUserIDFromThreadID(this._threadID))this._noRecipientsTabSheet=new q(z,aa,ba);this._deferred.resolve();}.bind(this));}});f.exports=l;},null);
__d('ChatTitleLink.react',['Link.react','MercuryThreadTitle.react','React','TrackingNodes','UserAgent','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=j.PropTypes,o=j.createClass({displayName:'ChatTitleLink',propTypes:{href:n.string,isNewThread:n.bool,thread:n.object,viewer:n.string},getDefaultProps:function(){return {href:null};},getTitle:function(){return this.refs.threadTitle.getTitle();},render:function(){if(!this.props.thread)return null;return (j.createElement(h,{'aria-level':'3',className:"titlebarText"+(l.isBrowser('Chrome')&&!l.isPlatform('Windows')?' '+"fixemoji":'')+(this.props.href===null?' '+"noLink":''),'data-ft':k.getTrackingInfo(k.types.TITLE),'data-hover':'tooltip',href:this.props.href},j.createElement(i,{ref:'threadTitle',isNewThread:this.props.isNewThread,thread:this.props.thread,useAndSeparator:true,useShortName:!this.props.thread.is_canonical,viewer:this.props.viewer})));}});f.exports=o;},null);
__d('EmoticonUtils',['EmoticonsList','Parent'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j='emoticon_',k=h.symbols,l={getEmoteFromTarget:function(m){var n=i.byClass(m,'emoticon');if(!n)return null;var o=null;n.className.split(' ').forEach(function(p){if(p.startsWith(j))o=p.substring(j.length);});return k[o]||null;},insertEmoticon:function(m,n,o){var p=n.substring(0,o.start),q=n.substring(o.end);if(o.start>0&&!p.endsWith(' '))m=' '+m;if(!q.startsWith(' '))m+=' ';var r=p+m+q;o.start+=m.length;o.end=o.start;return {result:r,start:o.start,end:o.end};}};f.exports=l;},null);
__d('FBRTCAvailability',['ChannelConstants','PresenceStatus'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j={isCallable:function(k){var l=i.getCapabilities(k),m=h.CAPABILITY_VOIP_INTEROP;return !!(l&m);}};f.exports=j;},null);
__d('FBRTCCallabilityActions',['keyMirror'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=h({CALLABILITY_FETCHED:null,CALLABILITY_FETCH_ERROR:null});function j(k){this.$FBRTCCallabilityActions1=k;}j.prototype.callabilityFetched=function(k,l){this.$FBRTCCallabilityActions1.dispatch({type:i.CALLABILITY_FETCHED,userID:k,callability:l});};j.prototype.callabilityFetchError=function(k){this.$FBRTCCallabilityActions1.dispatch({type:i.CALLABILITY_FETCH_ERROR,userID:k});};j.Types=i;f.exports=j;},null);
__d("XRTCCallabilityController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/rtc\/callability\/",{user_id:{type:"Int",required:true}});},null);
__d('FBRTCCallabilityDataManager',['AsyncRequest','FBRTCCallabilityActions','XRTCCallabilityController'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();function k(l){this.$FBRTCCallabilityDataManager1=new i(l);}k.prototype.fetchCallability=function(l){var m=j.getURIBuilder().setInt('user_id',parseInt(l,10)).getURI(),n=this.$FBRTCCallabilityDataManager2.bind(this,l),o=this.$FBRTCCallabilityDataManager3.bind(this,l);new h().setURI(m).setHandler(n).setErrorHandler(o).setAllowCrossPageTransition(true).send();};k.prototype.$FBRTCCallabilityDataManager2=function(l,m){this.$FBRTCCallabilityDataManager1.callabilityFetched(l,m.payload);};k.prototype.$FBRTCCallabilityDataManager3=function(l,m){this.$FBRTCCallabilityDataManager1.callabilityFetchError(l);};f.exports=k;},null);
__d('RTCCallabilityStore',['Cache','FBRTCAvailability','FluxStore','FBRTCCallabilityActions','FBRTCCallabilityDataManager','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';var n,o;if(c.__markCompiled)c.__markCompiled();var p=.5,q=5;n=babelHelpers.inherits(r,j);o=n&&n.prototype;function r(s){o.constructor.call(this,s);this.$RTCCallabilityStore2=new l(s);this.$RTCCallabilityStore1=new h();}r.prototype.__onDispatch=function(s){var t=s.type;switch(t){case k.Types.CALLABILITY_FETCHED:var u=s.userID,v=s.callability;this.$RTCCallabilityStore1.set(u,v.is_callable,null,v.is_callable?q:p);this.__emitChange();break;case k.Types.CALLABILITY_FETCH_ERROR:this.$RTCCallabilityStore1.set(s.userID,false,null,p);this.__emitChange();break;}};r.prototype.isCallable=function(s){if(i.isCallable(s))return true;if(!this.$RTCCallabilityStore1.has(s)){this.$RTCCallabilityStore2.fetchCallability(s);this.$RTCCallabilityStore1.set(s,false,null,p);}return !!this.$RTCCallabilityStore1.get(s);};r.prototype.callButtonTooltip=function(s,t){if(this.isCallable(s))return m._("D\u00e9marrer un appel vid\u00e9o avec {shortname}",[m.param('shortname',t)]);return m._("{shortname} est actuellement indisponible pour un appel vid\u00e9o",[m.param('shortname',t)]);};r.prototype.voiceCallButtonTooltip=function(s,t){if(this.isCallable(s))return m._("Commencer un appel vocal avec {shortname}",[m.param('shortname',t)]);return m._("{shortname} est actuellement indisponible pour un appel vid\u00e9o",[m.param('shortname',t)]);};f.exports=r;},null);
__d('FBRTCCallabilityStore',['FBRTCDispatcher','RTCCallabilityStore'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new i(h);},null);
__d('MercuryCanonicalGroupThreadManager',['KeyedCallbackManager','MercuryIDs','MercuryServerPayloadPreprocessor','MercurySingletonProvider','MercuryThreads','MercuryServerDispatcher'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();function n(p){this.$MercuryCanonicalGroupThreadManager1=p;this.$MercuryCanonicalGroupThreadManager2=new h();this.$MercuryCanonicalGroupThreadManager3=j.getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager4=l.getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager5();}n.getForFBID=function(p){return o.getForFBID(p);};n.get=function(){return o.get();};n.prototype.getCanonicalGroupThreadIDForParticipants=function(p,q){if(p.indexOf(this.$MercuryCanonicalGroupThreadManager1)===-1)p.push(this.$MercuryCanonicalGroupThreadManager1);var r=this.$MercuryCanonicalGroupThreadManager6(p);this.$MercuryCanonicalGroupThreadManager2.setResource(r,undefined);var s=this.$MercuryCanonicalGroupThreadManager2.executeOrEnqueue(r,q);this.$MercuryCanonicalGroupThreadManager7(p);return s;};n.prototype.unsubscribe=function(p){if(p)this.$MercuryCanonicalGroupThreadManager2.unsubscribe(p);};n.prototype.$MercuryCanonicalGroupThreadManager6=function(p){return p.sort().join(',');};n.prototype.$MercuryCanonicalGroupThreadManager8=function(p,q){var r=i.getThreadIDFromThreadFBID(q);this.$MercuryCanonicalGroupThreadManager2.setResource(p,r);};n.prototype.$MercuryCanonicalGroupThreadManager7=function(p){var q={canonical_group_key:this.$MercuryCanonicalGroupThreadManager6(p),participants:p};m.trySend('/ajax/mercury/search_canonical_groups.php',q,null,this.$MercuryCanonicalGroupThreadManager1);};n.prototype.$MercuryCanonicalGroupThreadManager5=function(){m.registerEndpoints({'/ajax/mercury/search_canonical_groups.php':{request_user_id:this.$MercuryCanonicalGroupThreadManager1,mode:m.IMMEDIATE,handler:function(p){this.handleUpdate(p);}.bind(this)}});};n.prototype.handleUpdate=function(p){if(p.mercury_payload)this.$MercuryCanonicalGroupThreadManager3.handleUpdate(p.mercury_payload);var q=p.canonical_group;if(q)for(var r in q)this.$MercuryCanonicalGroupThreadManager8(r,q[r]);};var o=new k(n);f.exports=n;},null);
__d('ContextualLayerAutoFlipHorizontal',['ContextualLayerAutoFlip'],function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,h);j=i&&i.prototype;k.prototype.getValidPositions=function(l){'use strict';return [l.getPosition()];};function k(){'use strict';i.apply(this,arguments);}f.exports=k;},null);
__d('MessengerContextualDialog.react',['ContextualLayerAutoFlipHorizontal','LayerHideOnEscape','ReactAbstractContextualDialog','ReactLayer','cx'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=12,n=k.createClass(j.createSpec({addedBehaviors:[h,i],displayName:'MessengerContextualDialog',shouldSetARIAProperties:false,theme:{wrapperClassName:"_1r_9",arrowDimensions:{offset:m,length:16}}}));f.exports=n;},null);
__d('P2PAbstractSendMoneyButton.react',['React','TooltipLink.react','cx','fbt','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=h.PropTypes,n=h.createClass({displayName:'P2PAbstractSendMoneyButton',propTypes:{button:m.object,isActive:m.bool.isRequired,isDisabled:m.bool,isMessenger:m.bool.isRequired,onClick:m.func.isRequired,onMouseOver:m.func,recipientName:m.string},_clickGuard:false,render:function(){return (h.createElement(i,{alignH:'center',className:l(this.props.className,(this.props.isActive?"open":'')+(this.props.isDisabled?' '+"disabled":'')+(this.props.isActive?' '+"_10gz":'')+(this.props.isDisabled?' '+"_10g-":'')+(!this.props.isMessenger&&!this.props.className?' '+"_5uqy":'')+(this.props.isMessenger?' '+"_3ggc":'')),href:'#',onClick:this._handleClick,onMouseDown:this._prepareForClick,onMouseOver:this.props.onMouseOver,position:'above',role:'button',title:this._getLinkTitle()},this.getButton()));},getButton:function(){if(this.props.button)return this.props.button;return h.createElement('i',{className:"_5s8l"});},_getLinkTitle:function(){if(this.props.isDisabled)return null;return k._("Envoyer de l\u2019argent");},_prepareForClick:function(){this.props.onMouseDown&&this.props.onMouseDown();this._clickGuard=this.props.isActive;},_handleClick:function(o){o.stopPropagation();if(this._clickGuard){this._clickGuard=false;return;}this.props.onClick();}});f.exports=n;},null);
__d('MercuryFilters',['MessagingTag','arrayContains'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=[h.UNREAD],k={ALL:'all',UNREAD:h.UNREAD,getSupportedFilters:function(){return j.concat();},isSupportedFilter:function(l){return i(j,l);}};f.exports=k;},null);
__d('MessengerURIConstants',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={COMPOSE_SUBPATH:'/new',GROUPS_PATH:'/groups',PEOPLE_PATH:'/people',FILTERED_REQUESTS_PATH:'/filtered',MESSAGE_REQUESTS_PATH:'/requests',THREAD_PREFIX:'/t/',GROUP_PREFIX:'group-'};f.exports=h;},null);
__d('MessengerStateProcessor',['MercuryAPIArgsSource','MercuryIDs','MercuryParticipantTypes','MercuryParticipants','MercuryThreadIDMap','MercuryThreads','MercuryVanityIDMap','MessengerURIConstants'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p={preprocess:function(r){var s=r.activeThreadID;if(s){var t=i.getUserIDFromThreadID(s),u=t&&k.getNow(i.getParticipantIDFromUserID(t));if(u&&u.type!==j.EVENT){r.threadKey=u.vanity||t;}else if(t&&!u){var v=i.getParticipantIDFromUserID(t);r.threadKey=n.hasID(v)?n.getVanity(v):t;}else{var w=l.get(),x=w.getServerIDFromClientIDNow(s);r.threadKey=x||s;}}delete r.activeThreadID;return r;},postprocess:function(r){var s=l.get(),t=m.get(),u=q(r.threadKey),v;v=i.isValid(u)?u:s.getClientIDFromServerIDNow(u);if(!v){var w=k.getIDFromVanityOrFBID(u),x=w&&t.getCanonicalThreadToParticipant(w,null,h.MESSENGER);if(x)v=x.thread_id;}if(v){r.activeThreadID=v;r.serverThreadID=s.getServerIDFromClientIDNow(v);}delete r.threadKey;return r;}};function q(r){if(!r)return null;return r.startsWith(o.GROUP_PREFIX)?r.substr(o.GROUP_PREFIX.length):r;}f.exports=p;},null);
__d('MessengerURISerializer',['MercuryFilters','MessagingTag','MessengerStateProcessor','MessengerURIConstants','MessengerView','URI','WWWBase'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o='/?$',p={serialize:function(r){var s=new m(n.uri);r=j.preprocess(r);switch(r.masterView){case l.MASTER.GROUPS:s.setPath(k.GROUPS_PATH);break;case l.MASTER.PEOPLE:s.setPath(k.PEOPLE_PATH);break;}switch(r.folder){case i.OTHER:s.setPath(k.FILTERED_REQUESTS_PATH);break;case i.PENDING:s.setPath(k.MESSAGE_REQUESTS_PATH);break;}if(r.detailView===l.DETAIL.COMPOSE){s.setPath(s.getPath()+k.COMPOSE_SUBPATH);}else if(r.threadKey)s.setPath(s.getPath()+k.THREAD_PREFIX+r.threadKey);if(h.isSupportedFilter(r.filter))s.addQueryData({filter:r.filter});return s;},deserialize:function(r){var s={},t=r.getPath();if(t.match('^'+k.GROUPS_PATH)){s.masterView=l.MASTER.GROUPS;}else if(t.match('^'+k.PEOPLE_PATH)){s.masterView=l.MASTER.PEOPLE;}else s.masterView=l.MASTER.RECENT;if(t.match('^'+k.FILTERED_REQUESTS_PATH)){s.folder=i.OTHER;}else if(t.match('^'+k.MESSAGE_REQUESTS_PATH)){s.folder=i.PENDING;}else s.folder=i.INBOX;if(t.match(k.COMPOSE_SUBPATH+o)){s.detailView=l.DETAIL.COMPOSE;}else{var u=q(t);if(u){s.threadKey=u;s.detailView=l.DETAIL.THREAD;}}var v=r.getQueryData();if(h.isSupportedFilter(v.filter)){s.filter=v.filter;}else s.filter=h.ALL;return j.postprocess(s);}};function q(r){var s=r.match(k.THREAD_PREFIX+'([^/]+)'+o);return s&&s[1];}f.exports=p;},null);
__d('MessengerActions',['MessengerDispatcher','MessengerURISerializer','MessengerView','URI','goURI','keyMirror'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=m({HIDE_DIALOG:null,REPLACE_STATE:null,SHOW_DIALOG:null}),o={Types:n,changeDetailView:function(q){p(function(r){if(r.detailView!==q)return {detailView:q};});},changeMasterView:function(q){p(function(r){if(r.masterView!==q)return {masterView:q};});},selectThread:function(q){p(function(r){if(r.activeThreadID!==q)return {activeThreadID:q,detailView:j.DETAIL.THREAD};});},changeState:function(q){h.dispatch({type:n.REPLACE_STATE,nextState:q});},showDialog:function(q,r){h.dispatch({type:o.Types.SHOW_DIALOG,dialogClass:q,dialogProps:r});},hideDialog:function(q){h.dispatch({type:o.Types.HIDE_DIALOG,dialogClass:q});},changeFolder:function(q){p(function(r){if(r.folder!==q)return {folder:q};});},changeFilter:function(q){p(function(r){if(r.filter!==q)return {filter:q};});}};function p(q){var r=i.deserialize(new k(window.location.href)),s=q(r);if(s)l(i.serialize(Object.assign(r,s)));}f.exports=o;},null);
__d('P2PActionConstants',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={CREDIT_CARDS_UPDATED:'credit_cards_updated',CREDIT_CARDS_UPDATED_ERROR:'credit_cards_updated_error',CHANNEL_EVENTS_ALLOWED:'channel_events_allowed',CHANNEL_EVENTS_IGNORED:'channel_events_ignored',CREDIT_CARD_SAVING:'credit_card_saving',CREDIT_CARD_ADDED:'credit_card_added',CREDIT_CARD_ADDED_ERROR:'credit_card_added_error',CREDIT_CARD_ADDED_ERROR_CLEARED:'credit_card_added_error_cleared',CREDIT_CARD_DELETED:'credit_card_deleted',CREDIT_CARD_DELETED_ERROR:'credit_card_deleted_error',CREDIT_CARD_UPDATED:'credit_card_updated',CREDIT_CARD_UPDATED_ERROR:'credit_card_updated_error',PRESET_CREDIT_CARD_UPDATED:'preset_credit_card_updated',PRESET_CREDIT_CARD_UPDATED_ERROR:'preset_credit_card_updated_error',CREDIT_CARD_VERIFIED:'credit_card_verified',CREDIT_CARD_VERIFIED_ERROR:'credit_card_verified_error',TRANSFERS_UPDATED:'transfers_updated',TRANSFERS_UPDATED_ERROR:'transfers_updated_error',NUX_TRANSFERS_UPDATED:'nux_transfers_updated',TRANSFER_ADDED:'transfer_added',TRANSFER_ADDED_ERROR:'transfer_added_error',TRANSFER_UPDATED:'transfer_updated',TRANSFER_UPDATED_ERROR:'transfer_updated_error',TRANSFER_ACCEPTED:'transfer_accepted',TRANSFER_DECLINED:'transfer_declined',CHAT_SEND_VIEW_OPENED:'chat_send_view_opened',CHAT_SEND_VIEW_CLOSED:'chat_send_view_closed',BIN_NUMBER_VALIDATED:'bin_number_validated',BIN_NUMBER_VALIDATED_ERROR:'bin_number_validated_error',USER_ELIGIBILITY_UDPATED:'user_eligibility_updated',FRIENDS_LIST_UPDATED:'friends_list_updated',DIALOG_SHOWN:'dialog_shown',DIALOG_CLOSED:'dialog_closed',BANNER_STATES_UPDATED:'banner_states_updated',BANNER_DISMISSED:'banner_dismissed',BANNER_VIEWED:'banner_viewed',BANNER_COMPLETED:'banner_completed',MONEYPENNY_TRANSFER_CREATED:'moneypenny_transfer_created',MONEYPENNY_TRANSFER_CREATED_ERROR:'moneypenny_transfer_created_error',PLATFORM_CONTEXT_ADDED:'platform_context_added',PLATFORM_CONTEXT_ADDED_ERROR:'platform_context_added_error',PLATFORM_CONTEXT_SAVE_ERRORS_CLEARED:'platform_context_save_errors_cleared',PLATFORM_CONTEXT_BANNER_DISMISSED:'platform_context_banner_dismissed',PLATFORM_CONTEXT_PRODUCT_ITEM_SOLD:'platform_context_product_item_sold',PLATFORM_CONTEXT_CHANGED:'platform_context_changed',EXTENSIVE_TRANSFER_DETAILS_UPDATED:'extensive_transfer_details_updated',ADDRESS_SAVING:'address_saving',ADDRESSES_UPDATED:'addresses_updated',ADDRESS_ADDED:'address_added',ADDRESS_ADDED_ERROR:'address_added_error',ADDRESS_ADDED_ERROR_CLEARED:'address_added_error_cleared',CHECKOUT_CART_INITIATED:'checkout_cart_initiated',CHECKOUT_CART_CREATED:'checkout_cart_created',CHECKOUT_SHIPPING_OPTION_SELECTED:'checkout_shipping_option_selected',CHECKOUT_ADDRESS_SELECTED:'checkout_address_selected',CHECKOUT_CREDIT_CARD_SELECTED:'checkout_credit_card_selected',CHECKOUT_ADDRESS_FORM_TOGGLED:'checkout_address_form_toggled',CHECKOUT_CREDIT_CARD_FORM_TOGGLED:'checkout_credit_card_form_toggled',CHECKOUT_ADDRESS_EDIT_OPTIONS_TOGGLED:'checkout_address_options_toggled',CHECKOUT_CREDIT_CARD_EDIT_OPTIONS_TOGGLED:'checkout_credit_card_edit_options_toggled',CHECKOUT_ADDRESS_FORM_VALIDATED:'checkout_address_form_validated',CHECKOUT_CREDIT_CARD_FORM_VALIDATED:'checkout_credit_card_form_validated',CHECKOUT_EDIT_COMPLETED:'checkout_completed',CHECKOUT_PROCESSING:'checkout_processing',CHECKOUT_BUYER_PROFILE_UPDATED:'checkout_buyer_profile_updated',PAYMENT_REQUEST_INITIATED:'payment_request_initiated',PAYMENT_REQUEST_INITIATED_COMPLETE:'payment_request_initiated_completed',PAYMENT_REQUEST_CREATED:'payment_request_created',PAYMENT_REQUEST_CREATED_ERROR:'payment_request_created_error',PAYMENT_REQUEST_UPDATED:'payment_request_updated',PAYMENT_REQUEST_DECLINE_INITIATED:'payment_request_decline_initiated',PAYMENT_REQUEST_DECLINED:'payment_request_declined',PAYMENT_REQUEST_DECLINE_ERROR:'payment_request_decline_error',PAYMENT_REQUESTS_FETCHED:'payment_requests_fetched',PAYMENT_REQUEST_CANCEL_INITIATED:'payment_request_cancel_initiated',PAYMENT_REQUEST_CANCELED:'payment_request_canceled',PAYMENT_REQUEST_CANCEL_ERROR:'payment_request_cancel_error'};f.exports=h;},null);
__d('P2PDispatcher',['Dispatcher_DEPRECATED'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);
__d('P2PActions',['ChatOpenTab','CurrentEnvironment','MessengerActions','P2PActionConstants','P2PDispatcher','MercuryShareAttachmentRenderLocations'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n={updateCreditCards:function(o){l.dispatch({type:k.CREDIT_CARDS_UPDATED,data:o});},updateCreditCardsError:function(){l.dispatch({type:k.CREDIT_CARDS_UPDATED_ERROR});},ignoreCreditCardChannelEvents:function(){l.dispatch({type:k.CHANNEL_EVENTS_IGNORED});},allowCreditCardChannelEvents:function(){l.dispatch({type:k.CHANNEL_EVENTS_ALLOWED});},creditCardSaving:function(){l.dispatch({type:k.CREDIT_CARD_SAVING});},addCreditCard:function(o){l.dispatch({type:k.CREDIT_CARD_ADDED,data:o});},addCreditCardError:function(o){l.dispatch({type:k.CREDIT_CARD_ADDED_ERROR,data:o});},addCreditCardErrorCleared:function(){l.dispatch({type:k.CREDIT_CARD_ADDED_ERROR_CLEARED});},updatePresetCreditCard:function(o){l.dispatch({type:k.PRESET_CREDIT_CARD_UPDATED,data:o});},updatePresetCreditCardError:function(o){l.dispatch({type:k.PRESET_CREDIT_CARD_UPDATED_ERROR,data:o});},updateCreditCard:function(o){l.dispatch({type:k.CREDIT_CARD_UPDATED,data:o});},updateCreditCardError:function(o){l.dispatch({type:k.CREDIT_CARD_UPDATED_ERROR,data:o});},deleteCreditCard:function(o){l.dispatch({type:k.CREDIT_CARD_DELETED,data:o});},deleteCreditCardError:function(o){l.dispatch({type:k.CREDIT_CARD_DELETED_ERROR,data:o});},verifyCreditCard:function(o){l.dispatch({type:k.CREDIT_CARD_VERIFIED,data:o});},verifyCreditCardError:function(o){l.dispatch({type:k.CREDIT_CARD_VERIFIED_ERROR,data:o});},updateTransfers:function(o){l.dispatch({type:k.TRANSFERS_UPDATED,data:o});},updateTransfersError:function(o){l.dispatch({type:k.TRANSFERS_UPDATED_ERROR,data:o});},updateNUXTransfers:function(o){l.dispatch({type:k.NUX_TRANSFERS_UPDATED,data:o});},transferAdded:function(o){l.dispatch({type:k.TRANSFER_ADDED,data:o});},transferAddedError:function(o){l.dispatch({type:k.TRANSFER_ADDED_ERROR,data:o});},transferUpdated:function(o){l.dispatch({type:k.TRANSFER_UPDATED,data:o});},transferUpdatedError:function(o){l.dispatch({type:k.TRANSFER_UPDATED_ERROR,data:o});},transferAccepted:function(){l.dispatch({type:k.TRANSFER_ACCEPTED});},transferDeclined:function(o){l.dispatch({type:k.TRANSFER_DECLINED,data:o});},chatSendViewOpened:function(o){function p(){l.dispatch({type:k.CHAT_SEND_VIEW_OPENED,data:o});}if(o.referrer===m.WEB_INBOX){p();}else if(h.canOpenTab()){h.openThread(o.threadID,null,null,p);}else if(i.messengerdotcom){j.selectThread(o.threadID);p();}else p();},chatSendViewClosed:function(o){l.dispatch({type:k.CHAT_SEND_VIEW_CLOSED,data:o});},binNumberValidated:function(o){l.dispatch({type:k.BIN_NUMBER_VALIDATED,data:o});},binNumberValidatedError:function(o){l.dispatch({type:k.BIN_NUMBER_VALIDATED_ERROR,data:o});},friendsListUpdated:function(o){l.dispatch({type:k.FRIENDS_LIST_UPDATED,data:o});},userEligibilityUpdated:function(o){l.dispatch({type:k.USER_ELIGIBILITY_UDPATED,data:o});},showDialog:function(o,p){l.dispatch({type:k.DIALOG_SHOWN,data:{dialogClass:o,dialogProps:p}});},hideDialog:function(){l.dispatch({type:k.DIALOG_CLOSED});},bannerStatesUpdated:function(o){l.dispatch({type:k.BANNER_STATES_UPDATED,data:o});},bannerDismissed:function(o){l.dispatch({type:k.BANNER_DISMISSED,data:o});},bannerCompleted:function(o){l.dispatch({type:k.BANNER_COMPLETED,data:o});},moneypennyTransferCreated:function(o){l.dispatch({type:k.MONEYPENNY_TRANSFER_CREATED,data:o});},moneypennyTransferCreatedError:function(o){l.dispatch({type:k.MONEYPENNY_TRANSFER_CREATED_ERROR,data:o});},addPlatformContext:function(o){l.dispatch({type:k.PLATFORM_CONTEXT_ADDED,data:o});},addPlatformContextError:function(o){l.dispatch({type:k.PLATFORM_CONTEXT_ADDED_ERROR,data:o});},clearPlatformContextSaveErrors:function(o){l.dispatch({type:k.PLATFORM_CONTEXT_SAVE_ERRORS_CLEARED,data:o});},platformContextBannerDismissed:function(o){l.dispatch({type:k.PLATFORM_CONTEXT_BANNER_DISMISSED,data:o});},platformContextProductItemSold:function(o){l.dispatch({type:k.PLATFORM_CONTEXT_PRODUCT_ITEM_SOLD,data:o});},platformContextChanged:function(o){l.dispatch({type:k.PLATFORM_CONTEXT_CHANGED,data:o});},extensiveTransferDetailsLoaded:function(o){l.dispatch({type:k.EXTENSIVE_TRANSFER_DETAILS_UPDATED,data:o});},updateAddresses:function(o){l.dispatch({type:k.ADDRESSES_UPDATED,data:o});},addressSaving:function(){l.dispatch({type:k.ADDRESS_SAVING});},addAddress:function(o){l.dispatch({type:k.ADDRESS_ADDED,data:o});},addAddressError:function(o){l.dispatch({type:k.ADDRESS_ADDED_ERROR,data:o});},addAddressErrorCleared:function(){l.dispatch({type:k.ADDRESS_ADDED_ERROR_CLEARED});},checkoutCartInitiated:function(){l.dispatch({type:k.CHECKOUT_CART_INITIATED});},checkoutCartCreated:function(o){l.dispatch({type:k.CHECKOUT_CART_CREATED,data:o});},checkoutShippingOptionSelected:function(o){l.dispatch({type:k.CHECKOUT_SHIPPING_OPTION_SELECTED,data:o});},checkoutAddressSelected:function(o){l.dispatch({type:k.CHECKOUT_ADDRESS_SELECTED,data:o});},checkoutCreditCardSelected:function(o){l.dispatch({type:k.CHECKOUT_CREDIT_CARD_SELECTED,data:o});},checkoutAddressFormToggled:function(o){l.dispatch({type:k.CHECKOUT_ADDRESS_FORM_TOGGLED,data:o});},checkoutCreditCardFormToggled:function(o){l.dispatch({type:k.CHECKOUT_CREDIT_CARD_FORM_TOGGLED,data:o});},checkoutAddressEditOptionsToggled:function(o){l.dispatch({type:k.CHECKOUT_ADDRESS_EDIT_OPTIONS_TOGGLED,data:o});},checkoutCreditCardEditOptionsToggled:function(o){l.dispatch({type:k.CHECKOUT_CREDIT_CARD_EDIT_OPTIONS_TOGGLED,data:o});},checkoutCreditCardFormValidated:function(o,p){l.dispatch({type:k.CHECKOUT_CREDIT_CARD_FORM_VALIDATED,data:{isValid:o,formData:p}});},checkoutAddressFormValidated:function(o,p){l.dispatch({type:k.CHECKOUT_ADDRESS_FORM_VALIDATED,data:{isValid:o,formData:p}});},checkoutEditCompleted:function(){l.dispatch({type:k.CHECKOUT_EDIT_COMPLETED});},checkoutProcessing:function(o){l.dispatch({type:k.CHECKOUT_PROCESSING,data:o});},checkoutBuyerProfileUpdated:function(o){l.dispatch({type:k.CHECKOUT_BUYER_PROFILE_UPDATED,data:o});},paymentRequestInitiated:function(){l.dispatch({type:k.PAYMENT_REQUEST_INITIATED});},paymentRequestInitiatedComplete:function(){l.dispatch({type:k.PAYMENT_REQUEST_INITIATED_COMPLETE});},paymentRequestCreated:function(o){l.dispatch({type:k.PAYMENT_REQUEST_CREATED,data:o});},paymentRequestCreatedError:function(o){l.dispatch({type:k.PAYMENT_REQUEST_CREATED_ERROR,data:o});},paymentRequestUpdated:function(o){l.dispatch({type:k.PAYMENT_REQUEST_UPDATED,data:o});},paymentRequestDeclineInitiated:function(){l.dispatch({type:k.PAYMENT_REQUEST_DECLINE_INITIATED});},paymentRequestDeclined:function(o){l.dispatch({type:k.PAYMENT_REQUEST_DECLINED,data:o});},paymentRequestDeclineError:function(o){l.dispatch({type:k.PAYMENT_REQUEST_DECLINE_ERROR,data:o});},paymentRequestCancelInitiated:function(){l.dispatch({type:k.PAYMENT_REQUEST_CANCEL_INITIATED});},paymentRequestCanceled:function(o){l.dispatch({type:k.PAYMENT_REQUEST_CANCELED,data:o});},paymentRequestCancelError:function(o){l.dispatch({type:k.PAYMENT_REQUEST_CANCEL_ERROR,data:o});},paymentRequestsFetched:function(o){l.dispatch({type:k.PAYMENT_REQUESTS_FETCHED,data:o});}};f.exports=n;},null);
__d('P2PLoadingMask.react',['React','XUISpinner.react','cx'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=h.PropTypes,l=h.createClass({displayName:'P2PLoadingMask',propTypes:{visible:k.bool},getDefaultProps:function(){return {visible:false};},render:function(){if(!this.props.visible)return null;return (h.createElement('div',{className:"_3de"},h.createElement(i,{background:'dark',size:'large',className:"_3df"}),h.createElement('div',{className:"_3dg"})));}});f.exports=l;},null);
__d('P2PLogger',['BanzaiLogger'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i='P2PPaymentLoggerConfig',j={log:function(k,l){l=babelHelpers['extends']({event:k},l);h.log(i,l);}};f.exports=j;},null);
__d('P2PSendMoneyDialogStore',['P2PActionConstants','EventEmitter','P2PDispatcher'],function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m,n;k=babelHelpers.inherits(o,i);l=k&&k.prototype;function o(){l.constructor.call(this);n={};m=j.register(this.onEventDispatched.bind(this));}o.prototype.onEventDispatched=function(p){var q=p.data,r=p.type;switch(r){case h.CHAT_SEND_VIEW_OPENED:this.handleChatSendViewOpened(q);this.emit('change');break;case h.CHAT_SEND_VIEW_CLOSED:this.handleChatSendViewClosed(q);this.emit('change');break;}};o.prototype.getStateByThreadID=function(p){return n[p];};o.prototype.handleChatSendViewOpened=function(p){n[p.threadID]={amount:p.amount,groupSendRecipientUserID:p.groupSendRecipientUserID,groupSendReceiptDetails:p.groupSendReceiptDetails,groupThreadFBID:p.groupThreadFBID,openRequestTab:p.openRequestTab,memoText:p.memoText,platformData:p.platformData,referrer:p.referrer,paymentRequestID:p.paymentRequestID,sendMoneyDialogShown:true,sendMoneyNUXDismissed:p.sendMoneyNUXDismissed,useModal:p.useModal};};o.prototype.handleChatSendViewClosed=function(p){n[p.threadID]={amount:'',groupSendRecipientUserID:null,groupSendReceiptDetails:null,groupThreadFBID:'',openRequestTab:false,memoText:null,platformData:null,referrer:null,paymentRequestID:null,sendMoneyDialogShown:false,sendMoneyNUXDismissed:false,useModal:false};};f.exports=new o();},null);
__d('P2PSendMoneyContainerBootloader.react',['Bootloader','CurrentEnvironment','DeferredComponent.react','MercuryIDs','MessengerContextualDialog.react','P2PAbstractSendMoneyButton.react','P2PActions','P2PLoadingMask.react','P2PLogger','P2PPaymentLoggerEvent','P2PPaymentLoggerEventFlow','React','ReactLayeredComponentMixin','ReactDOM','Run','XUIContextualDialog.react','cx','emptyFunction','P2PSendMoneyDialogStore'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){'use strict';if(c.__markCompiled)c.__markCompiled();c('P2PSendMoneyDialogStore');var z=s.PropTypes,aa=i.messengerdotcom,ba=s.createClass({displayName:'P2PSendMoneyContainerBootloader',propTypes:{button:z.node,className:z.string,flyoutAlignment:z.string,onTrigger:z.func,participantIDs:z.array,referrer:z.string,threadID:z.string},getInitialState:function(){return {showPlaceholderDialog:false};},mixins:[t],_clicked:false,log:function(ca,da){p.log(ca,babelHelpers['extends']({www_event_referrer:this.props.referrer,www_event_flow:r.UI_FLOW_P2P_SEND},da));},onPlaceholderClick:function(){var ca=this.props.threadID?k.tokenize(this.props.threadID).value:null;this._handleDialogVisibility(!this.state.showPlaceholderDialog);this.log(q.UI_ACTN_SEND_MONEY_BUTTON_PLACEHOLDER_CLICKED,{object_id:ca});this._clicked=false;},_handleDialogVisibility:function(ca){if(!ca){n.chatSendViewClosed({threadID:this.props.threadID});}else n.chatSendViewOpened({referrer:this.props.referrer,threadID:this.props.threadID});this.setState({showPlaceholderDialog:ca});},renderLayers:function(){var ca={};if(this.state.showPlaceholderDialog){var da=i.messengerdotcom,ea=da?l:w,fa=da?282:260;ca.placeholderDialog=s.createElement(ea,{alignment:this.props.flyoutAlignment?this.props.flyoutAlignment:da?'right':'left',context:u.findDOMNode(this.refs.placeholderButton),onBlur:function(){if(!this._clicked)this._handleDialogVisibility(false);this._clicked=false;}.bind(this),ref:'dialog',shown:true,width:fa,position:'above'},s.createElement('div',{className:"_c_5"},s.createElement(o,{visible:true})));}return ca;},render:function(){return (s.createElement(j,babelHelpers['extends']({deferredComponent:this._bootloadComponent,deferredPlaceholder:this._renderPlaceholder()},this.props)));},_renderPlaceholder:function(){return (s.createElement(m,{button:this.props.button,className:this.props.className,isActive:false,isDisabled:false,isMessenger:aa,onClick:this.onPlaceholderClick,onMouseDown:function(){return this._clicked=true;}.bind(this),onMouseOver:this._bootloadComponentNow,ref:'placeholderButton'}));},_bootloadComponent:function(ca){v.onAfterLoad(function(){h.loadModules(["P2PSendMoneyContainer.react"],function(){ca.apply(this,arguments);this.setState({showPlaceholderDialog:false});}.bind(this));}.bind(this));},_bootloadComponentNow:function(){h.loadModules(["P2PSendMoneyContainer.react"],y);}});f.exports=ba;},null);
__d("XPagesMercuryIndicatorController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/pages\/messaging\/mercury\/indicator\/",{});},null);
__d('PagesMercuryChatTabIndicatorHandler',['Animation','AsyncRequest','AvailableListConstants','DOM','FBID','MercuryIDs','XPagesMercuryIndicatorController'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();o.tryCreateHandler=function(p,q,r){'use strict';if(!q)return null;var s=m.getUserIDFromThreadID(p);if(!s||l.isUser(s))return null;return new o(s,q,r);};function o(p,q,r){'use strict';this.$PagesMercuryChatTabIndicatorHandler2=false;this.$PagesMercuryChatTabIndicatorHandler3=q;this.$PagesMercuryChatTabIndicatorHandler4=false;this.$PagesMercuryChatTabIndicatorHandler5=false;this.$PagesMercuryChatTabIndicatorHandler6=r;this.$PagesMercuryChatTabIndicatorHandler7=false;this.$PagesMercuryChatTabIndicatorHandler8=p;}o.prototype.__getEnableTimeSwitch=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler2;};o.prototype.__getIndicator=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler3;};o.prototype.__getIsShown=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler5;};o.prototype.__getPageOnlineStatus=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler6;};o.prototype.__getShouldPreventFutureShown=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler7;};o.prototype.__getTargetID=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler8;};o.prototype.__getIsChecking=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler4;};o.prototype.__getResponsivenessDescription=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler1;};o.prototype.checkResponsiveness=function(){'use strict';if(this.$PagesMercuryChatTabIndicatorHandler4)return;var p=n.getURIBuilder().getURI();this.$PagesMercuryChatTabIndicatorHandler4=true;new i().setURI(p).setMethod('POST').setData({page_id:this.$PagesMercuryChatTabIndicatorHandler8}).setHandler(function(q){this.$PagesMercuryChatTabIndicatorHandler4=false;var r=q.payload;if(r.responsiveness)this.$PagesMercuryChatTabIndicatorHandler9(r.responsiveness,r.enableTimeSwitch);}.bind(this)).send();};o.prototype.hideIndicator=function(){'use strict';this.$PagesMercuryChatTabIndicatorHandler10(false);};o.prototype.hideIndicatorAndPreventFutureShow=function(){'use strict';this.$PagesMercuryChatTabIndicatorHandler10(true);};o.prototype.$PagesMercuryChatTabIndicatorHandler10=function(p){'use strict';this.$PagesMercuryChatTabIndicatorHandler7=this.$PagesMercuryChatTabIndicatorHandler7||p;if(this.$PagesMercuryChatTabIndicatorHandler3&&this.$PagesMercuryChatTabIndicatorHandler5){this.$PagesMercuryChatTabIndicatorHandler5=false;new h(this.$PagesMercuryChatTabIndicatorHandler3).to('height',0).duration(100).hide().go();}};o.prototype.showIndicator=function(){'use strict';if(!this.$PagesMercuryChatTabIndicatorHandler3||this.$PagesMercuryChatTabIndicatorHandler5||this.$PagesMercuryChatTabIndicatorHandler6!==j.OFFLINE||!this.$PagesMercuryChatTabIndicatorHandler1||this.$PagesMercuryChatTabIndicatorHandler7)return;k.setContent(this.$PagesMercuryChatTabIndicatorHandler3,this.$PagesMercuryChatTabIndicatorHandler1);this.$PagesMercuryChatTabIndicatorHandler5=true;new h(this.$PagesMercuryChatTabIndicatorHandler3).show().to('height',16).duration(100).go();};o.prototype.notifyPageOnlineStatusChanged=function(p){'use strict';if(this.$PagesMercuryChatTabIndicatorHandler6===p)return;this.$PagesMercuryChatTabIndicatorHandler6=p;if(!this.$PagesMercuryChatTabIndicatorHandler2)return;switch(p){case j.ACTIVE:this.hideIndicator();break;default:this.showIndicator();break;}};o.prototype.$PagesMercuryChatTabIndicatorHandler9=function(p,q){'use strict';this.$PagesMercuryChatTabIndicatorHandler1=p;this.$PagesMercuryChatTabIndicatorHandler2=q;this.showIndicator();};f.exports=o;},null);
__d('SelectionPosition',['Event','InputSelection','SubscriptionsHandler'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(l){'use strict';this.$SelectionPosition1=l;this.$SelectionPosition2={start:0,end:0};this.$SelectionPosition3=new j();this.$SelectionPosition4=false;this.updatePos();this.enable();}k.prototype.getPos=function(){'use strict';return babelHelpers['extends']({},this.$SelectionPosition2);};k.prototype.setPos=function(l,m){'use strict';this.$SelectionPosition2={start:l,end:m};this.restore();};k.prototype.updatePos=function(){'use strict';this.$SelectionPosition2=i.get(this.$SelectionPosition1);};k.prototype.restore=function(){'use strict';i.set(this.$SelectionPosition1,this.$SelectionPosition2.start,this.$SelectionPosition2.end);};k.prototype.enable=function(){'use strict';if(!this.$SelectionPosition4){this.$SelectionPosition3.addSubscriptions(h.listen(this.$SelectionPosition1,'keyup',this.updatePos.bind(this)),h.listen(this.$SelectionPosition1,'click',this.updatePos.bind(this)));this.$SelectionPosition4=true;}};k.prototype.disable=function(){'use strict';if(this.$SelectionPosition4){this.$SelectionPosition3.release();this.$SelectionPosition4=false;}};f.exports=k;},null);
__d('TypingDetector',['ArbiterMixin','Event','Input','Run','SubscriptionsHandler','TypingStates','createObjectFrom','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();function p(q,r){this._input=q;this._ignoreKeys={};this._getValueFn=r;}Object.assign(p.prototype,h,{_timeout:7000,_currentState:m.INACTIVE,init:function(){this.init=o;this.reset();this._subscriptions=new l();this._subscriptions.addSubscriptions(i.listen(this._input,'keyup',this._update.bind(this)),k.onUnload(this._onunload.bind(this)));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=m.INACTIVE;},setIgnoreKeys:function(q){this._ignoreKeys=n(q);},destroy:function(){this._subscriptions.release();},_onunload:function(){if(this._currentState==m.TYPING)this._transition(m.QUITTING);},_update:function(event){var q=i.getKeyCode(event),r=this._currentState;if(!this._ignoreKeys[q]){var s=this._getValueFn?this._getValueFn():j.getValue(this._input);if(s.trim().length===0){if(r==m.TYPING)this._transition(m.INACTIVE);}else if(r==m.TYPING){this._recordKeystroke();}else if(r==m.INACTIVE){this._transition(m.TYPING);this._recordKeystroke();}}},_transition:function(q){this.reset();this._currentState=q;this.inform('change',q);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=setTimeout(this._checkTyping.bind(this),this._timeout);},_checkTyping:function(){var q=this._lastKeystrokeTime+this._timeout,r=Date.now();if(r>q){this._transition(m.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=setTimeout(this._checkTyping.bind(this),q-r+10);}}});f.exports=p;},null);
__d('TypingDetectorController',['AsyncRequest','AvailableList','AvailableListConstants','ChannelConnection','ChatVisibility','Keys','MercuryServerRequestsConfig','TypingDetector','TypingStates','emptyFunction','setTimeoutAcrossTransitions','shield'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();function t(u,v,w,x,y,z){'use strict';this.userID=u;this.input=v;this.source=w;this.threadID=y;this.remoteState=p.INACTIVE;this.notifyTimer=null;x=x||{};this.notifyDelay=x.notifyDelay||this.notifyDelay;this._typingDetector=new o(v,z);this._typingDetector.init(x);this._typingDetector.subscribe('change',this._stateChange.bind(this));}t.prototype.setUserAndThread=function(u,v){'use strict';if(this.userID!==u||this.threadID!==v){this.resetState();this.userID=u;this.threadID=v;}};t.prototype.setIgnoreEnter=function(u){'use strict';var v=u?[m.RETURN]:[];this._typingDetector.setIgnoreKeys(v);};t.prototype.resetState=function(){'use strict';this._notifyState(p.INACTIVE);this.remoteState=p.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;};t.prototype.destroy=function(){'use strict';this.resetState();this._typingDetector.destroy();};t.prototype._stateChange=function(u,v){'use strict';if(v!=p.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=r(s(this._notifyState,this,v),this.notifyDelay);}else this._notifyState(v,true);};t.prototype._notifyState=function(u,v){'use strict';if(!this.userID&&!this.threadID||!l.isOnline()||u===this.remoteState||k.disconnected())return;this._sendRequest(u,this.userID,v);};t.prototype._sendRequest=function(u,v,w){'use strict';this.remoteState=u;var x={typ:u,to:v,source:this.source,thread:this.threadID},y=new h().setHandler(this._onTypResponse.bind(this,v)).setErrorHandler(q).setData(x).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous_DEPRECATED',!w);if(n.msgrRegion)y.setRequestHeader('X-MSGR-Region',n.msgrRegion);y.send();};t.prototype._onTypResponse=function(u,v){'use strict';var w=v.getPayload()||{};if(w.offline)i.set(u,j.OFFLINE,'typing_response');};Object.assign(t.prototype,{notifyDelay:1000});f.exports=t;},null);
__d('WebMessengerThreadPermalinks',['MercuryIDs','MessagingTag','URI','WebMessengerPermalinkConstants','WWWBase','requireWeak'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n={getThreadURI:function(r,s,t){if(h.isCanonical(r)){o(r,s,t);}else p(r,s,t);}};function o(r,s,t){var u=new j(l.uri),v=h.tokenize(r).value;u.setPath(q(t)+'/'+v);s&&s(u.toString());}function p(r,s,t){m('MercuryThreadIDMap',function(u){var v=u.get();v.getServerIDFromClientID(r,function(w){var x=new j(l.uri);x.setPath(k.getURIPathForThreadID(w,q(t)));s&&s(x.toString());});});}function q(r){var s=k.BASE_PATH;if(r&&r!=i.INBOX)s+='/'+r;return s;}f.exports=n;},null);
__d("XStickerReplyNUXController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/tooltip\/",{});},null);
__d('ChatTabView',['Promise','AsyncRequest','AsyncSignal','AvailableListConstants','BanzaiODS','BootloadedComponent.react','Bootloader','ChatBehavior','ChatConfig','ChatNubLogger','ChatOpenTab','ChatPhotoUploader.react','ChatTabActions','ChatTabMessagesView','ChatTabSheetController','ChatTabViewEvents','ChatTabViewInstances','ChatTitleLink.react','ChatVisibility','CSS','CurrentUser','Dock','DOM','DOMQuery','DragDropTarget','EmojiLikeUtils','EmoticonsList','EmoticonUtils','Event','FBID','FBRTCCallabilityStore','JSResource','Keys','LogHistory','MercuryCanonicalGroupThreadManager','MercuryConfig','MercuryIDs','MercuryParticipants','MercuryShareAttachmentRenderLocations','MercurySourceType','MercuryThreadInfo','MercuryThreadTitle.react','MercuryTypingAnimation.react','MercuryViewer','MessagingTag','NubController','P2PGKValues','P2PSendMoneyContainerBootloader.react','PagesMercuryChatTabIndicatorHandler','Parent','PhotosUploadWaterfall','PresenceStatus','React','ReactComponentRenderer','ReactDOM','Run','Scroll','SelectionPosition','ShortProfiles','SimpleXUIDialog','SiteData','StickerActions','StickerConstants','StickerState','Style','SubscriptionsHandler','SyntheticMouseEvent','ChatTabTemplates','TextAreaControl','TooltipData','TypingDetectorController','UserAgent_DEPRECATED','WaterfallIDGenerator','WebMessengerThreadPermalinks','WorkFileUploadsGating','WorkModeConfig','XStickerReplyNUXController','createCancelableFunction','csx','cx','emptyFunction','fbt','getActiveElement','isEmpty','requireWeak','setIntervalAcrossTransitions','ChatReactInput','MercuryBlockedParticipants','MercuryTypingReceiver','MercuryMessageObject','MercuryMessages','MercuryServerRequests','MercuryThreadActions','MercuryThreadIDMap','MercuryThreadInformer','MercuryThreads','MercuryMessageActions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc){'use strict';if(c.__markCompiled)c.__markCompiled();var pc=c('ChatReactInput').module,qc=c('MercuryBlockedParticipants').get(),rc=c('MercuryTypingReceiver').get(),sc=c('MercuryMessageObject').get(),tc=c('MercuryMessages').get(),uc=c('MercuryServerRequests').get(),vc=c('MercuryThreadActions').get(),wc=c('MercuryThreadIDMap').get(),xc=c('MercuryThreadInformer').get(),yc=c('MercuryThreads').get(),zc=c('MercuryMessageActions').get(),ad=/^\s*$/,bd=x,cd,dd='right',ed=960,fd=10,gd=p.get('chat_react_composer'),hd=oa.getInstance('chat_tab_view');nc('AvailableList',function(de){de.subscribe(k.ON_AVAILABILITY_CHANGED,zd);});function id(de,ee){var fe=da.create('div');ee=ee&&ee.filter(function(ie){return ie!=ya.getID();});if(mc(ee))return yb.remove(de);var ge=ee.length,he=ge-fd;if(he>1)ee=ee.slice(0,fd);sa.getMulti(ee,function(ie){for(var je in ie){var ke=ie[je],le=wb[':fb:mercury:chat:multichat-tooltip-item'].build();da.setContent(le.getNode('name'),ke.name);var me=ra.getUserIDFromParticipantID(je),ne=me&&gb.get(me)==k.ACTIVE;aa.conditionShow(le.getNode('icon'),ne);aa.conditionClass(le.getNode('name'),"_1aly",ne);da.appendContent(fe,le.getRoot());}if(he>1){var oe=kc._("et {number of hidden chat participants} autres.",[kc.param('number of hidden chat participants',he)]);da.appendContent(fe,da.create('div',{},oe));}yb.set(de,fe,'above');});}var jd={},kd=null,ld=false;function md(de,ee,fe){if(fe){jd[de]=ee;if(!kd)kd=oc(nd,600);}else{aa.removeClass(ee,'highlightTitle');delete jd[de];}}function nd(){for(var de in jd){var ee=jd[de];if(ee.parentNode){aa.conditionClass(ee,'highlightTitle',ld);}else delete jd[de];}ld=!ld;if(!Object.keys(jd).length){clearInterval(kd);kd=null;}}function od(de){var ee=ra.tokenize(de);switch(ee.type){case 'user':return wb[':fb:mercury:chat:user-tab'].build();}return wb[':fb:mercury:chat:multichat-tab'].build();}function pd(de){var ee=de._getInputValue(),fe=de._filesUploader,ge=fe?fe.getAttachments():[];if(ud(de))rd(de,ee,ge,function(he){he=ce(he,fe);zc.send(he,function(ie){var je=yc.getThreadMetaNow(ie);if(je&&je.folder===za.PENDING)vc.movePendingToInbox(ie);});fe&&fe.removeAttachments();if(de._sharePreview)de._sharePreview.setProps({share:null,uri:null});if(gd){de._composer.onSend();}else de._chatInput.component.resetState();de._typingDetector&&de._typingDetector.resetState();if(de._messagesView){de._messagesView.scrollToBottom();de._messagesView.setShouldScrollToBottom(true);de.tryMarkAsRead();}});}function qd(de,ee){if(ee===0)return;wd(de,fb.POST_PUBLISHED,{count:ee});de._waterfallID=bc.generate();}function rd(de,ee,fe,ge){yc.getThreadMeta(de._threadID,function(he){if(he&&he.is_canonical&&!va.canReply(he)){de._showMessageBlockedDialog(he);return;}var ie=ua.CHAT_WEB,je=sc.constructUserGeneratedMessageObject(ee,ie,de._threadID);if(fe.length>0){je.has_attachment=true;je.raw_attachments=fe;}if(de._sharePreview){var ke=de._sharePreview.component.getShareData();if(ke){je.has_attachment=true;je.shareable_attachment=ke;}}if(yc.isNewEmptyLocalThread(de._threadID)){var le=de._sheetController.getAddFriendsParticipants();de._sheetController.closeAddFriendsSheet();if(le===null||le.length===0)return;le=le.filter(function(pe){return pe!=ya.getID();});if(le.length===0){je.thread_id=ra.getThreadIDFromUserID(ba.getID());}else if(le.length===1){je.thread_id=ra.getThreadIDFromParticipantID(le[0]);}else{var me=de.getMessagesView().getThreadID();if(me!=de._threadID)je.thread_id=me;vc.addParticipants(de._threadID,le);}}if(yc.isEmptyLocalThread(de._threadID)){je.offline_threading_id=ra.tokenize(de._threadID).value;var ne=yc.getThreadMetaNow(he.thread_id);je.specific_to_list=Array.from(ne.participants);}if(typeof je!='undefined')je.signatureID=de._signatureID;je.ui_push_phase=pb.push_phase;ge(je);if(de._threadID!==je.thread_id&&!de.isUploading()){var oe=de._getInputValue();t.closeTab(de._threadID);r.openThread(je.thread_id,'ChatTabView',null,ee?jc:function(pe){return pe.appendTextToInput(oe);});}});}function sd(de){de._blocked=true;de._sheetController.openUploadWarningTabSheet();}function td(de){return de.isUploading();}function ud(de){var ee=de._getInputValue();if(!ad.test(ee))return true;var fe=de._filesUploader;if(fe&&(fe.getAttachments().length>0||fe.getImageFiles().length>0||fe.getAnimatedImageFiles().length>0||fe.getVideoFiles().length>0||fe.getAudioFiles().length>0||fe.getFiles().length>0))return true;if(de._sharePreview&&de._sharePreview.component.getShareData())return true;return false;}function vd(de){de._nubController.flyoutContentChanged();var ee=de._getNode('attachmentShelf');lb.setTop(ee,ee.scrollHeight);}function wd(de,ee,fe){fb.sendSignal(babelHelpers['extends']({qn:de._waterfallID,step:ee,uploader:fb.APP_CHAT},fe||{}));}function xd(de,ee,fe,ge,he){if(ee)uc.ensureThreadIsFetched(ee);this._threadID=de;this._signatureID=fe;this._eventListeners=[];this._onlineStatus=k.OFFLINE;this._tabTemplate=od(de);this._tabElem=this._tabTemplate.getRoot();if(he&&he.getTabElem()){this.insertBefore(he);}else this.appendTo(ge);this._stickersFlyoutShown=false;this._messagesView=null;this._titlebar=this._getNode('nubFlyoutTitlebar');if(!gd){this._iconsContainerNode=this._getNode('iconsContainer');this._inputContainerNode=this._getNode('inputContainer');this._contentSearchNode=this._getNode('contentSearchContainer');this._fileUploaderNode=this._getNode('fileUploaderContainer');}this._pagesMessageIndicator=this._getNode('pagesMessageIndicator');this._waterfallID=bc.generate();this._subscriptionsHandler=new ub();this._canonicalGroupSearchSubscriptionID=null;this._initializeSheetController();var ie=[jc,this._initializeHeader.bind(this),this._initializeUIListeners.bind(this),this._initializeAutoSendPhotoUploader.bind(this),this._initializeAutoSendFileUploader.bind(this),this._initializeTitleHREF.bind(this),this._initializeP2P.bind(this),this._initializeInput.bind(this),this._initializeStickers.bind(this),this._initializeContentSearch.bind(this),function(){this.updateAvailableStatus();this.updateTab();this._setCloseTooltip(false);}.bind(this),this._initializeUnloadListeners.bind(this),this._initializeDragDropTarget.bind(this),this._initializePageMessagingIndicator.bind(this),this._initializeP2PChatThreadBannerContainer.bind(this),this._initializeP2PRainMoneyContainer.bind(this)];for(var je=ie,ke=Array.isArray(je),le=0,je=ke?je:je[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var me;if(ke){if(le>=je.length)break;me=je[le++];}else{le=je.next();if(le.done)break;me=le.value;}var ne=me;ne();}bd.set(de,this);this._logOpenTab();}function yd(de){if(de._photoUploader&&de._photoUploader.isUploading())wd(de,fb.CANCEL_DURING_UPLOAD);}function zd(){for(var de=bd.values(),ee=Array.isArray(de),fe=0,de=ee?de:de[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ge;if(ee){if(fe>=de.length)break;ge=de[fe++];}else{fe=de.next();if(fe.done)break;ge=fe.value;}var he=ge;he.updateAvailableStatus();he.updateTitlebarTooltip();}}function ae(){for(var de=bd.values(),ee=Array.isArray(de),fe=0,de=ee?de:de[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ge;if(ee){if(fe>=de.length)break;ge=de[fe++];}else{fe=de.next();if(fe.done)break;ge=fe.value;}var he=ge;he.updateCallLink();}}la.addListener(ae);o.subscribe(o.ON_CHANGED,function(){for(var de=bd.keys(),ee=Array.isArray(de),fe=0,de=ee?de:de[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ge;if(ee){if(fe>=de.length)break;ge=de[fe++];}else{fe=de.next();if(fe.done)break;ge=fe.value;}var he=ge;yc.getThreadMeta(he,function(ie){bd.get(he)._updateUnreadCount(ie);});}});rc.addRetroactiveListener('state-changed',function(de){for(var ee in de){var fe=de[ee]&&de[ee].length,ge=bd.get(ee);ge&&ge.showTypingIndicator(fe);}});xc.subscribe('threads-updated',function(de,ee){for(var fe=bd.keys(),ge=Array.isArray(fe),he=0,fe=ge?fe:fe[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ie;if(ge){if(he>=fe.length)break;ie=fe[he++];}else{he=fe.next();if(he.done)break;ie=he.value;}var je=ie,ke=bd.get(je);ee[je]&&ke.updateTab();if(ke._newThreadIDFromPhotoUpload&&!ke.isUploading()&&ee[ke._newThreadIDFromPhotoUpload]){t.closeTab(ke._threadID);r.openThread(ke._newThreadIDFromPhotoUpload,'ChatTabView');ke._newThreadIDFromPhotoUpload=null;}}});xc.subscribe('threads-deleted',function(de,ee){for(var fe=bd.keys(),ge=Array.isArray(fe),he=0,fe=ge?fe:fe[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ie;if(ge){if(he>=fe.length)break;ie=fe[he++];}else{he=fe.next();if(he.done)break;ie=he.value;}var je=ie;ee[je]&&t.closeTab(je,'thread_deleted');if(yc.isNewEmptyLocalThread(je)){var ke=bd.get(je);ke.ensureValidCanonicalGroup(ee);}}});Object.assign(xd.prototype,{getThreadID:function(){return this._threadID;},getTabElem:function(){return this._tabElem;},showAddFriend:function(){setTimeout(function(){this._sheetController.openAddFriendsSheet();}.bind(this),0);},showNameConversation:function(de){setTimeout(function(){this._sheetController.openNameConversationSheet(de);}.bind(this),0);},hideAutomaticNameConversation:function(){setTimeout(function(){this._sheetController.closeAutomaticNameConversationSheet();}.bind(this),0);},isVisible:function(){return aa.shown(this._tabElem);},isUploading:function(){var de=gd?this._composer&&this._composer.isUploading():!!(this._fileUploader&&this._fileUploader.isUploading()||this._photoUploader&&this._photoUploader.isUploading());return !!(de||this._filesUploader&&this._filesUploader.isUploading()||this._sharePreview&&this._sharePreview.component.isLoading());},setVisibleState:function(de,ee){var fe=aa.shown(this._tabElem),ge=aa.hasClass(this._tabElem,'opened');aa.conditionShow(this._tabElem,de);aa.conditionClass(this._tabElem,'opened',ee);if(!(fe&&ge)&&de&&ee){if(!this._messagesView)this._updateChatTabMessagesView(this._threadID);this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();this.setP2PChatThreadBannerContainerVisibility();}},_updateChatTabMessagesView:function(de){if(this._messagesView&&this._messagesView.getThreadID()===de)return;var ee=ra.tokenize(de);this._messagesView&&this._messagesView.destroy();this._messagesView=new u(de,this._sheetController,this._getNode('scrollingArea'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'),this,qa.ShowContextBanner&&ee.type==='user');},focus:function(){if(aa.hasClass(this._tabElem,'opened')){try{this._focusInput();}catch(de){}}else this._getNode('dockButton').focus();},isFocused:function(){var de=lc();return eb.bySelector(de,"._50mz")===this._tabElem;},hasEmptyInput:function(){return ad.test(this._getInputValue());},getInputElem:function(){if(gd)return this._composer&&jb.findDOMNode(this._composer.getInput());if(!this._chatInput||!this._chatInput.component.isMounted())return null;return jb.findDOMNode(this._chatInput.component);},getMessagesView:function(){return this._messagesView;},setStickersFlyoutPackID:function(de){if(!this._stickerButton.isMounted())return;qb.selectPack(de);this._toggleStickersFlyoutShown(true);},loadShareFromParams:function(de,ee){this._getSharePreview().done(function(fe){fe.setProps({share:{params:ee,type:de},uri:null});});},_linkDropped:function(de){this._getSharePreview().done(function(ee){ee.setProps({share:null,uri:de});});},_filesDropped:function(de){this._loadReactMenu().done(function(ee){var fe=ee.component.getFileUploaderPromise();if(fe)fe.done(function(ge){setTimeout(function(){ge.addDroppedFiles(de);},0);});});},_toggleStickersFlyoutShown:function(de){this._stickerButton.showFlyout();this._stickersFlyoutShown=de;},showStickerReplyNUX:function(){if(cd)return;new i(fc.getURIBuilder().getURI()).setRelativeTo(this._getNode('stickerButtonContainer')).setData({thread_id:this._threadID}).setHandler(function(de){sb.clearShowStickerReplyNUX();}).send();},insertBefore:function(de){da.insertBefore(de.getTabElem(),this._tabElem);},appendTo:function(de){da.appendContent(de,this._tabElem);},nextTabIs:function(de){var ee=de&&de.getTabElem();return this._tabElem.nextSibling==ee;},getScrollTop:function(){return lb.getTop(da.find(this._tabElem,'.fbNubFlyoutBody.scrollable'));},setScrollTop:function(de){lb.setTop(da.find(this._tabElem,'.fbNubFlyoutBody.scrollable'),de);},destroy:function(){this._selectionPosition&&this._selectionPosition.disable();while(this._eventListeners.length)this._eventListeners.pop().remove();if(this._dropTarget)this._dropTarget.disable();this._checkUnsentMessages&&this._checkUnsentMessages.cancel();this._logUnsentPhotos&&this._logUnsentPhotos.cancel();this._messagesView&&this._messagesView.destroy();this._sheetController&&this._sheetController.destroy();jb.unmountComponentAtNode(this._getNode('animationContainer'));jb.unmountComponentAtNode(this._getNode('menuContainer'));if(this._addToThreadButton){this._addToThreadButton.unmount();this._addToThreadButton=null;}if(this._archiveWarning){this._archiveWarning.unmount();this._archiveWarning=null;}if(this._videoCallButton){this._videoCallButton.unmount();this._videoCallButton=null;}if(this._closeButton){this._closeButton.unmount();this._closeButton=null;}if(this._title){this._title.unmount();this._title=null;}if(this._sharePreview){this._sharePreview.unmount();this._sharePreview=null;}this._subscriptionsHandler&&this._subscriptionsHandler.release();jb.unmountComponentAtNode(this._getNode('name'));if(gd){jb.unmountComponentAtNode(this._getNode('footer'));}else{try{jb.unmountComponentAtNode(this._getNode('photoUploaderContainer'));jb.unmountComponentAtNode(this._getNode('fileUploaderContainer'));}catch(de){l.bumpEntityKey('chat.web','chattab.unmount_failed');}jb.unmountComponentAtNode(this._getNode('stickerButtonContainer'));jb.unmountComponentAtNode(this._getNode('inputContainer'));if(this._getNode('hotLikeContainer'))jb.unmountComponentAtNode(this._getNode('hotLikeContainer'));if(this._p2pButtonContainer){if(this._p2pButton)this._p2pButton.unmount();this._p2pButtonContainer=null;this._p2pButton=null;}if(this._p2pChatThreadBannerContainerEl){jb.unmountComponentAtNode(this._p2pChatThreadBannerContainerEl);this._p2pChatThreadBannerContainerEl=null;}if(this._p2pRainMoneyContainerEl){jb.unmountComponentAtNode(this._p2pRainMoneyContainerEl);this._p2pRainMoneyContainerEl=null;}}da.remove(this._tabElem);bd['delete'](this._threadID);ca.unregisterNubController(this._nubController);},updateAvailableStatus:function(){yc.getThreadMeta(this._threadID,function(de){var ee=k.OFFLINE,fe=this._getCanonicalUserID(),ge=null;if(fe){ee=gb.get(fe);ge=nb.getNow(fe);}else{var he=de.participants.map(function(je){return ra.getUserIDFromParticipantID(je);});ee=gb.getGroup(he);}if(!z.isOnline())ee=k.OFFLINE;this.updateCallLink();aa.conditionClass(this._tabElem,"_5238",ee===k.ACTIVE&&(ge===undefined||ge===null||!ge.is_messenger_only));var ie=this._getNode('presenceIndicator');this._onlineStatus=ee;this._pagesMessageIndicatorHandler&&this._pagesMessageIndicatorHandler.notifyPageOnlineStatusChanged(ee);switch(ee){case k.ACTIVE:ie.setAttribute('alt',kc._("En ligne"));break;default:ie.removeAttribute('alt');break;}}.bind(this));},updateTab:function(){yc.getThreadMeta(this._threadID,function(de){var ee=[this._getNode('name')];if(this._title)this._title.setProps({thread:de},function(){this._getNode('chatWrapper').setAttribute('aria-label',this._title.component.getTitle());}.bind(this));for(var fe=ee,ge=Array.isArray(fe),he=0,fe=ge?fe:fe[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ie;if(ge){if(he>=fe.length)break;ie=fe[he++];}else{he=fe.next();if(he.done)break;ie=he.value;}var je=ie;jb.render(hb.createElement(wa,{isNewThread:yc.isNewEmptyLocalThread(this._threadID),thread:de,useAndSeparator:true,useShortName:!de.is_canonical,viewer:ba.getID()}),je);}this._updateControls(de);this._updateMessageBlockSettings(de);this._updateMessageManageSettings(de);this._updateSecretModeSettings(de);this._updateMutingSettings(de);this._updateUnreadCount(de);this.updateTitlebarTooltip();this._updateArchiveWarning(de);this._updateConfidentialStatus(de);this._updateEmployeeAwayWarning(de);this._updateOfficeStatus(de);this._updateNewThread(de);this._updateNameConversationSheet(de);this._updateReadOnlySheet(de);this._updateSwitchToWork(de);this._updateCustomLike(de);}.bind(this));},_updateNameConversationSheet:function(de){if(va.canReply(de)&&!de.name&&!de.is_canonical&&!de.name_conversation_sheet_dismissed&&!de.has_email_participant&&!de.read_only&&!yc.isEmptyLocalThread(de.thread_id)&&!qa.SuppressNamingUpsell){this.showNameConversation(true);}else this.hideAutomaticNameConversation();},_updateReadOnlySheet:function(de){var ee=va.showComposer(de),fe=va.canReply(de),ge=yc.isEmptyLocalThread(de.thread_id);if(!fe&&!ee&&!ge)this._sheetController.openReadOnlySheet();},_updateMessageManageSettings:function(de){var ee=ra.getParticipantIDFromFromThreadID(de.thread_id),fe=sa.getNow(ee);this._updateMenuPropsSafe({isBusinessEnabled:fe&&fe.is_business_enabled});},updateSignatureID:function(de){this._signatureID=de;},_updateMessageBlockSettings:function(de){this._updateMenuPropsSafe({hasMessageBlocked:qc.isMessageBlocked(de),isEmptyConversation:de&&de.message_count==0});},_updateCustomLike:function(de){if(gd||!this._getNode('hotLikeContainer'))return;var ee="_6h1 _6gb";jb.render(hb.createElement(m,{bootloadPlaceholder:hb.createElement('a',{className:ee}),bootloadLoader:ma('MessengerHotLikeButton.react'),className:ee,customLike:de.custom_like_icon,sendSticker:this._stickerSelected.bind(this),sendCustomLike:this._customLikeSelected.bind(this),threadID:this._threadID}),this._getNode('hotLikeContainer'));aa.addClass(this._inputContainerNode,"_n4k");},_updateSecretModeSettings:function(de){var ee=!!(de&&de.ephemeral_ttl_mode);this._updateMenuPropsSafe({hasSecretModeOn:ee});aa.conditionClass(this._tabElem,"_5iq8",ee);var fe=ee?kc._("Entrez un message \u00e9ph\u00e9m\u00e8re..."):kc._("\u00c9crivez un message...");if(gd){this._composer&&this._composer.setPlaceholder(fe);}else this._chatInput.setProps({placeholder:fe});},_updateMutingSettings:function(de){var ee=!!de&&va.isMuted(de);ee&&!this._reactChatTabMenu&&this._loadReactMenu();this._updateMenuPropsSafe({isMuted:ee});},_updateMenuPropsSafe:function(de){if(this._menuPromise)this._menuPromise.done(function(ee){ee&&ee.component&&ee.component.isMounted()&&ee.setProps(de);});},_updateArchiveWarning:function(de){if(ba.isEmployee())sa.getMulti(de.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));},_updateConfidentialStatus:function(de){if(de.other_user_fbid)sa.getMulti(de.participants,function(ee){var fe=this._getNode('titlebarConfidentialStatus');if(fe){var ge=de.other_user_fbid&&ee[ra.getParticipantIDFromUserID(de.other_user_fbid)].is_anonymous_crisis_support;aa.conditionShow(fe,ge);}}.bind(this));},_updateEmployeeAwayWarning:function(de){if(!ba.isEmployee())return;kb.onAfterLoad(function(){n.loadModules(["ChatEmployeeAwayWarning"],function(ee){ee.updateEmployeeAwayWarning(de,function(){this._sheetController.openEmployeeAwaySheet();}.bind(this),jc);}.bind(this));}.bind(this));},_updateOfficeStatus:function(de){var ee=this._getNode('officeStatus');if(!ee||ra.isGroupChat(de.thread_id))return;kb.onAfterLoad(function(){n.loadModules(["ChatTabOfficeStatus"],function(fe){var ge=ra.getParticipantIDFromUserID(de.other_user_fbid);sa.get(ge,function(he){fe.update(ee,he);});});});},_updateSwitchToWork:function(de){if(ba.isEmployee()&&ba.hasWorkUser()&&ra.isGroupChat(de.thread_id)){sa.getMulti(de.participants,function(ee){var fe=this._isEmployeesOnly(ee);this._updateMenuPropsSafe({hasSwitchToWork:fe});}.bind(this));}else this._updateMenuPropsSafe({hasSwitchToWork:false});},_updateControls:function(de,ee,fe){var ge=false;if(de&&de.thread_id){var he=ra.tokenize(de.thread_id);if(he.type==='user'){var ie=he.value;ge=!ka.isUser(ie);}}var je=va.showComposer(de)&&(!mc(de.participants)||!!ee)&&!this._pendingActions,ke=this._getNode('footer');aa.conditionShow(ke,je);aa.conditionShow(this._getNode('menuContainer'),je);var le={isEmptyChat:yc.isNewEmptyLocalThread(de.thread_id),show:je};if(ge)le.showAddFriend=null;this._updateMenuPropsSafe(le);var me=je&&!ge;this._addToThreadButton&&this._addToThreadButton.setProps({shown:me});if(fe&&fe.length===1&&qa.ShowContextBanner&&qa.ShowContextBannerNullState){this._messagesView&&this._messagesView.renderContextBanner(null,fe[0].info&&fe[0].info.uid);}else this._messagesView&&this._messagesView.unmountContextBanner();this._resizeInputContainer();},_isP2PEnabled:function(){return bb.P2PEnabled;},_getP2PProps:function(){return {button:hb.createElement('i',{className:"hidden_elem"}),className:"_6ga _6gb",flyoutAlignment:dd,onTrigger:this._p2pTriggered.bind(this),referrer:ta.CHAT,threadID:this._threadID};},_renderP2PButton:function(){var de=this._getCanonicalUserID();if(this._isP2PEnabled()&&de!==ba.getID()){this._p2pButtonContainer=this._getNode('orionTriggerContainer');this._p2pButton=new ib(cb,this._p2pButtonContainer);this._p2pButton.setProps(this._getP2PProps());aa.addClass(this._inputContainerNode,"_11d6");}else aa.addClass(this._getNode('orionTriggerContainer'),"hidden_elem");},_resizeInputContainer:function(){if(gd)return;},_updateNewThread:function(de){if(yc.isNewEmptyLocalThread(de.thread_id))this.showAddFriend();},_isEmployeesOnly:function(de){for(var ee in de)if(!de[ee].employee)return false;return true;},_showArchiveWarningIfAllParticipantsAreEmployees:function(de){var ee=this._isEmployeesOnly(de),fe=this._getNode('archiveContainer');if(fe){if(this._titlebarTooltipAnchor)aa.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',ee);aa.conditionShow(fe,ee);this._archiveWarning&&this._archiveWarning.setProps({shown:ee});}},updateTitlebarTooltip:function(){yc.getThreadMeta(this._threadID,function(de){var ee=jb.findDOMNode(this._title.component);if(!ee)return;id(ee,de.participants);}.bind(this));},_getNode:function(de){return this._tabTemplate.getNode(de);},_getCanonicalUserID:function(){return ra.getUserIDFromThreadID(this._threadID);},_listen:function(de,event,ee,fe){var ge=this._getNode(de);if(ge){this._eventListeners.push(ja.listen(ge,event,ee.bind(this)));}else if(!fe)throw new Error('Could not find node "'+de+'"');},_closePreClicked:function(de){this._closeMouseDown=true;},_closeClicked:function(de){yd(this);t.closeTab(this._threadID);if(de instanceof vb){de.stopPropagation();return;}de.kill();},_closeEnter:function(de){if(de.keyCode===na.RETURN)this._closeClicked(de);},_nubClicked:function(de){de.kill();return w.inform('nub-activated',this._threadID);},_dockKeyDown:function(event){if(event.keyCode===na.RETURN||event.keyCode===na.SPACE){w.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===na.ESC){this._handleEscape();event.kill();}else if(event.keyCode===na.TAB)this._handleTabPressed(event);},_handleTabPressed:function(event){if(!event.ctrlKey){var de=w.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});!de&&event.preventDefault();}},_handleEscape:function(){if(this._stickersFlyoutShown){this._toggleStickersFlyoutShown(false);return;}yd(this);if(this.hasEmptyInput()){w.inform('esc-pressed',this._threadID);}else{var de=kc._("Voulez-vous vraiment fermer cette fen\u00eatre de discussion\u00a0?"),ee=kc._("Vous n\u2019avez pas envoy\u00e9 votre message.");ob.showConfirm(de,ee,function(fe){if(fe){w.inform('esc-pressed',this._threadID);}else this.focus();}.bind(this),{autofocusConfirm:true});}},_titleClicked:function(event){var de=event.getTarget();if(!eb.byClass(de,'titlebarText')&&!eb.byClass(de,'uiSelector')&&!eb.bySelector(de,"._3olv")&&!eb.byClass(de,'close')){event.kill();t.lowerTab(this._threadID);this.focus();}},_groupCallEnter:function(de){if(de.keyCode===na.RETURN)this._groupCallClicked(de);},_groupCallClicked:function(de){if(de.target)de.target.blur();if(this._videoCallLinkEnabled){var ee;if(de.target&&(aa.hasClass(de.target,'phoneicon')||aa.hasClass(de.target,"_1fu4"))){ee='chat_tab_voice_icon';}else ee='chat_tab_icon';yc.getThreadMeta(this._threadID,function(fe){var ge=fe.participants.map(function(ie){return ra.getUserIDFromParticipantID(ie);}),he=ge.filter(function(ie){return ie!==ba.getID();});w.inform('group-call-clicked',{conferenceName:'GROUP:'+fe.thread_fbid.toString(),usersToRing:he,hasVideo:ee!=='chat_tab_voice_icon',clickSource:ee});});}de.stopPropagation();},_callEnter:function(de){if(de.keyCode===na.RETURN)this._callClicked(de);},_callClicked:function(de){if(de.target)de.target.blur();var ee=this._getCanonicalUserID();if(this._videoCallLinkEnabled){var fe;if(de.target&&(aa.hasClass(de.target,'phoneicon')||aa.hasClass(de.target,"_2fpc"))){fe='chat_tab_voice_icon';}else fe='chat_tab_icon';w.inform('video-call-clicked',{threadID:this._threadID,userID:ee,clickSource:fe,audioOnly:fe==='chat_tab_voice_icon'});}de.stopPropagation();},_addFriendLinkClicked:function(){this.showAddFriend();},_getUserParticipants:function(de){var ee=[];de.forEach(function(fe){var ge=ra.getUserIDFromParticipantID(fe);ge&&ee.push(ge);});return ee;},_enableDesktopNotif:function(){Notification.requestPermission();},_inputPasted:function(event){if(ac.chrome()){var de=event.clipboardData||event.originalEvent.clipboardData;if(!de||!de.items||de.items.length<1)return;var ee=de.items[0].type;if(ee!=='image/png')return;if(de.items[0].getAsFile){var fe=de.items[0].getAsFile();this._photoUploader&&this._photoUploader.uploadFiles([fe]);}}},_focusInput:function(){q.processEvent('focus');if(gd){this._composer&&this._composer.getInput().focus();}else this._chatInput&&this._chatInput.component.isMounted()&&this._chatInput.component.focus();},_focusTab:function(){aa.addClass(this._tabElem,'focusedTab');this.tryMarkAsRead();this._closeMouseDown=false;this._setCloseTooltip(true);w.inform('focus-tab',this._threadID);},_blurTab:function(){q.processEvent('blur');aa.removeClass(this._tabElem,'focusedTab');!this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function(de){if(this._closeButton){this._closeButton.setProps({active:de});return;}var ee=this._getNode('titlebarCloseButton');if(!ee)return;var fe=de?kc._("Appuyez sur \u00c9chap pour fermer"):kc._("Fermer l\u2019onglet");yb.set(ee,fe,'above');},_inputKeyDown:function(event){this.tryMarkAsRead();if(event.keyCode===na.RETURN&&!event.shiftKey){if(td(this)){sd(this);event.kill&&event.kill();return;}pd(this);event.kill?event.kill():event.preventDefault();return;}if(event.keyCode===na.DOWN&&event.shiftKey&&this.hasEmptyInput()){event.kill&&event.kill();t.lowerTab(this._threadID);this.focus();return;}this._handleHotkeyPressed(event);},_showMessageBlockedDialog:function(de){var ee=this._getCanonicalUserID();if(!ee)return;var fe='fbid:'+ee;sa.get(fe,function(ge){n.loadModules(["MessageBlockedDialog"],function(he){he.show(de.thread_id,de.can_reply,qc.isMessageBlocked(de),ge.short_name);});});},_initializeInput:function(){if(gd){var de=new ib(m,this._getNode('footer'));de.setProps({bootloadPlaceholder:hb.createElement('div',null),bootloadLoader:ma('ChatTabComposerContainer.react'),initializeThingsWithInputFn:this._initializeThingsWithInputFn.bind(this),inputKeyDown:this._inputKeyDown.bind(this),onMount:function(fe){this._composer=fe;}.bind(this),onBlur:this._blurTab.bind(this),onEscape:this._handleEscape.bind(this),onFocus:this._focusTab.bind(this),onTab:this._handleTabPressed.bind(this),openFlyoutFn:function(){return this._toggleStickersFlyoutShown(true);}.bind(this),resizeFn:function(){this._nubController.flyoutContentChanged();}.bind(this),placeholder:kc._("\u00c9crivez un message..."),photoUploaderProps:this._getPhotoUploaderProps(),fileUploaderProps:this._getFileUploaderProps(),stickerButtonProps:this._getStickerButtonProps(),p2pProps:this._getP2PProps(),onCustomLikeSelect:this._customLikeSelected.bind(this),onStickerSelect:this._stickerSelected.bind(this),threadID:this._threadID,viewer:ba.getID()});return;}var ee=kc._("\u00c9crivez un message...");this._chatInput=new ib(pc,this._getNode('chatInputContainer'));this._chatInput.setProps({initializeThingsWithInputFn:this._initializeThingsWithInputFn.bind(this),inputKeyDown:this._inputKeyDown.bind(this),onBlur:this._blurTab.bind(this),onEscape:this._handleEscape.bind(this),onFocus:this._focusTab.bind(this),onTab:this._handleTabPressed.bind(this),openFlyoutFn:function(){return this._toggleStickersFlyoutShown(true);}.bind(this),resizeFn:function(fe){tb.set(this._getNode('inputContainer'),'height',fe+'px');this._nubController.flyoutContentChanged();}.bind(this),uploadPhotoFn:function(fe){this._photoUploader&&this._photoUploader.uploadFiles([fe]);}.bind(this),placeholder:ee});},_initializeSharePreview:function(de,ee){ja.listen(de,'keyup',function(){var fe=ee?ee():de.value;if(!fe.length)if(this._urlScraper){this._urlScraper.reset();delete this._urlScraperData;}}.bind(this));kb.onAfterLoad(function(){n.loadModules(["URLScraper"],function(fe){this._urlScraper=new fe(de,ee);this._urlScraper.subscribe('match',function(ge,he){this._urlScraperData=he;this._getSharePreview().done(function(ie){var je=this._urlScraperData;ie.setProps({share:null,uri:je&&je.url});}.bind(this));}.bind(this));}.bind(this));}.bind(this));},_getSharePreview:function(){if(!this._sharePreview&&!this._sharePreviewPromise){this._sharePreviewLoading=true;this._sharePreviewPromise=new h(function(de){n.loadModules(["MercurySharePreview.react"],function(ee){this._sharePreview=new ib(ee,this._getNode('shareAttachmentShelf'));this._sharePreview.setProps({imageSize:{width:ed,height:ed},location:ta.CHAT_PREVIEW,onClose:this._focusInput.bind(this),onUpdate:function(){vd(this);this._unblockSend();}.bind(this)});this._sharePreviewLoading=false;de(this._sharePreview);}.bind(this));}.bind(this));}return this._sharePreviewPromise;},_initializeThingsWithInputFn:function(de,ee){if(gd)this._getValueFromReactComposer=ee;this._initializeSharePreview(de,ee);yc.getThreadMeta(this._threadID,function(fe){if(fe&&fe.folder===za.PENDING){var ge=da.create('div');da.appendContent(this._getNode('chatConv'),ge);this._pendingActions=ge;jb.render(hb.createElement(m,{bootloadPlaceholder:hb.createElement('div',{style:{height:27}}),bootloadLoader:ma('ChatPendingActions.react'),onDeleteClick:function(he){vc.changeFolder(this._threadID,za.OTHER);t.closeTab(this._threadID);}.bind(this),onReplyClick:function(he){vc.changeFolder(this._threadID,za.INBOX);da.remove(ge);delete this._pendingActions;this._updateControls(fe);}.bind(this)}),ge);}wc.getServerIDFromClientID(this._threadID,function(he){this._typingDetector=new zb(this._getCanonicalUserID(),de,'mercury-chat',null,he,ee);}.bind(this));}.bind(this));},_getInputValue:function(){if(this._getValueFromReactComposer)return this._getValueFromReactComposer();if(!this._chatInput||!this._chatInput.component.isMounted())return '';return this._chatInput.component.getValue()||'';},appendTextToInput:function(de){if(gd){this._composer&&this._composer.getInput().appendText(de);}else if(this._chatInput&&this._chatInput.component.isMounted())this._chatInput.component.appendText(de);},_hasUnfinishedPost:function(){return ud(this)||this.isUploading();},tryMarkAsRead:function(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){vc.markRead(this._threadID);vc.markSeen(this._threadID);return true;}return false;},_chatConvClicked:function(de){this.tryMarkAsRead();if(eb.byTag(de.getTarget(),'a')||da.getSelection())return;this.focus();},_inputContainerClicked:function(de){this.tryMarkAsRead();this.focus();},_initializePageMessagingIndicator:function(){if(!this._pagesMessageIndicator)return;aa.hide(this._pagesMessageIndicator);this._pagesMessageIndicatorHandler=db.tryCreateHandler(this._threadID,this._pagesMessageIndicator,this._onlineStatus);this._pagesMessageIndicatorHandler&&this._pagesMessageIndicatorHandler.checkResponsiveness();},showTypingIndicator:function(de){this._renderTypingIndicator();aa.conditionClass(this._tabElem,"_54m8",de);},_renderTypingIndicator:function(){var de=aa.hasClass(this._tabElem,'highlightTab')?'light':'dark';jb.render(hb.createElement(xa,{color:de}),this._getNode('animationContainer'));},_updateUnreadCount:function(de){var ee=de.unread_count;if(typeof ee!='undefined'){var fe=!!ee&&(!o.showsTabUnreadUI||o.showsTabUnreadUI()),ge=this._getNode('numMessages');aa.conditionShow(ge,fe);aa.conditionClass(this._tabElem,'highlightTab',fe);this._renderTypingIndicator();md(this._threadID,this._tabElem,fe);da.setContent(ge,ee);}},ensureValidCanonicalGroup:function(de){if(this._messagesView&&this._messagesView.getThreadID()===this._threadID)return;if(de[this._messagesView.getThreadID()])this._updateChatTabMessagesView(this._threadID);},updateCallLink:function(){var de=ra.isGroupChat(this._threadID);if(de&&p.get('rtc_conferencing_www')){this._videoCallLinkEnabled=true;}else{var ee=this._getCanonicalUserID();if(!ee||ee===ba.getID()||!ka.isUser(ee)){if(this._videoCallButton)this._videoCallButton&&this._videoCallButton.setProps({shown:false});this._videoCallLinkEnabled=false;return;}this._videoCallLinkEnabled=la.isCallable(ee);}},_initializeSheetController:function(){this._sheetController=new v(this._threadID,this._getNode('sheet'),this._tabElem,this);this._sheetController.onClickMessagesBlockedSheet(function(){vc.unblockMessages(this._threadID);this.focus();}.bind(this));this._sheetController.onClickNewMessagesSheet(function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();this.tryMarkAsRead();}.bind(this));this._sheetController.onClickThreadIsMutedSheet(function(){vc.unmute(this._threadID);this.focus();}.bind(this));this._sheetController.onClickSecretModeSheet(function(){vc.turnOffSecretMode(this._threadID);this.focus();}.bind(this));this._sheetController.onTokensChanged(function(de,ee){this._handleSheetControllerTokensChanged(ee);}.bind(this));this._nubController=new ab().init(this._tabElem);this._sheetController.onResize(function(){this._nubController.flyoutContentChanged();}.bind(this));this._nubController.subscribe('resize',function(){this._resizeInputContainer();}.bind(this));},_handleSheetControllerTokensChanged:function(de){this._updateP2PParticipants(de.tokens);yc.getThreadMeta(this._threadID,function(ee){this._updateControls(ee,de.token_count,de.tokens);}.bind(this));this._updateMessagesViewIfNecessary(de);},_updateMessagesViewIfNecessary:function(de){if(!qa.MessengerChatTabSnapCanonialGK||!yc.isEmptyLocalThread(this._threadID))return;var ee=pa.get();ee.unsubscribe(this._canonicalGroupSearchSubscriptionID);if(de.token_count===1){var fe=de.tokens[0].info&&de.tokens[0].info.uid;this._updateMercuryMessagesViewCanonical(ra.getThreadIDFromUserID(fe));return;}this._updateMercuryMessagesViewCanonical(this._threadID);if(de.token_count>1){var ge=de.tokens.map(function(he){return he.info.uid;});this._canonicalGroupSearchSubscriptionID=ee.getCanonicalGroupThreadIDForParticipants(Array.from(ge),this._updateMercuryMessagesViewCanonical.bind(this));}},_updateMercuryMessagesViewCanonical:function(de){if(de){this._updateChatTabMessagesView(de);this._messagesView.scrollToBottom();}},_updateP2PParticipants:function(de){var ee;if(de&&de.length===1&&de[0].info&&de[0].info.uid)ee=[ra.getParticipantIDFromUserID(de[0].info.uid)];if(this._p2pButton){this._p2pButton.setProps({participantIDs:ee});}else if(this._composer)this._composer.setParticipantIDs(ee);},_initializeHeader:function(){this._initializeTitle();this._initializeCloseButton();this._initializeReactMenu();this._initializeAddToThreadButton();this._initializeVideoCallButton();this._initializeArchiveWarning();},_loadReactMenu:function(){var de=ra.isGroupChat(this._threadID),ee=yc.isNewEmptyLocalThread(this._threadID),fe=this._sheetController.openAddFriendsSheet.bind(this._sheetController);ma('ChatTabMenu.react').load().done(function(ge){this._reactChatTabMenu=new ib(ge,this._getNode('menuContainer'));this._reactChatTabMenu.setProps({sheetController:this._sheetController,onFileUploaderMounted:this.setFilesUploader.bind(this),nameConversationFunc:function(){return this.showNameConversation();}.bind(this),isGroupChat:de,isEmptyChat:ee,showAddFriend:fe,threadID:this._threadID,otherUserID:this._getCanonicalUserID(),attachmentsShelf:this._getNode('fileAttachmentShelf'),onUploadFinished:this._unblockSend.bind(this),onUpdateAttachmentsShelf:function(){return vd(this);}.bind(this),onSubmit:this._focusInput.bind(this)},function(){this._menuPromiseResolve(this._reactChatTabMenu);}.bind(this));}.bind(this));return this._menuPromise;},_initializeReactMenu:function(){this._menuPromise=new h(function(de){this._menuPromiseResolve=de;}.bind(this));this._listen('menuButton','click',function(de){de.preventDefault();this._loadReactMenu().done(function(ee){ee.component.open();});}.bind(this));},_initializeArchiveWarning:function(){var de=this._getNode('archiveContainer');if(!de)return;kb.onAfterLoad(function(){n.loadModules(["ArchiveWarning.react"],function(ee){this._archiveWarning=new ib(ee,de);this._archiveWarning.setProps({isFBAtWork:ec.is_work_user,shown:true});}.bind(this));}.bind(this));},_initializeAddToThreadButton:function(){kb.onAfterLoad(function(){n.loadModules(["ChatAddToThreadButton.react"],function(de){this._addToThreadButton=new ib(de,this._getNode('addToThreadContainer'));this._addToThreadButton.setProps({isFBAtWork:ec.is_work_user,onClick:this._addFriendLinkClicked.bind(this),shown:true});}.bind(this));}.bind(this));},_initializeVideoCallButton:function(){kb.onAfterLoad(function(){n.loadModules(["ChatVideoCallButton.react"],function(de){var ee=ra.isGroupChat(this._threadID);if(ee&&p.get('rtc_conferencing_www')){this._videoCallButton=new ib(de,this._getNode('videoCallButtonContainer'));this._videoCallButton.setProps({shown:true,isAudio:false,isGroupChat:true,userID:null,onClick:this._groupCallClicked.bind(this),onKeyUp:this._groupCallEnter.bind(this)});this._voiceCallButton=new ib(de,this._getNode('voiceCallButtonContainer'));this._voiceCallButton.setProps({shown:true,isAudio:true,isGroupChat:true,userID:null,onClick:this._groupCallClicked.bind(this),onKeyUp:this._groupCallEnter.bind(this)});}else{if(!ra.getUserIDFromThreadID(this._threadID))return;var fe=this._getCanonicalUserID();this._videoCallButton=new ib(de,this._getNode('videoCallButtonContainer'));this._videoCallButton.setProps({shown:true,isAudio:false,userID:fe,onClick:this._callClicked.bind(this),onKeyUp:this._callEnter.bind(this)});var ge=this._getNode('voiceCallButtonContainer');if(ge){this._voiceCallButton=new ib(de,ge);this._voiceCallButton.setProps({shown:true,isAudio:true,userID:fe,onClick:this._callClicked.bind(this),onKeyUp:this._callEnter.bind(this)});}}}.bind(this));}.bind(this));},_initializeCloseButton:function(){this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','keyup',this._closeEnter);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);kb.onAfterLoad(function(){n.loadModules(["ChatCloseButton.react"],function(de){this._closeButton=new ib(de,this._getNode('titlebarCloseButtonContainer'));this._closeButton.setProps({active:this.isFocused(),className:"_3olu _3olv",onClick:this._closeClicked.bind(this),onKeyUp:this._closeEnter.bind(this),onMouseDown:this._closePreClicked.bind(this)});}.bind(this));}.bind(this));},_initializeTitle:function(){var de=yc.getThreadMetaNow(this._threadID);this._title=new ib(y,this._getNode('titleContainer'));this._title.setProps({isNewThread:yc.isNewEmptyLocalThread(this._threadID),thread:de,viewer:ba.getID()});},_initializeTitleHREF:function(){cc.getThreadURI(this._threadID,function(ee){return this._setTitleHref(ee);}.bind(this));this._titlebarTooltipAnchor=this._getNode('titlebarText');var de=this._getCanonicalUserID();if(this._getCanonicalUserID())sa.get(ra.getParticipantIDFromUserID(de),function(ee){if(ee.href)this._setTitleHref(ee.href);}.bind(this));},_initializeUIListeners:function(){if(this._pagesMessageIndicator)this._listen('scrollingArea','scroll',function(event){var de=event.target;if(de.scrollHeight-de.offsetHeight!==de.scrollTop)this._pagesMessageIndicatorHandler&&this._pagesMessageIndicatorHandler.hideIndicatorAndPreventFutureShow();}.bind(this));this._listen('closeButton','click',this._closeClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);if(this._getNode('inputContainer'))this._listen('inputContainer','click',this._inputContainerClicked);this._listen('sheet','keydown',function(event){if(!event.getModifiers().any&&event.keyCode===na.TAB){this._focusInput();event.kill();}if(event.keyCode===na.ESC)this._handleEscape();}.bind(this));if(this._getNode('officeStatus'))this._listen('officeStatus','click',function(){return false;},true);},setFilesUploader:function(de){this._filesUploader=de;},_getPhotoUploaderProps:function(){return {className:"_6gd",customUI:true,imageClassName:"hidden_elem",linkClassName:"_6gb _6ge",onSubmit:this._handlePUSubmit.bind(this),onAllUploadsComplete:this._handlePUAllUploadsCompleted.bind(this),onLastUploadFail:this._handlePULastUploadFailed.bind(this),onLastUploadCancel:this._handlePULastUploadCanceled.bind(this)};},_initializeAutoSendPhotoUploader:function(){if(gd)return;this._photoUploader=jb.render(hb.createElement(s,this._getPhotoUploaderProps()),this._getNode('photoUploaderContainer'));},_getStickerButtonProps:function(){return {className:"_6gb _6gf",flyoutAlignment:dd,onFlyoutShown:this._onStickerFlyoutShown.bind(this),onFlyoutHidden:this._onStickerFlyoutHidden.bind(this),onLoad:function(de){this._stickerButton=de;}.bind(this),onStickerSelect:this._stickerSelected.bind(this),onEmoticonSelect:this._emoticonSelected.bind(this),threadID:this._threadID};},_initializeStickers:function(){if(gd)return;var de=this._getStickerButtonProps();jb.render(hb.createElement(m,babelHelpers['extends']({bootloadPlaceholder:hb.createElement('a',{className:de.className}),bootloadLoader:ma('ChatStickerButton.react')},de)),this._getNode('stickerButtonContainer'));},_getFileUploaderProps:function(){var de=this._getPhotoUploaderProps();de.linkClassName="_6gb _6gg";de.imagesOnly=false;return de;},_initializeAutoSendFileUploader:function(){if(gd)return;if(!this._fileUploaderNode)return;this._fileUploader=jb.render(hb.createElement(s,this._getFileUploaderProps()),this._fileUploaderNode);},_initializeContentSearch:function(){if(gd)return;if(this._contentSearchNode){var de="_6gb _6gs";jb.render(hb.createElement(m,{bootloadPlaceholder:hb.createElement('a',{className:de}),bootloadLoader:ma('ChatContentSearchButton.react'),className:de,getQuery:function(){return this._getInputValue();}.bind(this),onLoad:function(ee){this._contentSearchButton=ee;}.bind(this),onSelect:function(ee,fe){var ge=this.getInputElem();ge&&ge.select&&ge.select();if(ee.platformFBID.toString()===qa.MessengerAppID){this._stickerSelected(ee.resultID.toString());}else{this._photoUploader&&this._photoUploader.uploadURL({attribution_app_id:ee.platformFBID,errorDialogParams:{body:kc._("Un probl\u00e8me est survenu lors de l\u2019envoi de ce GIF. Veuillez en choisir un autre et r\u00e9essayer."),title:kc._("Impossible d\u2019envoyer le GIF")},external_image_url:ee.source.url,preview_url:ee.media.preview?ee.media.preview.url:ee.media.thumbnail.url,source:ee.source});this._messagesView&&this._messagesView.scrollToBottom();}}.bind(this)}),this._contentSearchNode);aa.addClass(this._inputContainerNode,"_35li");l.bumpEntityKey('chat.web','content_search_button.mounting_attempted');}},_initializeDragDropTarget:function(){if(dc.canUploadFiles){var de=ea.scry(this._tabElem,"._1ia");if(de&&de.length>0){this._dropTarget=new fa(de[0]);this._dropTarget.setOnFilesDropCallback(this._filesDropped.bind(this));this._dropTarget.setOnURLDropCallback(this._linkDropped.bind(this));this._dropTarget.enable();}}},_initializeP2PChatThreadBannerContainer:function(){var de=ea.scry(this._tabElem,"._2hc2");if(de&&de.length>0){this._p2pChatThreadBannerContainerEl=de[0];kb.onAfterLoad(function(){n.loadModules(["P2PChatThreadBannerContainer.react"],function(ee){this._p2pChatThreadBannerContainer=new ib(ee,this._p2pChatThreadBannerContainerEl);this._p2pChatThreadBannerContainer.setProps({isVisible:this.isChatViewable(),otherUserID:ra.getUserIDFromThreadID(this._threadID),threadID:this._threadID});}.bind(this));}.bind(this));}},_initializeP2PRainMoneyContainer:function(){if(!this._isP2PEnabled||!bb.P2PRainMoneyWWW)return false;var de=ea.scry(this._tabElem,"._3bpu");if(de&&de.length>0){this._p2pRainMoneyContainerEl=de[0];kb.onAfterLoad(function(){n.loadModules(["P2PRainMoneyContainer.react"],function(ee){this._p2pRainMoneyContainer=new ib(ee,this._p2pRainMoneyContainerEl);this._p2pRainMoneyContainer.setProps({threadID:this._threadID,width:this._tabElem.clientWidth});}.bind(this));}.bind(this));}},setP2PChatThreadBannerContainerVisibility:function(){if(this._p2pChatThreadBannerContainer)this._p2pChatThreadBannerContainer.setProps({isVisible:this.isChatViewable()});},isChatViewable:function(){return (this._tabElem&&aa.hasClass(this._tabElem,'opened')&&!aa.hasClass(this._tabElem,'hidden_elem'));},_initializeP2P:function(){if(gd)return;this._renderP2PButton();},_initializeUnloadListeners:function(){this._checkUnsentMessages=gc(function(){if(this._hasUnfinishedPost())return kc._("Vous n\u2019avez pas encore envoy\u00e9 votre message. Voulez-vous quitter sans envoyer\u00a0?");if(tc.getNumberLocalMessages(this._threadID))return kc._("Votre message est en cours d\u2019envoi. Voulez-vous vraiment quitter\u00a0?");return null;}.bind(this));kb.onBeforeUnload(this._checkUnsentMessages,false);this._logUnsentPhotos=gc(yd.bind(null,this));kb.onUnload(this._logUnsentPhotos);},_handlePUSubmit:function(de,ee){wd(this,fb.UPLOAD_START,ee);rd(this,'',[],function(fe){if(this._threadID!==fe.thread_id){this._newThreadIDFromPhotoUpload=fe.thread_id;if(this._messagesView)this._messagesView.setNewThreadID(fe.thread_id);}fe.content_attachment=null;zc.addAttachmentPlaceholder(fe,ee.upload_id,ee);}.bind(this));be('submit',ee);this._focusInput();},_handlePULastUploadFailed:function(de,ee){wd(this,fb.CLIENT_ERROR,ee);be('failed',ee);zc.cancelAttachmentPlaceholder(ee.upload_id,ee);var fe=kc._("Impossible de t\u00e9l\u00e9charger la photo"),ge=kc._("Veuillez r\u00e9essayer. Assurez-vous de t\u00e9l\u00e9charger une photo valide.");if(ee.errorDialogParams){fe=ee.errorDialogParams.title||fe;ge=ee.errorDialogParams.body||ge;}ob.show(fe,ge);},_handlePULastUploadCanceled:function(de,ee){wd(this,fb.CANCEL_DURING_UPLOAD,ee);be('canceled',ee);zc.cancelAttachmentPlaceholder(ee.upload_id,ee);},_handlePUAllUploadsCompleted:function(de,ee){wd(this,fb.ALL_UPLOADS_DONE,ee);be('completed',ee);zc.confirmAttachmentPlaceholder(ee.upload_id,ee);var fe=ee.image_ids.length||ee.attachments.length;qd(this,fe);},_stickerSelected:function(de){rd(this,'',[],function(ee){ee.has_attachment=true;ee.sticker_id=de;zc.send(ee);this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_customLikeSelected:function(de,ee){rd(this,de.emoji,[],function(fe){fe.has_attachment=false;zc.send(ga.setEmojiSize(fe,ee));this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emoticonSelected:function(de){var ee=ha.symbols[de];if(!ee)return;if(gd){this._composer&&this._composer.getInput().insertEmoticon(ee);return;}else if(!p.get('chat_basic_input')){this._chatInput.component.insertEmoticon(ee);return;}this._selectionPosition=this._selectionPosition||new mb(this._getNode('input'));var fe=xb.getInstance(this._getNode('input')),ge=fe.getValue(),he=ia.insertEmoticon(ee,ge,this._selectionPosition.getPos());fe.setValue(he.result);this._selectionPosition.setPos(he.start,he.end);},_p2pTriggered:function(){rd(this,'',[],function(de){this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_onStickerFlyoutShown:function(de){this.focus();de();this._stickersFlyoutShown=true;},_searchStickers:function(de,ee){this._stickersFlyout&&this._stickersFlyout.setProps({packID:rb.SEARCH_PACK_ID,trigger:de},ee);},_onStickerFlyoutHidden:function(){this._stickersFlyoutShown=false;if(!gd)this.focus();},_setTitleHref:function(de){this._title&&this._title.setProps({href:de});},_unblockSend:function(){if(!this._blocked||td(this))return;this._blocked=false;pd(this);this._sheetController.closeUploadWarningTabSheet();},_logOpenTab:function(){new j('/ajax/chat/opentab_tracking.php',{threadID:this._threadID,userID:this._getCanonicalUserID(),signatureID:this._signatureID}).send();}});function be(de,ee){hd.debug('photo_uploader:'+de,'{}');}function ce(de,ee){if(!ee)return de;var fe=ee.getImageFiles();if(fe.length>0){de.image_ids=fe;de.has_attachment=true;}var ge=ee.getAnimatedImageFiles();if(ge.length>0){de.gif_ids=ge;de.has_attachment=true;}var he=ee.getVideoFiles();if(he.length>0){de.video_ids=he;de.has_attachment=true;}var ie=ee.getAudioFiles();if(ie.length>0){de.audio_ids=ie;de.has_attachment=true;}var je=ee.getFiles();if(je.length>0){de.file_ids=je;de.has_attachment=true;}return de;}f.exports=xd;},null);
__d('ChatTabViewCoordinator',['Arbiter','ChatTabModel','ChatTabView','ChatTabViewSelector','CSS','ErrorUtils','FBRTCSupport','LogHistory'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=o.getInstance('chat_tab_coordinator');function q(r,s){var t=new k(r),u={},v=false;function w(){var aa=i.get(),ba={};aa.tabs.forEach(function(da){ba[da.id]=1;});p.log('process_tab_changed',{model_tabs:Object.keys(ba),view_tabs:Object.keys(u)});for(var ca in u)if(!ba[ca]){p.log('remove_tab',{tab_id:ca});u[ca].destroy();delete u[ca];}x(aa);y(aa);if(aa.tabNeedsFocus&&!aa.tabNeedsFocus.isFocused())aa.tabNeedsFocus.focus();}function x(aa){var ba=null;aa.tabs.forEach(function(ca){var da=ca.id,ea=false;if(!u[da]){p.log('add_tab',{tab_id:da});u[da]=new j(da,ca.server_id,ca.signatureID,r,ba);ea=true;if(u[da].onBeingReplaced)u[da].onBeingReplaced(function(ha,ia){u[ha]=ia;});}else u[da].updateSignatureID(ca.signatureID);if(u[da].isFocused())aa.tabNeedsFocus=u[da];if(!ea&&!u[da].nextTabIs(ba)){var fa=u[da].getScrollTop();if(ba){try{u[da].insertBefore(ba);}catch(ga){p.log('insertBeforeFailed','{}');u[da].appendTo(r);m.reportError(ga);}}else u[da].appendTo(r);if(fa)u[da].setScrollTop(fa);}ba=u[da];});}function y(aa){var ba=s.getTabsToShow(aa),ca=[],da=false;aa.tabs.forEach(function(ea){if(!ba[ea.id]){u[ea.id].setVisibleState(false,ea.raised);ca.push(ea);}});aa.tabs.forEach(function(ea){if(ba[ea.id]){u[ea.id].setVisibleState(true,ea.raised);da|=ea.raised;}});t.setTabData(ca);z(da);}function z(aa){if(!aa&&v){h.inform('layer_hidden',{type:'ChatTab'});v=false;}else if(aa&&!v){h.inform('layer_shown',{type:'ChatTab'});v=true;}}if(n.isSendWebrtcSupported())l.addClass(r,'videoCallEnabled');s.subscribe('tabs-changed',w);w();}f.exports=q;},null);
__d('FBRTCCallControlActions',['FBRTCDispatcher','keyMirror'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=i({ACCEPT_ESCALATION:null,HANG_UP:null,PARENT_WINDOW_START_CALL:null,TOGGLE_FULL_SCREEN:null,TOGGLE_MUTE_AUDIO:null,TOGGLE_MUTE_VIDEO:null,TOGGLE_SCREEN_SHARING:null,TOGGLE_SELF_VIEW:null,SHOW_SETTINGS:null,START_CALL:null,DECLINE_ESCALATION:null,RECEIVED_SIGNALING_MESSAGE:null,RESET_CALL:null,OPEN_SCREEN_IN_NEW:null,CLOSE_STANDALONE_SCREEN:null}),k={Types:j,hangUp:function(){h.dispatch({type:j.HANG_UP});},toggleMuteAudio:function(){h.dispatch({type:j.TOGGLE_MUTE_AUDIO});},toggleMuteVideo:function(){h.dispatch({type:j.TOGGLE_MUTE_VIDEO});},toggleFullScreen:function(){h.dispatch({type:j.TOGGLE_FULL_SCREEN});},toggleSelfView:function(){h.dispatch({type:j.TOGGLE_SELF_VIEW});},showSettings:function(){h.dispatch({type:j.SHOW_SETTINGS});},toggleScreenSharing:function(){h.dispatch({type:j.TOGGLE_SCREEN_SHARING});},startCall:function(){h.dispatch({type:j.START_CALL});},openScreenInNewWindow:function(){h.dispatch({type:j.OPEN_SCREEN_IN_NEW});},receivedSignalingMessage:function(l){h.dispatch({type:j.RECEIVED_SIGNALING_MESSAGE,message_type:l.msgType,message:l});},acceptEscalation:function(){h.dispatch({type:j.ACCEPT_ESCALATION});},declineEscalation:function(){h.dispatch({type:j.DECLINE_ESCALATION});},resetCall:function(l){h.dispatch({type:j.RESET_CALL,trigger:l});},parentWindowStartCall:function(){h.dispatch({type:j.PARENT_WINDOW_START_CALL});}};f.exports=k;},null);
__d('FBRTCLogger',['Log','LogHistory','MarauderLogger','formatDate','pageID'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m='webrtc',n='sent_message',o='received_message',p='send_succeeded',q='send_failed',r='info',s='call_action',t='client_event',u='client_error',v='type',w='msg_id',x='ack_msg_id',y='call_id',z='from',aa='to',ba='content',ca='tag',da='peer_id',ea='error_code',fa='trigger',ga='endcallstats',ha=null;ia.getInstance=function(){'use strict';if(!ha)ha=new ia();return ha;};function ia(){'use strict';this.$FBRTCLogger1=i.getInstance(m);}ia.prototype.logToConsole=function(ja){'use strict';var ka='Console';this.$FBRTCLogger2(null,null,ka,ja);this.$FBRTCLogger1.log(ka,ja);};ia.prototype.logReceivedMessage=function(ja,ka,la){'use strict';var ma={};ma[z]=ja;ma[y]=ka;ma[v]=la.type;ma[w]=la.msg_id;if(la.sdp)ma[ba]=la.sdp;if(la.ack_id)ma[x]=la.ack_id;this.$FBRTCLogger3(o,ma);this.$FBRTCLogger2(ja,ka,'Received',la.type+', '+la.msg_id);};ia.prototype.logSentMessage=function(ja,ka,la){'use strict';var ma={};ma[aa]=ja;ma[y]=ka;ma[v]=la.type;ma[w]=la.msg_id;if(la.sdp)ma[ba]=la.sdp;if(la.ack_id)ma[x]=la.ack_id;this.$FBRTCLogger3(n,ma);this.$FBRTCLogger2(ja,ka,'Sent',la.type+', '+la.msg_id);};ia.prototype.logSentMessageSuccess=function(ja,ka,la,ma){'use strict';var na={};na[da]=ja;na[y]=ka;na[v]=la;na[w]=ma;this.$FBRTCLogger3(p,na);};ia.prototype.logSentMessageFailure=function(ja,ka,la,ma,na){'use strict';var oa={};oa[da]=ja;oa[y]=ka;oa[v]=la;oa[w]=ma;oa[ea]=na;this.$FBRTCLogger3(q,oa);this.$FBRTCLogger2(ja,ka,'Send Failed',la+', '+na);};ia.prototype.logCallAction=function(ja,ka,la,ma,na){'use strict';var oa={};oa[da]=ja;oa[y]=ka;oa[s]=la;oa[ba]=ma;if(na)oa[fa]=na;this.$FBRTCLogger3(s,oa);this.$FBRTCLogger2(ja,ka,'CallAction',la+', '+ma);};ia.prototype.logEvent=function(ja,ka,event){'use strict';var la={};la[da]=ja;la[y]=ka;la[ba]=event;this.$FBRTCLogger3(t,la);this.$FBRTCLogger2(ja,ka,'Event',event);};ia.prototype.logInfo=function(ja,ka,la){'use strict';var ma={};ma[da]=ja;ma[y]=ka;ma[ba]=la;this.$FBRTCLogger3(r,ma);this.$FBRTCLogger2(ja,ka,'Info',la);};ia.prototype.logError=function(ja,ka,la){'use strict';var ma={};ma[da]=ja;ma[y]=ka;ma[ba]=la;this.$FBRTCLogger3(u,ma);this.$FBRTCLogger2(ja,ka,'Error',la);};ia.prototype.logErrorWithoutID=function(ja){'use strict';this.logError(null,null,ja);};ia.prototype.logEndCallSummary=function(ja){'use strict';if(!ja)return;var ka={};ka[da]=ja.peerID;ka[y]=ja.callID;ka[ca]=ga;ka[ba]=ja.toString();var la=ja.getExtraInfo();for(var ma in la)if(la.hasOwnProperty(ma))ka[ma]=la[ma];this.$FBRTCLogger3(r,ka);this.$FBRTCLogger2(ja.peerID,ja.callID,'Call Summary',ka);};ia.prototype.$FBRTCLogger3=function(ja,ka){'use strict';ka.page_id=l;this.$FBRTCLogger1.log(ja,ka);j.log(ja,m,ka);};ia.prototype.$FBRTCLogger2=function(ja,ka,la,ma){'use strict';};ia.CallAction={START_CALL:'start_call',RECEIVED_CALL:'received_call',ANSWER_CALL:'answer_call',END_CALL:'end_call',DENIED_PERMISSION:'denied_permission',SET_MUTE:'set_mute',SET_VIDEO_ON:'set_video_on',SET_SELF_VIEW_ON:'set_self_view_on',SET_FULLSCREEN_ON:'set_fullscreen_on',START_SKYPE:'start_skype',TRY_NEW:'try_new',OPEN_POPUP:'open_popup',POPUP_OPENED:'popup_opened',AUTO_DISABLE_VIDEO:'auto_disable_video',FAILED_GETTING_URI:'failed_getting_uri',OLD_URI:'old_uri',USER_SETTINGS_CHANGED:'user_settings_changed'};ia.Trigger={ADMIN_MESSAGE:'admin_message',CHAT_TAB_ICON:'chat_tab_icon',CHAT_TAB_ICON_TOUR:'chat_tab_icon_tour',CHAT_TAB_VOICE_ICON:'chat_tab_voice_icon',SKYPE_DEPRECATION_DIALOG:'skype_deprecation_dialog',REDIAL_BUTTON:'redial_button',RETURN_CALL:'return_call',WEB_MESSENGER:'web_messenger',POPUP_CALL_START_BUTTON:'popup_start_call_button',TIMELINE_PROFILE:'timeline_profile',UNKNOWN:'unknown',RESET_CALL:'install_screen_sharing_ext_dialog'};ia.Key={DEVICE_INFO:'device_info',RATING:'rating5',RATING_SHOWN:'rating_shown',SURVEY_CHOICE:'survey_choice',SURVEY_DETAILS:'survey_details',SURVEY_SHOWN:'survey_shown',INITIATED_BY_PAGE_ID:'initiated_by_page_id',PEER_IS_MOBILE:'peer_is_mobile'};f.exports=ia;},null);
__d('FBRTCLocalMessageQueue',['CacheStorage','FBRTCLogger','Map','RTCConfig'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l='localstorage',m='RTC_',n='offer',o='offer_msg',p='data_',q=30*1000,r=15*1000,s=500,t=new j();function u(){'use strict';this.$FBRTCLocalMessageQueue1=i.getInstance();}u.prototype.enqueueOffer=function(v,w){'use strict';var x=this.$FBRTCLocalMessageQueue2(v,o);this.$FBRTCLocalMessageQueue3(x,n,w);};u.prototype.getOffer=function(v){'use strict';var w=this.$FBRTCLocalMessageQueue2(v,o);return this.$FBRTCLocalMessageQueue4(w,n);};u.prototype.removeOffer=function(v){'use strict';var w=this.$FBRTCLocalMessageQueue2(v,o);w.remove(n);};u.prototype.enqueueMessage=function(v,w,x,y){'use strict';var z=p+x.toString(),aa=t.get(v)||new j();aa.set(z,y);t.set(v,aa);this.$FBRTCLocalMessageQueue1.logToConsole('Queued '+z);};u.prototype.drainQueue=function(v,w){'use strict';var x=t.get(v)||new j(),y,z;for(var aa=x,ba=Array.isArray(aa),ca=0,aa=ba?aa:aa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){if(ba){if(ca>=aa.length)break;var da=aa[ca++];y=da[0];z=da[1];}else{ca=aa.next();if(ca.done)break;var ea=ca.value;y=ea[0];z=ea[1];}void y;w(z);}t.set(v,new j());};u.prototype.enableDequeuing=function(v,w,x,y){'use strict';if(y===undefined)y=r;this.$FBRTCLocalMessageQueue5(v,w,x,y);};u.prototype.$FBRTCLocalMessageQueue5=function(v,w,x,y){'use strict';var z=this.$FBRTCLocalMessageQueue2(v,w),aa=z.keys(),ba=aa.length;for(var ca=0;ca<ba;ca++){var da=this.$FBRTCLocalMessageQueue6(z,aa[ca]);if(da&&x)x(da);}this.$FBRTCLocalMessageQueue1.logToConsole('Dequeued '+ba+' ('+v+') with '+y+' left)');if(y>0){y-=s;setTimeout(function(){this.$FBRTCLocalMessageQueue5(v,w,x,y);}.bind(this),s);}};u.prototype.$FBRTCLocalMessageQueue3=function(v,w,x){'use strict';var y={__t:Date.now(),__d:x};v.set(w,y);};u.prototype.$FBRTCLocalMessageQueue4=function(v,w){'use strict';var x=v.get(w);if(x&&this.$FBRTCLocalMessageQueue7(x)){return x.__d;}else if(x)v.remove(w);return null;};u.prototype.$FBRTCLocalMessageQueue6=function(v,w){'use strict';var x=this.$FBRTCLocalMessageQueue4(v,w);if(x!==null){v.remove(w);return x;}return null;};u.prototype.$FBRTCLocalMessageQueue7=function(v){'use strict';return Date.now()-v.__t<q;};u.prototype.$FBRTCLocalMessageQueue2=function(v,w){'use strict';return new h(l,''+m+v+'_'+w+'_');};f.exports=u;},null);
__d('FBRTCMessageListener',['Arbiter','ChannelConstants','FBRTCCallControlActions','FBRTCLocalMessageQueue','FBRTCSupport','RTCConfig','guid','invariant','mixInEventEmitter'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=45*1000,r='rtc_child_window_ready',s='rtc_child_window_start_call',t='rtc_child_window_message',u=[],v=null,w=null,x=null,y=null,z=null,aa=false,ba=null,ca={init:function(da,ea){if(aa)return;aa=true;h.subscribe(i.getArbiterType('webrtc'),function(ga,ha){this._onMessage(ha.obj);}.bind(this));h.subscribe(i.getArbiterType('webrtc_offer'),function(ga,ha){this._onMessage(ha.obj);}.bind(this));h.subscribe(i.getArbiterType('webrtc_offerack'),function(ga,ha){this._onMessage(ha.obj);}.bind(this));if(m.RtcConferencingGK)h.subscribe(i.getArbiterType('rtc_multi_json'),function(ga,ha){this._onMultiwayMessage(ha.obj);}.bind(this));this._localMessageQueue=new k();if(m.PassMessagesBetweenWindowsGK){if(l.isWebrtcSupported()&&window.addEventListener){var fa=da?this._handleWindowMessageToChild.bind(this):this._handleWindowMessageToParent.bind(this);window.addEventListener('message',fa,false);}if(da)this._connectToParentWindow(ea);}},setParentWindowNonce:function(da){y=da;},generateNewNonce:function(){z=n();return z;},setMultiwayMessageHandler:function(da,ea){!!ba?o(0):undefined;ba=ea?da.bind(ea):da;},_onMultiwayMessage:function(da){this.emit('multiwayMessageReceived',da);if(ba)ba(da);},setMessageHandler:function(da,ea){!!v?o(0):undefined;v=ea?da.bind(ea):da;while(u.length)v(u.shift());},removeMessageHandler:function(){v=null;},_onMessage:function(da){this.emit('messageReceived',da);if(v){v(da);}else u.push(da);this._passMessageToChildWindow(da);},_connectToParentWindow:function(da){if(window.opener&&window.opener.postMessage){var ea={type:r,nonce:y,childNonce:this.generateNewNonce(),peerID:da};window.opener.postMessage(ea,window.location.origin);}},_verifyWindowMessage:function(event){return event.origin===window.location.origin&&event.data&&z&&event.data.nonce===z;},_handleWindowMessageToParent:function(event){if(!this._verifyWindowMessage(event))return;if(event.data.type===r){this.setParentWindowNonce(event.data.childNonce);this._setChildWindow(event.source);this._replayQueuedMessagesToChild(event.data.peerID,w);}},_handleWindowMessageToChild:function(event){if(!this._verifyWindowMessage(event))return;if(event.data.type===t)this._onMessage(event.data.message);if(event.data.type===s)j.parentWindowStartCall();},_replayQueuedMessagesToChild:function(da,ea){this._localMessageQueue.drainQueue(da,function(fa){var ga={type:t,nonce:y,message:fa};ea.postMessage(ga,window.location.origin);});},_setChildWindow:function(da){w=da;clearTimeout(x);x=setTimeout(function(){w=null;},q);this._startCallInChildWindow();this.generateNewNonce();},_passMessageToChildWindow:function(da){if(w){var ea={type:t,nonce:y,message:da};w.postMessage(ea,window.location.origin);}},_startCallInChildWindow:function(){if(w){var da={type:s,nonce:y};w.postMessage(da,window.location.origin);}}};p(ca,{messageReceived:true,multiwayMessageReceived:true});f.exports=ca;},null);
__d('FBRTCMessageHandler',['Bootloader','FBRTCMessageListener','invariant','FBRTCSupport'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=null,m=false,n=null,o={init:function(){if(!m&&k.isReceiveWebrtcSupported()){m=true;i.init(false);i.once('messageReceived',function(r){p();});i.once('multiwayMessageReceived',function(r){q();});}},resetListener:function(){!l?j(0):undefined;i.removeMessageHandler();i.setMessageHandler(l.onMessageReceived,l);}};function p(){if(!l)h.loadModules(["FBRTCIncomingCallController","FBRTCIncomingCallDialog","FBRTCMissedVideoCallHandler","FBRTCUnsupportedBrowserMessage"],function(r,s,t,u){l=new r(s,u,new t());i.setMessageHandler(l.onMessageReceived,l);});}function q(){if(!n)h.loadModules(["FBRTCGroupCallIncomingController"],function(r){n=new r();i.setMultiwayMessageHandler(n.onMessageReceived,n);});}f.exports=o;},null);
__d('HotLikeSound',['MercuryConfig','SoundPlayer','StickerConstants'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();i.init(['audio/ogg','audio/mpeg']);var k=[h['sound.hot_like_grow_mp3_url'],h['sound.hot_like_grow_ogg_url']],l=[h['sound.hot_like_pop_mp3_url'],h['sound.hot_like_pop_ogg_url']],m=[h['sound.hot_like_outgoing_small_mp3_url'],h['sound.hot_like_outgoing_small_ogg_url']],n=[h['sound.hot_like_outgoing_medium_mp3_url'],h['sound.hot_like_outgoing_medium_ogg_url']],o=[h['sound.hot_like_outgoing_large_mp3_url'],h['sound.hot_like_outgoing_large_ogg_url']],p=function(){return false;},q={setCheckSoundEnabledFunc:function(r){p=r;},start:function(){this._play(k);},stop:function(){i.stop(k);},pop:function(){this.stop();this._play(l);},snap:function(r){this.stop();if(r===j.HOT_LIKE_SMALL_STICKER_ID)this._play(m);if(r===j.HOT_LIKE_MEDIUM_STICKER_ID)this._play(n);if(r===j.HOT_LIKE_LARGE_STICKER_ID)this._play(o);},_play:function(r){if(p())i.play(r);}};f.exports=q;},null);
__d('MNCommerceDialogStateStore',['FluxStore','MessengerDispatcher','MNCommerceActionTypes'],function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();k=babelHelpers.inherits(m,h);l=k&&k.prototype;function m(){l.constructor.call(this,i);this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;}m.prototype.__onDispatch=function(n){var o=n.type;switch(o){case j.DIALOG.SHOW:this.$MNCommerceDialogStateStore1=n.dialogContainer;this.$MNCommerceDialogStateStore2=n.state;this.__emitChange();break;case j.DIALOG.HIDE:this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;this.__emitChange();break;}};m.prototype.getDialogContainer=function(){return this.$MNCommerceDialogStateStore1;};m.prototype.getState=function(){return this.$MNCommerceDialogStateStore2;};f.exports=new m();},null);
__d('PureStoreBasedStateMixin',['StoreBasedStateMixinHelper','invariant','setImmediate'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=function(){for(var l=arguments.length,m=Array(l),n=0;n<l;n++)m[n]=arguments[n];return {getInitialState:function(){return this.constructor.calculateState();},componentWillMount:function(){!this.constructor.calculateState?i(0):undefined;this._recalculateStateID=null;var o=function(){if(this.isMounted())this.setState(this.constructor.calculateState());this._recalculateStateID=null;}.bind(this);this._mixin=new h(m);this._mixin.subscribeCallback(function(){if(this._recalculateStateID===null)this._recalculateStateID=j(o);}.bind(this));},componentWillUnmount:function(){this._mixin.release();this._mixin=null;}};}.bind(this);f.exports=k;},null);
__d('MNCommerceDialogContainer.react',['MNCommerceDialogStateStore','PureStoreBasedStateMixin','React'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=j.createClass({displayName:'MNCommerceDialogContainer',mixins:[i(h)],statics:{calculateState:function(){var l=h.getDialogContainer();return {dialogContainer:l};}},render:function(){var l=this.state.dialogContainer;if(!l)return null;return j.createElement(l,null);}});f.exports=k;},null);
__d('MercuryChannelMessageTransformer',['MercuryActionType'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j,k){var l={author:j.mercury_author_id,author_email:j.mercury_author_email,body:j.body,subject:j.subject,has_attachment:j.has_attachment,attachments:j.attachments,ephemeral_ttl_mode:j.ephemeral_ttl_mode,html_body:j.html_body,thread_id:j.tid,thread_fbid:j.thread_fbid&&j.thread_fbid.toString(),other_user_fbid:j.other_user_fbid&&j.other_user_fbid.toString(),offline_threading_id:j.offline_threading_id,message_id:j.mid,is_spoof_warning:j.is_spoof_warning,ranges:j.ranges,source:j.mercury_source,source_tags:j.mercury_source_tags,tags:j.tags&&j.tags.split(','),threading_id:j.threading_id,timestamp:j.timestamp,timestamp_absolute:j.timestamp_absolute,timestamp_relative:j.timestamp_relative,timestamp_datetime:j.timestamp_datetime,timestamp_time_passed:j.timestamp_time_passed,action_type:h.USER_GENERATED_MESSAGE,is_unread:j.is_unread,is_forward:false,forward_count:j.forward_count||j.forward,forward_message_ids:j.forward_msg_ids,folder:k,sync_id:undefined,action_id:undefined};if('sync_id' in j){l.sync_id=j.sync_id;}else l.action_id=j.action_id;return l;}f.exports={transform:i};},null);
__d('MercuryDelayedDispatcher',['MercuryDispatcher','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();function m(o){this.$MercuryDelayedDispatcher1=o;this.$MercuryDelayedDispatcher2=[];this.$MercuryDelayedDispatcher3=l.getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4=h.getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher5=j.getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher6=i.getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4.subscribe('model-update-completed',function(p,q){return this.$MercuryDelayedDispatcher7();}.bind(this));}m.getForFBID=function(o){return n.getForFBID(o);};m.get=function(){return n.get();};m.prototype.handleUpdateWaitForThread=function(o,p){var q=this.$MercuryDelayedDispatcher3.getClientIDFromServerIDNow(p);if(q){this.$MercuryDelayedDispatcher8(o);return;}this.$MercuryDelayedDispatcher3.getClientIDFromServerID(p,function(){return this.$MercuryDelayedDispatcher2.push(o);}.bind(this));this.$MercuryDelayedDispatcher5.ensureThreadIsFetched(p);};m.prototype.$MercuryDelayedDispatcher7=function(){if(this.$MercuryDelayedDispatcher2&&this.$MercuryDelayedDispatcher2.length){var o=this.$MercuryDelayedDispatcher2[0];this.$MercuryDelayedDispatcher2=this.$MercuryDelayedDispatcher2.slice(1);this.$MercuryDelayedDispatcher8(o);}};m.prototype.$MercuryDelayedDispatcher8=function(o){if(o.from_client){this.$MercuryDelayedDispatcher4.handleUpdate(o);}else this.$MercuryDelayedDispatcher6.handleUpdate(o);};var n=new k(m);f.exports=m;},null);
__d('MercuryChannelHandler',['Arbiter','ChannelConstants','MercuryActionType','MercuryChannelMessageTransformer','MercuryConfig','MercuryDelayedDispatcher','MercuryGlobalActionType','MercuryLogMessageType','MercuryMessages','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySingletonMixin','MercuryThreadInformer','MercuryViewer','MessagingEvent','MessagingTag','PresenceUtil','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z,aa;if(c.__markCompiled)c.__markCompiled();z=babelHelpers.inherits(ba,y(s));aa=z&&z.prototype;function ba(ca){'use strict';aa.constructor.call(this);this.$MercuryChannelHandler1=ca;this.__payloadPreprocessor=r.getForFBID(this.$MercuryChannelHandler1);this.$MercuryChannelHandler2=t.getForFBID(this.$MercuryChannelHandler1);this.$MercuryChannelHandler3=p.getForFBID(this.$MercuryChannelHandler1);this.__delayedDispatcher=m.getForFBID(this.$MercuryChannelHandler1);this.$MercuryChannelHandler4=[];}ba.prototype.getInstanceFBID=function(){'use strict';return this.$MercuryChannelHandler1;};ba.prototype.$MercuryChannelHandler5=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||!da.obj.message)return;var ea=da.obj.message,fa=ea.other_user_fbid?ea.other_user_fbid:ea.thread_fbid;fa=fa.toString();var ga=k.transform(ea,da.obj.folder);if(this.__shouldDropMessageBecauseOfSync(ea))return;var ha=[babelHelpers['extends']({},ga)];ha=ha.concat(ea.forward_actions||[]);var ia=q.CLIENT_CHANNEL_MESSAGE;this.__delayedDispatcher.handleUpdateWaitForThread({actions:ha,payload_source:ia},fa);};ba.prototype.$MercuryChannelHandler7=function(ca,da){'use strict';if(l.WWWSyncDeliveryReceipt)return;var ea=da.obj.other_user_fbid,fa=da.obj.thread_fbid;if(!this.$MercuryChannelHandler6(ca)||!ea&&!fa)return;this.__payloadPreprocessor.handleUpdate({delivery_receipts:[{other_user_fbid:ea?ea.toString():'',thread_fbid:fa?fa.toString():'',time:da.obj.timestamp}]});};ba.prototype.$MercuryChannelHandler8=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||!da.obj.thread_fbids&&!da.obj.other_user_fbids)return;var ea=[],fa=da.obj.event==v.READ;if(fa&&l.WWWSyncMarkRead)return;(da.obj.thread_fbids||[]).forEach(function(ga){ea.push({action_type:j.CHANGE_READ_STATUS,action_id:null,thread_fbid:ga,mark_as_read:fa,timestamp:da.obj.timestamp||0,folder:da.obj.folder_info[ga]});});(da.obj.other_user_fbids||[]).forEach(function(ga){ea.push({action_type:j.CHANGE_READ_STATUS,action_id:null,other_user_fbid:ga,mark_as_read:fa,timestamp:da.obj.timestamp||0,folder:da.obj.folder_info[ga]});});this.__payloadPreprocessor.handleUpdate({actions:ea,payload_source:q.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler9=function(ca,da){'use strict';if(l.WWWSyncThreadDelete)return;if(!this.$MercuryChannelHandler6(ca)||!da.obj||!(da.obj.thread_fbids||da.obj.other_user_fbids))return;var ea=[];(da.obj.thread_fbids||[]).forEach(function(fa){ea.push({action_type:j.DELETE_THREAD,action_id:null,thread_fbid:fa});});(da.obj.other_user_fbids||[]).forEach(function(fa){ea.push({action_type:j.DELETE_THREAD,action_id:null,other_user_fbid:fa});});this.__payloadPreprocessor.handleUpdate({actions:ea,payload_source:q.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler10=function(ca,da){'use strict';if(l.WWWSyncDeleteMessage)return;if(!this.$MercuryChannelHandler6(ca)||!da.obj||!da.obj.thread_fbids&&!da.obj.other_user_fbids||!da.obj.mids)return;var ea=da.obj.thread_fbids.length?da.obj.thread_fbids[0]:null,fa=da.obj.other_user_fbids.length?da.obj.other_user_fbids[0]:null,ga={action_type:j.DELETE_MESSAGES,action_id:null,thread_fbid:ea,other_user_fbid:fa,message_ids:da.obj.mids};if(l.MessengerGlobalDeleteGK){if(da.obj.updated_thread)return;this.__payloadPreprocessor.handleUpdate({actions:[ga],payload_source:q.CLIENT_CHANNEL_MESSAGE});return;}this.__payloadPreprocessor.handleUpdate({actions:[ga],payload_source:q.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler11=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||!da.obj.folder)return;var ea={action_type:n.MARK_ALL_READ,action_id:da.obj.action_id,folder:da.obj.folder};this.__payloadPreprocessor.handleUpdate({global_actions:[ea]});};ba.prototype.$MercuryChannelHandler12=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj.thread_fbids&&!da.obj.other_user_fbids)return;var ea=q.CLIENT_CHANNEL_MESSAGE;(da.obj.thread_fbids||[]).forEach(function(fa){var ga={action_type:j.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:fa.toString(),other_user_fbid:null,archived:da.obj.state};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers['extends']({},ga)],payload_source:ea},fa.toString());},this);(da.obj.other_user_fbids||[]).forEach(function(fa){var ga={action_type:j.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:null,other_user_fbid:fa.toString(),archived:da.obj.state};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers['extends']({},ga)],payload_source:ea},fa.toString());},this);};ba.prototype.$MercuryChannelHandler13=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj.thread_fbids&&!da.obj.other_user_fbids)return;var ea=q.CLIENT_CHANNEL_MESSAGE,fa;(da.obj.thread_fbids||[]).forEach(function(ga){if(da.obj.event==v.TAG){fa=da.obj.tag;}else fa=da.obj.marked_as_spam?w.SPAM:w.INBOX;var ha={action_type:j.CHANGE_FOLDER,action_id:null,thread_fbid:ga.toString(),other_user_fbid:null,new_folder:fa};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers['extends']({},ha)],payload_source:ea},ga.toString());},this);(da.obj.other_user_fbids||[]).forEach(function(ga){if(da.obj.event==v.TAG){fa=da.obj.tag;}else fa=da.obj.marked_as_spam?w.SPAM:w.INBOX;var ha={action_type:j.CHANGE_FOLDER,action_id:null,other_user_fbid:ga.toString(),thread_fbid:null,new_folder:fa};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers['extends']({},ha)],payload_source:ea},ga.toString());},this);};ba.prototype.$MercuryChannelHandler14=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj.tag)return;switch(da.obj.tag){case w.ACTION_ARCHIVED:this.$MercuryChannelHandler12(ca,da);break;case w.INBOX:case w.OTHER:this.$MercuryChannelHandler13(ca,da);break;}};ba.prototype.__markAsSeen=function(ca,da){'use strict';if(!this.$MercuryChannelHandler15(ca)||!da.obj||!da.obj.seen_timestamp)return;this.__payloadPreprocessor.handleUpdate({message_counts:[{seen_timestamp:da.obj.seen_timestamp,folder:w.INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:w.INBOX}],payload_source:q.CLIENT_CHANNEL_MESSAGE});};ba.prototype.__updateModelsFromMercuryPayload=function(ca,da){'use strict';if(!this.$MercuryChannelHandler16(ca)||!da.obj)return;this.$MercuryChannelHandler2.synchronizeInforms(function(){var ea=da.obj,fa=[];(ea.actions||[]).forEach(function(ga){var ha=j.USER_GENERATED_MESSAGE;if(ga.action_type==j.LOG_MESSAGE){if(this.__shouldDropLogMessageBecauseOfSync(ga))return;var ia=q.CLIENT_CHANNEL_MESSAGE,ja;ja=ga.other_user_fbid||ga.thread_fbid;this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers['extends']({},ga)],payload_source:ia},ja);}else if(ga.action_type!=ha)fa.push(ga);},this);ea.actions=fa;ea.payload_source=q.CLIENT_CHANNEL_MESSAGE;this.__payloadPreprocessor.handleUpdate(ea);}.bind(this));};ba.prototype.$MercuryChannelHandler17=function(ca,da){var ea,fa;'use strict';if(l.WWWSyncReadReceipt)return;var ga=da.obj.time,ha=da.obj.reader,ia=da.obj.thread_fbid||'';this.__payloadPreprocessor.handleUpdate({roger:(fa={},fa[ia]=(ea={},ea[ha]=ga,ea),fa)});};ba.prototype.$MercuryChannelHandler18=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||da.obj.message_blocked===undefined||!da.obj.thread_fbid)return;var ea=j.UPDATE_BLOCKER_STATUS,fa=[{action_type:ea,action_id:null,thread_fbid:da.obj.thread_fbid,message_blocked:da.obj.message_blocked,is_blocked_by_recipient:da.obj.is_blocked_by_recipient}];this.__payloadPreprocessor.handleUpdate({actions:fa,payload_source:q.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler19=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||da.obj.got_blocked===undefined||!da.obj.thread_fbid)return;var ea=j.UPDATE_BLOCKEE_STATUS,fa=[{action_type:ea,action_id:null,thread_fbid:da.obj.thread_fbid,got_blocked:da.obj.got_blocked}];this.__payloadPreprocessor.handleUpdate({actions:fa,payload_source:q.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler20=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||da.obj.mute_settings===undefined||!da.obj.thread_fbid&&!da.obj.other_user_fbid)return;var ea=j.CHANGE_MUTE_SETTINGS,fa=[{action_type:ea,action_id:null,thread_fbid:da.obj.thread_fbid,other_user_fbid:da.obj.other_user_fbid,mute_settings:da.obj.mute_settings}];this.__payloadPreprocessor.handleUpdate({actions:fa,payload_source:q.CLIENT_CHANNEL_MESSAGE});};ba.prototype.__handleMessagingPayload=function(ca,da){'use strict';switch(da.obj.event){case v.DELIVER:this.$MercuryChannelHandler5(ca,da);break;case v.DELIVERY_RECEIPT:this.$MercuryChannelHandler7(ca,da);break;case v.READ:case v.UNREAD:this.$MercuryChannelHandler8(ca,da);break;case v.READ_ALL:this.$MercuryChannelHandler11(ca,da);break;case v.DELETE:this.$MercuryChannelHandler9(ca,da);break;case v.DELETE_MESSAGES:this.$MercuryChannelHandler10(ca,da);break;case v.TAG:this.$MercuryChannelHandler14(ca,da);break;case v.REPORT_SPAM:this.$MercuryChannelHandler13(ca,da);break;case v.READ_RECEIPT:this.$MercuryChannelHandler17(ca,da);break;case v.CHANGE_MUTE_SETTINGS:this.$MercuryChannelHandler20(ca,da);break;case v.UPDATE_BLOCKER_STATUS:this.$MercuryChannelHandler18(ca,da);break;case v.UPDATE_BLOCKEE_STATUS:this.$MercuryChannelHandler19(ca,da);break;}};ba.prototype.getRouting=function(){'use strict';return {mercury:this.__updateModelsFromMercuryPayload,messaging:this.__handleMessagingPayload,inbox:this.__markAsSeen};};ba.prototype.__getMessagingPayloadType=function(){'use strict';return i.getArbiterType('messaging');};ba.prototype.__getMercuryPayloadType=function(){'use strict';return i.getArbiterType('mercury');};ba.prototype.__getInboxPayloadType=function(){'use strict';return i.getArbiterType('inbox');};ba.prototype.$MercuryChannelHandler6=function(ca){'use strict';return ca==this.__getMessagingPayloadType();};ba.prototype.$MercuryChannelHandler16=function(ca){'use strict';return ca==this.__getMercuryPayloadType();};ba.prototype.$MercuryChannelHandler15=function(ca){'use strict';return ca==this.__getInboxPayloadType();};ba.prototype.turnOn=function(){'use strict';if(!this.$MercuryChannelHandler4.length){var ca=this.getRouting();for(var da in ca)this.$MercuryChannelHandler4.push(h.subscribe(i.getArbiterType(da),ca[da].bind(this)));}return this;};ba.prototype.turnOff=function(){'use strict';if(this.$MercuryChannelHandler4.length){this.$MercuryChannelHandler4.forEach(h.unsubscribe);this.$MercuryChannelHandler4=[];}return this;};ba.prototype.__shouldDropMessageBecauseOfSync=function(ca){'use strict';if(!ca.has_attachment&&l.WWWSyncMsgText){return true;}else if(ca.has_attachment&&l.WWWSyncMsgAttach)return true;return false;};ba.prototype.__shouldDropLogMessageBecauseOfSync=function(ca){'use strict';if(l.WWWSyncMsgLog)switch(ca.log_message_type){case o.UNSUBSCRIBE:case o.SUBSCRIBE:case o.THREAD_NAME:case o.VIDEO_CALL:case o.PHONE_CALL:case o.THREAD_IMAGE:case o.ORION:case o.PAGE_REPLY:case o.GENERIC_ADMIN_TEXT:return true;case o.SERVER_ERROR:case o.LIVE_LISTEN:case o.SWITCH_TO_WORK:case o.WALLPAPER:default:break;}return false;};Object.assign(ba,s);f.exports=ba;},null);
__d('MercuryDeliveryReceipts',['ArbiterMixin','Map','MercuryDispatcher','MercurySingletonProvider','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l){var m,n;if(c.__markCompiled)c.__markCompiled();m=babelHelpers.inherits(o,l(h));n=m&&m.prototype;function o(q){'use strict';n.constructor.call(this);this.$MercuryDeliveryReceipts2=q;this.$MercuryDeliveryReceipts3=new i();this.$MercuryDeliveryReceipts1=j.getForFBID(this.$MercuryDeliveryReceipts2);this.$MercuryDeliveryReceipts1.subscribe('update-delivery',function(r,s){if(s.delivery_receipts)for(var t in s.delivery_receipts){var u=s.delivery_receipts[t],v=this.$MercuryDeliveryReceipts3.get(t)||0;if(u>v){this.$MercuryDeliveryReceipts3.set(t,u);this.informDeliveryStatusChanged(t);}}}.bind(this));}o.getForFBID=function(q){'use strict';return p.getForFBID(q);};o.get=function(){'use strict';return p.get();};o.prototype.informDeliveryStatusChanged=function(q){'use strict';var r=new i();r.set(q,true);this.inform('change',r);};o.prototype.getDeliveryTime=function(q){'use strict';return this.$MercuryDeliveryReceipts3.get(q)||0;};var p=new k(o);f.exports=o;},null);
__d('MercuryDeliveryState',['MercuryConfig','MercuryIDs','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInformer','PresencePrivacy','UserActivity','debounceAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=h.delivery_timeout||120000;r.getForFBID=function(t){return s.getForFBID(t);};r.get=function(){return s.get();};function r(t){this.$MercuryDeliveryState1=t;this.$MercuryDeliveryState2=j.getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState3=m.getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState4=l.getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState5=[];this.$MercuryDeliveryState6=[];this.$MercuryDeliveryState3.subscribe('messages-received',this.$MercuryDeliveryState7.bind(this));o.subscribe(p(this.$MercuryDeliveryState8,300,this));}r.prototype.$MercuryDeliveryState7=function(t,u){for(var v in u){var w=u[v];w.forEach(function(x){if(this.$MercuryDeliveryState9(x)){this.$MercuryDeliveryState5.push(x);this.$MercuryDeliveryState4.getServerIDFromClientID(v,function(y){if(!this.$MercuryDeliveryState6[y])this.$MercuryDeliveryState6[y]=[];this.$MercuryDeliveryState6[y].push(x.message_id);}.bind(this));}}.bind(this));}if(o.isActive(q))this.$MercuryDeliveryState8();};r.prototype.$MercuryDeliveryState8=function(){if(this.$MercuryDeliveryState5.length===0&&this.$MercuryDeliveryState6.length===0)return;var t=this.$MercuryDeliveryState5.map(function(u){return u.message_id;});if(t)this.$MercuryDeliveryState2.sendDeliveryReceipts(t,this.$MercuryDeliveryState6);this.$MercuryDeliveryState6=[];this.$MercuryDeliveryState5=[];};r.prototype.$MercuryDeliveryState9=function(t){var u=t.author?i.getUserIDFromParticipantID(t.author):null;if(u===this.$MercuryDeliveryState1)return false;if(!t.is_unread)return false;if(!n.allows(u))return false;return true;};var s=new k(r);f.exports=r;},null);
__d('MercuryOrderedThreadlist',['LogHistory','MercuryActionType','MercuryDispatcher','MercuryFilters','MercuryFolders','MercuryPayloadSource','MercurySingletonMixin','MercuryThreadIDMap','MessagingTag','PageMessageEnumTag','RangedCallbackManager','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','arrayContains'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){'use strict';if(c.__markCompiled)c.__markCompiled();var w=h.getInstance('ordered_threadlist_model'),x=k.getSupportedFilters().concat([k.ALL,p.GROUPS]),y=l.getSupportedFolders().concat([p.SPAM]);function z(ja,ka,la,ma){var na=[],oa=false,pa=false,qa=(ka||[]).filter(function(xa){var ya=xa.filter||k.ALL;return (xa.folder==la||!xa.folder&&la==p.INBOX)&&ya==ma;}),ra=ja._threadlistOrderMap[la][ma].getAllResources(),sa;qa.forEach(function(xa){na=na.concat(xa.thread_ids);if(xa.error){if(xa.end>ra.length)pa=xa.error;}else{var ya=xa.end-xa.start;if(xa.thread_ids.length<ya)oa=true;}if(!sa||xa.end>sa)sa=xa.end;});da(ja,na,la,ma);if(oa){ja._threadlistOrderMap[la][ma].setReachedEndOfArray();}else if(pa){ja._threadlistOrderMap[la][ma].setError(pa);}else{var ta=ja._threadlistOrderMap[la][ma].getCurrentArraySize();if(sa&&ta<sa){var ua={},va=ra.concat(na),wa=va.filter(function(xa){var ya=ua[xa];ua[xa]=true;return ya;});if(wa.length){w.warn('duplicate_threads',JSON.stringify({folder:la,expected_final_size:sa,actual_final_size:ta,duplicate_thread_ids:wa}));ja._serverRequests.fetchThreadlistInfo(sa,wa.length,la,ma==k.ALL?null:ma);}}}}function aa(ja,ka){y.forEach(function(la){x.forEach(function(ma){z(ja,ka,la,ma);});});}function ba(ja,ka){var la={};y.forEach(function(ma){la[ma]={};x.forEach(function(na){la[ma][na]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});});ka.forEach(function(ma){if(ma.is_forward)return;var na=ma.thread_id,oa=ea(ja,na),pa=fa(ja,na);function qa(){pa.forEach(function(sa){if(!v(x,sa))return;la[oa][sa].to_add.push(na);if(!ja._threadlistOrderMap[oa][sa].hasReachedEndOfArray()&&!ja._threadlistOrderMap[oa][sa].hasResource(na))la[oa][sa].to_remove_if_last_after_add[na]=true;});}function ra(sa){if(v(x,sa))if(v(pa,sa)){la[oa][sa].to_add.push(na);}else la[oa][sa].to_remove.push(na);}if(!oa){if(ma.action_type===i.CHANGE_FOLDER||ma.action_type===i.CHANGE_ARCHIVED_STATUS)y.forEach(function(sa){if(sa!==oa)x.forEach(function(ta){ja._threadlistOrderMap[sa][ta].removeResources([na]);});});return;}switch(ma.action_type){case i.DELETE_THREAD:pa.forEach(function(sa){if(!v(x,sa))return;la[oa][sa].to_remove.push(na);});break;case i.CHANGE_ARCHIVED_STATUS:case i.CHANGE_FOLDER:qa();break;case i.CHANGE_READ_STATUS:ra(p.UNREAD);break;case i.USER_GENERATED_MESSAGE:case i.LOG_MESSAGE:pa.forEach(function(sa){if(!v(x,sa))return;if(ga(ja,na,oa,sa))la[oa][sa].to_add.push(na);});break;case i.CHANGE_FLAG:ra(q.FLAG);break;}});y.forEach(function(ma){x.forEach(function(na){var oa=ja._threadlistOrderMap[ma][na];da(ja,la[ma][na].to_add,ma,na);for(var pa=oa.getCurrentArraySize()-1;pa>=0;pa--){var qa=oa.getResourceAtIndex(pa);if(!la[ma][na].to_remove_if_last_after_add[qa])break;la[ma][na].to_remove.push(qa);}oa.removeResources(la[ma][na].to_remove);});});}function ca(ja,ka){var la={};y.forEach(function(ma){la[ma]={};x.forEach(function(na){la[ma][na]=[];});});ka.forEach(function(ma){var na=ea(ja,ma.thread_id),oa=fa(ja,ma.thread_id);if(na)oa.forEach(function(pa){if(ga(ja,ma.thread_id,na,pa))la[na][pa].push(ma.thread_id);});});y.forEach(function(ma){x.forEach(function(na){if(la[ma][na].length>0)da(ja,la[ma][na],ma,na);});});}function da(ja,ka,la,ma){ma=ma||k.ALL;ja._threadlistOrderMap[la][ma].addResources(ka);y.forEach(function(na){if(na!=la)ja._threadlistOrderMap[na][ma].removeResources(ka);});}function ea(ja,ka){var la=ja._threads.getThreadMetaNow(ka),ma=null;if(!la){ma='No thread metadata';}else if(!la.folder)ma='No thread folder';if(ma){var na={error:ma,tid:ka};w.warn('no_thread_folder',JSON.stringify(na));return null;}var oa=la.folder;if(la.is_archived)oa=p.ACTION_ARCHIVED;if(ja._threadlistOrderMap[oa]){return oa;}else return null;}function fa(ja,ka){var la=ja._threads.getThreadMetaNow(ka),ma=[k.ALL];if(!la){var na={error:'no_thread_metadata',tid:ka};w.warn('no_thread_metadata',JSON.stringify(na));return [];}if(la.unread_count)ma.push(p.UNREAD);if(!la.is_canonical)ma.push(p.GROUPS);var oa=la.page_thread_info;if(oa&&oa.flagged)ma.push(q.FLAG);return ma;}function ga(ja,ka,la,ma){var na=ja._threads.getThreadMetaNow(ka);return !!(na&&na.timestamp&&ea(ja,ka)==la&&v(fa(ja,ka),ma));}function ha(ja){this._fbid=ja;this._serverRequests=s.getForFBID(this._fbid);this._threadIDMap=o.getForFBID(this._fbid);this._threadInformer=t.getForFBID(this._fbid);this._threads=u.getForFBID(this._fbid);this._dispatcher=j.getForFBID(this._fbid);this._threadlistOrderMap={};this._initializeThreadlistOrderMap();this._dispatcher.subscribe('update-threadlist',function(ka,la){if(!ia(la))return;var ma=la.ordered_threadlists;if(ma&&ma.length){aa(this,ma);}else{var na=(la.actions||[]).filter(function(oa){return oa.thread_id;});ca(this,la.threads||[]);ba(this,na);}this._threadInformer.updatedThreadlist();}.bind(this));this._dispatcher.subscribe('invalidate-global-state',function(){return this._invalidateGlobalState();}.bind(this));}Object.assign(ha.prototype,{getThreadlistOrderMap:function(ja,ka){if(!this._threadlistOrderMap[ja][ka]){x=x.concat([ka]);y.forEach(function(la){this._threadlistOrderMap[la][ka]=new r(function(ma){return this._threads.getThreadMetaNow(ma).timestamp;}.bind(this),function(ma,na){return na-ma;},this._threadIDMap.canLinkExternally.bind(this._threadIDMap));}.bind(this));}return this._threadlistOrderMap[ja][ka];},getThreadlist:function(ja,ka,la,ma,na,oa){return this.getFilteredThreadlist(ja,ka,la,k.ALL,ma,na,oa);},getFilteredThreadlist:function(ja,ka,la,ma,na,oa,pa){var qa=this.getThreadlistOrderMap(la,ma),ra=qa.executeOrEnqueue(ja,ka,na,oa),sa=qa.getUnavailableResources(ra),ta=qa.getError(ja,ka,oa);if(sa.length||ta){if(qa.getCurrentArraySize()<ja){var ua={start:ja,limit:ka,filter:ma,resources_size:qa.getCurrentArraySize()};w.warn('range_with_gap',JSON.stringify(ua));}qa.setError(false);this._serverRequests.fetchThreadlistInfo(qa.getCurrentArraySize(),sa.length,la,ma==k.ALL?null:ma,pa);}return ra;},getThreadlistUntilTimestamp:function(ja,ka,la){la=la||k.ALL;return this.getThreadlistOrderMap(ka,la).getElementsUntil(ja);},getAvailableThreadlistNow:function(ja,ka){ka=ka||k.ALL;return this.getThreadlistOrderMap(ja,ka).getAllResources();},getThreadCount:function(ja,ka){ka=ka||k.ALL;return this.getThreadlistOrderMap(ja,ka).getCurrentArraySize();},hasLoadedThreadlist:function(ja,ka){ka=ka||k.ALL;return this.getThreadlistOrderMap(ja,ka).hasReachedEndOfArray();},unsubscribe:function(ja,ka,la){la=la||k.ALL;this.getThreadlistOrderMap(ka,la).unsubscribe(ja);},_invalidateGlobalState:function(){this._threadlistOrderMap={};this._initializeThreadlistOrderMap();},_initializeThreadlistOrderMap:function(){y.forEach(function(ja){this._threadlistOrderMap[ja]={};x.forEach(function(ka){this._threadlistOrderMap[ja][ka]=new r(function(la){return this._threads.getThreadMetaNow(la).timestamp;}.bind(this),function(la,ma){return ma-la;},this._threadIDMap.canLinkExternally.bind(this._threadIDMap));}.bind(this));}.bind(this));}});Object.assign(ha,n);function ia(ja){switch(ja.payload_source){case m.CLIENT_CHANGE_ARCHIVED_STATUS:case m.CLIENT_CHANGE_READ_STATUS:case m.CLIENT_CHANGE_FOLDER:case m.CLIENT_CHANNEL_MESSAGE:case m.CLIENT_DELETE_MESSAGES:case m.CLIENT_DELETE_THREAD:case m.CLIENT_SEND_MESSAGE:case m.SERVER_SEND_MESSAGE:case m.SERVER_FETCH_THREADLIST_INFO:case m.SERVER_THREAD_SYNC:case m.SERVER_INVALIDATE_GLOBAL_STATE:return true;case m.SERVER_INITIAL_DATA:return !!ja.ordered_threadlists;default:return false;}}f.exports=ha;},null);
__d('MercuryStateCheck',['Arbiter','ChannelConstants','LogHistory','MercuryAPIArgsSource','MercuryConfig','MercuryFolders','MercuryOrderedThreadlist','MercuryServerRequests','MercurySingletonProvider','MercurySyncFakeDFFSender','MessagingTag','URI','requireWeak'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=j.getInstance('mercury_state_check');v.getForFBID=function(x){'use strict';return w.getForFBID(x);};v.get=function(){'use strict';return w.get();};function v(x){'use strict';this.$MercuryStateCheck1=x;this.$MercuryStateCheck3=o.getForFBID(this.$MercuryStateCheck1);this.$MercuryStateCheck2=n.getForFBID(this.$MercuryStateCheck1);h.subscribe(i.ON_INVALID_HISTORY,this.$MercuryStateCheck4.bind(this,i.ON_INVALID_HISTORY));t('ChannelConnection',function(y){y.subscribe(y.CONNECTED,function(z,aa){if(!aa.init)this.$MercuryStateCheck5(y.CONNECTED);}.bind(this));}.bind(this));}v.prototype.$MercuryStateCheck4=function(x){'use strict';var y;if(s.getRequestURI().getPath().search(/messages/)!==-1){y=m.getSupportedFolders();}else y=[r.INBOX];u.debug('check',JSON.stringify({folders:y,source:x}));if(l.WWWSyncGlobalDFFOnChannelReconnect){q.sendGlobalDFF();}else this.$MercuryStateCheck3.fetchMissedMessages(y,k.MERCURYSYNC);};v.prototype.$MercuryStateCheck5=function(x){'use strict';var y=this.$MercuryStateCheck2.getAvailableThreadlistNow(r.INBOX)||[];y=y.slice(0,20);u.debug('full_check',JSON.stringify({source:x}));this.$MercuryStateCheck3.fetchThreadData(y,k.MERCURYSYNC);this.$MercuryStateCheck4(x);};var w=new p(v);f.exports=v;},null);
__d('MercurySyncDeltaHolder',['Map'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(){this.$MercurySyncDeltaHolder1=new h();this.$MercurySyncDeltaHolder2=[];}i.prototype.peek=function(){this.$MercurySyncDeltaHolder2=this.$MercurySyncDeltaHolder2.sort(function(j,k){return j-k;});return this.$MercurySyncDeltaHolder2[0];};i.prototype.pop=function(){this.$MercurySyncDeltaHolder2=this.$MercurySyncDeltaHolder2.sort(function(l,m){return l-m;});if(this.$MercurySyncDeltaHolder2.length===0)return undefined;var j=this.$MercurySyncDeltaHolder2.shift(),k=this.$MercurySyncDeltaHolder1.get(j);this.$MercurySyncDeltaHolder1['delete'](j);return {seqID:j,delta:k};};i.prototype.push=function(j,k){if(this.$MercurySyncDeltaHolder1.has(j))return;this.$MercurySyncDeltaHolder1.set(j,k);this.$MercurySyncDeltaHolder2.push(j);};f.exports=i;},null);
__d('MercurySyncNewMessageTransformer',['IrisProtocolMessageLifetime','MercuryActionType','MercuryIDs','MercuryTimestamp','MessagingTag'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();function m(n,o){var p=parseInt(o.messageMetadata.timestamp,10),q=k.getFormatedTimestamp(p),r=[];if(o.attachments)r=o.attachments.map(function(t){return t.mercury;});var s=o.messageMetadata.tags?o.messageMetadata.tags[0]:undefined;return {message_id:o.messageMetadata.messageId,threading_id:null,offline_threading_id:o.messageMetadata.offlineThreadingId,author:j.getParticipantIDFromUserID(o.messageMetadata.actorFbId),author_email:o.messageMetadata.actorFbId+'@facebook.com',ephemeral_ttl_mode:o.ttl?h[o.ttl]:0,timestamp:p,timestamp_absolute:q.absolute,timestamp_relative:q.relative,timestamp_datetime:q.relative,timestamp_time_passed:k.getTimeBucket(p),is_unread:n!==o.messageMetadata.actorFbId,is_forward:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,forward_count:0,forward_message_ids:[],source:s,tags:o.messageMetadata.tags,is_spoof_warning:false,folder:l.INBOX,thread_fbid:o.messageMetadata.threadKey.threadFbId,other_user_fbid:o.messageMetadata.threadKey.otherUserFbId,body:o.body!==undefined?o.body:'',html_body:null,subject:null,has_attachment:r.length>0,attachments:r,ranges:undefined,thread_id:null,action_id:null,action_type:i.USER_GENERATED_MESSAGE,is_from_iris:true,is_sponsored:!!(o.data&&o.data.is_sponsored&&o.data.is_sponsored==='true')};}f.exports={transform:m};},null);
__d('MercurySyncAdminTextMessageTransformer',['MercuryActionType','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();function k(l,m){var n=j.transform(l,m);n.action_type=h.LOG_MESSAGE;n.log_message_body=m.messageMetadata.adminText;n.log_message_data={message_type:m.type,untypedData:m.untypedData};n.log_message_type=i.GENERIC_ADMIN_TEXT;return n;}f.exports={transform:k};},null);
__d('MercurySyncDeliveryReceiptTransformer',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return {delivery_receipts:[{other_user_fbid:i.threadKey.otherUserFbId?i.threadKey.otherUserFbId:'',thread_fbid:i.threadKey.threadFbId?i.threadKey.threadFbId:'',time:parseInt(i.deliveredWatermarkTimestampMs,10)}]};}f.exports={transform:h};},null);
__d('MercurySyncHolesTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();function k(){this.clear();}k.prototype.log=function(){i.log('logger:MercurySyncHolesLoggerConfig',this.$MercurySyncHolesTypedLogger1,h.BASIC);};k.prototype.logVital=function(){i.log('logger:MercurySyncHolesLoggerConfig',this.$MercurySyncHolesTypedLogger1,h.VITAL);};k.prototype.clear=function(){this.$MercurySyncHolesTypedLogger1={};return this;};k.prototype.updateData=function(m){this.$MercurySyncHolesTypedLogger1=babelHelpers['extends']({},this.$MercurySyncHolesTypedLogger1,m);return this;};k.prototype.setDifference=function(m){this.$MercurySyncHolesTypedLogger1.difference=m;return this;};k.prototype.setSeqID=function(m){this.$MercurySyncHolesTypedLogger1.seq_id=m;return this;};k.prototype.setTopicType=function(m){this.$MercurySyncHolesTypedLogger1.topic_type=m;return this;};k.prototype.setVC=function(m){this.$MercurySyncHolesTypedLogger1.vc=m;return this;};var l={difference:true,seq_id:true,topic_type:true,vc:true};f.exports=k;},null);
__d('MercurySyncMarkReadTransformer',['MercuryActionType','MessagingTag'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(k){return k.threadKeys.map(function(l){return {action_type:h.CHANGE_READ_STATUS,action_id:null,other_user_fbid:l.otherUserFbId,thread_fbid:l.threadFbId,mark_as_read:true,timestamp:parseInt(k.watermarkTimestamp,10),folder:i.INBOX};});}f.exports={transform:j};},null);
__d('MercurySyncMessageDeleteTransformer',['MercuryActionType'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j){return {action_id:null,action_type:h.DELETE_MESSAGES,message_ids:j.messageIds,other_user_fbid:j.threadKey.otherUserFbId,thread_fbid:j.threadKey.threadFbId};}f.exports={transform:i};},null);
__d('MercurySyncParticipantLeftGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();'use strict';function l(m,n){var o=k.transform(m,n);o.action_type=h.LOG_MESSAGE;o.log_message_body=n.messageMetadata.adminText;o.log_message_data={removed_participants:[i.getParticipantIDFromUserID(n.leftParticipantFbId)]};o.log_message_type=j.UNSUBSCRIBE;return o;}f.exports={transform:l};},null);
__d('MercurySyncParticipantsAddedToGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();'use strict';function l(m,n){var o=k.transform(m,n);o.action_type=h.LOG_MESSAGE;o.log_message_body=n.messageMetadata.adminText;o.log_message_data={added_participants:n.addedParticipants.map(function(p){return (i.getParticipantIDFromUserID(p.userFbId));})};o.log_message_type=j.SUBSCRIBE;return o;}f.exports={transform:l};},null);
__d('MercurySyncRTCEventLogTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();'use strict';function l(m,n){var o=k.transform(m,n),p=n.messageMetadata.actorFbId,q=p===m?n.messageMetadata.threadKey.otherUserFbId:m;o.action_type=h.LOG_MESSAGE;o.log_message_body=n.messageMetadata.adminText;o.log_message_data={answered:n.duration>0,callee:i.getParticipantIDFromUserID(q),caller:i.getParticipantIDFromUserID(p)};o.log_message_type=j.VIDEO_CALL;return o;}f.exports={transform:l};},null);
__d('MercurySyncReadReceiptTransformer',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){var j=parseInt(i.actionTimestampMs,10),k=i.threadKey.otherUserFbId||i.actorFbId,l=i.threadKey.otherUserFbId||i.threadKey.threadFbId,m={roger:{}};m.roger[l]={};m.roger[l][k]=j;return m;}f.exports={transform:h};},null);
__d('MercurySyncReplaceMessageTransformer',['MercuryActionType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(k,l){l=Object.assign({},l.newMessage,l);return Object.assign(i.transform(k,l),{action_type:h.REPLACE_MESSAGE,replaced_message_id:l.replacedMessageId});}f.exports={transform:j};},null);
__d('MercurySyncThreadDeleteTransformer',['MercuryActionType'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j){return j.threadKeys.map(function(k){return {action_type:h.DELETE_THREAD,action_id:null,other_user_fbid:k.otherUserFbId,thread_fbid:k.threadFbId};});}f.exports={transform:i};},null);
__d('MercurySyncThreadNameTransformer',['MercuryActionType','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();'use strict';function k(l,m){var n=j.transform(l,m);n.action_type=h.LOG_MESSAGE;n.log_message_body=m.messageMetadata.adminText;n.log_message_data={name:m.name};n.log_message_type=i.THREAD_NAME;return n;}f.exports={transform:k};},null);
__d('MercurySyncDispatcher',['Arbiter','Map','MercuryConfig','MercuryDelayedDispatcher','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySyncAdminTextMessageTransformer','MercurySyncDeliveryReceiptTransformer','MercurySyncHolesTypedLogger','MercurySyncMarkReadTransformer','MercurySyncMessageDeleteTransformer','MercurySyncNewMessageTransformer','MercurySyncReadReceiptTransformer','MercurySyncParticipantLeftGroupThreadTransformer','MercurySyncParticipantsAddedToGroupThreadTransformer','MercurySyncRTCEventLogTransformer','MercurySyncThreadDeleteTransformer','MercurySyncThreadNameTransformer','MercurySyncReplaceMessageTransformer','MercurySyncDeltaTypes','MercurySyncTopicType','MercurySingletonProvider'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){'use strict';if(c.__markCompiled)c.__markCompiled();da.getForFBID=function(fa){return ea.getForFBID(fa);};da.get=function(){return ea.get();};function da(fa){this.$MercurySyncDispatcher1=fa;this.$MercurySyncDispatcher2=k.getForFBID(this.$MercurySyncDispatcher1);this.$MercurySyncDispatcher3=m.getForFBID(this.$MercurySyncDispatcher1);}da.prototype.process=function(fa){var ga;switch(fa['class']){case aa.NewMessage:if(!this.$MercurySyncDispatcher4(fa))break;ga=s.transform(this.$MercurySyncDispatcher1,fa);this.$MercurySyncDispatcher5(ga);break;case aa.ReplaceMessage:if(!this.$MercurySyncDispatcher4(fa))break;ga=z.transform(this.$MercurySyncDispatcher1,fa);this.$MercurySyncDispatcher5(ga);break;case aa.DeliveryReceipt:if(!j.WWWSyncDeliveryReceipt)break;ga=o.transform(fa);this.$MercurySyncDispatcher3.handleUpdate(ga);break;case aa.MarkRead:if(!j.WWWSyncMarkRead)break;ga=q.transform(fa);this.$MercurySyncDispatcher6(ga);break;case aa.ParticipantLeftGroupThread:if(!j.WWWSyncMsgLog)break;ga=u.transform(this.$MercurySyncDispatcher1,fa);this.$MercurySyncDispatcher5(ga);break;case aa.ParticipantsAddedToGroupThread:if(!j.WWWSyncMsgLog)break;ga=v.transform(this.$MercurySyncDispatcher1,fa);this.$MercurySyncDispatcher5(ga);break;case aa.RTCEventLog:if(!j.WWWSyncMsgLog)break;ga=w.transform(this.$MercurySyncDispatcher1,fa);this.$MercurySyncDispatcher5(ga);break;case aa.ThreadName:if(!j.WWWSyncMsgLog)break;ga=y.transform(this.$MercurySyncDispatcher1,fa);this.$MercurySyncDispatcher5(ga);break;case aa.ReadReceipt:if(!j.WWWSyncReadReceipt)break;ga=t.transform(fa);this.$MercurySyncDispatcher3.handleUpdate(ga);break;case aa.AdminTextMessage:if(!j.WWWSyncMsgLog)break;ga=n.transform(this.$MercurySyncDispatcher1,fa);this.$MercurySyncDispatcher5(ga);break;case aa.MessageDelete:if(!j.WWWSyncDeleteMessage)break;ga=r.transform(fa);this.$MercurySyncDispatcher5(ga);break;case aa.ThreadDelete:if(!j.WWWSyncThreadDelete)break;ga=x.transform(fa);this.$MercurySyncDispatcher6(ga);break;default:break;}};da.prototype.$MercurySyncDispatcher4=function(fa){var ga=!!fa.stickerId||fa.attachments&&!!fa.attachments.length;if(!ga&&!j.WWWSyncMsgText){return false;}else if(ga&&!j.WWWSyncMsgAttach)return false;return true;};da.prototype.$MercurySyncDispatcher5=function(fa){var ga=fa.other_user_fbid||fa.thread_fbid;this.$MercurySyncDispatcher2.handleUpdateWaitForThread({actions:[fa],payload_source:l.CLIENT_CHANNEL_MESSAGE},ga);};da.prototype.$MercurySyncDispatcher6=function(fa){this.$MercurySyncDispatcher3.handleUpdate({actions:fa,payload_source:l.CLIENT_CHANNEL_MESSAGE});};var ea=new ca(da);f.exports=da;},null);
__d('MercurySyncDataFetcherImpl',['Promise','AsyncRequest','MessagingConfig','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=5000;function m(o){return new h(function(p,q){n(o,p,q,0);});}function n(o,p,q,r){if(r>j.syncFetchRetries){q();return;}var s=r===0?0:j.syncFetchInitialTimeoutMs*Math.pow(j.syncFetchTimeoutMultiplier,r);k(function(){var t=false,u=function(){if(t)return;t=true;n(o,p,q,r+1);};new i().setURI(o).setHandler(function(v){t=true;p(v);}).setErrorHandler(u).setTimeoutHandler(l,u).setAllowCrossPageTransition(true).send();},s);}f.exports={fetch:m};},null);
__d('MercurySyncDataFetcher',['Promise','MessagingConfig','MercurySyncDataFetcherImpl','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=500;function m(){var p=0;for(var q=0;q<i.syncFetchRetries;q++){var r=q===0?0:i.syncFetchInitialTimeoutMs*Math.pow(i.syncFetchTimeoutMultiplier,q);p+=r+l;}return p;}var n=m();function o(p){return new h(function(q,r){j.fetch(p).done(q,r);k(r,n);});}f.exports={fetch:o};},null);
__d("XMercuryFetchMessageController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/fetch_message\/",{other_user_or_thread_fbid:{type:"Int",required:true},mid:{type:"String",required:true}});},null);
__d("XMercuryInvalidateGlobalStateController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/invalidate_global_state\/",{});},null);
__d("XMercuryInvalidateThreadStateController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/invalidate_thread_state\/",{other_user_or_thread_fbid:{type:"Int",required:true},num_messages:{type:"Int",required:true}});},null);
__d('MercurySyncDFFDataFetcher',['Promise','AsyncRequest','MercuryMessages','MercuryThreads','MercuryThreadIDMap','MercurySingletonProvider','MercurySyncDataFetcher','XMercuryFetchMessageController','XMercuryInvalidateGlobalStateController','XMercuryInvalidateThreadStateController'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();function r(t){this.$MercurySyncDFFDataFetcher1=t;this.__messages=j.getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threads=k.getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threadIDMap=l.getForFBID(this.$MercurySyncDFFDataFetcher1);}r.getForFBID=function(t){return s.getForFBID(t);};r.get=function(){return s.get();};r.prototype.fetchInvalidateGlobalState=function(){var t=p.getURIBuilder().getURI();return n.fetch(t);};r.prototype.fetchInvalidateThreadState=function(t,u){var v=3,w=t||u,x=this.__threadIDMap.getClientIDFromServerIDNow(w);if(!x)return h.resolve({getPayload:function(){return {};}});var y=this.__messages.getCurrentlyLoadedMessages(x).length,z=q.getURIBuilder().setInt('other_user_or_thread_fbid',w).setInt('num_messages',y+v).getURI();return n.fetch(z);};r.prototype.fetchInvalidateMessage=function(t,u,v){var w=o.getURIBuilder().setInt('other_user_or_thread_fbid',t||u).setString('mid',v).getURI();return n.fetch(w);};var s=new m(r);f.exports=r;},null);
__d('MercurySyncForcedFetchHandler',['Promise','MercurySingletonProvider','MercurySyncDFFDataFetcher','MercuryMessages','MercuryThreadIDMap'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();function m(p){return {getPayload:function(){return {sequence_id:p};}};}n.getForFBID=function(p){return o.getForFBID(p);};n.get=function(){return o.get();};function n(p){this.$MercurySyncForcedFetchHandler1=p;this.$MercurySyncForcedFetchHandler2=k.getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler3=l.getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler4=j.getForFBID(this.$MercurySyncForcedFetchHandler1);}n.prototype.processMessageDFF=function(p,q,r,s){if(s){var t=q.otherUserFbId!==undefined?q.otherUserFbId.toString():q.threadFbId.toString(),u=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(t);if(u===undefined)return h.resolve(m(p));var v=this.$MercurySyncForcedFetchHandler2.getMessagesFromIDs([r]);if(v.length===0)return h.resolve(m(p));}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateMessage(q.otherUserFbId,q.threadFbId,r);};n.prototype.processThreadDFF=function(p,q,r){if(r){var s=q.otherUserFbId!==undefined?q.otherUserFbId.toString():q.threadFbId.toString(),t=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(s);if(t===undefined)return h.resolve(m(p));}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateThreadState(q.otherUserFbId,q.threadFbId);};n.prototype.processGlobalDFF=function(){return this.$MercurySyncForcedFetchHandler4.fetchInvalidateGlobalState();};var o=new i(n);f.exports=n;},null);
__d('MercurySyncDeltaHandler',['Arbiter','ChannelConstants','ChannelInitialData','LogHistory','MercuryConfig','MercuryDelayedDispatcher','MercuryPayloadSource','MercurySyncDeltaHolder','MercurySyncDeltaTypes','MercurySyncDispatcher','MercurySyncForcedFetchHandler','MercurySyncHolesTypedLogger','MercuryServerPayloadPreprocessor','MercurySyncTopicType','MercurySingletonProvider','invariant'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){'use strict';if(c.__markCompiled)c.__markCompiled();var x=k.getInstance('mercury_sync_delta_handler');y.getForFBID=function(aa){return z.getForFBID(aa);};y.get=function(){return z.get();};function y(aa){this.$MercurySyncDeltaHandler1=aa;this.$MercurySyncDeltaHandler2=q.getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler4=r.getForFBID(this.$MercurySyncDeltaHandler1);this.__payloadPreprocessor=t.getForFBID(this.$MercurySyncDeltaHandler1);this.__delayedDispatcher=m.getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler5=new o();this.$MercurySyncDeltaHandler6=false;this.$MercurySyncDeltaHandler7=[];if(!j.channelConfig)return;this.$MercurySyncDeltaHandler3=j.channelConfig.sequenceId;h.subscribe('channel/message:delta',function(ba,ca){var da=ca&&ca.obj&&ca.obj.delta,ea=ca&&ca.obj&&ca.obj.iseq;if(!da||!ea)return;this.$MercurySyncDeltaHandler8(ea,u.DELTA);this.$MercurySyncDeltaHandler9(ea,da);if(l.WWWSyncRaceConditionImprovements){this.$MercurySyncDeltaHandler5.push(ea,da);this.$MercurySyncDeltaHandler10();}else this.$MercurySyncDeltaHandler11(ea,da);}.bind(this));h.subscribe('channel/message:deltaflow',function(ba,ca){var da=ca&&ca.obj&&parseInt(ca.obj.sequencer,10);this.$MercurySyncDeltaHandler8(da,u.DELTAFLOW);}.bind(this));h.subscribe(i.getArbiterType(i.FAKE_DFF),function(ba,ca){var da=ca&&ca.obj&&ca.obj.delta;if(!da)return;this.$MercurySyncDeltaHandler7.push(da);this.$MercurySyncDeltaHandler10();}.bind(this));}y.prototype.$MercurySyncDeltaHandler10=function(){if(this.$MercurySyncDeltaHandler6)return;if(this.$MercurySyncDeltaHandler7.length>0){var aa=this.$MercurySyncDeltaHandler7.shift();this.$MercurySyncDeltaHandler11(this.$MercurySyncDeltaHandler3,aa);this.$MercurySyncDeltaHandler10();}var ba=this.$MercurySyncDeltaHandler5.peek();if(!ba)return;var ca=ba-this.$MercurySyncDeltaHandler3;if(ca===1){var da=this.$MercurySyncDeltaHandler5.pop();if(!da)return;var ea=da.seqID,fa=da.delta;this.$MercurySyncDeltaHandler11(ea,fa);this.$MercurySyncDeltaHandler10();}else if(ca>1){this.$MercurySyncDeltaHandler12();}else{this.$MercurySyncDeltaHandler5.pop();this.$MercurySyncDeltaHandler10();}};y.prototype.$MercurySyncDeltaHandler11=function(aa,ba){this.$MercurySyncDeltaHandler3=aa;if(ba['class']===p.ForcedFetch){if(!l.WWWSyncForcedFetch)return;x.debug('DFF',aa.toString());if(ba.threadKey!==undefined&&ba.messageId===undefined){this.$MercurySyncDeltaHandler13(aa,ba);}else if(ba.threadKey!==undefined&&ba.messageId!==undefined){this.$MercurySyncDeltaHandler14(aa,ba);}else this.$MercurySyncDeltaHandler15(aa);}else this.$MercurySyncDeltaHandler2.process(ba);};y.prototype.$MercurySyncDeltaHandler12=function(){x.debug('hole',JSON.stringify({$MercurySyncDeltaHandler3:this.$MercurySyncDeltaHandler3,nextSeqID:this.$MercurySyncDeltaHandler5.peek()}));var aa=this.$MercurySyncDeltaHandler5.peek();!!!aa?w(0):undefined;var ba=aa-1;this.$MercurySyncDeltaHandler15(ba);};y.prototype.$MercurySyncDeltaHandler16=function(aa,ba,ca,da){if(l.WWWSyncRaceConditionImprovements)!!this.$MercurySyncDeltaHandler6?w(0):undefined;this.$MercurySyncDeltaHandler6=true;x.debug('_scheduleDataFetch:start',JSON.stringify({seqID:aa}));ba().done(function(ea){x.debug('_scheduleDataFetch:success',JSON.stringify({seqID:aa}));ca(aa,ea);this.$MercurySyncDeltaHandler6=false;this.$MercurySyncDeltaHandler10();}.bind(this),function(){x.debug('_scheduleDataFetch:failure',JSON.stringify({seqID:aa}));da(aa);this.$MercurySyncDeltaHandler6=false;this.$MercurySyncDeltaHandler10();}.bind(this));};y.prototype.$MercurySyncDeltaHandler15=function(aa){this.$MercurySyncDeltaHandler16(undefined,function(){return this.$MercurySyncDeltaHandler4.processGlobalDFF();}.bind(this),function(ba,ca){var da=ca.getPayload();this.__payloadPreprocessor.handleUpdate(da);if(da.sequence_id)this.$MercurySyncDeltaHandler3=da.sequence_id;}.bind(this),function(){this.$MercurySyncDeltaHandler3=aa;}.bind(this));};y.prototype.$MercurySyncDeltaHandler13=function(aa,ba){this.$MercurySyncDeltaHandler16(aa,function(){return this.$MercurySyncDeltaHandler4.processThreadDFF(aa,ba.threadKey,ba.isLazy);}.bind(this),function(ca,da){this.__payloadPreprocessor.handleUpdate(da.getPayload());this.$MercurySyncDeltaHandler3=ca;}.bind(this),function(){var ca=babelHelpers['extends']({},ba);delete ca.threadKey;this.$MercurySyncDeltaHandler3=aa-1;this.$MercurySyncDeltaHandler5.push(aa,ca);}.bind(this));};y.prototype.$MercurySyncDeltaHandler14=function(aa,ba){this.$MercurySyncDeltaHandler16(aa,function(){return this.$MercurySyncDeltaHandler4.processMessageDFF(aa,ba.threadKey,ba.messageId,ba.isLazy);}.bind(this),function(ca,da){var ea=da.getPayload(),fa=ea.other_user_fbid?ea.other_user_fbid:ea.thread_fbid,ga=[babelHelpers['extends']({},ea)],ha=n.CLIENT_CHANNEL_MESSAGE;this.__delayedDispatcher.handleUpdateWaitForThread({actions:ga,payload_source:ha},fa);this.$MercurySyncDeltaHandler3=ca;}.bind(this),function(){var ca=babelHelpers['extends']({},ba);delete ca.messageId;this.$MercurySyncDeltaHandler3=aa-1;this.$MercurySyncDeltaHandler5.push(aa,ca);}.bind(this));};y.prototype.$MercurySyncDeltaHandler8=function(aa,ba){var ca=aa-this.$MercurySyncDeltaHandler3;if(ca!==1&&ca!==0){if(!l.WWWSyncHolesLogging)return;new s().setSeqID(aa).setDifference(ca).setTopicType(ba).log();}};y.prototype.$MercurySyncDeltaHandler9=function(aa,ba){if(ba['class']===p.NewMessage){var ca={seqID:aa,threadKey:ba.messageMetadata.threadKey,messageId:ba.messageMetadata.messageId};x.debug('message_delta_received',JSON.stringify(ca));}};var z=new v(y);f.exports=y;},null);
__d('MercuryUnseenState',['MercuryFolders','KeyedCallbackManager','LogHistory','MercuryActionType','MercuryDispatcher','MercurySingletonMixin','MercuryThreadInfo','MercuryThreadlistConstants','MercuryThreadIDMap','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','createObjectFrom','isEmpty'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=o.MAX_UNSEEN_COUNT,x='unseen_thread_hash',y='unseen_thread_list',z=j.getInstance('mercury_unseen_state');function aa(pa){this._fbid=pa;this._serverRequests=r.getForFBID(this._fbid);this._threadIDMap=p.getForFBID(this._fbid);this._threads=t.getForFBID(this._fbid);this._threadInformer=s.getForFBID(this._fbid);this._dispatcher=l.getForFBID(this._fbid);this._initialUnseenCount=null;this._lastSeenTimestamp=0;this._maxCount=false;this._pendingServerUpdates=false;this._unseenResources=new i();this._dispatcher.subscribe('update-unseen',function(qa,ra){ga(this,ra);}.bind(this));this._dispatcher.subscribe('update-thread-ids',function(qa,ra){ma(this,ra);}.bind(this));}Object.assign(aa.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){z.error('unguarded_unseen_count_fetch','{}');return 0;}return fa(this)||0;},exceedsMaxCount:function(){return this._maxCount||fa(this)>w;},markAsSeen:function(){var pa=fa(this);if(pa===null){this._pendingServerUpdates=true;}else if(pa>0||this._maxCount){this._serverRequests.markSeen();var qa=this._serverRequests.getLastActionTimestamp();ha(this,qa,[]);}}});Object.assign(aa,m);function ba(pa,qa,ra){var sa={};sa[qa]=0;ja(pa,sa,ra);}function ca(pa,qa){pa._unseenResources.setResource(x,qa);pa._unseenResources.setResource(y,Object.keys(qa));}function da(pa,qa){var ra=pa._unseenResources.executeOrEnqueue(x,qa),sa=pa._unseenResources.getUnavailableResources(ra);if(sa.length)pa._serverRequests.fetchUnseenThreadIDs();}function ea(pa){return pa._unseenResources.getResource(x);}function fa(pa){var qa=pa._unseenResources.getResource(y);if(qa){return qa.length;}else return pa._initialUnseenCount;}function ga(pa,qa){var ra=oa(qa);if(qa.unseen_thread_fbids){qa.unseen_thread_fbids.forEach(function(cb){if(cb.folder!=q.INBOX)return;var db=cb.thread_fbids||[];db=db.concat(cb.other_user_fbids||[]);var eb=la(pa,db),fb=pa._lastSeenTimestamp;if(ra&&ra.seen_timestamp)fb=ra.seen_timestamp;ha(pa,fb,eb);if(ra&&ra.unseen_count>w)pa._maxCount=true;});}else if(ra&&ra.seen_timestamp!==undefined){pa._lastSeenTimestamp=ra.seen_timestamp;if(ra.unseen_count>w){pa._maxCount=true;ca(pa,{});}else{pa._initialUnseenCount=ra.unseen_count;if(pa._initialUnseenCount===0)ca(pa,{});}}else{if(pa._maxCount)return;var sa=qa.actions;if(!sa||!sa.length)return;var ta={},ua={};for(var va=0;va<sa.length;va++){var wa=sa[va];if(wa.is_forward)continue;var xa=wa.action_type,ya=wa.other_user_fbid?wa.other_user_fbid:wa.thread_fbid,za=wa.thread_id?wa.thread_id:ya;if(xa==k.MARK_THREAD_SEEN){ba(pa,za,wa.persistent);continue;}if(!na(pa,wa))continue;if(xa==k.USER_GENERATED_MESSAGE||xa==k.LOG_MESSAGE){var ab=ta[za]?wa.timestamp>ta[za]:false,bb=ab||!ta[za];if(wa.is_unread&&bb)pa._threads.getThreadMeta(za,function(cb){var db=false;if(cb&&cb.last_read_timestamp)if(cb.last_read_timestamp>=wa.timestamp)db=true;if(!n.isMuted(cb)&&!db)ta[za]=wa.timestamp;});}else if(xa==k.CHANGE_READ_STATUS&&wa.mark_as_read)ua[za]=wa.timestamp;}ia(pa,ta);ja(pa,ua);}if(pa._pendingServerUpdates){pa._pendingServerUpdates=false;pa.markAsSeen();}}function ha(pa,qa,ra){var sa=ea(pa);if(sa===undefined||qa>pa._lastSeenTimestamp||pa._maxCount){pa._lastSeenTimestamp=qa;ra=ra||[];if(ra.length<=w)pa._maxCount=false;var ta={},ua=ea(pa)||{};for(var va in ua)if(ua[va]!==true){var wa=ua[va];if(ka(pa,wa))ta[va]=wa;}var xa=Object.assign(u(ra,true),ta);ca(pa,xa);pa._threadInformer.updatedUnseenState();}}function ia(pa,qa){if(pa._maxCount)return;var ra={},sa=false;for(var ta in qa){var ua=qa[ta];if(ka(pa,ua)){ra[ta]=ua;sa=true;}}if(!sa)return;da(pa,function(va){for(var wa in ra){var xa=ra[wa];if(!va[wa]&&ka(pa,xa))va[wa]=ra[wa];}ca(pa,va);pa._threadInformer.updatedUnseenState();});}function ja(pa,qa,ra){var sa=false;if(!v(qa))sa=true;if(sa)da(pa,function(ta){var ua=false;for(var va in qa){var wa=qa[va],xa=wa>=ta[va];if(ta[va]&&(!wa||xa)){delete ta[va];ua=true;}}if(ua){ca(pa,ta);pa._threadInformer.updatedUnseenState();if(ra&&fa(pa)===0)pa._serverRequests.markSeen();}});}function ka(pa,qa){return qa>pa._lastSeenTimestamp;}function la(pa,qa){return qa.map(pa._threadIDMap.convertThreadIDIfAvailable,pa._threadIDMap);}function ma(pa,qa){var ra=ea(pa);if(!ra)return;for(var sa in qa){var ta=qa[sa];if(ra[sa]){ra[ta]=ra[sa];delete ra[sa];}}ca(pa,ra);}function na(pa,qa){var ra=qa.thread_id?pa._threads.getThreadMetaNow(qa.thread_id):null,sa=ra?h.getFromMeta(ra):qa.folder;return sa===q.INBOX||sa===undefined;}function oa(pa){var qa=pa.message_counts||[];for(var ra=0;ra<qa.length;ra++)if(qa[ra].folder==q.INBOX)return qa[ra];return null;}f.exports=aa;},null);
__d('P2PDialogStore',['EventEmitter','P2PActionConstants','P2PDispatcher'],function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m,n={};k=babelHelpers.inherits(o,h);l=k&&k.prototype;function o(){l.constructor.call(this);m=j.register(this.onEventDispatched.bind(this));n={dialogClass:null,dialogProps:null};}o.prototype.getState=function(){return n;};o.prototype.onEventDispatched=function(p){var q=p.type,r=p.data;switch(q){case i.DIALOG_SHOWN:n.dialogClass=r.dialogClass;n.dialogProps=r.dialogProps;this.emit('change');break;case i.DIALOG_CLOSED:n.dialogClass=null;n.dialogProps=null;this.emit('change');break;}};f.exports=new o();},null);
__d('P2PDialogContainer.react',['P2PDialogStore','React','ReactLayeredComponentMixin'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=i.createClass({displayName:'P2PDialogContainer',mixins:[j],getInitialState:function(){return h.getState();},componentDidMount:function(){this.dialogStoreSub=h.addListener('change',this.onDialogStoreChange);},componentWillUnmount:function(){if(this.dialogStoreSub){this.dialogStoreSub.remove();this.dialogStoreSub=null;}},onDialogStoreChange:function(){this.setState(h.getState());},renderLayers:function(){if(!this.state.dialogClass)return {};var l=this.state.dialogClass;return {dialog:i.createElement(l,this.state.dialogProps)};},render:function(){return null;}});f.exports=k;},null);
__d('TabsViewport',['Arbiter','ArbiterMixin','ChatTabModel','Dock','DOM','Event','Parent','Vector','ViewportBounds','areJSONRepresentationsEqual','csx','getViewportDimensions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=175,u=269,v=0;function w(){return t;}function x(){return u;}function y(z){this._root=z;var aa=this._recalculateWidth.bind(this);m.listen(window,'resize',aa);k.subscribe('resize',aa);h.subscribeOnce('sidebar/initialized',aa,h.SUBSCRIBE_NEW);j.addListener(function(){return this._recalculateTabs(true);}.bind(this));this._recalculateWidth();this._initialized=true;}Object.assign(y.prototype,i,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var z=y._getAvailableDockWidth(this._root),aa=Math.max(1,Math.floor(z/x())),ba=aa!=this._maxShown;if(!this._viewState||ba||z<=this._viewState.usedWidth||z>this._viewState.widthToShowNext){this._availableWidth=z;this._maxShown=aa;this._viewState=null;this._recalculateTabs(ba);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(z){var aa=y._getTabsToShow(j.get(),this._availableWidth);if(z||!q(this._viewState,aa)){this._viewState=aa;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},hasRoomForRaisedTab:function(){return this._availableWidth-this._viewState.usedWidth>x();},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},getShowingTabsOrder:function(){var z=j.get(),aa=this._viewState.tabsToShow;return z.tabs.filter(function(ba){return aa[ba.id];});},getRightmostHiddenTab:function(){var z=j.get(),aa=this._viewState.tabsToShow,ba=z.tabs.filter(function(da){return !aa[da.id];}),ca=ba.shift();return ca?ca.id:null;},getLeftmostVisibleTab:function(){var z=this.getShowingTabsOrder(),aa=z.pop();return aa?aa.id:null;},getRaisedVisibleTabs:function(){var z=[],aa=this.getShowingTabsOrder(),ba=aa.length;for(var ca=0;ca<ba;ca++)if(j.getTab(aa[ca].id).raised)z.push(aa[ca].id);return z;},shouldPromoteOnRaise:function(z){if(!this._viewState.tabsToShow[z])return true;if(this._viewState.nextToHide!=z)return false;var aa=j.getTab(z),ba=aa&&aa.raised;return !ba&&this._availableWidth-this._viewState.usedWidth<x()-w();}});Object.assign(y,{_getAvailableDockWidth:function(z){var aa=s.withoutScrollbars().width;aa-=p.getLeft()+p.getRight();aa-=50;var ba=n.byClass(z,'fbDock'),ca=l.find(ba,"._56ox"),da=ca?o.getElementDimensions(ca).x:0;aa-=da;var ea=l.scry(ba,"._56oy");da+=o.getElementDimensions(ea.pop()).x;var fa=o.getElementDimensions(ba),ga=fa.x-da;if(ga>v)v=ga;aa-=v;aa-=15;return Math.max(aa,0);},_getTabsToShow:function(z,aa){aa=Math.max(aa,x()+1);function ba(ra,sa){return ra.raised||!sa?x():w();}var ca=JSON.parse(JSON.stringify(z.tabs)),da=-1,ea=null;if(z.promoted)ca.forEach(function(ra,sa){if(ra.id===z.promoted){da=sa;ea=ra;}});var fa=0,ga=false,ha=0,ia=!ea;ca.forEach(function(ra,sa){var ta=ba(ra,ga);ga=ga||!ra.raised;ra.leftmostOffset=fa+ta;fa+=ta;if(ra.leftmostOffset<aa)ha++;ia|=sa==da;ra.alreadyPlacedPromoted=ia;});function ja(ra,sa,ta){var ua={};for(var va=0;va<sa;va++){var wa=ra[va];if(!wa.alreadyPlacedPromoted&&va==sa-1){ua[ta]=true;}else ua[wa.id]=true;}return ua;}var ka=ja(ca,ha,z.promoted),la=ja(ca,ha-1,z.promoted),ma=null;for(var na in ka)if(!la[na])ma=na;var oa=ca[ha-1],pa=oa?oa.leftmostOffset:0,qa=Infinity;if(ha<ca.length)qa=ca[ha].leftmostOffset;return {nextToHide:ma,tabsToShow:ka,usedWidth:pa,widthToShowNext:qa};}});f.exports=y;},null);
__d('ChatApp',['Promise','CSS','ChatPerfInstrumentation','DOM','JSLogger','React','ReactDOM','TimeSlice','csx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q={chatOpenTabImpl:undefined,tabsViewport:undefined,tabViewCoordinator:undefined,tabController:undefined,init:function(v,w,x){if(this._isInitialized){l.create('chat_app').error('repeated_init');return;}this._rootElem=v;h.resolve().then(function(){return j.init();}).then(o.guard(function(){return r();},'ChatApp stores')).then(o.guard(function(){return s(x);},'ChatApp data')).then(o.guard(function(){return t(w,v);},'ChatApp UI')).then(o.guard(function(){return u();},'ChatApp Hotlike sound')).done(function(){this._isInitialized=this._isLoaded=true;j.logTTI();}.bind(this));},isInitialized:function(){return !!this._isInitialized;},isHidden:function(){return !!(!this._isInitialized||this._isHidden);},hide:function(){if(this.isHidden())return;i.hide(this._rootElem);this._isHidden=true;},unhide:function(){if(this._isInitialized){if(this._isHidden){i.show(this._rootElem);this.tabsViewport.checkWidth();e(['Dock'],function(v){v.resizeAllFlyouts();});this._isHidden=false;}}else if(!this._isLoaded){e(['UIPagelet'],function(v){v.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');v.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});this._isLoaded=true;}}};function r(){return new h(function(v){e(['MercuryBlockedParticipants','MercuryChannelHandler','MercuryDelayedRoger','MercuryDeliveryReceipts','MercuryDeliveryState','MercuryParticipants','MercuryStateCheck','MercuryThreads','MercuryUnreadState','MercuryUnseenState','MercurySyncDeltaHandler','P2PSendMoneyDialogStore'],function(w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){w.get();x.get().turnOn();y;z.get();aa.get();ba;da.get();fa.get();ea.get();ca.get();ga.get();v();});});}function s(v){return new h(function(w){e(['MercuryServerPayloadPreprocessor'],function(x){x.get().handleUpdate(v);w();});});}function t(v,w){return new h(function(x){e(['ChatDispatcher','ChatTabController','ChatTabModel','ChatTabViewCoordinator','TabsViewport','MNCommerceDialogContainer.react','P2PDialogContainer.react','FBRTCMessageHandler','ChatOpenTabImpl'],function(y,z,aa,ba,ca,da,ea,fa,ga){y.explicitlyRegisterStore(aa);q.tabsViewport=new ca(v);q.tabViewCoordinator=new ba(v,q.tabsViewport);q.tabController=new z(q.tabsViewport);fa.init();var ha=k.find(w,"._26-x");n.render(m.createElement(da,null),ha);var ia=k.find(w,"._26-y");n.render(m.createElement(ea,null),ia);q.chatOpenTabImpl=ga;x();});});}function u(){return new h(function(v){e(['HotLikeSound','ChatOptions'],function(w,x){w.setCheckSoundEnabledFunc(function(){return x.getSetting('sound');});v();});});}f.exports=q;},null);
__d('ChatSidebarComposeLink.react',['ChatOpenTab','Link.react','React','TooltipData','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';var m,n;if(c.__markCompiled)c.__markCompiled();m=babelHelpers.inherits(o,j.Component);n=m&&m.prototype;function o(p){n.constructor.call(this,p);}o.prototype.render=function(){var p=l._("Nouveau message");return (j.createElement(i,babelHelpers['extends']({className:this.props.className,href:'#',onClick:this.$ChatSidebarComposeLink1},k.propsFor(p))));};o.prototype.$ChatSidebarComposeLink1=function(p){h.openEmptyTab(null,'sidebar');p.preventDefault();};f.exports=o;},null);
__d('ChatSidebar',['Arbiter','AsyncRequest','Bootloader','ChatDispatcher','ChatImpressionLogger','ChatSidebarActions','ChatSidebarComposeLink.react','ChatSidebarStore','ChatSidebarVisibility','CSS','DOM','DOMDimensions','Event','LogHistory','KeyEventController','LitestandClassicPlaceHolders','MercuryConfig','Parent','PresencePrivacy','PresenceUtil','React','ReactDOM','Run','ScrollableArea','SidebarType','Style','TimeSlice','ViewportBounds','csx','cx','debounce','emptyFunction','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na){if(c.__markCompiled)c.__markCompiled();var oa,pa,qa,ra,sa,ta,ua,va=false,wa,xa=true,ya=null,za=u.getInstance('chat_sidebar');function ab(){return o.getVisibleType()===fa.SIDEBAR;}function bb(lb,mb){if(!ab())return;if(mb){sa.hide();}else{sa.show();eb();}}function cb(){return !ab()||!ra?0:206;}function db(){q.removeClass(document.documentElement,'sidebarMode');if(!o.isInitialized()){h.inform('reflow');ia.inform('change');return;}sa.hide();ua.getCore().reset();q.hide(ra);q.hide(qa);h.inform('sidebar/hide',kb);h.inform('reflow');ia.inform('change');}function eb(lb){if(!lb||lb.width!==ya.width)m.show(ya);if(!lb||lb.height!==ya.height)hb();}function fb(lb){var mb=ya||p.getViewport(),nb=mb.height;lb.forEach(function(ob){if(ob&&ob!==oa&&!q.hasClass(ob,'hidden_elem'))nb-=s.getElementDimensions(ob).height;});if(wa)nb-=wa.getOffset();if(ta)nb-=s.getElementDimensions(ta).height;return Math.max(0,nb);}function gb(){q.show(qa);q.show(ra);q.addClass(document.documentElement,'sidebarMode');sa.show();za.log('sidebar_show','{}');h.inform('sidebar/show',kb);w.destroy('sidebar');ia.inform('change');if(!va){hb();va=true;}}function hb(){if(o.getVisibleType()!==fa.SIDEBAR)return;var lb=kb.getBodyHeight(),mb=sa.getItemHeight(),nb=8;ga.set(oa,'height',lb+'px');var ob=Math.floor((lb-nb)/mb);sa.setNumTopFriends(ob,xa);xa=false;da.onAfterLoad(function(){var pb=Math.floor((lb-nb)/mb);pb=Math.max(pb-2,1);ua.getData().setMaxResults(pb);});h.inform('sidebar/resized',kb);h.inform('reflow');}function ib(){new i('/ajax/chat/settings.php').setHandler(ma).setErrorHandler(ma).setData({sidebar_mode:o.isEnabled(),window_id:aa.getSessionID()}).setAllowCrossPageTransition(true).send();}function jb(){var lb=true;if(!o.isEnabled()){za.log('state_not_enabled','{}');lb=false;}if(p.hasLowFriendCount()){za.log('state_not_shown_num_friends','{}');lb=false;}if(!p.isViewportCapable(ya))lb=false;var mb=lb?'state_shown':'state_not_shown';za.log(mb,'{}');}var kb={init:function(lb,mb,nb){kb.init=ma;k.explicitlyRegisterStore(o);m.loaded();ra=lb;sa=mb;ua=nb;oa=r.find(lb,'div.fbChatSidebarBody');qa=r.find(lb,"._51x_");ta=r.find(lb,"._5qqe");var ob=r.find(lb,"._x1u");if(ob)ca.render(ba.createElement(n,{className:"_3a-4 _5q85"}),ob);var pb=r.find(lb,"._1ltf");if(pb)da.onAfterLoad(function(){j.loadModules(["ChatSidebarDropdown.react","SidebarType"],function(qb,rb){ca.render(ba.createElement(qb,{sidebarType:rb.SIDEBAR,onToggleSidebar:m.disable}),pb);});});t.listen(window,'resize',function(){var qb=babelHelpers['extends']({},ya)||{};this._cacheViewport();eb(qb);}.bind(this));v.registerKey('q',function(event){if(o.getVisibleType()!==fa.SIDEBAR)return;if(!pa)pa=r.scry(lb,'.inputsearch')[0];if(pa){pa.focus();event.prevent();}});sa.setScrollContainer(y.byClass(sa.getRoot(),'uiScrollableAreaWrap'));sa.subscribe(['render','show','hide'],la(function(qb){var rb=ea.getInstance(sa.getRoot());rb&&rb.adjustGripper();}));h.subscribe('chat/option-changed',function(qb,rb){if(rb.name==='hide_groups')hb();});h.subscribe(['AppsDivebar/show-apps','AppsDivebar/hide-apps','Ticker/resized'],hb);nb.getCore().subscribe('sidebar/typeahead/active',bb);nb.subscribe('reset',function(){if(!nb.getCore().getValue()&&!sa.isVisible())bb(null,false);});da.onAfterLoad(function(){var qb=r.find(lb,'div.fbChatSidebarMessage div.message');if(qb)j.loadModules(["ChatSidebarSheet.react"],function(rb){ca.render(ba.createElement(rb,{root:lb,onUpdate:hb}),qb,hb);});});z.subscribe('privacy-user-presence-changed',eb);o.addListener(function(){var qb=o.getState(),rb=o.getPrevState();if(qb.visible!==rb.visible)switch(qb.visible){case fa.SIDEBAR:gb();break;case fa.BUDDYLIST:db();break;}if(qb.enabled!==rb.enabled)ib();});this._cacheViewport();eb();l.init(sa);ia.addPersistentRight(cb);h.inform('sidebar/initialized',kb,h.BEHAVIOR_PERSISTENT);m.init();jb();},ensureLoaded:function(){if(!o.isEnabled())return;if(o.isLoaded())return;if(na('pagelet_sidebar'))return;e(['UIPagelet'],function(lb){var mb=r.create('div',{id:'pagelet_sidebar'});r.appendContent(document.body,mb);lb.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});m.loaded();},hide:function(){if(!o.isEnabled())return;m.disable();},unhide:function(){if(o.isEnabled())return;m.enable();},_cacheViewport:function(){ya=p.getViewport();},getBodyHeight:function(){return fb(Array.from(qa.childNodes));}};kb.init=ha.guard(kb.init,'ChatSidebar init');f.exports=kb;},null);