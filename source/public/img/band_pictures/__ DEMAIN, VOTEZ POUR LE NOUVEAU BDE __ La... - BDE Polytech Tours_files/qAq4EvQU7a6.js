/*!CK:1683619358!*//*1456774000,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["MtNDg"]); }

__d('DataViewPolyfill',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j,k){if(j===undefined){this.$DataViewPolyfill1=new Uint8Array(i);}else if(k===undefined){this.$DataViewPolyfill1=new Uint8Array(i,j);}else this.$DataViewPolyfill1=new Uint8Array(i,j,k);this.byteLength=this.$DataViewPolyfill1.byteLength;}h.prototype.getUint8=function(i){if(i>=this.$DataViewPolyfill1.length)throw new Error('Trying to read beyond bounds of DataViewPolyfill');return this.$DataViewPolyfill1[i];};h.prototype.getUint16=function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1);return j?l*256+k:k*256+l;};h.prototype.getUint32=function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1),m=this.getUint8(i+2),n=this.getUint8(i+3);return j?((n*256+m)*256+l)*256+k:((k*256+l)*256+m)*256+n;};h.isSupported=function(){return !!b.Uint8Array;};f.exports=h;},null);
__d('getImageSize',['DataViewPolyfill'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=b.DataView||h;function j(n){return {width:n.getUint16(6,true),height:n.getUint16(8,true)};}function k(n){return {width:n.getUint32(16,false),height:n.getUint32(20,false)};}function l(n){var o=n.byteLength,p=2;while(p<o){var q=n.getUint16(p,false);p+=2;if(q==65472||q==65474){return {width:n.getUint16(p+5,false),height:n.getUint16(p+3,false)};}else p+=n.getUint16(p,false);}return null;}function m(n){var o=new i(n);if(o.getUint8(0)==255&&o.getUint8(1)==216)return l(o);if(o.getUint8(0)==71&&o.getUint8(1)==73&&o.getUint8(2)==70)return j(o);if(o.getUint8(0)==137&&o.getUint8(1)==80&&o.getUint8(2)==78&&o.getUint8(3)==71)return k(o);return null;}f.exports=m;m.gif=j;m.png=k;m.jpeg=l;},null);
__d('ChatAutoSendPhotoUploader',['ArbiterMixin','AsyncUploadRequest','AsyncRequest','DOM','Event','FileForm','FileFormResetOnSubmit','FileInput','FormSubmitOnChange','JpegResizer','MercuryAttachmentType','MercuryConstants','PhotosMimeType','PhotosUploadID','Run','SubscriptionsHandler','URI','arrayContains','csx','fbt','getImageSize','getObjectValues','invariant','isEmpty','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa){'use strict';var ga,ha;if(c.__markCompiled)c.__markCompiled();function ia(){return 'upload_'+u.getNewID();}function ja(la){return Array.prototype.reduce.call(la,function(ma,na){var oa=ia();ma[oa]=na;return ma;},{});}ga=babelHelpers.inherits(ka,fa(h));ha=ga&&ga.prototype;function ka(la,ma,na){ha.constructor.call(this);this.$ChatAutoSendPhotoUploader1=na;this.$ChatAutoSendPhotoUploader2=ma;this.$ChatAutoSendPhotoUploader3=new w();this.$ChatAutoSendPhotoUploader4={};this.$ChatAutoSendPhotoUploader5={};this.$ChatAutoSendPhotoUploader6=false;this.$ChatAutoSendPhotoUploader7=la.getAttribute('action');this.$ChatAutoSendPhotoUploader8=new m(la,[p,n]);this.$ChatAutoSendPhotoUploader8.setAllowCrossOrigin(true);this.$ChatAutoSendPhotoUploader8.setUploadInParallel(true);var oa=k.find(la,"._4q60"),pa=k.find(oa,"._4q61");this.$ChatAutoSendPhotoUploader9=new o(oa,pa,ma);this.$ChatAutoSendPhotoUploader3.addSubscriptions(v.onBeforeUnload(this.onBeforeUnload.bind(this)),this.$ChatAutoSendPhotoUploader8.subscribe('submit',this.$ChatAutoSendPhotoUploader10.bind(this)),this.$ChatAutoSendPhotoUploader8.subscribe('success',this.$ChatAutoSendPhotoUploader11.bind(this)),this.$ChatAutoSendPhotoUploader8.subscribe('failure',this.$ChatAutoSendPhotoUploader12.bind(this)),this.$ChatAutoSendPhotoUploader8.subscribe('progress',this.$ChatAutoSendPhotoUploader13.bind(this)),l.listen(pa,'click',function(){if(this.$ChatAutoSendPhotoUploader14===undefined)this.$ChatAutoSendPhotoUploader15();if(this.$ChatAutoSendPhotoUploader14)if(q.prepareResource)q.prepareResource();this.inform('open');}.bind(this)));}ka.prototype.$ChatAutoSendPhotoUploader15=function(){this.$ChatAutoSendPhotoUploader14=q.isSupported();if(this.$ChatAutoSendPhotoUploader14)this.$ChatAutoSendPhotoUploader8.setPreprocessHandler(this.$ChatAutoSendPhotoUploader16.bind(this));};ka.prototype.onBeforeUnload=function(){if(this.isUploading()&&!this.$ChatAutoSendPhotoUploader6)return aa._("Vous n\u2019avez pas encore envoy\u00e9 votre message. Voulez-vous quitter sans envoyer\u00a0?");};ka.prototype.isUploading=function(){return !ea(this.$ChatAutoSendPhotoUploader4);};ka.prototype.destroy=function(){this.$ChatAutoSendPhotoUploader3.release();this.$ChatAutoSendPhotoUploader8.destroy();this.$ChatAutoSendPhotoUploader4={};this.$ChatAutoSendPhotoUploader5={};};ka.prototype.$ChatAutoSendPhotoUploader17=function(la,ma){var na=this.$ChatAutoSendPhotoUploader18(la);if(ma){na.preview_width=ma.width;na.preview_height=ma.height;}return na;};ka.prototype.$ChatAutoSendPhotoUploader18=function(la){var ma={upload_id:la,on_progress:function(na){this.$ChatAutoSendPhotoUploader3.addSubscriptions(this.subscribe('progress',na));}.bind(this),on_resizing_progress:function(na){this.$ChatAutoSendPhotoUploader3.addSubscriptions(this.subscribe('resize_progress',na));}.bind(this),on_success:function(na){this.$ChatAutoSendPhotoUploader3.addSubscriptions(this.subscribe('success',na));}.bind(this),upload_canceled:this.$ChatAutoSendPhotoUploader19.bind(this),attach_type:r.PHOTO,preview_uploading:true};return ma;};ka.prototype.$ChatAutoSendPhotoUploader16=function(la,ma){var na=la.getFile();if(!t(na.type).isJpeg())return ma(la);q.getSingleton().resizeBlob(na,function(oa,pa,qa){if(pa)la.setFile(pa);ma(la);},this.$ChatAutoSendPhotoUploader20.bind(this,la));};ka.prototype.$ChatAutoSendPhotoUploader10=function(){var la=ia();this.$ChatAutoSendPhotoUploader21(la,this.$ChatAutoSendPhotoUploader2.files);};ka.prototype.$ChatAutoSendPhotoUploader21=function(la,ma){var na=arguments.length<=2||arguments[2]===undefined?{}:arguments[2],oa=0;for(var pa=0;pa<ma.length;pa++){var qa=ma[pa];oa+=qa.size;if(oa>s.AttachmentMaxSize){this.inform('file-upload-error',{error:'size-exceeded'});return;}if(qa.type==='application/x-msdownload'||qa.type==='application/x-msdownload-x64'){this.inform('file-upload-error',{error:'wrong-type'});return;}}if(typeof FileReader!=='undefined'&&FileReader.prototype.readAsArrayBuffer&&ma&&ma.length===1){this.$ChatAutoSendPhotoUploader4[la]=la;na[la]=ma[0];var ra=new FileReader();ra.onload=function(){this.inform('submit',{upload_id:la,preview_attachments:[this.$ChatAutoSendPhotoUploader17(la,ba(ra.result))]});}.bind(this);ra.onerror=function(){this.inform('submit',{upload_id:la,preview_attachments:[this.$ChatAutoSendPhotoUploader18(la)]});}.bind(this);if(ma[0].size){ra.readAsArrayBuffer(ma[0]);}else{var sa=babelHelpers['extends']({},this.$ChatAutoSendPhotoUploader17(la,ma[0].source),{preview_url:ma[0].preview_url});this.inform('submit',{upload_id:la,preview_attachments:[sa]});}}else{var ta=[];if(!ma){this.$ChatAutoSendPhotoUploader4[la]=la;this.$ChatAutoSendPhotoUploader1.value=la;ta.push(this.$ChatAutoSendPhotoUploader18(la));}else{var ua=Object.keys(na);if(ua.length>0){ua.forEach(function(xa){this.$ChatAutoSendPhotoUploader4[xa]=la;ta.push(this.$ChatAutoSendPhotoUploader18(xa));}.bind(this));}else for(var va=0;va<ma.length;++va){var wa=ia();na[wa]=ma[va];this.$ChatAutoSendPhotoUploader4[wa]=la;ta.push(this.$ChatAutoSendPhotoUploader18(wa));}}this.inform('submit',{upload_id:la,preview_attachments:ta});}if(Object.keys(na).length>0)this.$ChatAutoSendPhotoUploader8.setFiles(na);};ka.prototype.$ChatAutoSendPhotoUploader11=function(event,la){var ma=this.$ChatAutoSendPhotoUploader22(la);if(this.$ChatAutoSendPhotoUploader4[ma]){var na=this.$ChatAutoSendPhotoUploader4[ma];delete this.$ChatAutoSendPhotoUploader4[ma];var oa=la.response.getPayload();if(!this.$ChatAutoSendPhotoUploader5[na])this.$ChatAutoSendPhotoUploader5[na]=[];this.$ChatAutoSendPhotoUploader5[na].push({id:ma,audio_id:oa.metadata[0].audio_id,image_id:oa.metadata[0].image_id,file_id:oa.metadata[0].file_id,gif_id:oa.metadata[0].gif_id,video_id:oa.metadata[0].video_id});this.inform('success',{upload_id:ma});if(!this.$ChatAutoSendPhotoUploader23(na))this.$ChatAutoSendPhotoUploader24(na);this.$ChatAutoSendPhotoUploader9.clear();this.$ChatAutoSendPhotoUploader2=this.$ChatAutoSendPhotoUploader9.getInput();}};ka.prototype.$ChatAutoSendPhotoUploader24=function(la){!!this.$ChatAutoSendPhotoUploader23(la)?da(0):undefined;this.$ChatAutoSendPhotoUploader5[la].sort(function(ma,na){return ma.id<na.id?-1:1;});this.inform('all-uploads-completed',{upload_id:la,audio_ids:this.$ChatAutoSendPhotoUploader5[la].map(function(ma){return ma.audio_id;}),image_ids:this.$ChatAutoSendPhotoUploader5[la].map(function(ma){return ma.image_id;}),file_ids:this.$ChatAutoSendPhotoUploader5[la].map(function(ma){return ma.file_id;}),gif_ids:this.$ChatAutoSendPhotoUploader5[la].map(function(ma){return ma.gif_id;}),video_ids:this.$ChatAutoSendPhotoUploader5[la].map(function(ma){return ma.video_id;})});delete this.$ChatAutoSendPhotoUploader5[la];};ka.prototype.$ChatAutoSendPhotoUploader13=function(event,la){this.inform('progress',{upload_id:la.upload.getName(),event:la.event});};ka.prototype.$ChatAutoSendPhotoUploader20=function(la,event){this.inform('resize_progress',{upload_id:la.getName(),event:event});};ka.prototype.$ChatAutoSendPhotoUploader23=function(la){return y(ca(this.$ChatAutoSendPhotoUploader4),la);};ka.prototype.$ChatAutoSendPhotoUploader12=function(event,la){var ma=this.$ChatAutoSendPhotoUploader22(la);this.$ChatAutoSendPhotoUploader25(ma,'last-upload-failed',la.additionalParams);this.$ChatAutoSendPhotoUploader9.clear();this.$ChatAutoSendPhotoUploader2=this.$ChatAutoSendPhotoUploader9.getInput();return false;};ka.prototype.$ChatAutoSendPhotoUploader19=function(la){this.$ChatAutoSendPhotoUploader25(la,'last-upload-canceled');};ka.prototype.$ChatAutoSendPhotoUploader25=function(la,ma,na){if(!this.$ChatAutoSendPhotoUploader4[la])return;var oa=this.$ChatAutoSendPhotoUploader4[la];delete this.$ChatAutoSendPhotoUploader4[la];if(!this.$ChatAutoSendPhotoUploader23(oa))if(this.$ChatAutoSendPhotoUploader5[oa]){this.$ChatAutoSendPhotoUploader24(oa);}else this.inform(ma,babelHelpers['extends']({upload_id:oa},na));};ka.prototype.$ChatAutoSendPhotoUploader22=function(la){if(la.upload){return la.upload.getName();}else return la.response.getPayload().uploadID;};ka.prototype.uploadFiles=function(la){var ma=ia(),na;if(la.length===1){var oa;na=(oa={},oa[ma]=la[0],oa);}else na=ja(la);var pa=new i(this.$ChatAutoSendPhotoUploader7).setAllowCrossOrigin(true).setAllowCrossPageTransition(this.$ChatAutoSendPhotoUploader6).setRelativeTo(this.$ChatAutoSendPhotoUploader8.getRoot()).setFiles(na);this.$ChatAutoSendPhotoUploader3.addSubscriptions(pa.subscribe('success',function(event,qa){this.$ChatAutoSendPhotoUploader11(event,{upload:qa,response:qa.getResponse()});}.bind(this)),pa.subscribe('failure',this.$ChatAutoSendPhotoUploader12.bind(this)));pa.send();this.$ChatAutoSendPhotoUploader21(ma,la,na);};ka.prototype.uploadURL=function(la){var ma=ia(),na=la.errorDialogParams;delete la.errorDialogParams;var oa=new j().setURI(new x(this.$ChatAutoSendPhotoUploader7).getPath()).setAllowCrossPageTransition(this.$ChatAutoSendPhotoUploader6).setData(babelHelpers['extends']({},la,{attach_id:ma})).setErrorHandler(function(pa){this.$ChatAutoSendPhotoUploader12(null,{additionalParams:{errorDialogParams:na},response:{getPayload:function(){return {uploadID:ma};}}});}.bind(this)).setHandler(function(pa){this.$ChatAutoSendPhotoUploader11(null,{response:pa});}.bind(this));oa.send();this.$ChatAutoSendPhotoUploader21(ma,[la]);};ka.prototype.setAllowCrossPage=function(la){this.$ChatAutoSendPhotoUploader6=la;this.$ChatAutoSendPhotoUploader8.setAllowCrossPageTransition(la);};f.exports=ka;},null);