/*!CK:3735640653!*//*1456759353,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["DthY7"]); }

__d("ContentSearchEvents",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CONTENT_SEARCH:"content_search",OPEN_TRAY:"open_tray",QUERY_RESULTS_LOADED:"query_results_loaded",RESULT_SENT:"result_sent",namesByValue:{content_search:"CONTENT_SEARCH",open_tray:"OPEN_TRAY",query_results_loaded:"QUERY_RESULTS_LOADED",result_sent:"RESULT_SENT"}};},null);
__d("MessengerPlatformQueryType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SEARCH:0,MEDIAFY:1,TRENDING:2,SAMPLE:3,namesByValue:["SEARCH","MEDIAFY","TRENDING","SAMPLE"]};},null);
__d('CloseButton.atlas',['PureRenderComponent.atlas','React','XUICloseButton.react','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';var m,n;if(c.__markCompiled)c.__markCompiled();var o=i.PropTypes;m=babelHelpers.inherits(p,i.Component);n=m&&m.prototype;p.propTypes={onClick:o.func,shade:o.oneOf(['light','dark']),size:o.oneOf(['small','medium'])};function p(q,r){n.constructor.call(this,q,r);this.$CloseButton1=this.$CloseButton1.bind(this);}p.prototype.$CloseButton1=function(event){event.preventDefault();if(this.props.onClick)this.props.onClick(event);};p.prototype.render=function(){var q=l(this.props.className,"_5tdj");return (i.createElement('label',{className:q},i.createElement(j,{onClick:this.$CloseButton1,shade:this.props.shade,size:this.props.size})));};f.exports=h.create(p);},null);
__d('Notice.atlas',['CloseButton.atlas','Icon.atlas','PureRenderComponent.atlas','React','Text.atlas','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';var o,p;if(c.__markCompiled)c.__markCompiled();var q=k.PropTypes,r={error:'warning',information:'information-open',success:'check',warning:'warning'},s={type:'warning'};o=babelHelpers.inherits(t,k.Component);p=o&&o.prototype;t.defaultProps=s;t.propTypes={type:q.oneOf(['information','success','warning','error']).isRequired,onClose:q.func};t.prototype.render=function(){return (k.createElement('div',{className:n(this.props.className,"_2c4l"+(this.props.type==='error'?' '+"_2c4m":'')+(this.props.type==='warning'?' '+"_2c4n":'')+(this.props.type==='information'?' '+"_2c4p":'')+(this.props.type==='success'?' '+"_2c4q":'')+(!!this.props.onClose?' '+"_2c4r":''))},k.createElement(i,{className:"_2c4s",name:r[this.props.type]}),k.createElement(l,{className:"_2c4t",color:'dark',display:'block',size:'s'},this.props.children),this.props.onClose?k.createElement(h,{className:"_2c4u",onClick:this.props.onClose}):null));};function t(){o.apply(this,arguments);}f.exports=j.create(t);},null);
__d('relativeTimeString.atlas',['fbt'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j,k){var l=Date.now(),m='',n=null,o=Math.floor((j-l)/1000),p=o<0;o=Math.abs(o);if(o<60){if(k){m=p?h._("just now"):h._("now");}else m=p?h._("Just now"):h._("Now");}else if(o<60*2){m=p?h._("1 minute ago"):h._("1 minute");}else if(o<3600){n=Math.floor(o/60);m=p?h._("{number} minutes ago",[h.param('number',n)]):h._("{number} minutes",[h.param('number',n)]);}else if(o<3600*2){if(k){m=p?h._("about an hour ago"):h._("about an hour");}else m=p?h._("About an hour ago"):h._("About an hour");}else if(o<3600*24){n=Math.floor(o/3600);m=p?h._("{number} hours ago",[h.param('number',n)]):h._("{number} hours",[h.param('number',n)]);}else if(o<3600*24*2){if(k){m=p?h._("about a day ago"):h._("about a day");}else m=p?h._("About a day ago"):h._("About a day");}else if(o<3600*24*30){n=Math.floor(o/3600/24);m=p?h._("{number} days ago",[h.param('number',n)]):h._("{number} days",[h.param('number',n)]);}else if(o<3600*24*30*2){if(k){m=p?h._("about a month ago"):h._("about a month");}else m=p?h._("About a month ago"):h._("About a month");}else if(o<3600*24*30*12){n=Math.floor(o/3600/24/30);m=p?h._("{number} months ago",[h.param('number',n)]):h._("{number} months",[h.param('number',n)]);}else if(o<3600*24*30*24){if(k){m=p?h._("over a year ago"):h._("over a year");}else m=p?h._("Over a year ago"):h._("Over a year");}else{n=Math.floor(o/3600/24/365);m=p?h._("{number} years ago",[h.param('number',n)]):h._("{number} years",[h.param('number',n)]);}return m;}f.exports=i;},null);
__d('FBPaymentsCreditCardExpDateFormField.react',['Image.react','FBPaymentsFormField.react','FBPaymentsFormFieldUtils','React','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=k.PropTypes,o=k.createClass({displayName:'FBPaymentsCreditCardExpDateFormField',propTypes:{initiallyFocused:n.bool,name:n.string.isRequired,onChange:n.func.isRequired,showIcon:n.bool,showPlaceholder:n.bool},getDefaultProps:function(){return {showIcon:true,showPlaceholder:true};},getLimit:function(){return 5;},formatValue:function(p,q,r){var s=String.fromCharCode(r);p=p.replace(/[^0-9\/]+/g,'');var t=p.split('/'),u=t[0],v=t[1];if(v&&v.length===4)p=u+'/'+v.substr(-2);if(!/^\d+$/.test(s)&&r!==191&&r!==111)return p;p=j.stripNonDigits(p);if(/^\d$/.test(p)&&p!=='0'&&p!=='1'){p='0'+p+'/';}else if(p.length>=2&&p.indexOf('/')===-1)p=p.substr(0,2)+'/'+p.substr(2,2);return p;},validate:function(p){var q=p.split('/'),r=new Date(),s=parseInt(r.getFullYear().toString().substring(2),10),t=r.getMonth()+1,u=parseInt(q[0],10),v=parseInt(q[1],10);if(p.length!==5||!u||!v||isNaN(u)||isNaN(v)||u<1||u>12)return false;if(v<s||v===s&&u<t)return false;return true;},render:function(){var p,q,r;if(this.props.showLabel)q=l._("Expiration");if(this.props.showPlaceholder)p=l._("MM\/AA");if(this.props.showIcon)r={normal:k.createElement(h,{height:12,src:m('/images/p2p/events-grey_s.png'),width:12}),focused:k.createElement(h,{height:12,src:m('/images/p2p/events-blue_s.png'),width:12})};return (k.createElement(i,babelHelpers['extends']({autoCompleteName:'cc-exp',formatValue:this.formatValue,icon:r,label:q,limit:this.getLimit(),placeholder:p,ref:'input',validate:this.validate},this.props)));}});f.exports=o;},null);
__d('FBPaymentsCreditCardNumberFormField.react',['Image.react','FBPaymentsFormField.react','FBPaymentsFormFieldUtils','PaymentMethodUtils','React','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=l.PropTypes,p=l.createClass({displayName:'FBPaymentsCreditCardNumberFormField',propTypes:{allowCredit:o.bool,disabled:o.bool,shouldValidateBIN:o.bool,initiallyFocused:o.bool,name:o.string.isRequired,onChange:o.func.isRequired,showIcon:o.bool,showPlaceholder:o.bool,showSecondaryIcon:o.bool,value:o.string},getDefaultProps:function(){return {allowCredit:true,showIcon:true,showPlaceholder:true,showSecondaryIcon:false};},getInitialState:function(){return {errorMessage:null};},calculateLimit:function(q){return (k.getCardType(q).digits+(this.getGrouping(q).length-2));},getGrouping:function(q){var r=[0,4,8,12,16],s=r;switch(k.getCardType(q).name){case 'visa':case 'mc':case 'disc':s=r;break;case 'amex':s=[0,4,10,15];break;case 'diners':s=[0,4,10,14];break;default:s=r;break;}return s;},formatValue:function(q,r,s){return j.formatCardNumber(q,r,s,this.getGrouping(q),' ');},validate:function(q){var r=this.isValidCardType(q),s;if(!this.props.allowCredit){s=m._("Veuillez saisir une carte de d\u00e9bit. Les cartes de cr\u00e9dit ne sont pas accept\u00e9es.");}else s=m._("Saisissez un num\u00e9ro de carte de cr\u00e9dit ou de d\u00e9bit valable.");this.setState({errorMessage:!r?s:null});return !!(k.isValidCCNumber(q)&&r&&!this.props.binError);},isValidCardType:function(q){var r=['mc','visa','unknown'];if(this.props.allowCredit)r.push('diners','disc','jcb','amex');var s=k.getCardType(q),t=s?s.name:'',u=r.indexOf(t)>=0;return u;},getSaveError:function(){return this.props.binError||this.props.saveError;},getSecondaryIcon:function(q){var r,s;if(!this.props.showSecondaryIcon)return null;s=k.getCardType(q).name;switch(s){case 'visa':r=n('/images/payments/icons/modularization/visa-cc.png');break;case 'mc':r=n('/images/payments/icons/modularization/mastercard-cc.png');break;case 'amex':r=n('/images/payments/icons/modularization/amex-cc.png');break;case 'disc':r=n('/images/payments/icons/modularization/discover-cc.png');break;case 'jcb':r=n('/images/payments/icons/modularization/jcb-cc.png');break;default:r=n('/images/payments/icons/modularization/CC.png');break;}return (l.createElement(h,{height:20,src:r,width:30}));},render:function(){var q=m._("Num\u00e9ro de carte"),r,s,t;if(this.props.showLabel){s=q;r='0000 0000 0000 0000';}else if(this.props.showPlaceholder)r=q;if(this.props.showIcon)t={normal:l.createElement(h,{height:12,src:n('/images/p2p/card-grey_s.png'),width:12}),focused:l.createElement(h,{height:12,src:n('/images/p2p/card-blue_s.png'),width:12})};return (l.createElement(i,babelHelpers['extends']({autoCompleteName:'cc-number',cursorPositionUpdater:j.getUpdatedCursorPosition,errorMessage:this.state.errorMessage,formatValue:this.formatValue,getSecondaryIcon:this.getSecondaryIcon,icon:t,label:s,limit:this.calculateLimit,placeholder:r,ref:'input',validate:this.validate,value:this.props.value},this.props,{saveError:this.getSaveError()})));}});f.exports=p;},null);
__d('FBPaymentsForm.react',['FBPaymentsErrorNotice.react','React','cx','getObjectValues'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=i.PropTypes,m=i.createClass({displayName:'FBPaymentsForm',propTypes:{errorTitle:l.string,onValidation:l.func.isRequired,prefilledFormData:l.object,saveErrors:l.object,showIcons:l.bool,showLabels:l.bool,showPlaceholderOnFocus:l.bool,showSecondaryIcons:l.bool,useGutters:l.bool},getDefaultProps:function(){return {prefilledFormData:{},saveErrors:null,showIcons:true,showLabels:false,showPlaceholderOnFocus:false,showSecondaryIcons:false,useGutters:false};},getInitialState:function(){var n=this.props.prefilledFormData,o=this.props.children,p={};i.Children.forEach(o,function(q,r){p[q.props.name]={valid:!q.props.required,value:n?n[q.props.name]:''};});return {fields:p,isValid:false};},_fieldKeyOrder:[],handleFormValueChange:function(n,o,p,q){var r=this.state.fields;r[n]={valid:p,value:o};this.validateForm();if(this.props.autoTab===true&&q&&p){var s=this._fieldKeyOrder.indexOf(n);if(s!==-1){var t=this._fieldKeyOrder[s+1];if(t){var u=this.refs[t];u&&u.refs.input.focusInput();}}}},validateForm:function(){var n=true,o=this.state.fields;n=!k(o).some(function(p){return !p.valid;});this.setState({isValid:n});this.props.onValidation(n,this.serializeFormFields());},serializeFormFields:function(){var n=this.state.fields,o={};for(var p in n)if(n.hasOwnProperty(p))o[p]=n[p].value;return o;},getSaveError:function(n){var o='',p=this.props.saveErrors;if(p&&p.fields&&p.fields[n]){o=p.fields[n].message;if(o.__html)o=o.__html;}return o;},renderGeneralError:function(){var n=this.getGeneralError();if(n)return (i.createElement(h,{error:n}));},getGeneralError:function(){if(this.props.saveErrors&&this.props.saveErrors.general)return this.props.saveErrors.general;return null;},renderFormFields:function(){var n=[],o=[],p=[],q=0,r=this.props.children,s=i.Children.count(r),t=[];i.Children.forEach(r,function(u,v){var w=v===s-1;if(!u)return null;var x=parseInt(u.props.width||'100',10),y=u.props.name;u=i.cloneElement(u,{key:y,onChange:this.handleFormValueChange,saveError:this.getSaveError(y),showIcon:this.props.showIcons,showLabel:this.props.showLabels,showPlaceholderOnFocus:this.props.showPlaceholderOnFocus,showSecondaryIcon:this.props.showSecondaryIcons,useGutter:this.props.useGutters,value:this.state.fields[y].value,ref:y});t.push(y);if(!u.props.ignoreStyling){if(Math.round(q)<100)n.push(u);q+=x;if(Math.round(q)===100||w){o.push(i.createElement('div',{className:(this.props.useGutters?"_284-":'')+(' '+"_284_")+(n.length>1?' '+"_2850":'')+(o.length===0?' '+"_2851":'')+(w?' '+"_2852":''),key:o.length},n));n=[];q=0;}}else p.push(u);}.bind(this));this._fieldKeyOrder=t;return p.concat(o);},render:function(){return (i.createElement('form',{className:"_2853"},this.renderGeneralError(),this.renderFormFields()));}});f.exports=m;},null);
__d('FBPaymentsCreditCardForm.react',['CreditCardFormParam','KappaWrapper','FBPaymentsCreditCardCVCFormField.react','FBPaymentsCreditCardExpDateFormField.react','FBPaymentsCreditCardNumberFormField.react','FBPaymentsCreditCardZipCodeFormField.react','FBPaymentsForm.react','React','emptyFunction','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=o.PropTypes,s=o.createClass({displayName:'FBPaymentsCreditCardForm',propTypes:{allowCredit:r.bool,autoTab:r.bool,binError:r.string,compactMode:r.bool,cscMaxLength:r.number,editMode:r.bool,onValidation:r.func,prefilledFormData:r.object,saveErrors:r.object,showIcons:r.bool,showLabels:r.bool,showPlaceholderOnFocus:r.bool,showSecondaryIcons:r.bool,useGutters:r.bool},getDefaultProps:function(){return {autoTab:false,allowCredit:true,binError:'',compactMode:false,cscMaxLength:null,editMode:false,onValidation:p,prefilledFormData:{},saveErrors:null,showIcons:true,showSecondaryIcons:false,showLabels:false,showPlaceholderOnFocus:false,useGutters:false};},getInitialState:function(){return {formData:{},isValid:false};},componentWillMount:function(){i.start(6,3,0);},handleValidation:function(t,u){this.setState({formData:u,isValid:t});this.props.onValidation(t,u);},isCreditCardNumberMasked:function(){return this.props.editMode;},isCreditCardNumberFocused:function(){return !this.props.editMode;},isExpFocused:function(){return this.props.editMode;},getSaveErrors:function(){if(this.props.binError)return {general:{message:this.props.binError}};return this.props.saveErrors;},render:function(){var t=this.props.compactMode;return (o.createElement(n,{autoTab:this.props.autoTab,errorTitle:q._("Probl\u00e8me d\u2019enregistrement de la carte"),prefilledFormData:this.props.prefilledFormData,onValidation:this.handleValidation,saveErrors:this.getSaveErrors(),showIcons:this.props.showIcons,showLabels:this.props.showLabels,showPlaceholderOnFocus:this.props.showPlaceholderOnFocus,showSecondaryIcons:this.props.showSecondaryIcons,useGutters:this.props.useGutters},o.createElement(l,{allowCredit:this.props.allowCredit,binError:this.props.binError,disabled:this.isCreditCardNumberMasked(),initiallyFocused:this.isCreditCardNumberFocused(),name:h.CARD_NUMBER,required:true,width:t?75:100}),o.createElement(k,{initiallyFocused:this.isExpFocused(),name:h.CARD_EXPIRATION,required:true,width:t?25:50}),o.createElement(j,{creditCardNumber:this.state.formData[h.CARD_NUMBER],cscMaxLength:this.props.cscMaxLength,name:h.CSC,required:true,width:t?25:50}),o.createElement(m,{name:h.ZIP,required:true,width:t?30:100})));}});f.exports=s;},null);
__d("XMessengerPlatformContentSearchController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/content_search\/",{q:{type:"String",defaultValue:""},qtype:{type:"Enum",defaultValue:0,enumType:0},resume:{type:"String",defaultValue:""}});},null);
__d('ChatContentSearch',['AsyncRequest','MessengerPlatformQueryType','XMessengerPlatformContentSearchController'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k={getContentForQuery:function(l){var m=l.query,n=l.callback,o=l.resume,p=j.getURIBuilder().setString('q',m).setString('resume',o).getURI(),q=new h().setURI(p).setHandler(n);q.send();return q;},getTrending:function(l,m){var n=j.getURIBuilder().setEnum('qtype',i.TRENDING).setString('resume',m).getURI(),o=new h().setURI(n).setHandler(l);o.send();return o;}};f.exports=k;},null);
__d('ChatContentSearchContextualDialog.react',['ContextualLayerAutoFlipHorizontal','LayerHideOnEscape','ReactAbstractContextualDialog','ReactLayer','cx'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=k.createClass(j.createSpec({addedBehaviors:[h,i],displayName:'StickerXUIContextualDialog',theme:{wrapperClassName:"_53ii",arrowDimensions:{offset:47,length:16}}}));f.exports=m;},null);
__d('ChatContentSearchResult.react',['Image.react','ReactComponentWithPureRenderMixin','React','cx'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=274,n=137,o=j.createClass({displayName:'ChatContentSearchResult',mixins:[i],propTypes:{isWide:l.bool.isRequired,onClick:l.func.isRequired,result:l.object.isRequired,src:l.string.isRequired},statics:{isWide:function(p){var q=p.media.preview;return q.width>q.height*1.2;},getScaledDimensions:function(p,q){var r=p.media.preview,s=r.height,t=r.width,u=(q?m:n)/t;s*=u;t*=u;return {height:s,width:t};}},render:function(){var p=o.getScaledDimensions(this.props.result,this.props.isWide);return (j.createElement(h,{className:"_358"+(this.props.isWide?' '+"_26n6":''),onClick:this._handleClick,src:this.props.src,style:p}));},_handleClick:function(p){p.stopPropagation();this.props.onClick(this.props.result);}});f.exports=o;},null);
__d('ChatContentSearchResults.react',['ChatContentSearch','ChatContentSearchResult.react','MercuryConfig','MessengerSpinner.react','ReactComponentWithPureRenderMixin','React','ScrollableArea.react','debounce','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=m.PropTypes,r={},s=m.createClass({displayName:'ChatContentSearchResults',_inflightRequest:undefined,_requestResults:p,_reset:p,_inflightTimeStart:undefined,mixins:[l],propTypes:{onResultsLoaded:q.func,onSelect:q.func.isRequired,query:q.string.isRequired},getInitialState:function(){return {isLoading:false,response:null,results:[]};},componentDidMount:function(){this._reset=o(this._resetImpl,100);this._requestResults=o(this._requestResultsImpl,200);this._requestResults();},componentWillUnmount:function(){this._cancelInflightRequest();},componentWillReceiveProps:function(t){if(t.query!==this.props.query)this._reset(this._requestResults);},render:function(){return (m.createElement(n,{fade:true,onScroll:this._handleScroll,ref:'scrollable'},this._renderResults(),this._renderLoadingIndicator()));},_renderLoadingIndicator:function(){if(!this.state.isLoading)return null;return (m.createElement('div',{style:{marginTop:this.state.response?'10px':'140px',textAlign:'center'}},m.createElement(k,{color:'grey',size:k.Sizes.SMALL})));},_requestResultsImpl:function(){this._cancelInflightRequest();this._inflightTimeStart=Date.now();if(this.state.response&&(!this.state.response.resultNextCursor||!this.props.query))return;var t;this.setState({isLoading:true});if(this.props.query){t=h.getContentForQuery({query:this.props.query,resume:this.state.response?this.state.response.resultNextCursor:undefined,callback:this._handleAsyncResponse});}else t=h.getTrending(this._handleAsyncResponse,this.state.response?this.state.response.resultNextCursor:undefined);this._inflightRequest=t;},_handleAsyncResponse:function(t){if(this._inflightRequest===t.request){r=babelHelpers['extends']({},r,t.payload.attribution);this.setState({isLoading:false,response:t.payload,results:t.payload.resultGroup[0]?this.state.results.concat(t.payload.resultGroup[0].results):this.state.results},function(){if(this._inflightTimeStart){if(this.props.onResultsLoaded)this.props.onResultsLoaded(Date.now()-this._inflightTimeStart);delete this._inflightTimeStart;}}.bind(this));delete this._inflightRequest;}},_cancelInflightRequest:function(){this.setState({isLoading:false});if(this._inflightRequest){this._inflightRequest.abort();delete this._inflightRequest;delete this._inflightTimeStart;}},_renderResults:function(){if(!this.state.response||!this.state.results.length)return null;return this.state.results.map(function(t,u){var v=i.isWide(t);if(!v&&t.platformFBID.toString()!==j.MessengerAppID){var w=u-this._getPrevWideIndex(u),x=this._getNextWideIndex(u)-u;v=(w<=1||w%2!==0)&&x<=1;}return (m.createElement(i,{isWide:v,key:'result:'+u+':'+t.resultID,onClick:this._handleResultClick,result:t,src:t.media.preview.url}));}.bind(this));},_getPrevWideIndex:function(t){while(t>0){--t;if(i.isWide(this.state.results[t]))return t;}return t;},_getNextWideIndex:function(t){var u=this.state.results.length;while(t<u-1){++t;if(i.isWide(this.state.results[t]))return t;}return t;},_handleResultClick:function(t){this.props.onSelect(t,r[t.platformFBID]);},_handleScroll:function(){if(this._isScrolledNearBottom()&&!this._inflightRequest)this._requestResults();},_isScrolledNearBottom:function(){var t=this.refs.scrollable.getArea();return !!(t&&t.distanceToBottom()<=50);},_resetImpl:function(t){this.setState(this.getInitialState(),t);}});f.exports=s;},null);
__d('ChatContentSearchTrendingIndicator.react',['Image.react','React','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';var m,n;if(c.__markCompiled)c.__markCompiled();m=babelHelpers.inherits(o,i.Component);n=m&&m.prototype;function o(p){n.constructor.call(this,p);}o.prototype.shouldComponentUpdate=function(p){return p.shown!==this.props.shown;};o.prototype.render=function(){return this.props.shown?i.createElement('div',{className:"_515"},i.createElement(h,{src:l('/images/chat/composer/composerSearchTrending.png')}),k._("Populaire")):null;};f.exports=o;},null);
__d('MessengerSearchInput.react',['AbstractTextInput.react','ReactComponentWithPureRenderMixin','React','XUICloseButton.react','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=j.PropTypes,o=j.createClass({displayName:'MessengerSearchInput',mixins:[i],propTypes:{isFocused:n.bool,onBlur:n.func,onChange:n.func,onClear:n.func,onEnter:n.func,onFocus:n.func,placeholder:n.string,value:n.string.isRequired},render:function(){return (j.createElement('div',{className:m(this.props.className,"_5iwm"+(this.props.isFocused||!!this.props.value?' '+"_5iwn":'')),role:'search'},j.createElement(h,{className:"_3deo",onBlur:this.props.onBlur,onChange:this.props.onChange,onEnter:this.props.onEnter,onFocus:this.props.onFocus,placeholder:this.props.placeholder,ref:'inputField',value:this.props.value}),j.createElement(k,{size:'small',onMouseDown:this.props.onClear,className:(this.props.value.length===0?"hidden_elem":'')+(' '+"_2xme")})));},focusInput:function(){this.refs.inputField.focusInput();}});f.exports=o;},null);
__d('ChatContentSearchFlyout.react',['ChatContentSearchResults.react','ChatContentSearchTrendingIndicator.react','Keys','MessengerSearchInput.react','ReactComponentWithPureRenderMixin','React','MercuryShareAttachmentRenderLocations','XUITextInput.react','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=m.PropTypes,s=' ',t=/\s+/g,u=m.createClass({displayName:'ChatContentSearchFlyout',mixins:[l],propTypes:{location:r.oneOf(n.getValues()),onEscKeyDown:r.func,onResultsLoaded:r.func,onSelect:r.func.isRequired,query:r.string},getInitialState:function(){return {query:this.props.query,viewerEnteredText:false};},componentWillReceiveProps:function(v){if(!this.state.viewerEnteredText)this.setState({query:v.query});},render:function(){var v=this._normalize(this.state.query);return (m.createElement('div',{className:"_1er4",onKeyDown:this._handleKeyDown},m.createElement('div',{className:"_3mtr"},this._renderTextInput()),m.createElement('div',{className:"_3mts"},m.createElement(h,{onResultsLoaded:this.props.onResultsLoaded,onSelect:this.props.onSelect,query:v}),m.createElement(i,{shown:v.length===0}))));},_renderTextInput:function(){var v=this.props.location===n.MESSENGER?k:o;return (m.createElement(v,{className:"_4qcs",isFocused:true,onChange:this._handleInputChange,onClear:function(){this.setState({query:'',viewerEnteredText:false});}.bind(this),placeholder:q._("Rechercher des GIF et des autocollants dans les apps..."),ref:'input',value:this.state.query||''}));},_handleInputChange:function(v){this.setState({query:v.target.value,viewerEnteredText:v.target.value.length>0});},_normalize:function(v){return (v||'').trim().replace(t,s).toLowerCase();},_handleKeyDown:function(v){if(v.keyCode===j.ESC&&this.props.onEscKeyDown)this.props.onEscKeyDown();}});f.exports=u;},null);
__d('ChatContentSearchButton.react',['BanzaiLogger','ChatContentSearchFlyout.react','ContentSearchEvents','ChatContentSearchContextualDialog.react','Link.react','ReactComponentWithPureRenderMixin','React','ReactLayeredComponentMixin','MercuryShareAttachmentRenderLocations','cx','fbt','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';if(c.__markCompiled)c.__markCompiled();var t=n.PropTypes,u=n.createClass({displayName:'ChatContentSearchButton',_clickGuard:false,mixins:[m,o],propTypes:{ContextualDialogClass:t.func,flyoutAlignment:t.oneOf(['left','right']),getQuery:t.func.isRequired,location:t.oneOf(p.getValues()),onLoad:t.func,onSelect:t.func.isRequired},getDefaultProps:function(){return {flyoutAlignment:'left',location:p.CHAT};},getInitialState:function(){return {query:'',shown:false};},componentDidMount:function(){this.props.onLoad&&this.props.onLoad(this);},updateQuery:function(){this.setState({query:this.props.getQuery()});},hideFlyout:function(){this.setState(this.getInitialState());},render:function(){return (n.createElement(l,{className:s(this.props.className,this.state.shown?"open":''),href:'#',onMouseDown:this._handleMouseDown,onClick:this._handleClick,role:'button',title:r._("Choisissez un gif ou un autocollant"),ref:'link'}));},renderLayers:function(){if(!this.state.shown)return {contextualDialog:null};var v=this.props.ContextualDialogClass||k;return {contextualDialog:n.createElement(v,{alignment:this.props.flyoutAlignment,contextRef:function(){return this.refs.link;}.bind(this),onBlur:this.hideFlyout,onToggle:this._handleContextualDialogToggle,shown:this.state.shown,width:278},n.createElement(i,{location:this.props.location,onEscKeyDown:this.hideFlyout,onResultsLoaded:this._handleResultsLoaded,onSelect:this._handleSelect,query:this.state.query}))};},_handleMouseDown:function(v){this._clickGuard=this.state.shown;},_handleClick:function(v){v.stopPropagation();if(this.state.shown||this._clickGuard)return;this.setState({query:this.props.getQuery(),shown:!this.state.shown});h.log('ContentSearchLoggerConfig',{event:j.OPEN_TRAY,query:this.state.query});},_handleSelect:function(v,w){this.props.onSelect(v,w);this.setState(this.getInitialState());h.log('ContentSearchLoggerConfig',{event:j.RESULT_SENT,query:this.state.query,resultid:v.resultID});},_handleContextualDialogToggle:function(v){this.setState({shown:v});},_handleResultsLoaded:function(v){h.log('ContentSearchLoggerConfig',{event:j.QUERY_RESULTS_LOADED,query:this.state.query,inflighttime:v});}});f.exports=u;},null);
__d('MessengerSignals',['EventEmitter'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=new h(),j='resize',k={resize:function(){i.emit(j);},onResize:function(l){return i.addListener(j,l);}};f.exports=k;},null);
__d('MessengerAttachmentImageBlock.react',['React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=h.PropTypes,l=h.createClass({displayName:'MessengerAttachmentImageBlock',propTypes:{attachment:k.object.isRequired},render:function(){return (h.createElement('div',{className:j(this.props.className,this._computeClass())},this._renderImage(),h.createElement('div',{className:"_5swm"},this.props.children)));},_renderImage:function(){if(!this.props.attachment.media||!this.props.attachment.media.image)return null;var n=this._getDimensions(),o=n.height,p=n.width,q=o>p,r=m(o,p),s=o&&p?o/p*100:100,t=q||r?.2:1,u=q||r?s:52,v={backgroundImage:'url('+this.props.attachment.media.image+')',minHeight:'0px',paddingBottom:q&&s>150?'136px':u*t+'%'};if(this.props.attachment.description&&this.props.attachment.source)v.minHeight='112px';return (h.createElement('div',{className:"_3xn1",style:v}));},_computeClass:function(){if(!this.props.attachment.media||!this.props.attachment.media.image)return "_3xn3 _5swn";var n=this._getDimensions(),o=n.height,p=n.width,q=o>p,r=m(o,p);return "_3xn3"+(r&&!q?' '+"_3xn5":'')+(q?' '+"_3xn6":'')+(p>=o&&!r?' '+"_3xn7":'');},_getDimensions:function(){var n=this.props.attachment.properties||this.props.attachment.media.image_size||{},o=n.height,p=n.width;if(o&&p){o=parseInt(o,10);p=parseInt(p,10);return {height:o,width:p};}return {height:0,width:0};}});function m(n,o){return n<=300&&o<=300;}f.exports=l;},null);
__d('MessengerFlexArea.react',['Event','MessengerSignals','React','ReactDOM','ResponsiveBlock.react','Style','SubscriptionsHandler','Vector','getScrollPosition','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=j.PropTypes,s=j.createClass({displayName:'MessengerFlexArea',propTypes:{beforeResize:r.func,onResize:r.func},_subscriptions:null,_onResizeTimeout:null,getInitialState:function(){return {height:0};},componentDidMount:function(){var t=new n();t.addSubscriptions(h.listen(window,'resize',q(this.recalculateHeight,51)),i.onResize(function(){this.recalculateHeight();}.bind(this)));this._subscriptions=t;this.recalculateHeight();},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();clearTimeout(this._onResizeTimeout);},render:function(){return (j.createElement(l,{className:this.props.className,onResize:this._handleResponsiveBlockResize,style:{height:this.state.height+'px'}},this.props.children));},recalculateHeight:function(){if(!this.isMounted())return;var t=k.findDOMNode(this),u=t.parentNode,v=this.state.height,w=o.getViewportDimensions().y,x=false;if(u&&m.get(u,'display')==='none'){m.set(u,'display','initial');x=true;}w-=o.getElementPosition(u||t).y;var y=p(window);w+=y.y;if(u){Array.from(u.childNodes).forEach(function(z){if(z.nodeType===Node.COMMENT_NODE||m.get(z,'position')==='absolute')return;w-=o.getElementDimensions(z).y;});w+=o.getElementDimensions(t).y;}if(x)m.set(u,'display','');if(isNaN(w)||w<0)w=0;if(w!==v){this.props.beforeResize&&this.props.beforeResize();this.setState({height:w},this.props.onResize);}},_handleResponsiveBlockResize:q(function(t,u){if(!this.isMounted())return;if(u===this.state.height){this.props.beforeResize&&this.props.beforeResize();clearTimeout(this._onResizeTimeout);if(this.props.onResize)this._onResizeTimeout=setTimeout(this.props.onResize,0);}},51)});f.exports=s;},null);
__d('MessengerScrollableArea.react',['React','ReactDOM','ScrollableArea.react','Style','UserAgent','clearImmediate','cx','joinClasses','setImmediate','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=h.PropTypes,s=20,t=h.createClass({displayName:'MessengerScrollableArea',propTypes:{onScroll:r.func,width:r.number},_resizeCallback:null,componentDidMount:function(){this._resizeCallback=p(this._resize);},componentWillUnmount:function(){m(this._resizeCallback);},render:function(){return (h.createElement(j,{className:o("_5f0v",this.props.className),onScroll:this._handleScroll,ref:'scrollable',shadow:false,style:this.props.style,tabIndex:this.props.tabIndex,width:this.props.width},this.props.children));},_handleScroll:q(function(){var u;this.props.onScroll&&(u=this.props).onScroll.apply(u,arguments);},50),_resize:function(){if(!l.isBrowser('IE'))return;var u=this.refs.scrollable.refs.wrap,v=this.refs.scrollable.refs.body;if(!v||!u)return;v=i.findDOMNode(v);u=i.findDOMNode(u);var w=u.offsetWidth-u.clientWidth;if(w>0)k.set(v,'margin-right',-w+'px');},getArea:function(){return this.refs.scrollable.getArea();},scrollToBottom:function(){var u=this.getArea();if(u)this.scrollToPosition(u.getScrollHeight());},scrollToTop:function(u){var v=this.getArea();if(v)v.scrollToTop(!!u);},scrollToPosition:function(u){var v=this.getArea();if(!v)return;v.setScrollTop(u,false);},isScrolledToBottom:function(){return this.isScrolledToBottomWithHeight(0);},isScrolledToBottomWithHeight:function(u){var v=this.getArea();if(!v)return false;return v.getScrollTop()+v.getClientHeight()+u>=v.getScrollHeight()-s;},isScrolledToTop:function(){var u=this.getArea();if(!u)return true;return u.getScrollTop()<=s;},getScrollTop:function(){var u=this.getArea();if(!u)return 0;return u.getScrollTop();}});f.exports=t;},null);
__d('MessengerFlexScrollableArea.react',['MessengerFlexArea.react','MessengerScrollableArea.react','React'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=j.PropTypes,l=j.createClass({displayName:'MessengerFlexScrollableArea',propTypes:{flexChildren:k.node,onScroll:k.func,shouldStickToBottom:k.bool},render:function(){return (j.createElement(h,{beforeResize:this._prepareForResize,className:this.props.className,onResize:this._handleResize,ref:'flexArea'},this.props.flexChildren,j.createElement(i,{height:'100%',onScroll:this.props.onScroll,ref:'scrollable',tabIndex:this.props.tabIndex},this.props.children)));},getArea:function(){return this.refs.scrollable.getArea();},_prepareForResize:function(){this._wasScrolledToBottom=this.refs.scrollable.isScrolledToBottom();},_handleResize:function(){if(this._wasScrolledToBottom&&this.props.shouldStickToBottom)this.refs.scrollable.scrollToBottom();},handleResize:function(){this.refs.flexArea&&this.refs.flexArea.recalculateHeight();},scrollToBottom:function(){this.refs.scrollable.scrollToBottom();},scrollToTop:function(m){this.refs.scrollable.scrollToTop(m);},scrollToPosition:function(m){this.refs.scrollable.scrollToPosition(m);},isScrolledToBottom:function(){return this.refs.scrollable.isScrolledToBottom();},isScrolledToBottomWithHeight:function(m){return this.refs.scrollable.isScrolledToBottomWithHeight(m);},isScrolledToTop:function(){return this.refs.scrollable.isScrolledToTop();},getScrollTop:function(){return this.refs.scrollable.getScrollTop();}});f.exports=l;},null);
__d('MNCommerceBubbleImage.react',['React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=h.PropTypes,l=h.createClass({displayName:'MNCommerceBubbleImage',propTypes:{location:k.string,source:k.string.isRequired,width:k.number},render:function(){return (h.createElement('div',{className:j("_4y9n",this.props.className),style:{backgroundImage:'url(\''+this.props.source+'\')'}}));}});f.exports=l;},null);
__d('MNCommerceAgentItemSuggestionMercuryAttachment.react',['Image.react','LeftRight.react','Link.react','LineClamp.react','MercuryShareAttachmentRenderLocations','MNCommerceAgenItemSuggestionReactShape','MNCommerceBubbleImage.react','React','ReactComponentWithPureRenderMixin','ix','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';if(c.__markCompiled)c.__markCompiled();var t=o.PropTypes,u=3,v=o.createClass({displayName:'MNCommerceAgentItemSuggestionMercuryAttachment',mixins:[p],propTypes:{isPurchased:t.bool,itemSuggestion:m.isRequired,location:t.oneOf(l.getValues()),onBuyClick:t.func,width:t.number},render:function(){var w=this.props.itemSuggestion,x=w.thumb_url?o.createElement('div',{className:"_522n"},o.createElement(n,{location:this.props.location,source:w.thumb_url,width:this.props.width})):null,y=null;if(w.desc)y=o.createElement(k,{lines:u},w.desc);var z={};if(this.props.location===l.CHAT&&this.props.width)z.width=this.props.width;var aa=o.createElement('div',{className:(!w.target_url?"_522-":'')+(this.props.location===l.WEB_INBOX?' '+"_1hf9":''),style:z},x,o.createElement('div',{className:"_522o"},o.createElement('div',{className:"_522p"},w.name),y,o.createElement('div',{className:"_522q"},w.merchant_name)),this._renderFooter());if(w.target_url)return (o.createElement(j,{className:"_522-",href:w.target_url,target:'_blank',shimhash:w.shimhash},aa));return aa;},_renderFooter:function(){var w=this.props.itemSuggestion.total_cost;if(!w||w.amount<=0)return null;var x;if(!this.props.isPurchased){x=o.createElement('div',{className:"_522s",onClick:this._onBuyClick},s._("Obtenir"));}else x=o.createElement('div',{className:"_1x98"},o.createElement(h,{className:"_1x99",src:q('/images/messaging/commerce/paid_check.png')}),s._("Pay\u00e9"));return (o.createElement(i,{className:"_522r"},s._("Total\u00a0: {total cost}",[s.param('total cost',this.props.itemSuggestion.display_total_cost)]),x));},_onBuyClick:function(w){w.preventDefault();this.props.onBuyClick&&this.props.onBuyClick();}});f.exports=v;},null);
__d('MercuryFallbackShareAttachmentTextBlock.react',['LineClamp.react','MercuryShareAttachmentRenderLocations','MercuryShareAttachmentReactShape','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=k.PropTypes,n=k.createClass({displayName:'MercuryFallbackShareAttachmentTextBlock',propTypes:{attachment:j,location:m.oneOf(i.getValues())},render:function(){if(!this.props||!this.props.attachment)return k.createElement('div',{className:"__6j"});var o,p,q;if(i.MESSENGER===this.props.location){if(this.props.attachment.description)p=k.createElement('div',{className:"__6l"},k.createElement(h,{customEllipsis:" ",lines:2,lineHeight:16},this.props.attachment.description));if(this.props.attachment.title)o=k.createElement('div',{className:"__6k"},k.createElement(h,{customEllipsis:" ",lines:2,lineHeight:18},this.props.attachment.title));if(this.props.attachment.source)q=k.createElement('div',{className:"__6m"},this.props.attachment.source);return (k.createElement('div',{className:"__6j"},o,p,q));}if(this.props.attachment.title)o=k.createElement('div',{className:"__6k"},this.props.attachment.title);if(this.props.attachment.description)p=k.createElement('div',{className:"__6l"},this.props.attachment.description);if(this.props.attachment.source)q=k.createElement('div',{className:"__6m"},this.props.attachment.source);return (k.createElement('div',{className:"__6j"},o,p,q));}});f.exports=n;},null);
__d('MercuryShareImage.react',['ChatImageArrowDirection','ChatImageWithArrow.react','React','cx'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=j.createClass({displayName:'MercuryShareImage',propTypes:{height:l.number.isRequired,round:l.bool,source:l.string.isRequired,width:l.number.isRequired},render:function(){return (j.createElement('div',{className:"_4hsl"},j.createElement(i,{arrowDirection:h.BOTH,height:this.props.height,round:!!this.props.round,source:this.props.source,width:this.props.width})));}});f.exports=m;},null);
__d('MercuryFallbackShareAttachmentContent.react',['Image.react','ImageBlock.react','MercuryFallbackShareAttachmentTextBlock.react','MercuryShareAttachmentRenderLocations','MercuryShareAttachmentReactShape','MercuryShareImage.react','MessengerAttachmentImageBlock.react','React','URI','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){'use strict';if(c.__markCompiled)c.__markCompiled();var s=o.PropTypes,t=72,u=o.createClass({displayName:'MercuryFallbackShareAttachmentContent',propTypes:{attachment:l,location:s.oneOf(k.getValues())},render:function(){var v=this.props.attachment,w=this.props.location,x=(k.CHAT===w?"_49or":'')+(k.WEB_INBOX===w?' '+"__nm":'')+(k.CHAT_PREVIEW===w?' '+"_324d":'')+(k.CHAT!==w?' '+"_tih":'')+(!(v&&v.media.image)?' '+"_49ou":'');if(v.media&&v.media.image){if(k.CHAT===w||k.CHAT_PREVIEW===w){return (o.createElement(i,{className:x,spacing:'medium'},o.createElement(m,{height:t,source:v.media.image,width:t}),o.createElement('div',{style:{display:'flex',justifyContent:'center',flexDirection:'column',height:t}},o.createElement(j,this.props))));}else if(k.MESSENGER===w)return (o.createElement(n,{className:x,attachment:v},o.createElement(j,this.props),this.props.children));return (o.createElement(i,{className:r(this.props.className,x)},o.createElement(h,{className:"__6n",src:v.media.image,width:t}),o.createElement(j,this.props),this.props.children));}return (o.createElement('div',{className:r(this.props.className,x)},o.createElement(j,this.props),this.props.children));}});f.exports=u;},null);
__d('MercuryFallbackShareAttachment.react',['Link.react','MercuryFallbackShareAttachmentContent.react','MercuryShareAttachmentRenderLocations','MercuryShareAttachmentReactShape','MessengerAdsWebTypedLogger','MNAdsLoggerEventEnum','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=n.PropTypes,q=n.createClass({displayName:'MercuryFallbackShareAttachment',propTypes:{attachment:k,isSponsored:p.bool,location:p.oneOf(j.getValues()),messageID:p.string,pageID:p.string},renderLink:function(r){if(j.isPreview(this.props.location))return r;return (n.createElement(h,{className:"_5rw4",href:this.props.attachment.uri,onClick:this._onClick,target:'_blank'},r));},render:function(){return this.renderLink(n.createElement(i,this.props));},_onClick:function(event){if(this.props.isSponsored){var r=this.props.attachment&&this.props.attachment.subattachments;if(!r)return;for(var s=r,t=Array.isArray(s),u=0,s=t?s:s[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var v;if(t){if(u>=s.length)break;v=s[u++];}else{u=s.next();if(u.done)break;v=u.value;}var w=v;new l().setEvent(m.LINK_CLICK).setIsSponsored(this.props.isSponsored).setItemID(w&&w.id).setMessageID(this.props.messageID).setPageID(this.props.pageID).log();}}}});f.exports=q;},null);
__d('P2PCreditCardForm.react',['CreditCardFormParam','FBPaymentsCreditCardForm.react','MessengerPaymentProductType','P2PAPIUtils','P2PAPI','React','getObjectValues'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=m.PropTypes,p=m.createClass({displayName:'P2PCreditCardForm',propTypes:{asyncRequestState:o.object,onValidation:o.func.isRequired,productType:o.oneOf(n(j))},getDefaultProps:function(){return {asyncRequestState:{},productType:j.P2P};},getInitialState:function(){return {binError:'',previousBINNumber:'',validateBINRequestID:''};},componentWillReceiveProps:function(q){var r=q.asyncRequestState,s=r?r[this.state.validateBINRequestID]:null;if(s){this.setState({validateBINRequestID:''});if(s.error){this.handleValidateBINNumberError(s.error);}else this.handleValidateBINNumberSuccess();}},handleValidateBINNumberSuccess:function(){this.setState({binError:''});},handleValidateBINNumberError:function(q){var r=q.message;this.setState({binError:r});},validateBIN:function(q){var r,s;q=q.replace(/ /g,'');r=q.substr(0,6);if(r!==this.state.previousBINNumber&&r.length>=6){s=k.genRequestID();this.setState({validateBINRequestID:s});l.validateBINNumber({binNumber:r,requestID:s});}else if(r.length<6)this.setState({binError:'',validateBINRequestID:''});this.setState({previousBINNumber:r});},handleValidation:function(q,r){var s=r[h.CARD_NUMBER];if(!this.props.editMode&&this.props.productType===j.P2P&&s)this.validateBIN(s);this.props.onValidation(q,r);},render:function(){return (m.createElement(i,babelHelpers['extends']({},this.props,{allowCredit:this.props.productType===j.MESSENGER_COMMERCE,binError:this.state.binError,onValidation:this.handleValidation})));}});f.exports=p;},null);
__d('P2PAddCreditCardDialog.react',['CurrentEnvironment','Link.react','MessengerPaymentProductType','P2PAPI','P2PAPIUtils','P2PCreditCardStore','P2PCreditCardForm.react','P2PLoadingMask.react','P2PLogger','P2PPaymentLoggerEvent','P2PLinkConstants','React','P2PButton.react','P2PDialog.react','P2PDialogTitle.react','P2PDialogBody.react','P2PDialogFooter.react','P2PText.react','cx','emptyFunction','fbt','getObjectValues'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){'use strict';if(c.__markCompiled)c.__markCompiled();var da=s.PropTypes,ea='fbP2PAddCreditCardDialog_learnMoreSentenceID',fa=s.createClass({displayName:'P2PAddCreditCardDialog',propTypes:{cancelButtonText:da.string,eventFlow:da.string.isRequired,loggingData:da.object,loggingObjectID:da.string,onCancel:da.func,onSuccess:da.func,productType:da.oneOf(ca(j)),saveButtonText:da.string,showCancelButton:da.bool,text:da.string,title:da.string},getDefaultProps:function(){var ga;if(h.messengerdotcom){ga=480;}else ga=430;return {cancelButtonText:ba._("Annuler"),loggingData:{},onCancel:aa,onSuccess:aa,productType:j.P2P,saveButtonText:ba._("Enregistrer"),showCancelButton:true,text:ba._("Veuillez saisir une carte de d\u00e9bit. Les cartes de cr\u00e9dit ne sont pas accept\u00e9es."),title:ba._("Ajouter une carte de d\u00e9bit"),width:ga};},getInitialState:function(){return {isValid:false,formData:{},loading:false,requestID:'',saveErrors:null};},onCreditCardStoreChange:function(){var ga=m.getAsyncRequestState(),ha=ga[this.state.requestID];this.setState({asyncRequestState:ga});if(ha){this.setState({requestID:''});if(ha.error){this.handleOnSaveError(ha.error);}else this.handleOnSaveSuccess(ha);}},componentDidMount:function(){this.log(q.UI_ACTN_INITIATE_ADD_CARD);this.creditCardStoreSub=m.addListener('change',this.onCreditCardStoreChange);},componentWillUnmount:function(){if(this.creditCardStoreSub){this.creditCardStoreSub.remove();this.creditCardStoreSub=null;}},log:function(ga,ha){p.log(ga,babelHelpers['extends']({www_event_flow:this.props.eventFlow,object_id:this.props.loggingObjectID},this.props.loggingData,ha));},onSaveClick:function(){var ga=l.genRequestID();this.setState({loading:true,requestID:ga,saveErrors:null});this.log(q.UI_ACTN_CONFIRM_CARD_DETAILS);k.addCreditCard(babelHelpers['extends']({requestID:ga,product_type:this.props.productType},this.state.formData));},handleOnSaveSuccess:function(ga){this.props.onSuccess(ga);this.log(q.UI_ACTN_ADD_CARD_SUCCESS);},handleOnSaveError:function(ga){this.setState({loading:false,saveErrors:ga});this.log(q.UI_ACTN_ADD_CARD_FAIL,{message:ga&&ga.general?ga.general.message:''});},handleValidation:function(ga,ha){this.setState({isValid:ga,formData:ha});},isSaveButtonDisabled:function(){return this.state.loading||!this.state.isValid;},onToggle:function(ga){if(!ga){this.props.onCancel();this.log(q.UI_ACTN_CANCEL_ADD_CARD);}},onCancelClicked:function(){this.onToggle(false);},renderAddCardForm:function(){var ga,ha=this.props.title;if(this.props.showCancelButton)ga=s.createElement(t,{use:'default',size:'medium',label:this.props.cancelButtonText,disabled:this.state.loading,onClick:this.onCancelClicked});return (s.createElement('div',null,s.createElement(v,null,ha),s.createElement(w,null,s.createElement(y,{type:'primary',className:"_3-96"},this.props.text),s.createElement(n,{asyncRequestState:this.state.asyncRequestState,compactMode:true,onValidation:this.handleValidation,productType:this.props.productType,saveErrors:this.state.saveErrors,showIcons:false,showLabels:true,showPlaceholderOnFocus:true,showSecondaryIcons:true,useGutters:true}),s.createElement(y,{className:"_3-8y",id:ea,type:'secondary'},ba._("Vos informations de paiement sont stock\u00e9es de mani\u00e8re s\u00e9curis\u00e9e."),s.createElement('div',null,s.createElement(i,{'aria-describedby':ea,href:r.addDebitCardHelpURI,target:'_blank'},ba._("En savoir plus"))))),s.createElement(x,{leftContent:this.props.leftContent},ga,s.createElement(t,{use:'confirm',size:'medium',label:this.props.saveButtonText,disabled:this.isSaveButtonDisabled(),onClick:this.onSaveClick}))));},render:function(){return (s.createElement(u,{behaviors:this.props.behaviors,layerHideOnBlur:false,ref:'dialog',onToggle:this.onToggle,repositionOnUpdate:true,shown:true,width:this.props.width},this.renderAddCardForm(),s.createElement(o,{visible:this.state.loading})));}});f.exports=fa;},null);
__d('P2PChooseCreditCardDialog.react',['CurrentEnvironment','P2PButton.react','P2PChooseCreditCardForm.react','P2PCreditCard','P2PDialog.react','P2PDialogBody.react','P2PDialogFooter.react','P2PDialogTitle.react','P2PLoadingMask.react','P2PText.react','React','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){'use strict';if(c.__markCompiled)c.__markCompiled();var u=h.messengerdotcom,v=r.PropTypes,w=r.createClass({displayName:'P2PChooseCreditCardDialog',propTypes:{addCardOptionText:v.string,cancelButtonText:v.string,creditCards:v.arrayOf(v.instanceOf(k)).isRequired,onAddDebitCardOptionSelected:v.func.isRequired,onClose:v.func.isRequired,onSelected:v.func.isRequired,saveButtonText:v.string.isRequired,selectedCreditCard:v.instanceOf(k).isRequired,showCancelButton:v.bool,showLoading:v.bool,text:v.string,title:v.string,width:v.number},getDefaultProps:function(){return {cancelButtonText:t._("Annuler"),showCancelButton:false,text:t._("Vous pouvez utiliser une carte de d\u00e9bit d\u00e9j\u00e0 ajout\u00e9e \u00e0 Facebook ou en ajouter une autre."),title:t._("S\u00e9lectionner une carte de d\u00e9bit")};},getInitialState:function(){return {loading:false,selectedCreditCard:this.props.selectedCreditCard};},handleAddDebitCardOptionClicked:function(){this.props.onAddDebitCardOptionSelected();},handleCreditCardSelected:function(x){this.setState({selectedCreditCard:x});},handleSelected:function(){this.setState({loading:true});this.props.onSelected(this.state.selectedCreditCard);},handleToggle:function(x){if(!x)this.props.onClose();},render:function(){var x;if(this.props.showCancelButton)x=r.createElement(i,{disabled:this.props.showLoading,label:this.props.cancelButtonText,onClick:this.props.onClose,size:'medium',use:'default'});return (r.createElement(l,{behaviors:this.props.behaviors,className:u?"_auz":'',onToggle:this.handleToggle,width:this.props.width},r.createElement(o,null,this.props.title),r.createElement(m,{className:"_383d"},r.createElement(q,{type:'primary',className:"_au_"},this.props.text),r.createElement(j,{addCardOptionText:this.props.addCardOptionText,className:"_2pi4",creditCards:this.props.creditCards,onAddDebitCardOptionSelected:this.handleAddDebitCardOptionClicked,onChange:this.handleCreditCardSelected,selectedCard:this.props.selectedCreditCard,showAddDebitCardOption:true})),r.createElement(n,null,x,r.createElement(i,{disabled:this.props.showLoading,label:this.props.saveButtonText,onClick:this.handleSelected,size:'medium',use:'confirm'})),r.createElement(p,{visible:this.props.showLoading})));}});f.exports=w;},null);
__d('P2PEditCreditCardDialog.react',['CreditCardFormParam','CurrentEnvironment','Link.react','React','P2PAPI','P2PAPIUtils','P2PCreditCard','P2PCreditCardForm.react','P2PLoadingMask.react','P2PLinkConstants','P2PDialog.react','P2PDialogTitle.react','P2PDialogBody.react','P2PDialogFooter.react','P2PButton.react','P2PText.react','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){'use strict';if(c.__markCompiled)c.__markCompiled();var z='fbP2PEditCreditCardDialog_learnMoreSentenceID',aa=k.PropTypes,ba=k.createClass({displayName:'P2PEditCreditCardDialog',propTypes:{asyncRequestState:aa.object.isRequired,creditCard:aa.instanceOf(n).isRequired,onCancel:aa.func.isRequired,onSuccess:aa.func.isRequired,saveButtonText:aa.string,showCancelButton:aa.bool},getInitialState:function(){return {formData:{},isValid:false,loading:false,requestID:'',saveErrors:null};},getDefaultProps:function(){return {saveButtonText:y._("Enregistrer"),showCancelButton:true,width:i.messengerdotcom?350:300};},componentWillReceiveProps:function(ca){var da=ca.asyncRequestState?ca.asyncRequestState[this.state.requestID]:null;if(da){this.setState({requestID:''});if(da.error){this.handleOnSaveError(da.error);}else this.handleOnSaveSuccess(da);}},clearSaveErrors:function(){this.setState({saveErrors:null});},onSaveClick:function(ca){var da={},ea=m.genRequestID();da[h.CREDENTIAL_ID]=this.props.creditCard.getCredentialId();this.clearSaveErrors();this.setState({loading:true,requestID:ea});l.updateCreditCard(babelHelpers['extends']({requestID:ea},da,this.state.formData));},handleOnSaveSuccess:function(ca){this.props.onSuccess(ca);},onCancelClick:function(ca){this.props.onCancel();},handleOnSaveError:function(ca){this.setState({loading:false,saveErrors:ca});},isSaveDisabled:function(){return !this.state.isValid||this.state.loading;},isCancelDisabled:function(){return this.state.loading;},handleValidation:function(ca,da){this.setState({isValid:ca,formData:da});},getPrefilledFormData:function(){var ca={};ca[h.CARD_NUMBER]=this.props.creditCard.getCreditCardNumberMask();ca[h.CARD_EXPIRATION]=this.props.creditCard.getExpFormattedShort();ca[h.ZIP]=this.props.creditCard.getZipCode();return ca;},handleErrorDialogOKClick:function(){this.clearSaveErrors();},onToggle:function(ca){if(!ca)this.props.onCancel();},render:function(){var ca,da=this.props.text;if(!da)da=y._("Veuillez mettre \u00e0 jour la date d\u2019expiration de votre carte se terminant par {card numbers}.",[y.param('card numbers',this.props.creditCard.getCreditCardNumber())]);if(this.props.showCancelButton)ca=k.createElement(v,{use:'default',size:'medium',label:y._("Annuler"),disabled:this.isCancelDisabled(),onClick:this.onCancelClick});return (k.createElement(r,{behaviors:this.props.behaviors,layerHideOnBlur:false,onToggle:this.onToggle,repositionOnUpdate:true,shown:true,width:this.props.width},k.createElement(s,null,y._("Mettre \u00e0 jour la carte de d\u00e9bit")),k.createElement(t,null,k.createElement(w,{className:"_3-96",type:'primary'},da),k.createElement(o,{onValidation:this.handleValidation,saveErrors:this.state.saveErrors,editMode:true,prefilledFormData:this.getPrefilledFormData(),cscMaxLength:this.props.creditCard.getMaxCSCLength()}),k.createElement(w,{className:"_3-8y",id:z,type:'secondary'},y._("Vos informations de paiement sont stock\u00e9es de mani\u00e8re s\u00e9curis\u00e9e. {Learn more about p2p link}",[y.param('Learn more about p2p link',k.createElement(j,{'aria-describedby':z,href:q.addDebitCardHelpURI,target:'_blank'},y._("En savoir plus.")))]))),k.createElement(u,null,ca,k.createElement(v,{use:'confirm',size:'medium',label:this.props.saveButtonText,disabled:this.isSaveDisabled(),onClick:this.onSaveClick})),k.createElement(p,{visible:this.state.loading})));}});f.exports=ba;},null);
__d('P2PMoneypennyCheckoutDialog.react',['CurrentEnvironment','Link.react','MNCommerceAgenItemSuggestionReactShape','P2PBigAmount.react','P2PButton.react','P2PCreditCard','P2PDialog.react','P2PDialogBody.react','P2PDialogFooter.react','P2PDialogTitle.react','P2PLoadingMask.react','P2PMoneypennyProductItemDetails.react','P2PText.react','React','ReactComponentWithPureRenderMixin','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){'use strict';if(c.__markCompiled)c.__markCompiled();var z=u.PropTypes,aa=u.createClass({displayName:'P2PMoneypennyCheckoutDialog',mixins:[v],propTypes:{cancelButtonText:z.string,item:j.isRequired,leftContentText:z.string,onClose:z.func.isRequired,onChangeCreditCard:z.func.isRequired,onNextClicked:z.func.isRequired,onPurchaseClicked:z.func.isRequired,selectedCreditCard:z.instanceOf(m),showCancelButton:z.bool,showLoading:z.bool},getDefaultProps:function(){return {cancelButtonText:x._("Annuler"),leftContentText:x._("Vous ajouterez ensuite une carte de d\u00e9bit."),showCancelButton:false,width:360};},handleToggle:function(ba){if(!ba)this.props.onClose();},renderPaymentDetails:function(){var ba=this.props.selectedCreditCard;if(!ba)return null;return (u.createElement(t,{className:"_1t0k",shade:'light',size:'small',type:'secondary'},ba.getDetailsFormatted()+' \u00b7 ',u.createElement(i,{className:"_1t0l",onClick:this.props.onChangeCreditCard,href:'#'},x._("Modifier"))));},renderFooter:function(){var ba,ca,da;if(!this.props.selectedCreditCard){ba=u.createElement(t,{className:"_1t0n",type:'secondary'},this.props.leftContentText);ca=u.createElement(l,{label:x._("Suivant"),onClick:this.props.onNextClicked,size:'medium',type:'primary',use:'default'});}else ca=u.createElement(l,{label:x._("Payer"),onClick:this.props.onPurchaseClicked,size:'medium',type:'primary',use:'confirm'});if(this.props.showCancelButton)da=u.createElement(l,{use:'default',size:'medium',label:this.props.cancelButtonText,disabled:this.props.showLoading,onClick:this.props.onClose});return (u.createElement(p,{leftContent:ba},da,ca));},renderAmountSection:function(){return (u.createElement('div',{className:"_1t0o"},u.createElement('div',{className:"_4qbr"},u.createElement(k,{amount:this.props.item.raw_amount,size:'large'})),this.renderPaymentDetails(),u.createElement(t,{className:"_1wb1",shade:'light',size:'small',type:'secondary'},'We',"'",'ll place your order with the business when we receive your payment.')));},render:function(){var ba;if(!h.messengerdotcom)ba=u.createElement(q,null,x._("Paiement"));return (u.createElement(n,{layerHideOnBlur:false,onToggle:this.handleToggle,shown:true,width:this.props.width},ba,u.createElement(o,null,u.createElement('div',{className:"_b0z"},u.createElement(s,{item:this.props.item})),this.renderAmountSection()),this.renderFooter(),u.createElement(r,{visible:this.props.showLoading})));}});f.exports=aa;},null);
__d('P2PMoneypennyStore',['P2PActionConstants','EventEmitter','ImmutableObject','P2PDispatcher'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';var l,m;if(c.__markCompiled)c.__markCompiled();var n,o,p;function q(t,u){if(t)p[t]=new j(u);}function r(t,u){if(t)p[t]={error:u};}l=babelHelpers.inherits(s,i);m=l&&l.prototype;function s(){m.constructor.call(this);p={};o=[];n=k.register(this.onEventDispatched.bind(this));}s.prototype.onEventDispatched=function(t){var u=t.data,v=t.type;switch(v){case h.MONEYPENNY_TRANSFER_CREATED:this.handleMoneypennyTransferCreated(u);this.emit('change');break;case h.MONEYPENNY_TRANSFER_CREATED_ERROR:this.handleMoneypennyTransferCreatedError(u);this.emit('change');break;}};s.prototype.getAsyncRequestState=function(){return p;};s.prototype.handleMoneypennyTransferCreated=function(t){var u;q(t.requestID,t);u=o.filter(function(v){return (v.payment_id===t.payment_id);})[0];if(!u)o.push(new j(t));};s.prototype.handleMoneypennyTransferCreatedError=function(t){r(t.requestID,t.error);};s.prototype.getTransferByID=function(t){return o.filter(function(u){return u.item_id===t;})[0];};f.exports=new s();},null);
__d('P2PPasswordProtectionNUXDialog.react',['CurrentEnvironment','Link.react','P2PAPI','P2PErrorDialog.react','P2PLinkConstants','P2PLoadingMask.react','P2PLogger','P2PPaymentLoggerEvent','P2PPaymentLoggerEventFlow','P2PPasswordProtectionParam','P2PPasswordProtectionStatusTypes','React','P2PButton.react','P2PDialog.react','P2PDialogTitle.react','P2PDialogBody.react','P2PDialogFooter.react','P2PText.react','cx','emptyFunction','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){'use strict';if(c.__markCompiled)c.__markCompiled();var ca=s.PropTypes,da=s.createClass({displayName:'P2PPasswordProtectionNUXDialog',propTypes:{onComplete:ca.func},getDefaultProps:function(){return {onComplete:aa,width:h.messengerdotcom?320:300};},getInitialState:function(){return {saveErrorObject:null,loading:false};},componentWillMount:function(){this.log(o.UI_ACTN_INITIATE_PASSWORD_PROTECTION_NUX);},log:function(ea,fa){n.log(ea,babelHelpers['extends']({www_event_flow:p.UI_FLOW_P2P_SETTINGS},fa));},onSaveClick:function(){this.setState({loading:true,saveErrorObject:null});this.setPasswordProtection(r.ENABLED);this.log(o.UI_ACTN_OPT_IN_PASSWORD_PROTECTION_NUX);},setPasswordProtection:function(ea){var fa={};fa[q.STATUS]=ea;j.setPasswordProtectionSetting({formData:fa,success:this.handleOnSaveSuccess,error:this.handleOnSaveError});},handleOnSaveSuccess:function(){this.setState({loading:false});this.props.onComplete();},handleOnSaveError:function(ea){this.setState({loading:false,saveErrorObject:ea});},isSaveButtonDisabled:function(){return this.state.loading;},isCancelButtonDisabled:function(){return this.state.loading;},onCancelClick:function(){this.setState({loading:true,saveErrorObject:null});this.setPasswordProtection(r.DISABLED);this.log(o.UI_ACTN_OPT_OUT_PASSWORD_PROTECTION_NUX);},handleErrorBackClick:function(){this.setState({saveErrorObject:null});},handleErrorOKClick:function(){this.setState({saveErrorObject:null});this.props.onComplete();},render:function(){if(this.state.saveErrorObject)return (s.createElement(k,{allowBack:true,title:ba._("Probl\u00e8me d\u2019enregistrement"),onBackClick:this.handleErrorBackClick,onOKClick:this.handleErrorOKClick,error:this.state.saveErrorObject}));return (s.createElement(u,{className:h.messengerdotcom?"_-el":'',behaviors:{LayerFadeOnShow:false},layerHideOnBlur:false,shown:true,width:this.props.width},s.createElement(v,{showCloseButton:false},ba._("Utiliser un mot de passe\u00a0?")),s.createElement(w,null,s.createElement(y,{className:"_5sor",type:'primary'},ba._("Pour plus de s\u00e9curit\u00e9, vous pouvez saisir votre mot de passe Facebook pour envoyer de l\u2019argent. Vous pouvez toujours le mettre \u00e0 jour dans {link}.",[ba.param('link',s.createElement(i,{href:l.settingsWWWURI,target:'_blank'},ba._("Param\u00e8tres")))]))),s.createElement(x,null,s.createElement(t,{className:"_5sov",disabled:this.isCancelButtonDisabled(),label:ba._("Plus tard"),onClick:this.onCancelClick,size:'medium',use:'default'}),s.createElement(t,{className:"_5sox",disabled:this.isSaveButtonDisabled(),label:ba._("Utiliser un mot de passe"),onClick:this.onSaveClick,size:'medium',use:'confirm'})),s.createElement(m,{visible:this.state.loading})));}});f.exports=da;},null);
__d('P2PSuccessDialog.react',['CurrentEnvironment','Image.react','LayerSlowlyFadeOnShow','P2PConfirmationDialog.react','React','emptyFunction','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=l.PropTypes,q=l.createClass({displayName:'P2PSuccessDialog',propTypes:{allowBack:p.bool,buttonLabel:p.node,buttonUse:p.string,onOKClick:p.func,onSecondaryClick:p.func,showCloseButton:p.bool,showSecondaryButton:p.bool,secondaryButtonLabel:p.node,secondaryButtonUse:p.string,title:p.string.isRequired,width:p.number},getDefaultProps:function(){return {allowBack:false,buttonLabel:n._("OK"),buttonUse:'default',onOKClick:m,showCloseButton:false,width:h.messengerdotcom?350:300};},getImage:function(){if(h.messengerdotcom){return (l.createElement(i,{height:62,width:62,src:o('/images/p2p/checkmark-messenger.png')}));}else return (l.createElement(i,{height:56,width:56,src:o('/images/p2p/check_mark-sm.png')}));},render:function(){var r=this.getImage();return (l.createElement(k,{behaviors:babelHelpers['extends']({LayerSlowlyFadeOnShow:j},this.props.behaviors),allowBack:this.props.allowBack,buttonLabel:this.props.buttonLabel,buttonUse:this.props.buttonUse,centered:this.props.centered,image:r,onOKClick:this.props.onOKClick,onSecondaryClick:this.props.onSecondaryClick,showCloseButton:this.props.showCloseButton,showSecondaryButton:this.props.showSecondaryButton,secondaryButtonLabel:this.props.secondaryButtonLabel,secondaryButtonUse:this.props.secondaryButtonUse,title:this.props.title,width:this.props.width},this.props.children));}});f.exports=q;},null);
__d('P2PMoneypennyCheckoutDialogContainer.react',['Arbiter','CreditCardFormParam','CurrentEnvironment','MessengerPaymentProductType','MNCommerceAgenItemSuggestionReactShape','P2PAPI','P2PAPIUtils','P2PAddCreditCardDialog.react','P2PChooseCreditCardDialog.react','P2PCreditCardStore','P2PEditCreditCardDialog.react','P2PErrorDialog.react','P2PGKValues','P2PLogger','P2PMoneypennyCheckoutDialog.react','P2PMoneypennyStore','P2PPaymentLoggerEvent','P2PPaymentLoggerEventFlow','P2PPasswordProtectionNUXDialog.react','P2PPasswordProtectionStatusTypes','P2PSuccessDialog.react','P2PText.react','P2PVerifyCreditCardDialog.react','React','cx','fbt','setImmediate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){'use strict';if(c.__markCompiled)c.__markCompiled();var ia=ga._("Payer"),ja={LayerFadeOnShow:false},ka=360,la=y.UI_FLOW_MONEYPENNY_CHECKOUT,ma=ea.PropTypes,na=ea.createClass({displayName:'P2PMoneypennyCheckoutDialogContainer',propTypes:{item:l.isRequired,onClose:ma.func.isRequired},getInitialState:function(){var oa=this.getCards();return {addCreditCardDialogShown:false,editCreditCardDialogShown:false,creditCards:oa,creditCardAsyncRequestState:q.getAsyncRequestState(),chooseCreditCardDialogShown:false,loading:false,moneypennyAsyncRequestState:w.getAsyncRequestState(),p2pPasswordProtectionNUXDialogShown:false,transferErrors:null,transferRequestID:'',selectedCreditCard:oa[0],successDialogPending:false,successDialogShown:false,verifyCreditCardDialogShown:false};},componentWillMount:function(){this.log(x.UI_ACTN_INITIATE_MONEYPENNY_ORDER,{});this.creditCardStoreSub=q.addListener('change',this.onCreditCardStoreChange);this.moneypennyTransferStoreSub=w.addListener('change',this.onMoneypennyStoreChange);},componentWillUnmount:function(){if(this.creditCardStoreSub){this.creditCardStoreSub.remove();this.creditCardStoreSub=null;}if(this.moneypennyTransferStoreSub){this.moneypennyTransferStoreSub.remove();this.moneypennyTransferStoreSub=null;}if(this.passwordCancelSubscribeToken!==null){h.unsubscribe(this.passwordCancelSubscribeToken);this.passwordCancelSubscribeToken=null;}},creditCardStoreSub:null,moneypennyTransferStoreSub:null,passwordCancelSubscribeToken:null,passwordNUXPending:false,successDialogPending:false,getProductType:function(){return k.MESSENGER_COMMERCE;},getCards:function(){return q.getAll(this.getProductType());},log:function(oa,pa){u.log(oa,babelHelpers['extends']({raw_amount:this.props.item.raw_amount,currency:this.props.item.total_cost.currency,object_id:this.props.item.id,www_event_flow:la},pa));},onCreditCardStoreChange:function(){var oa=this.getCards(),pa;if(this.state.selectedCreditCard)pa=q.getCreditCardByCredentialID(this.state.selectedCreditCard.getCredentialId());if(!pa)pa=oa[0];this.setState({creditCards:oa,creditCardAsyncRequestState:q.getAsyncRequestState(),selectedCreditCard:pa});},onMoneypennyStoreChange:function(){var oa=w.getAsyncRequestState(),pa=oa[this.state.transferRequestID];this.setState({moneypennyAsyncRequestState:oa});if(pa){this.setState({transferRequestID:''});if(pa.error){this.handleMoneypennyTransferError(pa.error);}else this.handleMoneypennyTransferSuccess(pa);}},handleChangeCreditCardClicked:function(){this.hideAllDialogs();if(this.state.creditCards.length>1){this.setState({chooseCreditCardDialogShown:true});this.log(x.UI_ACTN_INITIATE_CHOOSE_CARD,{});}else this.setState({addCreditCardDialogShown:true});},handleAddDebitCardClicked:function(){this.hideAllDialogs();this.setState({addCreditCardDialogShown:true});},handleCreditCardSelected:function(oa){this.setState({selectedCreditCard:oa},function(){this.purchase();}.bind(this));},purchase:function(){var oa;if(!this.state.selectedCreditCard.getIsVerified()){this.log(x.UI_ACTN_VERIFY_CSC,{});this.hideAllDialogs();this.setState({verifyCreditCardDialogShown:true});return;}else if(this.state.selectedCreditCard.isExpired()){this.log(x.UI_ACTN_EDIT_CARD,{});this.hideAllDialogs();this.setState({editCreditCardDialogShown:true});return;}this.passwordCancelSubscribeToken=h.subscribeOnce('PasswordReauthDialogCancelClick',this.handlePasswordReauthDialogCancelClick);oa=n.genRequestID();this.setState({loading:true,transferRequestID:oa,transferErrors:null});m.createMoneypennyTransfer({amount:this.props.item.raw_amount,credential_id:this.state.selectedCreditCard.getCredentialId(),item_id:this.props.item.id,external_request_id:n.genRequestID(),requestID:oa});this.log(x.UI_ACTN_CONFIRM_MONEYPENNY_ORDER,{});},handleMoneypennyTransferSuccess:function(oa){this.hideAllDialogs();this.log(x.UI_ACTN_MONEYPENNY_ORDER_SUCCESS,{});if(oa.passwordProtection===aa.NOT_SET)this.passwordNUXPending=true;if(this.successDialogPending){this.successDialogPending=false;this.setState({successDialogShown:true});}else this.handleCheckoutSuccess();},handleMoneypennyTransferError:function(oa){this.hideAllDialogs();this.log(x.UI_ACTN_MONEYPENNY_ORDER_FAIL,{});this.setState({loading:false,transferErrors:oa});},handlePasswordReauthDialogCancelClick:function(){this.passwordCancelSubscribeToken=null;this.setState({loading:false});this.hideAllDialogs();},handleCheckoutSuccess:function(){this.hideAllDialogs();if(this.passwordNUXPending){this.passwordNUXPending=false;this.setState({p2pPasswordProtectionNUXDialogShown:true});}else ha(this.props.onClose);},handleAddCreditCardSuccess:function(oa){this.successDialogPending=this.getCards().length===1;this.setState({selectedCreditCard:q.getCreditCardByCredentialID(oa[i.CREDENTIAL_ID])},function(){this.purchase();}.bind(this));},handleCheckoutCancel:function(){this.log(x.UI_ACTN_MONEYPENNY_ORDER_CANCEL,{});this.props.onClose();},hideAllDialogs:function(){this.setState({addCreditCardDialogShown:false,editCreditCardDialogShown:false,chooseCreditCardDialogShown:false,successDialogShown:false,transferErrors:null,verifyCreditCardDialogShown:false,p2pPasswordProtectionNUXDialogShown:false});},render:function(){var oa=this.props.item,pa=j.messengerdotcom,qa,ra,sa,ta,ua,va;if(this.getProductType()===k.MESSENGER_COMMERCE){qa=ga._("Saisissez une carte de cr\u00e9dit ou de d\u00e9bit pour acheter {Product name}.",[ga.param('Product name',oa.name)]);ra=ga._("Ajouter une carte");ta=ga._("S\u00e9lectionner une carte");sa=ga._("Vous pouvez d\u00e9sormais utiliser une carte que vous avez d\u00e9j\u00e0 ajout\u00e9e \u00e0 Facebook ou en ajouter une nouvelle pour acheter {Product name}.",[ga.param('Product name',this.props.item.name)]);ua=ga._("Nouvelle carte");va=ga._("Vous ajouterez ensuite une carte.");}else{qa=ga._("Veuillez entrer une carte de d\u00e9bit pour acheter {Product name}. Les cartes de cr\u00e9dit ne sont pas encore accept\u00e9es.",[ga.param('Product name',oa.name)]);sa=ga._("Vous pouvez utiliser une carte de d\u00e9bit que vous avez d\u00e9j\u00e0 ajout\u00e9e sur Facebook ou en ajouter une autre pour acheter {Product name}.",[ga.param('Product name',this.props.item.name)]);}if(this.state.p2pPasswordProtectionNUXDialogShown){return (ea.createElement(z,{onComplete:this.props.onClose,width:ka}));}else if(this.state.transferErrors){return (ea.createElement(s,{behaviors:ja,error:this.state.transferErrors,onOKClick:this.handleCheckoutCancel,title:ga._("Probl\u00e8me avec votre paiement"),width:ka}));}else if(this.state.verifyCreditCardDialogShown){return (ea.createElement(da,{asyncRequestState:this.state.creditCardAsyncRequestState,behaviors:ja,creditCard:this.state.selectedCreditCard,isPurchasing:true,purchaseName:this.props.item.name,onCancel:this.handleCheckoutCancel,onSuccess:this.purchase,saveButtonText:ia,showCancelButton:pa,width:ka}));}else if(this.state.editCreditCardDialogShown){return (ea.createElement(r,{asyncRequestState:this.state.creditCardAsyncRequestState,behaviors:ja,creditCard:this.state.selectedCreditCard,onCancel:this.handleCheckoutCancel,onSuccess:this.purchase,saveButtonText:ia,showCancelButton:pa,text:ga._("Veuillez mettre \u00e0 jour la date d\u2019expiration de votre carte se terminant par {card numbers} pour acheter {Product name}.",[ga.param('card numbers',this.state.selectedCreditCard.getCreditCardNumber()),ga.param('Product name',this.props.item.name)]),width:ka}));}else if(this.state.successDialogShown){return (ea.createElement(ba,{behaviors:babelHelpers['extends']({LayerSlowlyFadeOnShow:false},ja),onOKClick:this.handleCheckoutSuccess,title:ga._("Paiement envoy\u00e9"),width:ka},ea.createElement(ca,{className:"_3-97",type:'primary'},ga._("Nous avons re\u00e7u votre paiement et passons commande aupr\u00e8s de l\u2019entreprise.")),ea.createElement(ca,{type:'primary'},ga._("{Bold text that says, Tip:} vous pouvez aussi utiliser {Credit card name and number} pour envoyer de l\u2019argent \u00e0 vos amis dans vos conversations.",[ga.param('Bold text that says, Tip:',ea.createElement(ca,{display:'inline',type:'primary',weight:'bold'},ga._("Conseil\u00a0:"))),ga.param('Credit card name and number',this.state.selectedCreditCard.getDetailsFormatted())]))));}else if(this.state.chooseCreditCardDialogShown){return (ea.createElement(p,{addCardOptionText:ua,behaviors:ja,creditCards:this.state.creditCards,onAddDebitCardOptionSelected:this.handleAddDebitCardClicked,onClose:this.handleCheckoutCancel,onSelected:this.handleCreditCardSelected,saveButtonText:ia,selectedCreditCard:this.state.selectedCreditCard,showCancelButton:pa,showLoading:this.state.loading,text:sa,title:ta,width:ka}));}else if(this.state.addCreditCardDialogShown){return (ea.createElement(o,{behaviors:ja,eventFlow:la,loggingData:{amount:oa.raw_amount,object_id:oa.id},onCancel:this.handleCheckoutCancel,onSuccess:this.handleAddCreditCardSuccess,productType:this.getProductType(),saveButtonText:ia,showCancelButton:pa,text:qa,title:ra,width:ka}));}else return (ea.createElement(v,{item:this.props.item,leftContentText:va,onChangeCreditCard:this.handleChangeCreditCardClicked,onClose:this.handleCheckoutCancel,onNextClicked:this.handleAddDebitCardClicked,onPurchaseClicked:this.purchase,selectedCreditCard:this.state.selectedCreditCard,showCancelButton:pa,showLoading:this.state.loading,width:ka}));}});f.exports=na;},null);
__d('MNCommerceAgentItemSuggestionMercuryShareAttachment.react',['MercuryFallbackShareAttachment.react','MercuryShareAttachmentReactShape','MercuryShareAttachmentRenderLocations','MNCommerceAgentItemSuggestionMercuryAttachment.react','P2PActions','P2PMoneypennyCheckoutDialogContainer.react','P2PMoneypennyStore','React','ReactComponentWithPureRenderMixin','StoreAndPropBasedStateMixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=o.PropTypes,s=o.createClass({displayName:'MNCommerceAgentItemSuggestionMercuryShareAttachment',mixins:[p,q(n)],propTypes:{attachment:i,maxWidth:r.number,location:r.oneOf(j.getValues())},statics:{calculateState:function(t){var u=t.attachment&&t.attachment.target,v=!!(u&&u.payment_id);if(!v){var w=n.getTransferByID(u.id);v=!!(w&&w.payment_id);}return {isItemPurchased:v};}},_handleBuyClick:function(){l.showDialog(m,{item:this._getItem(),onClose:l.hideDialog});},_getItem:function(){var t=this.props.attachment;return t&&t.target;},render:function(){var t=this._getItem();if(!t)return o.createElement(h,this.props);return (o.createElement(k,{itemSuggestion:t,isPurchased:this.state.isItemPurchased,location:this.props.location,onBuyClick:this._handleBuyClick,width:this.props.maxWidth}));}});f.exports=s;},null);
__d('OzActions',['Reflux'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={};i.activateThread=h.createAction();i.activateIntent=h.createAction();i.scrollThreadToTimestamp=h.createAction();i.doneScrollingToTimestamp=h.createAction();i.updateThreads=h.createAction();i.maybeUpdateThreads=h.createAction();i.clearReassignState=h.createAction();i.updateMerchants=h.createAction();i.deleteMerchants=h.createAction();i.updateWitIntents=h.createAction();i.updateReps=h.createAction();i.replaceReps=h.createAction();i.replaceHumans=h.createAction();i.updateRequirements=h.createAction();i.showDialog=h.createAction();i.hideDialog=h.createAction();i.updateComposer=h.createAction();i.addBubble=h.createAction();i.addAutopilot=h.createAction();i.isActive=h.createAction();i.isInactive=h.createAction();i.sendPulse=h.createAction();i.updateQueueFilters=h.createAction();i.intentCreator=h.createActions(['toggle','select','clear']);i.twilio=h.createActions(['connect','endCall','hangUp','incoming','incomingAccept','incomingReject','mute','ready','setup','startCall','unmute','updateIncomingInfo','useIntent','updateRating','dialAgain']);i.twilio.changeTo=h.createAction({sync:true});i.twilio.sendDigits=h.createAction({sync:true});i.sendMessageStart=h.createAction();i.sendMessageFinish=h.createAction();i.addHandledEvents=h.createAction();i.updateServerOffset=h.createAction();f.exports=i;},null);
__d('OzNotify',['immutable','ReactComponentWithPureRenderMixin','React','ReactCSSTransitionGroup','Reflux','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=h.OrderedMap,p=h.Map,q={addNotif:l.createAction({sync:true}),removeNotif:l.createAction({sync:true})},r=l.createStore({init:function(){this.data=o();this.listenTo(q.addNotif,this._onAddNotif);this.listenTo(q.removeNotif,this._onRemoveNotif);},getInitialState:function(){return this.data;},_onAddNotif:function(y){this.data=this.data.set(y.get('id'),y);this.trigger(this.data);},_onRemoveNotif:function(y){this.data=this.data['delete'](y);this.trigger(this.data);}}),s=p({info:"_4nqo",warn:"_4nqp",error:"_4nqq"}),t=j.createClass({displayName:'OzNotify',mixins:[l.connect(r,'notifs'),i],render:function(){return (j.createElement(k,{component:'div',transitionName:'oz-fade-in-out',className:"_4nqr",transitionEnterTimeout:500,transitionLeaveTimeout:500},this.state.notifs.reverse().map(function(y,z){return (j.createElement('div',{key:z,className:n("_4nqs",s.get(y.get('level')))},y.get('msg'),j.createElement('span',{className:"_ok9",onClick:function(){return q.removeNotif(z);}},'×')));}).valueSeq()));}}),u=7000,v=0;function w(y){return function(z){v+=1;q.addNotif(p({id:v,level:y,msg:z}));(function(aa){window.setTimeout(function(ba){return q.removeNotif(aa);},u);})(v);};}var x={Component:t,info:w('info'),warn:w('warn'),error:w('error')};f.exports=x;},null);
__d('OzAPI',['OzHelpers','OzNotify','Arbiter','ChannelConstants','ChannelManager','immutable','invariant','OzActions','OzAJAX','OzConfig','OzStores','promiseFinally','RTISubscriptionManager'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=m.List,v=m.Map,w=p.ajax,x=p.beacon,y=p.buildURI,z=r.ActiveThreadStore;l.getConfig;function aa(ka){if(ka.attachment&&!ka.attachments)ka.attachments=[ka.attachment];var la=m.fromJS(ka);return la;}function ba(ka){return u(ka.map(function(la){la=aa(la);return [h.msgID(la),la];})).fromEntrySeq().toMap();}function ca(ka){if(!ka.messages)ka.messages=(ka['last-events']||[]).map(function(ma){ma.sender=ma.from;return ma;});ka.messages=ba(ka.messages);var la=m.fromJS(ka);return la;}function da(ka){return u(ka.map(ca));}function ea(ka){var la=da([ka]);o.updateThreads(la);!(la.count()===1)?n(0):undefined;return la.first();}function fa(ka){!Number.isSafeInteger(ka.offset)?n(0):undefined;!Number.isSafeInteger(ka.limit)?n(0):undefined;return w({type:'GET',url:y('threads',q.getStaticConfig('PAGE_ID')),params:ka}).then(function(la){var ma=la.threads,na=da(ma);o.updateThreads(na);return na;});}function ga(ka){var la=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],ma=arguments.length<=2||arguments[2]===undefined?{}:arguments[2],na=arguments.length<=3||arguments[3]===undefined?null:arguments[3];!(typeof ka==='string')?n(0):undefined;!(typeof la==='object')?n(0):undefined;var oa,pa=false;if(la instanceof FormData){oa=la;}else{oa=JSON.stringify(la);pa=true;}var qa={type:'PUT',url:y('sync'),params:{t:ka,'intent-id':na||z.data.get('activeIntent'),page:q.getStaticConfig('PAGE_ID')},body:oa};qa=Object.assign(qa,ma);if(pa){qa.headers=qa.headers||{};qa.headers['content-type']='application/json';}h.info('[sync] '+ka,la);return w(qa);}function ha(ka){return function(la){return ga(ka,{tid:la}).then(function(ma){var na=ca(ma);o.updateThreads(u([na]));return na;});};}var ia={_witIntentCSV:function(){ia.witIntents().done(function(ka){var la='data:text/csv;charset=utf-8,';ka.forEach(function(ma){return la+='"'+ma.get('name')+'","'+ma.get('id')+'","'+ma.get('doc')+'"\n';});window.open(window.encodeURI(la));});},grab:ha('grab'),release:ha('release'),ready:ha('ready'),notready:ha('notready'),ack:ha('ack'),lockThread:ha('lock-thread'),unlockThread:function(ka,la){return ga('unlock-thread',{tid:ka,'locked-at':la}).then(ea);},assignTo:function(ka,la){return ga('assign-to',{tid:ka,id:la});},escalate:function(ka){return ia.createTag(ka,'escalated');},escalateTo:function(ka,la){return ia.escalate(ka).then(function(){return ia.assignTo(ka,la);});},typing:function(ka){return ga('rep-typing',{tid:ka});},createReminder:function(ka,la){return ga('create-reminder',babelHelpers['extends']({tid:ka},la.toJS())).then(ea);},closeReminder:function(ka,la,ma){return ga('close-reminder',{tid:ka,id:la,all:ma}).then(ea);},editReminder:function(ka,la){return ga('edit-reminder',{tid:ka,reminder:la.toJS()}).then(ea);},snoozeReminder:function(ka,la){return ga('snooze-reminder',{tid:ka,id:la}).then(ea);},deleteIntentRequirement:function(ka,la,ma){return ga('delete-intent-requirement',{tid:ka,'intent-id':la,'requirement-id':ma}).then(ea);},deleteThreadRequirement:function(ka,la){return ga('delete-thread-requirement',{tid:ka,'requirement-id':la}).then(ea);},createIntentRequirement:function(ka,la,ma){return ga('create-intent-requirement',{tid:ka,'intent-id':la,'requirement-name':ma}).then(ea);},createThreadRequirement:function(ka,la){return ga('create-thread-requirement',{tid:ka,'requirement-name':la}).then(ea);},createIntent:function(ka,la){return ga('create-intent',babelHelpers['extends']({tid:ka},la.toJS())).then(ea);},openIntent:function(ka,la){return ga('open-intent',{tid:ka,id:la},{},la).then(ea);},closeIntent:function(ka,la,ma){var na={tid:ka,id:la,'close-state':ma};return ga('close-intent',na,{},la).then(ea);},blockIntent:function(ka,la){return ga('block-intent',{tid:ka,id:la}).then(ea);},unblockIntent:function(ka,la){return ga('unblock-intent',{tid:ka,id:la}).then(ea);},addPhoneNumber:function(ka,la){return ga('add-phone-number',{tid:ka,'intent-id':la},{},la).then(ea);},editIntent:function(ka,la){return ga('edit-intent',babelHelpers['extends']({tid:ka},la.toJS()));},createTag:function(ka,la){return ga('add-thread-tag',{tid:ka,tag:la}).then(ea);},deleteTag:function(ka,la){return ga('remove-thread-tag',{tid:ka,tag:la}).then(ea);},view:ha('create-subscription'),unview:ha('delete-subscription'),updateMessage:function(ka,la){return ga('update-message',{tid:ka,message:la.toJS()}).then(ea);},everstoreUpload:function(ka){var la=new FormData();ka.forEach(function(ma,na){return la.append(na,ma);});return ga('everstore-upload',la);},upload:function(ka){var la=new FormData();ka.forEach(function(ma,na){return la.append(na,ma);});return ga('upload',la).then(function(ma){return m.fromJS(ma);});},sendMessage:function(ka){var la=ga('send',ka).then(function(ma){return ea({'user-id':ka.tid,'last-events':ma});});s(la,function(ma){return o.sendMessageFinish(ka.tid);});window.setTimeout(function(){return o.sendMessageStart(ka.tid);},200);return la;},scheduleMessage:function(ka){return ga('schedule-send',ka).then(ea);},suggest:function(ka){return ga('suggest',ka).then(ea);},scheduleSuggest:function(ka){return ga('schedule-suggest',ka).then(ea);},deleteScheduled:function(ka,la){return ga('delete-scheduled',{tid:ka,id:la}).then(ea);},saveNote:function(ka,la){var ma={tid:ka,infos:{notes:la}};return ga('update-infos',ma).then(ea);},saveMeta:function(ka,la){var ma={tid:ka,infos:{'metadata-json':la.toJS()}};return ga('update-infos',ma).then(ea);},saveMuted:function(ka,la){var ma={tid:ka,infos:{muted:la}};return ga('update-infos',ma).then(ea);},createMerchant:function(ka){return ga('create-merchant',ka.toJS()).then(function(la){var ma=u([v(la)]);o.updateMerchants(ma);return ma;});},editMerchant:function(ka){return ga('edit-merchant',ka.toJS()).then(function(la){var ma=u([v(la)]);o.updateMerchants(ma);return ma;});},deleteMerchant:function(ka){return ga('delete-merchant',ka.toJS()).then(function(la){if(la&&la.id){var ma=u([la.id]);o.deleteMerchants(ma);return ma;}else h.warn('[api] unexpected delete-merchant response',la);});},sendEmail:function(ka){return ga('send-email',ka.toJS());},sendInvite:function(ka){return ga('send-calendar',ka.toJS());},everstoreURI:function(ka){return ga('everstore-uri',{handle:ka});},witIntents:function(){return w({type:'GET',url:y('wit-intents',q.getStaticConfig('PAGE_ID'))}).then(function(ka){var la=m.fromJS(ka);o.updateWitIntents(la);return la;});},merchants:function(){return w({type:'GET',url:y('merchants')}).then(function(ka){o.updateMerchants(u(ka).map(function(la){return v(la);}));});},repsSync:function(){return w({type:'GET',url:y('reps-sync')});},requirements:function(){return w({type:'GET',url:y('requirements')}).then(function(ka){o.updateRequirements(m.fromJS(ka));});},AIModules:function(){return w({type:'GET',url:y('ai-modules')}).then(function(ka){return u(ka);});},authorFeedback:function(ka){return w({type:'GET',url:y('author-feedback'),params:{author_id:ka}}).then(function(la){return v(la.map(function(ma){ma=m.fromJS(ma);return [h.msgID(ma),ma];}));});},myThreads:function(){var ka=q.getStaticConfig('PAGE_ID');return w({type:'GET',params:{page:ka},url:y('mythreads')}).then(function(la){var ma=la.mythreads;o.updateThreads(da(ma));});},allThreads:function(ka,la,ma,na){var oa={all:true,first_tags:ka.toJS(),last_tags:la.toJS(),offset:ma,limit:na};if(ka.has('ready')){ka=ka['delete']('ready');oa.ready=true;}else if(la.has('ready')){la=la['delete']('ready');oa.ready=false;}return fa(oa);},thread:function(ka){return w({type:'GET',url:y('threads',q.getStaticConfig('PAGE_ID'),ka)}).then(ea);},handledEvents:function(ka){return w({type:'GET',params:{'intent-id':ka},url:y('handled-events')}).then(function(la){o.addHandledEvents(m.fromJS(la['handled-events']));});},history:function(ka,la,ma){return w({type:'GET',params:{timestamp:la,limit:ma},url:y('threads',q.getStaticConfig('PAGE_ID'),ka,'history')}).then(function(na){var oa=ea({'user-id':ka,messages:na});return oa.get('messages');});},topIntents:function(){return w({type:'GET',url:y('top-intents')}).then(function(ka){return m.fromJS(ka);});},intentsDashboard:function(ka){return w({type:'GET',params:ka,url:y('dashboard','intent',q.getStaticConfig('PAGE_ID'))}).then(function(la){return m.fromJS(la);});},aiDashboard:function(ka){return w({type:'GET',params:ka,url:y('dashboard','ai',q.getStaticConfig('PAGE_ID'))}).then(function(la){return m.fromJS(la);});},statsDashboard:function(ka){return w({type:'GET',params:ka,url:y('dashboard','trainer',ka['trainer-id'])}).then(function(la){return m.fromJS(la);});},teamStatsDashboard:function(ka){return w({type:'GET',params:ka,url:y('dashboard','trainer-team-stats')}).then(function(la){return m.fromJS(la);});},humans:function(){return w({type:'GET',url:y('humans')}).then(function(ka){return o.replaceHumans(m.fromJS(ka));});},requestAutopilot:function(ka){window.postMessage(ka,'*');},notifyExtension:function(ka){h.debug('[oz-ext] notifying toto',ka);window.postMessage(babelHelpers['extends']({type:'notification'},{data:ka}),'*');},recordActivity:function(ka,la){return ga('activity',babelHelpers['extends']({tid:ka},{activity:la}));},sendPulse:function(ka,la){return w({type:'POST',url:y('pulse'),headers:{'content-type':'application/json'},params:{page:q.getStaticConfig('PAGE_ID'),duration:ka},body:JSON.stringify(la)});},sendDisconnectPulse:function(ka,la){return x({url:y('pulse'),params:{page:q.getStaticConfig('PAGE_ID'),duration:ka},body:JSON.stringify(la)});},threadFocus:function(ka,la){return ga('thread-focus',babelHelpers['extends']({tid:ka},{intentID:la}));},away:function(ka){return ga('away',{away:ka});},coachMode:function(ka){return ga('coach-mode',{'coach-mode':ka});},timestamp:function(){var ka=Date.now();return w({type:'POST',url:y('timestamp')}).then(function(la){var ma=la.timestamp,na=Date.now();if(na-ka>1000){h.warn('[oz-api] timestamp took over 1 second, not updating offset');}else{var oa=na-(ma+(na-ka)/2);o.updateServerOffset({offsetMs:oa});}});},init:function(){return w({type:'GET',url:y('init')}).then(function(ka){ka['twilio-token']&&o.twilio.setup(ka['twilio-token']);});},realTime:function(ka,la){var ma,na=60000,oa=function(){var ta=Date.now();clearInterval(ma);ma=setInterval(function(ua){var va=Math.round((Date.now()-ta)/1000);h.warn('[rti] no payload in '+va+'seconds');i.warn('We have not received anything from the server in '+va+'           seconds. You may want to refresh the page.');},na);},pa={repsVersion:-1},qa=function(ta,ua){var va=ua.payload,wa=ua.topic;!(ta==='sky'||ta==='msg')?n(0):undefined;oa();var xa,ya,za=ta==='sky'?ta+' '+wa+' ->':ta,ab=va.type,bb=ab||'';h.debug('[rti] '+za+' '+bb,va);if(!va.data){h.error('[sky] got sky event without data',va,wa);return;}ya=va.data['page-id'];if(ya&&ya!==q.getStaticConfig('PAGE_ID')){h.debug('[sky] junk event on '+wa,va);return;}switch(ab){case 'thread':xa=va.data;ea(xa);break;case 'maybe-thread':xa=va.data;o.maybeUpdateThreads(da([xa]));break;case 'delivered':case 'seen':xa=va.data;ea({'user-id':xa['user-id'],'last-seen':xa['last-seen']});break;case 'presence':xa=va.data;ea({'user-id':xa['user-id'],'last-presence':xa['last-presence']});break;case 'carebear':(function(){var cb=va.data,db=cb.type,eb=cb.tid,fb={'user-id':eb};fb['ui-'+db]=true;ea(fb);})();break;case 'inactive':o.isInactive();break;case 'updated-merchant':o.updateMerchants(u([v(va.data)]));break;case 'deleted-merchant':o.deleteMerchants(u([va.data.id]));break;case 'phone-call':o.twilio.updateIncomingInfo(m.fromJS(va.data));break;case 'humans':o.replaceHumans(m.fromJS(va.data));break;case 'reps-sync':pa=babelHelpers['extends']({},pa,{repsVersion:va.version});o.replaceReps(m.fromJS(va.data));break;case 'reps-diff':if(pa.repsVersion!==va.version-1){h.warn('[api] reps version out of sync',{'our-version':pa.repsVersion,'next-version':va.version});pa=babelHelpers['extends']({},pa,{repsVersion:-1});ia.repsSync();}else{pa.repsVersion=va.version;o.updateReps(m.fromJS(va.data));}break;case 'handled-events':o.addHandledEvents(m.fromJS(va.data));default:h.debug('[sky] unk type',ab,va);}},ra=j.subscribe(k.getArbiterType('msg'),function(ta,ua){qa('msg',ua.obj);}),sa=ja(function(){j.unsubscribe(ra);t.unsubscribeAll();});t.subscribe(ka,qa.bind(this,'sky'),null,ja(function(ta){var ua=ta.data,va=ta.error;if(va){sa();la(va,ua);}else{oa();la(null,ua,ra);}}));return sa;}};function ja(ka){var la,ma,na=this;return function(){if(!la){ma=ka.apply(na,arguments);la=true;}return ma;};}f.exports=ia;},null);
__d('OzHelpers',['BanzaiScuba','DatePickerRestraints','ErrorUtils','getURLRanges','immutable','LogHistory','OzConstants','ReactComponentWithPureRenderMixin','React','URI','OzConfig','OzServerTime'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=l.List,u=l.Map,v=l.Set,w=l.OrderedMap,x=n.AUTHOR_TYPES,y=n.REMINDERS,z=/^image\//,aa={blobURI:function(ja){return window.URL.createObjectURL(ja);},blobFromDataURI:function(ja){var ka=ja.split(','),la=atob(ka[1]),ma=ka[0].split(':')[1].split(';')[0],na=new ArrayBuffer(la.length),oa=new Uint8Array(na);for(var pa=0;pa<la.length;pa++)oa[pa]=la.charCodeAt(pa);return new Blob([na],{type:ma});},toLocaleDate:function(ja){return new Date(ja).toLocaleDateString();},toLocaleTime:function(ja){return new Date(ja).toLocaleTimeString();},hasCmdOrCtrl:function(ja){return ja.getModifierState('Meta')||ja.getModifierState('Control');},keysIn:function(){var ja=v(arguments);return function(ka,la){return ja.has(la);};},safeParse:function(ja){var ka={};try{ka=JSON.parse(ja);}catch(la){aa.info('invalid json',ja);}return ka;},safeURI:function(ja){var ka=null;try{ka=q.isValidURI(ja)&&new q(ja)||null;}catch(la){aa.info('invalid uri',ja);}return ka;},pure:ca,memoize:da,values:function(ja){return Object.keys(ja).map(function(ka){return ja[ka];});},debug:fa('debug',false),info:fa('info',true),warn:fa('warn',true),error:fa('error',true),isImageType:function(ja){return z.test(ja);},dateRestraints:ea,threadID:function(ja){return ja.get('user-id');},isNew:function(ja){return !aa.intents(ja).find(aa.isClosedIntent);},hasOwner:function(ja){return ja.getIn(['owner','id']);},hasAllTags:function(ja,ka){return ka.every(function(la){return aa.hasTag(ja,la);});},hasSomeTag:function(ja,ka){return ka.some(function(la){return aa.hasTag(ja,la);});},hasTag:function(ja,ka){return ja.get('tags')&&ja.get('tags').contains(ka);},isEscalated:function(ja){return aa.hasTag(ja,'escalated');},hasEngage:function(ja){return !!ja.get('engagement-type');},photo:function(ja){return ja.getIn(['user-vcard','photo'])||ja.getIn(['user-vcard','picture']);},compareNums:function(ja,ka){if(ja&&ka){return ka-ja;}else if(ja){return -1;}else if(ka){return 1;}else return 0;},compareBools:function(ja,ka){if(ja&&ka){return 0;}else if(ja){return -1;}else if(ka)return 1;},getIncomingThreads:function(ja){return ja.filter(function(ka){return ka.get('ready')&&!aa.hasOwner(ka);}).sort(aa.threadComparator);},threadComparator:function(ja,ka){var la=aa.compareBools(aa.hasTag(ja,'vip'),aa.hasTag(ka,'vip')),ma=aa.compareBools(aa.hasTag(ja,'urgent'),aa.hasTag(ka,'urgent')),na=aa.compareNums(aa.urgentReminders(ja).getIn([0,'scheduled-time']),aa.urgentReminders(ka).getIn([0,'scheduled-time'])),oa=aa.compareNums(ja.get('last-event-at'),ka.get('last-event-at'));return (la||ma||na||oa);},lastEvents:function(ja){return ja.get('last-events',t()).sortBy(function(ka){return ka.get('timestamp');});},lastUserMessage:function(ja){var ka=aa.lastEvents(ja).reverse();return ka.find(function(la){return aa.authorType(la)===x.USER;})||ka.first();},shortDesc:function(ja){var ka=ja.getIn(['attachments',0,'mime_type']),la=ja.getIn(['attachments',0,'sticker_id']);return ja.get('text')||la&&'sent a sticker.'||ka&&(ka.match(/video/i)&&'sent a video.'||ka.match(/audio/i)&&'sent an audio clip.'||ka.match(/image/i)&&'sent an image');},preferredName:function(ja){return (ja.getIn(['metadata-json','preferred-name'])||ja.getIn(['user-vcard','first-name']));},userEmail:function(ja){return (ja.getIn(['metadata-json','email']));},intents:function(ja){return ja.get('intents',t()).sortBy(function(ka){return ka.get('created-at');});},isOwner:function(ja,ka){var la=ja.getIn(['owner','id']);return la&&ka&&la==ka;},wasOwner:function(ja,ka){var la=ja.getIn(['last-owner','id']);return la&&ka&&la==ka;},isLocker:function(ja,ka){return ja.get('locked')&&ja.get('locker-id')===ka;},nameOrId:function(ja){return ja&&(ja.get('name')||ja.get('id'))||'';},isSubscriber:function(ja,ka){return !!ja.get('subscriptions',t()).find(function(la){return la===ka;});},hasUnblockedIntents:function(ja){return ja.get('intents',t()).some(function(ka){return !aa.isBlockedIntent(ka);});},hasOpenIntents:function(ja){return ja.get('intents',t()).some(function(ka){return aa.isOpenIntent(ka);});},openIntents:function(ja){return aa.intents(ja).filter(aa.isOpenIntent);},isBlockedIntent:function(ja){return ja.get('blocked');},isOpenIntent:function(ja){return ja.get('state')==='open';},isClosedIntent:function(ja){var ka=ja.get('state');return ka!=='open'&&ka!=='deleted';},getName:function(ja){return ja.getIn(['user-vcard','name'],'Unknown user');},lastPresence:function(ja){return Math.max(ja.get('last-seen')||0,ja.get('last-presence')||0);},timeSpent:function(ja){if(ja.get('ready')&&ja.get('last-ready-at'))return aa.serverNow()-ja.get('last-ready-at');},locationLastSeen:function(ja){if(ja.getIn(['location','last-seen']))return new Date(ja.getIn(['location','last-seen']));},serverNow:function(){return s.serverNow();},repName:function(ja,ka){var la=ka.get(ja);return la&&la.get('name')||ja||null;},authorType:function(ja){var ka=x.BOT,la=x.USER,ma=x.TRAINER,na=ja.get('sender')||ja.get('from'),oa=ja.get('author-type');return (oa===ka&&ka||(oa===ma||na===r.getStaticConfig('PAGE_ID'))&&ma||la);},msgID:function(ja){return ja.get('offline-threading-id')||ja.get('mid')||aa.warn('[msgID] had to resort to timestamp',ja)&&null||ja.get('timestamp');},isActivePulse:function(ja){var ka=ja&&ja.get('pulse-data');if(!ka)return false;return !ka.get('away?')&&ka.get('inactive-ms',Infinity)<30000;},urgentReminders:function(ja){return ja.get('reminders',t()).sortBy(function(ka){return ka.get('scheduled-time');}).filter(aa.isUrgentReminder);},paidReminders:function(ja){return aa.urgentReminders(ja).filter(aa.isPaidReminder);},isUrgentReminder:function(ja){var ka=ja.get('state');return ka==='active'||ka==='active-snoozed';},isPaidReminder:function(ja){return !!ja.getIn(['body','suggestion']);},isSnoozedReminder:function(ja){var ka=ja.get('state');return ka==='snoozed'||ka==='active-snoozed';},isUnread:function(ja){return ja.get('read-state')==='unread';},hasPaid:function(ja){return !!aa.paidReminders(ja).size;},hasReminder:function(ja){return !!aa.urgentReminders(ja).size;},minAge:function(ja){var ka=+ja.getIn(['user-vcard','age-range','min']);return Number.isSafeInteger(ka)?ka:0;},shimURI:function(ja){return new q('https://l.facebook.com/l.php').setQueryData({u:ja,h:r.getStaticConfig('shimhash')}).toString();},uiSuggestion:function(ja){var ka=ja.has('amount')?'$'+(ja.get('amount')/100).toFixed(2):'';return {id:ja.get('item-id')||'-1',name:ja.get('name'),desc:ja.get('description'),thumb_url:ja.get('thumb-url'),merchant_name:ja.get('merchant-name')||'',total_cost:ja.get('amount')?u({amount:ja.get('amount')}):null,display_total_cost:ka,target_url:aa.shimURI(ja.get('target-url')),payment_id:ja.get('payment-id')};},parsePhoneNumber:function(ja){if(!ja)return '';if(ja.length==12&&ja[0]=='+')ja=ja.substr(1);if(ja.length==11&&ja[0]=='1')ja=ja.substr(1);switch(ja.length){case 10:return '('+ja.substr(0,3)+') '+ja.substr(3,3)+'-'+ja.substr(6,4);case 7:return ja.substr(0,3)+'-'+ja.substr(3,4);default:return ja;}},validateURL:function(ja){return (!!ja&&typeof ja==='string'&&k(ja).length&&q.isValidURI(ja));},normalizeMerchant:function(ja){return ja.updateIn(['website'],function(ka){if(!ka)return ka;var la=k(ka);if(!la||la.length===0)return ka;return la[0].entity.url;}).updateIn(['page-id'],function(ka){if(Number.isFinite(ka)||typeof ka==='string')return parseInt(ka,10);return null;});},validateMerchant:function(ja){var ka=v(['name-dba','country']),la=v(['address','website','page-id']),ma={},na=ja.get('website','');if(na&&!this.validateURL(na))ma.website='Website is an invalid URL';var oa=ja.get('page-id',null);if(oa!=null&&!Number.isFinite(oa))ma['page-id']='FB Page must be a number';ka.map(function(qa){if(!ja.get(qa))ma[qa]='This field is required';});if(v(ja.filter(function(qa){return qa;}).keys()).intersect(la).isEmpty()){var pa='At least one of '+la.join(', ')+' is required';la.forEach(function(qa){ma[qa]=pa;});}return u(ma);},isDaytime:function(ja){var ka=(Date.now()+ja)%(24*60*60*1000),la=ka/(60*60*1000);return la>=6;},fullThreadData:function(ja,ka,la){var ma=ja.get(la);if(!ma)return null;return ma.update('intents',function(na){return na.map(function(oa){return ba(ka,oa);});});}};function ba(ja,ka){var la=ja.getIn(['byIntent',ka.get('id')],u());return ka.set('events',la);}function ca(ja){var ka=arguments.length<=1||arguments[1]===undefined?'OzPureComponent':arguments[1];return (p.createClass({displayName:ka,mixins:[o],render:function(){return ja(this.props);}}));}function da(ja,ka){var la=arguments.length<=2||arguments[2]===undefined?1000:arguments[2],ma=w();return function(){for(var na=arguments.length,oa=Array(na),pa=0;pa<na;pa++)oa[pa]=arguments[pa];var qa=ka.apply(this,oa);if(ma.get(qa)){return ma.get(qa);}else{var ra=ja.apply(this,oa);ma=ma.set(qa,ra).takeLast(la);return ra;}}.bind(this);}function ea(){var ja=new Date(),ka=new Date(Date.UTC(ja.getFullYear(),ja.getMonth(),ja.getDate())),la=new Date(+ka);la.setFullYear(ka.getFullYear()+y.RANGE_IN_YEARS);return {dateRestraints:[i.enforceDateIsNoEarlierThan(ka),i.enforceDateIsNoLaterThan(la)]};}j.addListener(function(ja){var ka=ia({level:'error',message:'[unhandled-error]['+ja.name+'] '+ja.message,data:'--stack\n'+ja.stack+'\n\n--originalError\n'+ja._originalError});ha(ka);ga(ka);});function fa(ja,ka){return function(){for(var la=arguments.length,ma=Array(la),na=0;na<la;na++)ma[na]=arguments[na];var oa=ma[0],pa=ma.slice(1);window.console.log(ja,oa,pa);var qa=ia({level:ja,message:oa,data:pa});ha(qa);ka&&ga(qa);};}function ga(ja){var ka=new h(r.getStaticConfig('scubaCategory'));Object.entries(ja).forEach(function(la){var ma=la[0],na=la[1];Number.isSafeInteger(na)?ka.addInteger(ma,na):ka.addNormal(ma,na);});ka.post();}function ha(ja){var ka=m.getInstance('oz-logger');(ka[ja.level]||ka.debug).call(ka,ja.message,'');}function ia(ja){return babelHelpers['extends']({},ja,{uid:r.getStaticConfig('uid'),public_name:r.getStaticConfig('publicName'),rev:r.getStaticConfig('rev'),timestamp:aa.serverNow()});}f.exports=aa;},null);
__d('OzStores',['OzHelpers','immutable','invariant','OzActions','Reflux'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=i.List,n=i.Map,o=i.OrderedMap,p=i.OrderedSet,q=i.Set,r=l.createStore({init:function(){this.data=n();this.listenTo(k.updateRequirements,this._onUpdateRequirements);},getInitialState:function(){return this.data;},_onUpdateRequirements:function(ka){this.data=this.data.withMutations(function(la){ka.forEach(function(ma){var na=ma.get('name'),oa=la.get(na,n()).merge(ma).update('wit-intent-uuids',function(pa){return pa&&pa.toSet()||q();});la.set(na,oa);});});h.debug('[oz] updated RequirementStore');this.trigger(this.data);}}),s=l.createStore({init:function(){this.data=p();this.listenTo(k.addBubble,this._onAddBubble);},getInitialState:function(){return this.data;},_onAddBubble:function(ka){!n.isMap(ka)?j(0):undefined;this.data=this.data.add(ka).takeLast(100);this.trigger(this.data);}}),t=l.createStore({init:function(){this.data=o();this.listenTo(k.addAutopilot,this._onAddAutopilot);},getInitialState:function(){return this.data;},_onAddAutopilot:function(ka){!n.isMap(ka)?j(0):undefined;this.data=this.data.set(ka.get('id'),ka.get('data')).takeLast(100);this.trigger(this.data);}}),u='id',v=l.createStore({init:function(){this.data=n();this.listenTo(k.updateWitIntents,this._onUpdateWitIntents);},getInitialState:function(){return this.data;},_onUpdateWitIntents:function(ka){!i.List.isList(ka)?j(0):undefined;this.data=this.data.withMutations(function(la){return ka.reduce(function(ma,na){return ma.set(na.get(u),na);},la);});this.trigger(this.data);}}),w=l.createStore({init:function(){this.data=n();this.listenTo(k.activateThread,this._onActivateThread);this.listenTo(k.activateIntent,this._onActivateIntent);},getInitialState:function(){return this.data;},_onActivateThread:function(ka){h.info('[store/activeThread] set active thread: ',ka);this.data=this.data.set('oldThreadID',this.data.get('threadID')).set('threadID',ka).set('activeIntent',null);this.trigger(this.data);},_onActivateIntent:function(ka){this.data=this.data.set('activeIntent',ka);this.trigger(this.data);}}),x='user-id',y=function(ka,la){!(n.isMap(ka)&&n.isMap(la))?j(0):undefined;var ma=ka.reduce(function(na,oa,pa){na[oa.get('offline-threading-id')]=oa;return na;},{});return ka.withMutations(function(na){return la.valueSeq().filterNot(function(oa){var pa=oa.get('attachments');if(pa)return pa.first()&&pa.first().getIn(['xma','body'])===null;return false;}).reduce(function(oa,pa){var qa=pa.get('offline-threading-id'),ra=qa&&ma[qa]||oa.get(h.msgID(pa));if(ra){oa=oa['delete'](h.msgID(ra));pa=ra.merge(pa);}return oa.set(h.msgID(pa),pa);},na);});},z=function(ka,la,ma){if(ma==='messages'){return y(ka,la);}else return la;},aa=function(ka){!(typeof ka==='function')?j(0):undefined;return function(la,ma){!(n.isMap(ma)&&n.isMap(la))?j(0):undefined;var na=ma.get(x),oa=la.get(na,n()),pa=oa.mergeWith(ka,ma);return la.set(na,pa);};},ba=l.createStore({init:function(){this.data=n();this.updatedAt=Date.now();this.listenTo(k.updateThreads,this._onUpdateThreads);this.listenTo(k.maybeUpdateThreads,this._onMaybeUpdateThreads);this.listenTo(k.clearReassignState,this._onClearReassignState);},getInitialState:function(){return this.data;},_onUpdateThreads:function(ka){!m.isList(ka)?j(0):undefined;this.data=this.data.withMutations(function(la){return ka.reduce(aa(z),la);});this.updatedAt=Date.now();this.trigger(this.data);},_onMaybeUpdateThreads:function(ka){!m.isList(ka)?j(0):undefined;var la=ka.filter(function(ma){return this.data.has(ma.get(x));}.bind(this));if(la.isEmpty()){h.debug('[threads] not updating partial threads');return;}this.data=this.data.withMutations(function(ma){return la.reduce(aa(z),ma);});this.updatedAt=Date.now();this.trigger(this.data);},_onClearReassignState:function(){this.data=this.data.map(function(ka){return (ka.get('ui-reassign')?ka['delete']('ui-reassign'):ka);});this.trigger(this.data);}}),ca=l.createStore({init:function(){this.data=this._make(null,null);this.listenTo(k.showDialog,this._onShowDialog);this.listenTo(k.hideDialog,this._onHideDialog);},getInitialState:function(){return this.data;},_make:function(ka,la){return {dialogClass:ka,dialogProps:la};},_onShowDialog:function(ka,la){this.data=this._make(ka,la);this.trigger(this.data);},_onHideDialog:function(){this.data=this._make(null,null);this.trigger(this.data);}}),da=l.createStore({init:function(){this.data=n();this.listenTo(k.updateMerchants,this._onUpdateMerchants);this.listenTo(k.deleteMerchants,this._onDeleteMerchants);},getInitialState:function(){return this.data;},_onUpdateMerchants:function(ka){!m.isList(ka)?j(0):undefined;this.data=this.data.withMutations(function(la){return ka.reduce(function(ma,na){var oa=na.get('id'),pa=ma.get(oa,n()).merge(na);return ma.set(oa,pa);},la);});h.debug('[oz] updated merchants',this.data.toJS());this.trigger(this.data);},_onDeleteMerchants:function(ka){!m.isList(ka)?j(0):undefined;this.data=ka.reduce(function(la,ma){return la['delete'](ma);},this.data);h.debug('[oz] deleted merchants',this.data.toJS());this.trigger(this.data);}}),ea=l.createStore({init:function(){this.data=n();this.listenTo(k.updateReps,this._onUpdateReps);this.listenTo(k.replaceReps,this._onReplaceReps);},getInitialState:function(){return this.data;},_onReplaceReps:function(ka){this.data=n().withMutations(function(la){ka.reduce(function(ma,na){return ma.set(na.get('fbid'),na);},la);});this.trigger(this.data);},_onUpdateReps:function(ka){this.data=this.data.withMutations(function(la){return ka.reduce(function(ma,na){return ma.mergeIn([na.get('fbid')],na);},la);});this.trigger(this.data);}}),fa=l.createStore({init:function(){this.data=n();this.listenTo(k.replaceHumans,this._onReplace);},getInitialState:function(){return this.data;},_onReplace:function(ka){this.data=ka;this.trigger(this.data);}}),ga=l.createStore({init:function(){this.data=n({queue:n({showTags:q(),hideTags:q()}),all:n({showTags:q(),hideTags:q()})});this.listenTo(k.updateQueueFilters,this._onUpdateFilters);},getInitialState:function(){return this.data;},_onUpdateFilters:function(ka){this.data=this.data.merge(ka);this.trigger(this.data);}}),ha=l.createStore({init:function(){this._data=n();this.listenTo(k.sendMessageStart,this._onShiftSending.bind(this,1));this.listenTo(k.sendMessageFinish,this._onShiftSending.bind(this,-1));},getInitialState:function(){return this._data;},_onShiftSending:function(ka,la){this._data=this._data.update(la,function(ma){return (ma||0)+ka;});this.trigger(this._data);}}),ia=l.createStore({init:function(){this.data=n({byIntent:n(),byThread:n(),byId:n()});this.listenTo(k.addHandledEvents,this._onAddHandledEvents);},getInitialState:function(){return this.data;},_onAddHandledEvents:function(ka){this.data=this.data.withMutations(function(la){ka.reduce(function(ma,na){return (ma.setIn(['byIntent',na.get('intent-id'),na.get('id')],na).setIn(['byId',na.get('id')],na));},la);});this.trigger(this.data);}}),ja=l.createStore({init:function(){this.data=n({offsetMs:0});this.listenTo(k.updateServerOffset,this._onUpdateServerOffset);},getInitialState:function(){return this.offsetMs;},_onUpdateServerOffset:function(ka){var la=ka.offsetMs;this.data=this.data.set('offsetMs',la);this.trigger(this.data);}});f.exports={ActiveThreadStore:w,BubbleStore:s,DialogStore:ca,MerchantStore:da,AutopilotStore:t,QueueFilterStore:ga,RepStore:ea,HumanStore:fa,RequirementStore:r,ThreadStore:ba,WitIntentStore:v,PendingMessageStateStore:ha,HandledEventsStore:ia,ServerOffsetStore:ja};},null);
__d('OzAJAX',['Promise','OzHelpers','OzNotify','OzConfig','URI','invariant'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n={ajax:function(r){var s=r.type,t=r.headers,u=r.params,v=r.body,w=r.url;u=p(u);var x={type:s,url:w,headers:t,params:u,body:v};return o(x).then(function(y){return JSON.parse(y.responseText);},function(y){var z;try{z=JSON.parse(y.responseText);}catch(aa){}q(z||{},y,x);throw z||y;});},beacon:function(r){!(window.navigator&&window.navigator.sendBeacon)?m(0):undefined;var s=r.params,t=r.body,u=r.url;s=p(s);return window.navigator.sendBeacon(new l(u).addQueryData(s).toString(),new Blob([t],{type:'application/json'}));},buildURI:function(){var r=k.getStaticConfig('API_PATH');!r?m(0):undefined;for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return [r].concat(t).join('/');}};function o(r){var s=r.type,t=r.headers,u=r.params,v=r.body,w=r.url;return new h(function(x,y){var z=new XMLHttpRequest(),aa=new l(w);if(u)aa.addQueryData(u);z.open(s,aa.toString(),true);if(t)for(var ba=Object.keys(t),ca=Array.isArray(ba),da=0,ba=ca?ba:ba[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ea;if(ca){if(da>=ba.length)break;ea=ba[da++];}else{da=ba.next();if(da.done)break;ea=da.value;}var fa=ea;z.setRequestHeader(fa,t[fa]);}z.onreadystatechange=function(){if(z.readyState!==4)return;if(z.status===200){x(z);}else y(z);};z.send(v);});}function p(r){!k.getStaticConfig('authToken')?m(0):undefined;!k.getStaticConfig('uid')?m(0):undefined;!k.getStaticConfig('API_VERSION')?m(0):undefined;return babelHelpers['extends']({xs:k.getStaticConfig('authToken'),c_user:k.getStaticConfig('uid'),rep_name:k.getStaticConfig('fullName'),v:k.getStaticConfig('API_VERSION')},r);}function q(r,s,t){i.error('[oz-api] backend rejected',r,s,t);var u=r.error||'Something went wrong, the team has been notified already.';if(r.info){j.info(u);}else if(s.status===400){j.warn(u);}else if(s.status===0){j.error('Something went wrong. If this continues, please contact the Wit oncall');}else j.error(u);}f.exports=n;},null);
__d('OzEditorStateHelpers',['ContentState','OzHelpers','DraftModifier','EditorState','UnicodeUtils'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();function m(x,y){var z=h.createFromText(y),aa=k.push(x,z,'remove-range');aa=k.forceSelection(aa,aa.getSelection());return aa;}function n(x){var y=x.getCurrentContent().getBlockMap(),z=x.getSelection().getStartKey();return y.get(z);}function o(x,y){return x.getCurrentContent().getPlainText().indexOf(y)>=0;}function p(x){var y=v(x,function(z){var aa=z.getSelection();if(aa.getStartOffset()===0)return w(z,1);var ba=n(z).getText().length;return aa.merge({anchorOffset:ba,focusOffset:0,isBackward:true});},'backward');if(y===x.getCurrentContent())return x;return k.push(x,y,'remove-range');}function q(x,y){var z=x.getCurrentContent(),aa=n(x).getText(),ba=x.getSelection().merge({anchorOffset:0,focusOffset:aa.length}),ca=j.replaceText(z,ba,y);i.debug('[replaceLine]',y,aa,ca.getPlainText());if(ca===z)return x;return k.push(x,ca,'remove-range');}function r(x,y){var z=x.getCurrentContent(),aa=j.insertText(z,z.getSelectionAfter(),y);if(aa===z)return x;return k.push(x,aa,'insert-characters');}function s(x,y){var z=n(x).getText(),aa=z.length;if(aa===0)return false;y=Math.min(y,aa-1);return z[y];}function t(x,y){var z=x.getSelection().merge({focusOffset:y,anchorOffset:y});return k.forceSelection(x,z);}function u(x,y){var z=v(x,function(ba){var ca=ba.getSelection(),da=ba.getCurrentContent(),ea=ca.getAnchorKey(),fa=ca.getAnchorOffset(),ga=da.getBlockForKey(ea).getText().slice(fa-y,fa);return w(ba,ga?l.strlen(ga):1);},'backward');if(z===x.getCurrentContent())return x;z=z.set('selectionBefore',x.getSelection());var aa=x.getSelection().isCollapsed()?'backspace-character':'remove-range';return k.push(x,z,aa);}function v(x,y,z){var aa=x.getSelection(),ba=x.getCurrentContent(),ca=aa;if(aa.isCollapsed()){if(z==='forward'){if(x.isSelectionAtEndOfContent())return ba;}else if(x.isSelectionAtStartOfContent())return ba;ca=y(x);if(ca===aa)return ba;}return j.removeRange(ba,ca,z);}function w(x,y){var z=x.getSelection(),aa=x.getCurrentContent(),ba=z.getStartKey(),ca=z.getStartOffset(),da=ba,ea=0;if(y>ca){var fa=aa.getKeyBefore(ba);if(fa==null){da=ba;}else{da=fa;var ga=aa.getBlockForKey(fa);ea=ga.getText().length;}}else ea=ca-y;return z.merge({focusKey:da,focusOffset:ea,isBackward:true});}f.exports={append:r,backspaceTimes:u,charAt:s,currentBlock:n,deleteCurrentLine:p,editorStateHas:o,forceCollapsedSelection:t,replaceContentWithText:m,replaceLine:q};},null);
__d('OzHistory',['invariant','immutable'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=i.List,k=i.OrderedMap,l='oz-history',m=10,n=100;function o(){return k(JSON.parse(localStorage.getItem(l)||'{}')).map(function(t){return j(t);});}function p(t){!k.isOrderedMap(t)?h(0):undefined;return localStorage.setItem(l,JSON.stringify(t));}function q(t){var u=o();if(u.has(t))return;p(u.set(t,[]).takeLast(m));}function r(t){var u={},v={items:function(){if(!u.items)u.items=o().get(t);return u.items;},persist:function(w){!j.isList(w)?h(0):undefined;p(o().set(t,w));u.items=w;v.resetPos();},resetPos:function(){u.pos=v.items().size;},pos:function(){if(!Number.isSafeInteger(u.pos))v.resetPos();return u.pos;},dec:function(){u.pos=Math.max(v.pos()-1,0);},inc:function(){u.pos=Math.min(v.pos()+1,v.items().size);},val:function(){return v.items().get(v.pos());}};return v;}function s(t){q(t);var u=r(t);return {up:function(){u.dec();return u.val();},down:function(){u.inc();return u.val();},push:function(v){var w=u.items();if(!v||w.last()===v)return;u.persist(w.push(v).takeLast(n));}};}f.exports=s;},null);
__d('OzHumans',['OzHelpers'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=60000,j=45000,k=-1;function l(t){return t.get('coach-mode?');}function m(t){return t.get('is-coach');}function n(t){return t.get('away?');}function o(t){return t&&!n(t)&&h.serverNow()-t.get('at',0)<j;}function p(t){return o(t)&&t.get('inactive-ms',0)<i;}function q(t){return p(t)&&t.get('load',0)<=0&&t.get('team',k)!==k;}function r(t){return p(t)&&!l(t);}function s(t){var u=t.filter(r).count(),v=t.reduce(function(w,x){return w+x.get('load',0);},0);return v/u;}f.exports={inCoachMode:l,isCoach:m,isAway:n,isPresent:o,isActive:p,isIdle:q,isWorking:r,avgLoad:s};},null);
__d('OzInboxThreads',['OzHelpers'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i='GRABBED',j='VIEWING',k='PAST';function l(n){var o=function(p){return p.get('locked-at')&&p.get('locker-id')===n;};return function(p,q){if(o(p)&&!o(q)){return -1;}else if(!o(p)&&o(q)){return 1;}else return h.compareNums(p.get('last-event-at'),q.get('last-event-at'));};}var m=h.memoize(function(n,o){var p=arguments.length<=2||arguments[2]===undefined?'':arguments[2],q=l(o);return n.filter(function(r){var s=h.isOwner(r,o),t=h.isLocker(r,o),u=h.isSubscriber(r,o),v=h.wasOwner(r,o),w=h.hasOpenIntents(r);switch(p){case i:return ((s||r.get('ui-reassign')&&v)&&(r.get('ready')||w||t));case j:return u;case k:return (v||s&&!r.get('ready')&&!w);default:return s||u;}}).sort(q);},function(n,o){var p=arguments.length<=2||arguments[2]===undefined?'':arguments[2];return n.hashCode()+o+p;},3);f.exports={getInboxThreads:m,OZ_GRABBED_TAB:i,OZ_VIEWING_TAB:j,OZ_PAST_TAB:k};},null);
__d('OzBugNub.react',['Link.react','ReactComponentWithPureRenderMixin','React','Tooltip','URI','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=1031744366845008,p='Error:\n\nExpected Result:\n\nSteps taken before error occurred:\n',q=j.createClass({displayName:'MessengerBugNub',mixins:[i],render:function(){var r=new l('/ajax/bugs/report').setQueryData({config_id:o,defaultText:p});return (j.createElement('div',{className:"_gml"},j.createElement(h,babelHelpers['extends']({href:'#',ajaxify:r,className:"_gmm",rel:'dialog'},k.propsFor(n._("Signaler un bogue"))),j.createElement('span',{className:"_gmn"}))));}});f.exports=q;},null);
__d('OzDialogContainer.react',['OzStores','React','ReactLayeredComponentMixin','Reflux'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=h.DialogStore,m=i.createClass({displayName:'OzDialogContainer',mixins:[k.connect(l,'dialog'),j],renderLayers:function(){var n=this.state.dialog.dialogClass;if(n){var o=this.state.dialog.dialogProps||{};return {dialog:i.createElement(n,babelHelpers['extends']({ref:'dialog'},o))};}return {};},render:function(){return null;}});f.exports=m;},null);
__d('OzExtensionCheck.react',['MessengerDialogHeader.react','MessengerDialogTitle.react','Notice.atlas','OzActions','React','ReloadPage','XUIDialog.react','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=l.PropTypes,q=l.createClass({displayName:'InstallDialog',propTypes:{onInstall:p.func.isRequired},render:function(){return (l.createElement(n,{width:544,shown:true,layerHideOnBlur:false,className:"_4ebx"},l.createElement('div',{className:"_4eby _2c9g _1-6z"},l.createElement(h,null,l.createElement(i,null,'The Oz Chrome Extension is missing')),l.createElement(j,{type:'error'},l.createElement('div',{className:"_4d80"},'Toto, the oz chrome extension that helps you manage your tabs, and record what was done for each task in the background is missing!',l.createElement('strong',null,l.createElement('a',{onClick:this.props.onInstall},' Click here to install it.')))))));}}),r=l.createClass({displayName:'OzExtensionCheck',componentDidMount:function(){var s=!!document.querySelector('#toto-installed');if(s)return;k.showDialog(q,{onInstall:this._handleInstall});},render:function(){return null;},_handleInstall:function(){window.chrome.webstore.install(undefined,function(s){return m.now();});}});f.exports=r;},null);
__d('OzLoading.react',['MessengerFlexArea.react','MessengerSpinner.react','React','cx'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=j.createClass({displayName:'OzLoading',propTypes:{message:l.node,color:l.oneOf(["grey","blue"])},getDefaultProps:function(){return {color:"blue"};},render:function(){return (j.createElement('div',{className:"_30r7"},j.createElement(i,{color:this.props.color}),j.createElement('div',{className:"_30r8"},this.props.message)));}});m.Inline=j.createClass({displayName:'Inline',propTypes:{loading:l.bool.isRequired},render:function(){var n=this.props,o=n.loading,p=babelHelpers.objectWithoutProperties(n,['loading']);if(!o)return null;return (j.createElement('div',{className:"_nkb"},j.createElement(m,p)));}});m.Flex=j.createClass({displayName:'Flex',render:function(){return (j.createElement(h,null,j.createElement(m,this.props)));}});f.exports=m;},null);
__d('OzButton.react',['OzLoading.react','React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=i.createClass({displayName:'OzButton',getInitialState:function(){return {loading:false};},render:function(){var m=this.props,n=m.children,o=m.className,p=m.disabled,q=m.onClick,r=m.use,s=babelHelpers.objectWithoutProperties(m,['children','className','disabled','onClick','use']),t=this.state.loading;return (i.createElement('a',babelHelpers['extends']({},s,{onClick:this._handleClick,className:k(o,"_3e2t"+(t?' '+"_3e2u":'')+(r==='confirm'?' '+"_3e2v":'')+(p?' '+"_ysb":'')+(!p?' '+"_30yy":''))}),t?i.createElement(h,{color:'blue',message:'Sending...'}):n));},_handleClick:function(m){var n=this.props.onClick;if(!n)return;if(n.length>1)this.setState({loading:true});n(m,this._done);},_done:function(){if(this.isMounted())this.setState({loading:false});}});f.exports=l;},null);
__d('OzReps',['OzHelpers'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=1000*60*60*8;function j(m){return !m||h.serverNow()-m.get('updated-at',0)>i;}function k(m){var n=m.get('stats');return j(n)?0:n.get('closed-intents',0);}function l(m,n){var o=m.get('team');return n.reduce(function(p,q){return p+(q.get('team')===o?k(q):0);},0);}f.exports={closedIntentCount:k,teamClosedIntentCount:l};},null);
__d('OzTriSwitch.react',['React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(m){var n=m.className,o=m.value,p=m.onClick,q=m.label,r=m.animated,s=babelHelpers.objectWithoutProperties(m,['className','value','onClick','label','animated']);return (h.createElement('div',babelHelpers['extends']({},s,{className:j(n,"_56de"+(s.reverseColors?' '+"_3tyl":'')+(r?' '+"_56df":'')+(o==='on'?' '+"_56dg":'')+(o==='off'?' '+"_56dh":'')+(o==='neutral'?' '+"_56di":'')),onClick:function(t){return p(l[o]);},role:'checkbox'}),h.createElement('div',{className:"_56dj",tabIndex:'0'},h.createElement('div',{className:"_56dk"})),q?h.createElement('span',{className:"_56dn"},q):null));}var l={on:'off',off:'neutral',neutral:'on'};k.toBoolean=function(m){if(m==='neutral')return undefined;if(m==='on')return true;if(m==='off')return false;throw new Error('OzTriSwitch: unknown state '+m);};k.fromBoolean=function(m){return m==null?'neutral':m?'on':'off';};f.exports=k;},null);
__d('OzSwitch.react',['ReactComponentWithPureRenderMixin','OzTriSwitch.react','React'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=j.PropTypes,l=j.createClass({displayName:'OzSwitch',mixins:[h],propTypes:{isAnimated:k.bool.isRequired,isOn:k.bool.isRequired,label:k.node.isRequired,onToggle:k.func.isRequired,reverseColors:k.bool},getDefaultProps:function(){return {isAnimated:false};},render:function(){var m=this.props,n=m.className,o=m.isAnimated,p=m.isOn,q=m.label,r=m.onToggle;return (j.createElement(i,{animated:o,className:n,reverseColors:!!this.props.reverseColors,label:q,onClick:function(){return r(!p);},value:i.fromBoolean(p)}));}});f.exports=l;},null);
__d('OzTwilio',['cx','OzHelpers','immutable','Keys','MessengerButton.react','OzNotify','OzActions','OzConfig','OzDraggable.react','ReactComponentWithPureRenderMixin','React','Reflux','StarsInput.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u,v,w,x;if(c.__markCompiled)c.__markCompiled();var y=j.Record,z=j.Set,aa=r.PropTypes,ba=n.twilio;function ca(){var ya=window.Twilio.Device,za=function(ab,bb){return function(){i.info('[twilio] '+ab,fa.data.toJS());bb.apply(undefined,arguments);};};ba.setup.listen(function(ab){ya.setup(ab,{rtc:o.getInStaticConfig(['GK','webRTC']),debug:true});});ba.hangUp.listen(function(ab){ya.disconnectAll();ba.endCall();});ba.startCall.listen(za('start-call',ya.connect));ya.ready(ba.ready);ya.error(function(ab){var bb=ab.message;m.error('VOIP is having issues. '+(bb?bb:'')+'. Please contact the wit oncall');i.error('[twilio] had an error',ab);ba.endCall();});ya.connect(za('connect',ba.connect));ya.disconnect(za('disconnect',ba.endCall));ya.cancel(za('cancel',ba.endCall));ya.incoming(za('incoming',ba.incoming));}ca();u=babelHelpers.inherits(da,y({'intent-id':null,tid:null,extension:null}));v=u&&u.prototype;function da(){'use strict';u.apply(this,arguments);}w=babelHelpers.inherits(ea,y({from:null,meta:new da(),muted:false,status:'pending',to:null,wasIncoming:null,rating:null,sentDigits:null}));x=w&&w.prototype;function ea(){'use strict';w.apply(this,arguments);}var fa=s.createStore({init:function(){this.data=new ea();this.listenToMany(ba);},getInitialState:function(){return this.data;},onChangeTo:function(ya){this._u(function(za){return za.set('to',ya);});},onDialAgain:function(){this._conn=null;this._u(function(ya){return new ea({status:'dial',meta:ya.get('meta'),from:ya.get('from'),to:ya.get('to')});});},onConnect:function(ya){this._conn=ya;},onEndCall:function(){this._conn=null;this._u(function(ya){return ya.merge({status:'ended'});});},onIncoming:function(ya){this._conn=ya;this._u(function(za){return za.mergeDeep({status:'incoming',to:ya.parameters.From,wasIncoming:true});});},onIncomingAccept:function(){if(this._conn){this._conn.accept();this._u(function(ya){return ya.merge({status:'in-call'});});}},onIncomingReject:function(){if(this._conn){this._conn.reject();this._conn=null;}this.onEndCall();},onMute:function(){if(this._conn){this._conn.mute(true);this._u(function(ya){return ya.set('muted',true);});}},onReady:function(){this._u(function(ya){return new ea({status:'ready'});});},onSendDigits:function(ya){if(this._conn){this._conn.sendDigits(ya);this._u(function(za){return za.update('sentDigits',function(ab){return (ab||'')+ya;});});}},onStartCall:function(){this._u(function(ya){return ya.set('status','in-call');});},onUnmute:function(){if(this._conn){this._conn.mute(false);this._u(function(ya){return ya.set('muted',false);});}},onUseIntent:function(ya){if(this.data.get('status')!=='ready'){m.error('End your call before starting another one');return;}this._u(function(za){return new ea({status:'dial',from:ya.get('phone-number'),meta:new da({tid:ya.get('user-id'),'intent-id':ya.get('id'),extension:ya.get('phone-extension')})});});},onUpdateIncomingInfo:function(ya){this._u(function(za){return za.merge({meta:new da({tid:ya.get('user-id'),'intent-id':ya.get('intent-id'),extension:ya.get('phone-extension')}),from:ya.get('to'),to:ya.get('from')});});},onUpdateRating:function(ya){this._u(function(za){return za.set('rating',ya);});},_u:function(ya){this.data=ya(this.data);this.trigger(this.data);}}),ga=r.createClass({displayName:'OzTwilio',mixins:[q,s.connect(fa,'store'),s.connect(o.ConfigStore,'config')],contextTypes:{router:aa.object.isRequired},componentDidMount:function(){var ya=window.setInterval(function(za){this.state.store.get('status')==='in-call'&&n.isActive();}.bind(this),5000);this._cleanup=function(za){return window.clearInterval(ya);};},componentDidUpdate:function(ya,za){var ab=za.store.get('status'),bb=this.state.store.get('status');if(ab==='in-call'&&bb==='ended')window.clearInterval(this._callDurationInterval);},componentWillUnmount:function(){this._cleanup();},render:function(){var ya=this.state,za=ya.store,ab=ya.callDuration;return (r.createElement('span',{className:"_221-"},ha(za)&&r.createElement(ia,{callDuration:ab,onCallStart:this._handleStartCall,onDialAgain:ba.dialAgain,onHangUp:this._handleHangUp,onIncomingAccept:this._handleIncomingAccept,onIncomingReject:ba.incomingReject,onMute:ba.mute,onRatingChange:this._handleRatingChange,onReady:ba.ready,onSendDigits:ba.sendDigits,onThreadClick:this._handleThreadClick,onToChange:ba.changeTo,onUnmute:ba.unmute,store:za})));},_handleThreadClick:function(ya){this.context.router.push('/inbox/'+ya);},_handleStartCall:function(){var ya=this.state.store;this._startDurationTimer();ba.startCall(babelHelpers['extends']({},ya.get('meta').toJS(),{from:ya.get('from'),to:ya.get('to'),page:this.state.config.get('PAGE_ID'),type:'outgoing'}));},_handleIncomingAccept:function(){this._startDurationTimer();ba.incomingAccept();},_startDurationTimer:function(){var ya=Date.now();clearInterval(this._callDurationInterval);this._callDurationInterval=setInterval(function(){this.setState({callDuration:Date.now()-ya});}.bind(this),950);this.setState({callDuration:0});},_handleHangUp:function(){ba.hangUp();clearInterval(this._callDurationInterval);},_handleRatingChange:function(ya){i.info('[twilio] rating='+ya,this.state.store.toJS());ba.updateRating(ya);}});function ha(ya){return z(['dial','in-call','incoming','ended']).has(ya.get('status'));}var ia=i.pure(function(ya){return (r.createElement(p,{className:"_2221"},r.createElement(ja,{store:ya.store}),r.createElement(ka,ya)));}),ja=i.pure(function(ya){var za=ya.store,ab=za.get('status'),bb=za.get('wasIncoming')?'Incoming':'Outgoing';return (r.createElement('h2',{className:"_1su5"},ab==='ended'&&bb+' Call End'||bb+' Phone Call'));}),ka=i.pure(function(ya){switch(ya.store.get('status')){case 'dial':return r.createElement(la,ya);case 'in-call':return r.createElement(pa,ya);case 'incoming':return r.createElement(ua,ya);case 'ended':return r.createElement(va,ya);default:i.debug('[twilio] unknown status',ya);return null;}}),la=i.pure(function(ya){var za=ya.store,ab=ya.onToChange,bb=ya.onCallStart,cb=ya.onReady;return (r.createElement('div',{className:"_3hon"},r.createElement(xa,{placeholder:'Type a phone number...',value:za.get('to'),onChange:function(db){return ab(db.target.value);},onKeyDown:function(db){return (db.which===k.RETURN?ma(za)&&bb():null);}}),r.createElement('div',{className:"_1su6"},oa(za)),r.createElement('div',{className:"_1su7"},r.createElement(l,{onClick:cb,type:'secondary',label:'Cancel'}),r.createElement(l,{disabled:!ma(za),onClick:bb,type:'primary',label:'Call'}))));});function ma(ya){return (ya.get('from')&&ya.get('to')&&ya.get('to').length>=10);}var na=function(ya){var za=60000,ab=Math.floor(ya/za);ya%=za;var bb=Math.floor(ya/1000);if(ab<10)ab='0'+ab;if(bb<10)bb='0'+bb;return ab+':'+bb;},oa=function(ya){var za=ya.getIn(['meta','extension']);return 'My Number: '+i.parsePhoneNumber(ya.get('from'))+' ext. '+za;},pa=i.pure(function(ya){var za=ya.callDuration,ab=ya.onHangUp,bb=ya.onMute,cb=ya.onSendDigits,db=ya.onThreadClick,eb=ya.onUnmute,fb=ya.store;return (r.createElement('div',{className:"_2225"},r.createElement('div',{className:"_1su8"},na(za)),r.createElement('div',{className:"_1su9"},i.parsePhoneNumber(fb.get('to'))),r.createElement(qa,{sentDigits:fb.get('sentDigits'),onSendDigits:cb}),r.createElement('div',{className:"_1su6"},fb.get('from')?oa(fb):'Searching for our number...'),r.createElement('div',{className:"_1su7"},r.createElement(ta,{tid:fb.getIn(['meta','tid']),onThreadClick:db}),fb.get('muted')?r.createElement(l,{onClick:eb,type:'secondary',use:'danger',label:'Unmute'}):r.createElement(l,{onClick:bb,type:'secondary',use:'default',label:'Mute'}),r.createElement(l,{onClick:ab,type:'primary',label:'End Call'}))));}),qa=i.pure(function(ya){var za=ya.onSendDigits,ab=ya.sentDigits;return (r.createElement('div',null,r.createElement(xa,{placeholder:'Type numbers using keyboard',value:'',onChange:function(bb){var cb=sa(bb.target.value);cb&&za(cb);}}),r.createElement('div',{className:"_538o"},ab)));}),ra=z(['1','2','3','4','5','6','7','8','9','0','#','*']);function sa(ya){return ya.split('').filter(function(za){return ra.has(za);}).join('');}var ta=i.pure(function(ya){var za=ya.onThreadClick,ab=ya.tid;return ab?r.createElement(l,{onClick:function(){return za(ab);},type:'secondary',label:'Go to Thread'}):null;}),ua=i.pure(function(ya){var za=ya.store,ab=ya.onIncomingAccept,bb=ya.onIncomingReject;return (r.createElement('div',{className:"_2226"},r.createElement('div',{className:"_1su9"},i.parsePhoneNumber(za.get('to'))),r.createElement('div',{className:"_1su6"},oa(za)),r.createElement('div',{className:"_1su7"},r.createElement(l,{onClick:bb,type:'secondary',label:'Ignore'}),r.createElement(l,{onClick:ab,type:'primary',label:'Answer'}))));}),va=i.pure(function(ya){var za=ya.callDuration,ab=ya.store,bb=ya.onHideDialog,cb=ya.onRatingChange,db=ya.onDialAgain,eb=ya.onReady;return (r.createElement('div',{className:"_5gaw"},r.createElement('div',{className:"_1su8"},na(za)),r.createElement('div',{className:"_1su9"},i.parsePhoneNumber(ab.get('to'))),r.createElement('div',{className:"_1su6"},oa(ab)),r.createElement(wa,{rating:ab.get('rating'),onRatingChange:cb}),r.createElement('div',{className:"_1su7"},r.createElement(l,{onClick:db,type:'secondary',label:'New Call'}),r.createElement(l,{onClick:eb,type:'primary',label:'Close'}))));}),wa=i.pure(function(ya){var za=ya.rating,ab=ya.onRatingChange;return (r.createElement('div',{className:"_5rvp"},za?r.createElement('h3',{className:"_5rvu"},'Thank you for rating!'):r.createElement('span',null,r.createElement('h3',{className:"_5rvu"},'How would you rate your experience?'),r.createElement(t,{large:true,count:0,onClick:ab}))));}),xa=i.pure(function(ya){return (r.createElement('input',babelHelpers['extends']({},ya,{className:"_1-i0 _2224"})));});f.exports=ga;},null);
__d('OzHeader.react',['OzHelpers','immutable','Layout.react','OzButton.react','OzConfig','OzHumans','OzReps','OzStores','OzSwitch.react','OzTwilio','React','Reflux','ReactRouter','Tooltip','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=i.Map,x=o.RepStore,y=o.HumanStore,z=t.Link,aa=r.PropTypes,ba=r.createClass({displayName:'OzHeader',mixins:[s.connect(y,'humans'),s.connect(x,'reps'),s.connect(l.ConfigStore,'config')],propTypes:{coachMode:aa.bool.isRequired,rev:aa.number.isRequired,version:aa.string.isRequired,onAway:aa.func.isRequired,onCoachModeToggle:aa.func.isRequired,params:aa.object.isRequired},contextTypes:{uid:aa.string.isRequired,router:aa.object.isRequired},render:function(){var da='/inbox/'+(this.props.params.threadid||''),ea=this.state.humans.getIn([this.context.uid,'load'],0),fa='Inbox'+(ea?' ('+ea+')':''),ga=this.state.config.get('GK',w());return (r.createElement(j,{className:"_2d86"},r.createElement('div',{className:"_2d87"},r.createElement('img',{className:"_2d88"}),this._renderItem(fa,da),this._renderItem('Merchants','/merchants'),this._renderItem('Feedback','/feedback'),this._renderItem('Stats','/stats'),ga.get('supervisor')&&this._renderItem('Top','/top'),ga.get('IntentDashboard')&&this._renderItem('Intents','/intents'),ga.get('AIDashboard')&&this._renderItem('AI','/ai'),ga.get('supervisor')&&this._renderItem('Trainers','/trainers'),this._renderItem('All Threads','/all')),r.createElement('div',{className:"_j6m"},r.createElement(ca,{humans:this.state.humans,reps:this.state.reps,uid:this.context.uid}),ga.get('supervisor')?r.createElement(p,{className:"_b8c",isAnimated:true,isOn:this.props.coachMode,label:'Coach Mode',onToggle:this.props.onCoachModeToggle}):null,r.createElement(q,null),!this.props.away?r.createElement(k,{onClick:this.props.onAway},'I\'m going away'):null)));},_renderItem:function(da,ea){return (r.createElement(z,{activeClassName:'active',className:"_33os",to:ea},r.createElement('span',null,da)));}}),ca=h.pure(function(da){var ea=da.reps,fa=da.humans,ga=da.uid,ha=ea.get(ga,w()),ia=n.closedIntentCount(ha),ja=n.teamClosedIntentCount(ha,ea),ka=Math.round(m.avgLoad(fa)),la=fa.filter(m.isWorking).count();return (r.createElement('span',{className:"_3fr"},r.createElement('span',{className:"_3fs"},r.createElement('span',u.propsFor('Your closed intents'),ia),' ',r.createElement('span',u.propsFor('Closed intents for your entire team'),'(',ja,')')),'intents closed',r.createElement('span',{className:"_3fs"},ka),'avg load',r.createElement('span',{className:"_3fs"},la),la===1?'trainer':'trainers'));});f.exports=ba;},null);
__d('OzSuggestions',['OzHelpers','immutable','OzConstants'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=j.ATTS,l=i.List,m=i.Map;f.exports={toServer:function(p,q){return p.set('type',k.SUGG).update('data',function(r){return m({name:r.get('title'),description:r.get('description')||'','merchant-name':this.findMerchantName(r.get('merchant'),q),'thumb-url':r.get('images',l()).find(h.validateURL)||null,'thumb-urls':r.get('images',l()).filter(h.validateURL),'target-url':r.get('url'),'expiration-time':r.get('expiration-time'),currency:'USD',amount:r.has('price')?n(r.get('price')):null});}.bind(this));},findMerchantName:function(p,q){var r=q&&p&&q.find(function(s){return (s.get('name-dba')||'').toLowerCase()===p.toLowerCase();});if(r){h.info('[sugg] found merchant',p,r);return r.get('name-dba');}return null;}};function n(p){return Math.round(100*parseFloat(o(p,'$'),10));}function o(p,q){if(!p||!p.startsWith(q))return p;return p.substr(q.length);}},null);
__d('Oz.react',['OzAPI','OzHelpers','immutable','Layout.react','OzActions','OzBugNub.react','OzDialogContainer.react','OzExtensionCheck.react','OzHeader.react','OzStores','OzSuggestions','ReactComponentWithPureRenderMixin','React','Reflux','Run','XUIDialog.react','XUINotice.react','cx','OzNotify'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){if(c.__markCompiled)c.__markCompiled();var z=c('OzNotify').Component,aa=q.ActiveThreadStore,ba=q.MerchantStore,ca=q.RepStore,da=q.RequirementStore,ea=q.ThreadStore,fa=q.WitIntentStore,ga=t.PropTypes,ha=j.Map,ia=20000,ja=60000,ka=5000,la=t.createClass({displayName:'Oz',mixins:[u.connect(ba,'merchants'),u.connect(ca,'reps'),u.connect(fa,'witIntents'),u.connect(da,'requirements')],propTypes:{rev:ga.number.isRequired,uid:ga.string.isRequired,version:ga.string.isRequired,skipToto:ga.bool,onUnmount:ga.func.isRequired},childContextTypes:{uid:ga.string.isRequired,merchants:ga.instanceOf(ha).isRequired,reps:ga.instanceOf(ha).isRequired,witIntents:ga.instanceOf(ha).isRequired},getChildContext:function(){return {uid:this.props.uid,merchants:this.state.merchants,reps:this.state.reps,witIntents:this.state.witIntents};},getInitialState:function(){return {almostInactive:false,away:false,coachMode:false,inactive:false};},componentDidMount:function(){window.addEventListener('message',this._handleMessage);window.postMessage({type:'consolemounted'},'*');this.lastPulseAt=Date.now();var ra=l.sendPulse.listen(this._handlePulse),sa=l.activateIntent.listen(this._handleActivateIntent),ta=setInterval(l.sendPulse,ka);this.lastActiveAt=Date.now();window.addEventListener('mousemove',function(wa){return l.isActive();});window.addEventListener('keydown',function(wa){return l.isActive();});var ua=l.isActive.listen(function(){this.lastActiveAt=Date.now();if(this.state.almostInactive||this.state.inactive)this.setState({almostInactive:false,inactive:false});}.bind(this));l.updateThreads.preEmit=oa.bind(null,this.props.uid);var va=l.isInactive.listen(function(wa){if(Date.now()-this.lastActiveAt>ka)this.setState({almostInactive:false,inactive:true});}.bind(this));v.onBeforeUnload(function(){h.sendDisconnectPulse(Math.floor((Date.now()-this.lastPulseAt)/1000),this._buildPulse(true));this.props.onUnmount();}.bind(this));this._cleanup=function(){window.removeEventListener('message');ra();sa();clearInterval(ta);window.removeEventListener('mousemove');ua();va();};},componentWillUnmount:function(){this._cleanup();},render:function(){return (t.createElement(k,{className:"_3_ps _li",onKeyPress:this._handleKeyPress},t.createElement(z,null),!this.props.skipToto&&t.createElement(o,null),this.state.away?t.createElement(ma,{onClick:this._handleAway,shown:this.state.away,text:'You\'re currently away.',className:"_1tir"}):this.state.almostInactive?t.createElement(na,{lastActiveAt:this.lastActiveAt,onZero:this._handleZero}):this.state.inactive?t.createElement(ma,{shown:this.state.inactive,text:'You\'re currently inactive.',className:"_4da6"}):null,t.createElement(p,{away:this.state.away,coachMode:!!this.state.coachMode,onAway:this._handleAway,onCoachModeToggle:this._handleCoachModeToggle,rev:this.props.rev,version:this.props.version,reps:this.state.reps,params:this.props.params}),t.cloneElement(this.props.children,{witIntents:this.state.witIntents,requirements:this.state.requirements,merchants:this.state.merchants,reps:this.state.reps}),t.createElement(m,null),t.createElement(n,null)));},_handleKeyPress:function(){l.isActive();},_handlePulse:function(){var ra=Date.now(),sa=Math.round((ra-this.lastPulseAt)/1000),ta=this._buildPulse();h.sendPulse(sa,ta);qa(aa.data,ea.data);this.lastPulseAt=ra;if(!this.state.almostInactive&&!this.state.inactive&&ta.get('inactive-ms')>=ja-ia)this.setState({almostInactive:true});},_handleActivateIntent:function(ra){if(ra)h.handledEvents(ra);},_handleMessage:function(ra){if(ra.source!==window)return;if(!ra.data)return;switch(ra.data.type){case 'active':l.isActive();break;case 'recordactivity':var sa=aa.data,ta=ra.data.data,ua=sa.get('threadID');i.debug('[oz-ext] received activity',ta);if(!ua){i.debug('[oz-ext] skipping event, no threadID');return;}h.recordActivity(ua,ta);break;case 'bubble':i.debug('[toto] got bubble',ra.data);l.addBubble(r.toServer(j.fromJS(ra.data),this.state.merchants));break;case 'autopilot-data':i.debug('[toto] got autopilot',ra.data);if(ra.data)l.addAutopilot(j.fromJS(ra.data));break;}},_handleAway:function(ra){h.away(!this.state.away).done(function(sa){this.setState({away:!!sa});}.bind(this));},_handleCoachModeToggle:function(ra){h.coachMode(ra).done(function(){this.setState({coachMode:ra});}.bind(this));},_handleZero:function(){this.setState({almostInactive:false,inactive:true});},_buildPulse:function(ra){return pa(this.props.uid,aa.data,ea.data,this.lastActiveAt,this.state.away||ra||false,this.state.coachMode);}});function ma(ra){var sa=ra.shown,ta=ra.onClick,ua=ra.text,va=ra.className;return (t.createElement(w,{width:544,shown:sa,layerHideOnBlur:false},t.createElement('div',{className:"_1tip"},t.createElement('div',{className:va}),t.createElement('div',{className:"_1tis"},ua),ta?t.createElement('a',{className:"_1tit _57lt _30yy",onClick:ta},'I\'m back :)'):null)));}var na=t.createClass({displayName:'OzCountdownDialog',mixins:[s],propTypes:{lastActiveAt:ga.number.isRequired,onZero:ga.func.isRequired},getInitialState:function(){return {countdown:Math.floor((ja-(Date.now()-this.props.lastActiveAt))/1000)};},componentDidMount:function(){this._interval=setInterval(function(){this.setState({countdown:Math.max(this.state.countdown-1,0)});}.bind(this),1000);},componentDidUpdate:function(){if(this.state.countdown===0){clearInterval(this._interval);this.props.onZero();}},componentWillUnmount:function(){clearInterval(this._interval);},render:function(){return (t.createElement(w,{width:544,shown:true,layerHideOnBlur:false},t.createElement('div',{className:"_1tip"},t.createElement('div',{className:"_4da6"}),t.createElement(x,{use:'warn'},'You\'ll be inactive (and your threads will be reassigned) in approximately ',this.state.countdown,' seconds...'))));}});function oa(ra,sa){var ta=ea.data;if(ta.isEmpty())return;sa.filter(function(ua){return ((i.isOwner(ua,ra)||i.isSubscriber(ua,ra))&&(ua.get('ready')||i.isUnread(ua)||i.hasPaid(ua)||i.hasReminder(ua)));}).forEach(function(ua){var va=i.isUnread(ua)&&i.shortDesc(i.lastUserMessage(ua))||i.hasPaid(ua)&&'Payment received.'||i.hasReminder(ua)&&'Reminder triggered.';if(!va)return;var wa=i.threadID(ua),xa=ta.getIn([wa,'last-event-at']);if(ua.get('last-event-at')===xa)return;var ya=i.photo(ua),za=ya?ya.getIn(['data','url'])||ya.get('mime_type')+','+ya.get('data'):null;h.notifyExtension({action:'show',title:i.getName(ua),desc:va,picture:za,id:i.threadID(ua)});});}function pa(ra,sa,ta,ua,va,wa){var xa=sa.get('threadID'),ya=xa&&ta.get(xa),za=ha();if(xa)za=za.merge({tid:xa});if(ya)za=za.merge({'intent-id':sa.get('activeIntent'),'owner-id':ya.getIn(['owner','id']),'user-name':ya.getIn(['user-vcard','name'])});if(Number.isFinite(ua))za=za.set('inactive-ms',Date.now()-ua);za=za.set('load',ta.toSeq().filter(function(ab){return i.isOwner(ab,ra)&&ab.get('ready');}).count());za=za.set('away?',va);za=za.set('coach-mode?',wa);return za;}function qa(ra,sa){var ta=ra.get('threadID'),ua=ta&&sa.get(ta),va=ha();if(ua)va=va.merge({tid:ta,'intent-id':ra.get('activeIntent'),'user-vcard':ua.get('user-vcard')});window.postMessage({type:'consolepulse',data:va.toJS()},'*');}f.exports=la;},null);
__d('OzAIDashboardFilters.react',['immutable','InputLabel.react','ReactComponentWithPureRenderMixin','React','XUISingleSelector.react','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=h.List,o=h.Map,p=k.PropTypes,q=l.Option,r=k.createClass({displayName:'OzAIDashboardFilters',mixins:[j],propTypes:{intentMetas:p.instanceOf(o).isRequired,modules:p.instanceOf(n).isRequired,isReversed:p.bool.isRequired,onIsReversedChange:p.func.isRequired,onSortByChange:p.func.isRequired,onUUIDChange:p.func.isRequired,onModuleChange:p.func.isRequired,sortBy:p.string,sortableFields:p.instanceOf(o).isRequired,uuid:p.string,selectedModule:p.string},render:function(){return (k.createElement('ul',{className:"_1bo-"},k.createElement('li',null,this._renderModuleFilter()),k.createElement('li',null,this._renderUUIDFilter()),k.createElement('li',null,this._renderSortByFilter()),k.createElement('li',null,this._renderIsReversedFilter())));},_renderModuleFilter:function(){return (k.createElement(l,{maxheight:400,onChange:this._handleModuleChange,value:this.props.selectedModule||'__none__'},k.createElement(q,{value:'__none__'},'Select a module'),this.props.modules.valueSeq().map(function(t){return (k.createElement(q,{key:t,value:t},t));})));},_renderUUIDFilter:function(){return (k.createElement(l,{maxheight:400,onChange:this._handleUUIDChange,value:this.props.uuid||'__none__'},k.createElement(q,{value:'__none__'},'Select an intent category'),this.props.intentMetas.sortBy(function(t){return t.get('name');}).valueSeq().map(function(t){return (k.createElement(q,{key:t.get('id'),value:t.get('id')},t.get('name')));})));},_renderIsReversedFilter:function(){return (k.createElement(i,null,k.createElement('input',{checked:this.props.isReversed,onChange:function(t){this.props.onIsReversedChange(t.target.checked);}.bind(this),type:'checkbox'}),k.createElement('label',null,'Reversed?')));},_renderSortByFilter:function(){return (k.createElement(l,{maxheight:400,onChange:this._handleSortByChange,value:this.props.sortBy||'__none__'},k.createElement(q,{value:'__none__'},'Select a field to sort by'),this.props.sortableFields.map(function(t,u){return (k.createElement(q,{key:u,value:u},t));}).valueSeq()));},_handleSortByChange:function(t){this.props.onSortByChange(s(t.value));},_handleUUIDChange:function(t){this.props.onUUIDChange(s(t.value));},_handleModuleChange:function(t){this.props.onModuleChange(t.value);}});function s(t){return t!=='__none__'?t:undefined;}f.exports=r;},null);
__d('OzAIDashboardEventSuggestions.react',['cx','immutable','OzConstants','ReactComponentWithPureRenderMixin','React','XUITable.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=i.List,o=i.Map,p=j.ATTS,q=l.PropTypes,r=l.createClass({displayName:'OzAIDashboardEventSuggestions',mixins:[k],propTypes:{gold:q.instanceOf(o).isRequired,guesses:q.instanceOf(n).isRequired},render:function(){return (l.createElement(m,{outerBorder:true},l.createElement('thead',null,l.createElement('tr',null,l.createElement('th',null,'Source'),l.createElement('th',null,'Guess'),l.createElement('th',null,'Class'),l.createElement('th',null,'Confidence'))),l.createElement('tbody',null,this._getSuggestions().map(this._renderRow))));},_buildGuess:function(s){switch(s.get('type')){case p.TEMPLATE:return (l.createElement('span',null,s.get('ui-body')||JSON.stringify(s.get('body'))));case p.SUGG:case 'bubble':return (l.createElement('a',{href:s.get('target-url'),target:'_blank'},s.get('name')));default:return l.createElement('span',null,JSON.stringify(s));}},_renderRow:function(s,t){var u=this.props.gold,v=s.get('source');return (l.createElement('tr',{className:u.get('source')===v&&u.get('position')===s.get('position')?"_31bp":'',key:t},l.createElement('td',null,v),l.createElement('td',null,this._buildGuess(s)),l.createElement('td',null,s.get('class')),l.createElement('td',null,s.get('confidence'))));},_getSuggestions:function(){return this.props.guesses.flatMap(function(s){return s.get('items')||[s].map(function(t){return t.merge(o({position:s.get('position'),confidence:s.get('confidence'),'class':s.get('class')}));});}).toSeq();}});f.exports=r;},null);
__d('OzAIDashboardEventsDialog.react',['DialogFitHeight','immutable','InputLabel.react','OzAIDashboardEventSuggestions.react','ReactComponentWithPureRenderMixin','React','XUIDialog.react','XUIDialogBody.react','XUIDialogFooter.react','XUIDialogOkayButton.react','XUIDialogTitle.react','XUITable.react','cx','formatDate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';if(c.__markCompiled)c.__markCompiled();var v=i.Map,w=m.PropTypes,x=m.createClass({displayName:'OzAIDashboardEventsDialog',mixins:[l],propTypes:{session:w.instanceOf(v).isRequired,onToggle:w.func.isRequired,shown:w.bool.isRequired},getInitialState:function(){return {isFiltered:true};},render:function(){return (m.createElement(n,{behaviors:{DialogFitHeight:h},onToggle:this.props.onToggle,shown:this.props.shown,width:800},m.createElement(r,null,m.createElement('span',null,'Events for Session  ',this.props.session.get('id'))),m.createElement(o,null,m.createElement(j,null,m.createElement('input',{checked:this.state.isFiltered,onChange:function(aa){this.setState({isFiltered:aa.target.checked});}.bind(this),type:'checkbox'}),m.createElement('label',null,'Filter Non-Message Events?')),this._renderTable()),m.createElement(p,null,m.createElement(q,{use:'confirm',action:'cancel'}))));},_renderTable:function(){return (m.createElement(s,{className:"_4p5_",outerBorder:true},m.createElement('thead',null,m.createElement('tr',null,m.createElement('th',null,'Time'),m.createElement('th',null,'Text/Data'),m.createElement('th',null,'Suggestions'),m.createElement('th',null,'Winner'))),m.createElement('tbody',null,this._getEvents().map(this._renderRow))));},_renderRow:function(event,aa){var ba=event.get('type'),ca=event.getIn(['aiusage','guesses']),da=event.get('suggestion');return (m.createElement('tr',{key:aa},m.createElement('td',{className:"_4p60"},y(event.get('time'))),m.createElement('td',{className:"_4p61"+(ba!=='message'?' '+"_31bp":'')},event.get('text')||da&&z(da)),m.createElement('td',null,ca?m.createElement(k,{gold:event.getIn(['aiusage','gold'])||v(),guesses:ca}):''),m.createElement('td',null,event.getIn(['aiusage','gold','source']))));},_getEvents:function(){var aa=this.props.session.get('events').toSeq();if(this.state.isFiltered)aa=aa.filter(function(event){var ba=event.get('type');return ba==='send'||ba==='message'||ba==='suggest';});return aa;}});function y(aa){return u(aa/1000,'M d, Y g:ia');}function z(aa){return (m.createElement('a',{href:aa.get('target-url'),target:'_blank'},aa.get('name')));}f.exports=x;},null);
__d('OzAIDashboardRow.react',['immutable','ReactLayeredComponentMixin','OzAIDashboardEventsDialog.react','ReactComponentWithPureRenderMixin','React','formatDate'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=h.Map,o=l.PropTypes,p=l.createClass({displayName:'OzAIDashboardRow',mixins:[i,k],propTypes:{session:o.instanceOf(n).isRequired,intentMeta:o.instanceOf(n),selectedModule:o.string},getInitialState:function(){return {isDialogOpen:false};},render:function(){var r=this.props,s=r.session,t=r.intentMeta,u=r.selectedModule;return (l.createElement('tr',null,l.createElement('td',null,s.get('id')),l.createElement('td',null,q(s.get('created-at'))),l.createElement('td',null,t&&t.get('name')),l.createElement('td',null,s.get('sends')||0),l.createElement('td',null,s.get('texts')||0),l.createElement('td',null,s.get('suggs')||0),l.createElement('td',null,s.get('humans')||0),l.createElement('td',null,s.getIn(['shown',u])||0),l.createElement('td',null,s.getIn(['won',u])||0),l.createElement('td',null,this._renderEventsLink())));},renderLayers:function(){if(!this.state.isDialogOpen)return {};return {dialog:l.createElement(j,{session:this.props.session,onToggle:this._handleDialogToggle,shown:this.state.isDialogOpen})};},_renderEventsLink:function(){var r=this.props.session.get('events');if(!r||r.isEmpty())return l.createElement('span',null,'None');return (l.createElement('a',{href:'#',onClick:this._handleEventsLinkClick},'Click to View'));},_handleDialogToggle:function(r){this.setState({isDialogOpen:r});},_handleEventsLinkClick:function(r){r.preventDefault();this.setState({isDialogOpen:true});}});function q(r){return m(r/1000,'M d, Y g:ia');}f.exports=p;},null);
__d('OzAIDashboard.react',['OzAPI','immutable','MessengerFlexScrollableArea.react','OzAIDashboardFilters.react','OzAIDashboardRow.react','ReactComponentWithPureRenderMixin','React','XUITable.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=i.List,q=i.Map,r=n.PropTypes,s=q({id:'ID','created-at':'Created At',sends:'Sends',texts:'Texts',suggs:'Suggs',humans:'Humans',shown:'Shown',won:'Won'}),t=n.createClass({displayName:'OzAIDashboard',mixins:[m],propTypes:{intentMetas:r.instanceOf(q).isRequired,sessions:r.instanceOf(p).isRequired,isLoaded:r.bool.isRequired,isLoading:r.bool.isRequired,isReversed:r.bool.isRequired,onFetchRequest:r.func.isRequired,onIsReversedChange:r.func.isRequired,onSortByChange:r.func.isRequired,onUUIDChange:r.func.isRequired,onModuleChange:r.func.isRequired,selectedModule:r.string,sortBy:r.string,uuid:r.string},getInitialState:function(){return {modules:p()};},componentDidMount:function(){h.AIModules().done(function(u){if(!this.isMounted())return;this.setState({modules:u});if(u.size>0)this.props.onModuleChange(u.get(0));}.bind(this));},render:function(){return (n.createElement(j,{onScroll:this._handleScroll,ref:'scrollable'},n.createElement(k,{intentMetas:this.props.intentMetas,modules:this.state.modules,isReversed:this.props.isReversed,onIsReversedChange:this.props.onIsReversedChange,onSortByChange:this.props.onSortByChange,onUUIDChange:this.props.onUUIDChange,onModuleChange:this.props.onModuleChange,sortBy:this.props.sortBy,sortableFields:s,uuid:this.props.uuid,selectedModule:this.props.selectedModule}),this._renderTable(),this._renderLoadMoreLink()));},_renderTable:function(){var u=this.props,v=u.intentMetas,w=u.selectedModule;return (n.createElement(o,{outerBorder:false},n.createElement('thead',null,n.createElement('tr',null,n.createElement('th',null,'ID'),n.createElement('th',null,'Created At'),n.createElement('th',null,'Intent'),n.createElement('th',null,'Sends'),n.createElement('th',null,'Texts'),n.createElement('th',null,'Suggs'),n.createElement('th',null,'Humans'),n.createElement('th',null,'Shown'),n.createElement('th',null,'Won'),n.createElement('th',null,'Events'))),n.createElement('tbody',null,this.props.sessions.map(function(x){return (n.createElement(l,{session:x,intentMeta:v.get(x.get('wit-intent-uuid')),selectedModule:w,key:x.get('id')}));}))));},_renderLoadMoreLink:function(){if(this.props.isLoaded)return null;if(this.props.isLoading)return n.createElement('div',null,'Loading...');return (n.createElement('div',null,n.createElement('a',{href:'#',onClick:function(u){u.preventDefault();this.props.onFetchRequest();}.bind(this)},'Fetch More Sessions')));},_handleScroll:function(){if(!this.props.isLoading&&!this.props.isLoaded&&this.refs.scrollable&&this.refs.scrollable.isScrolledToBottom())this.props.onFetchRequest();}});f.exports=t;},null);
__d('OzAIDashboardContainer.react',['immutable','OzAPI','OzAIDashboard.react','React'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=h.List,m=h.Map,n=k.PropTypes,o=30,p={sessions:l(),isLoaded:false,offset:0},q=k.createClass({displayName:'OzAIDashboardContainer',propTypes:{witIntents:n.instanceOf(m).isRequired},getInitialState:function(){return babelHelpers['extends']({},p,{isLoading:false,isReversed:true,sortBy:'won',uuid:undefined,selectedModule:undefined});},componentDidMount:function(){this._handleFetchRequest();},render:function(){return (k.createElement(j,{intentMetas:this.props.witIntents,sessions:this.state.sessions,modules:this.state.modules,selectedModule:this.state.selectedModule,isLoaded:this.state.isLoaded,isLoading:this.state.isLoading,isReversed:this.state.isReversed,onFetchRequest:this._handleFetchRequest,onIsReversedChange:this._handleIsReversedChange,onSortByChange:this._handleSortByChange,onUUIDChange:this._handleUUIDChange,onModuleChange:this._handleModuleChange,sortBy:this.state.sortBy,uuid:this.state.uuid}));},_handleFetchRequest:function(){if(this.state.isLoading||this.state.isLoaded)return;this.setState({isLoading:true});i.aiDashboard({offset:this.state.offset,limit:o,uuid:this.state.uuid,reverse:this.state.isReversed||undefined,'sort-by':this.state.sortBy||undefined,module:this.state.selectedModule}).done(function(r){this.setState({sessions:this.state.sessions.concat(r),isLoaded:r.size<o,isLoading:false,offset:this.state.offset+r.size});}.bind(this));},_handleModuleChange:function(r){this.setState(babelHelpers['extends']({},p,{selectedModule:r}),this._handleFetchRequest);},_handleUUIDChange:function(r){this.setState(babelHelpers['extends']({},p,{uuid:r}),this._handleFetchRequest);},_handleIsReversedChange:function(r){this.setState(babelHelpers['extends']({},p,{isReversed:r}),this._handleFetchRequest);},_handleSortByChange:function(r){this.setState(babelHelpers['extends']({},p,{sortBy:r}),this._handleFetchRequest);}});f.exports=q;},null);
__d('OzDate.react',['formatDate','joinClasses','React','cx'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=j.createClass({displayName:'OzDate',propTypes:{timestamp:l.number.isRequired},statics:{formatTimestamp:function(n){return h(new Date(n),{today:'g:ia',withinWeek:'D g:ia',thisYear:'M jS, g:ia',older:'m/d/Y g:ia'});}},render:function(){var n=this.constructor.formatTimestamp(this.props.timestamp);return (j.createElement('time',{className:i("_2s4p",this.props.className)},n));}});f.exports=m;},null);
__d('OzLastEvent.react',['cx','OzHelpers','OzConstants','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=j.AUTHOR_TYPES,n=l.PropTypes,o=l.createClass({displayName:'OzLastEvent',mixins:[k],propTypes:{name:n.string.isRequired,lastEvent:n.object.isRequired},render:function(){var p=this.props.lastEvent,q=i.authorType(p)===m.USER?this.props.name.split(' ')[0].substr(0,10):'M',r=p.get('text'),s=i.shortDesc(p)||'did something',t=r&&q+': '+r||q+' '+s;return (l.createElement('div',{className:"_4-_6 _4-_7",title:t},this._renderText(q,s)));},_renderText:function(p,q){return (l.createElement('span',null,l.createElement('span',{className:"_3ikz"},p,': '),q));}});f.exports=o;},null);
__d('OzStrings',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();f.exports={NOTREADY_BUTTON:'I\'m waiting',IS_NOTREADY:'Currently waiting',READY_BUTTON:'The user is waiting for us!',USER_FILTER_ALL:'All users',USER_FILTER_PUBLIC:'Public only',USER_FILTER_EMPLOYEE:'Employee only',READY_FILTER_ALL:'All threads',READY_FILTER_ATTENTION:'Needs attention',READY_FILTER_WAITING:'I\'m waiting'};},null);
__d('OzThreadLabels.react',['OzHelpers','OzAPI','ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','joinClasses','immutable','ReactLayeredComponentMixin','ReactComponentWithPureRenderMixin','React','ReactDOM','XUICloseButton.react','XUIContextualDialog.react','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=m.Map,v=m.OrderedMap,w=m.List,x=p.PropTypes,y=p.createClass({displayName:'Label',mixins:[o],propTypes:{noColor:x.bool,removable:x.bool,shade:x.oneOf(['dark','light']),thread:x.instanceOf(u).isRequired},getDefaultProps:function(){return {shade:'dark'};},render:function(){if(!this.props.shown)return null;return (p.createElement('div',{className:l("_2yqb"+(this.props.noColor?' '+"_2yqc":'')+(' '+"_2yqd"),this.props.className)},this.props.text,this.props.removable&&this.props.onRemove?p.createElement(r,{className:"_2yqe",onClick:this.props.onRemove,shade:this.props.shade}):null));}});function z(ma){return (p.createElement(y,babelHelpers['extends']({},ma,{className:"_2yqi",text:'REMINDER',shown:!h.urgentReminders(ma.thread).isEmpty()})));}function aa(ma){return (p.createElement(y,babelHelpers['extends']({},ma,{className:"_2yqj",text:'PAID',shown:!h.paidReminders(ma.thread).isEmpty()})));}function ba(ma){var na=h.minAge(ma.thread);return (p.createElement(y,babelHelpers['extends']({},ma,{className:"_2yqm",text:na<18&&'UNDER 18'||na<21&&'UNDER 21',shown:na<21})));}function ca(ma){return (p.createElement(y,babelHelpers['extends']({},ma,{className:"_2yql",text:'ENGAGE',shown:h.hasEngage(ma.thread)})));}var da=v({OzVIPLabel:['vip',"_2yqf"],OzUrgentLabel:['urgent',"_2yqg"],OzAbuserLabel:['abuser',"_2yqh"],OzEscalatedLabel:['escalated',"_1jce"]}),ea=v({OzEmployeeLabel:['employee',"_2yqk"]}),fa=da.merge(ea).map(function(ma){var na=ma[0],oa=ma[1];return na;}).toSet();function ga(ma,na,oa){return function(pa){return (p.createElement(y,babelHelpers['extends']({},pa,{className:na,text:la(ma),shown:h.hasTag(pa.thread,ma),onRemove:function(){return i.deleteTag(h.threadID(pa.thread),ma);}})));};}var ha=da.map(function(ma){return ga.apply(undefined,ma);}),ia=ea.map(function(ma){return ga.apply(undefined,ma);});function ja(ma){var na=ma.className,oa=ma.removable,pa=ma.addable,qa=babelHelpers.objectWithoutProperties(ma,['className','removable','addable']);return (p.createElement('div',{className:na},ha.map(function(ra,sa){return p.createElement(ra,babelHelpers['extends']({key:sa,removable:oa},qa));}).valueSeq(),(qa.thread.get('tags')||w()).filterNot(function(ra){return fa.has(ra);}).sort().map(function(ra){var sa=ga(ra,"_tch");return sa(babelHelpers['extends']({key:ra,removable:oa},qa));}),ia.map(function(ra,sa){return p.createElement(ra,babelHelpers['extends']({key:sa},qa));}).valueSeq(),p.createElement(ca,qa),p.createElement(aa,qa),p.createElement(z,qa),pa?p.createElement(ka,{thread:qa.thread}):null));}var ka=p.createClass({displayName:'OzAddLabel',mixins:[o,n],propTypes:{thread:x.instanceOf(u).isRequired},getInitialState:function(){return {shown:false};},render:function(){return (p.createElement('span',{ref:'add'},this._tags().isEmpty()?null:p.createElement('button',{className:"_1-hv _2yqb _2yqn _2yqo",onClick:function(){return this.setState({shown:true});}.bind(this)},'+')));},renderLayers:function(){var ma=this.state.shown;if(!ma)return null;var na=this.props.thread;return {contextualDialog:p.createElement(s,{behaviors:{ContextualLayerAutoFlip:j,ContextualLayerUpdateOnScroll:k},position:'below',shown:ma,context:q.findDOMNode(this.refs.add),onBlur:function(oa){return this.setState({shown:false});}.bind(this)},p.createElement('div',{className:"_2yqp"},this._tags().map(function(oa){var pa=oa[0],qa=oa[1];return (p.createElement('button',{key:pa,className:l(qa,"_1-hv _2yqq"),onClick:function(){this.setState({shown:false});i.createTag(h.threadID(na),pa);}.bind(this)},la(pa)));}.bind(this))))};},_tags:function(){return da.filterNot(function(ma){var na=ma[0],oa=ma[1];return h.hasTag(this.props.thread,na);}.bind(this)).valueSeq();}});function la(ma){return ma.split('m_experiment_').join('').toUpperCase();}f.exports={OzLabelList:ja,OzUnderageLabel:ba};},null);
__d('OzUserImage.react',['joinClasses','Image.react','immutable','ReactComponentWithPureRenderMixin','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=j.Map,o=l.PropTypes,p=l.createClass({displayName:'OzUserImage',mixins:[k],propTypes:{photo:o.object},render:function(){var q=h(this.props.className,"_3c52 _3c53"),r=function(t){return l.createElement(i,{className:q,src:t});},s=this.props.photo||n();return (s.getIn(['data','url'])&&r(s.getIn(['data','url']))||s.get('data')&&r(s.get('mime_type')+','+s.get('data'))||l.createElement('span',{className:h(q,"_3ejm")}));}});f.exports=p;},null);
__d('OzAllRow.react',['OzStrings','cx','OzHelpers','immutable','OzButton.react','OzConfig','OzConstants','OzDate.react','OzLastEvent.react','OzThreadLabels.react','OzUserImage.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=k.Map,v=k.List,w=n.AUTHOR_TYPES,x=t.PropTypes,y=q.OzLabelList,z=j.pure(function(ia){var ja=ia.thread,ka=ia.witIntents,la=babelHelpers.objectWithoutProperties(ia,['thread','witIntents']);return (t.createElement('div',{className:"_-66"},t.createElement(fa,{width:'220px'},t.createElement(aa,{thread:ja})),t.createElement(fa,{marginLeft:'10px',width:'250px'},t.createElement(ba,{thread:ja,witIntents:ka})),t.createElement(fa,{marginLeft:'10px',width:'350px'},t.createElement(ca,{thread:ja})),t.createElement(fa,{marginLeft:'10px',width:'150px'},t.createElement(da,{thread:ja})),t.createElement(fa,{margineft:'10px',flex:'1',alignItems:'right'},t.createElement(ea,babelHelpers['extends']({thread:ja},la)))));}),aa=j.pure(function(ia){var ja=ia.thread;return (t.createElement('div',{className:"_-67"},t.createElement(r,{photo:j.photo(ja)}),t.createElement('div',{className:"_-68"},t.createElement('h1',{className:"_-69"},j.getName(ja)),t.createElement(y,{className:"_-6a",thread:ja}))));}),ba=j.pure(function(ia){var ja=ia.thread,ka=ia.witIntents,la=j.openIntents(ja).toSeq().map(function(na){return ka.getIn([na.get('wit-intent-uuid'),'name']);}).filter(function(na){return na;}).map(function(na){return 'Intent: '+na;}),ma=j.urgentReminders(ja).toSeq().map(function(na){return na.getIn(['body','description']);}).filter(function(na){return na;}).map(function(na){return 'Reminder: '+na;});return (t.createElement('div',{className:"_-6q"},t.createElement('div',{className:"_-6r"},la.concat(ma).map(function(na,oa){return (t.createElement('div',{key:oa,className:"_4-_7 _-6s"},na));}))));}),ca=j.pure(function(ia){var ja=ia.thread;return (t.createElement('div',{className:"_-6u"},ga(ja).map(function(ka){return (t.createElement('div',{key:j.msgID(ka),className:"_-6v"+(j.authorType(ka)!==w.USER?' '+"_-6w":'')},t.createElement('span',{className:"_4-_7 _-6x"},t.createElement(o,{timestamp:ka.get('timestamp')})),t.createElement(p,{key:j.msgID(ka),name:j.getName(ja),lastEvent:ka})));})));}),da=j.pure(function(ia){var ja=ia.thread,ka=ja.getIn(['owner','name'])||'No owner',la=ja.getIn(['last-owner','name']);return (t.createElement('div',{className:"_-6y"},t.createElement('div',{className:"_-6z"},ka),la?t.createElement('div',{className:"_-6-"},'Last owner: ',la):null));}),ea=t.createClass({displayName:'Actions',mixins:[s],contextTypes:{uid:x.string.isRequired},propTypes:{thread:x.instanceOf(u).isRequired,onThreadNotReady:x.func.isRequired,onThreadReady:x.func.isRequired,onThreadRelease:x.func.isRequired,onThreadView:x.func.isRequired},render:function(){return (t.createElement('div',{className:"_-6_"},ha(babelHelpers['extends']({},this.props,{uid:this.context.uid})).map(function(ia){var ja=ia.body,ka=ia.f;return (t.createElement(l,{key:ja,onClick:function(la,ma){return ka(this.props.thread,ma,la);}.bind(this)},ja));}.bind(this))));}}),fa=j.pure(function(ia){var ja=ia.children,ka=babelHelpers.objectWithoutProperties(ia,['children']);return (t.createElement('div',{className:"_-70",style:ka},ja));});function ga(ia){var ja=j.lastEvents(ia).groupBy(j.authorType);return v([ja.get(w.USER),ja.get(w.TRAINER),ja.get(w.BOT)]).toSeq().filter(function(ka){return ka;}).map(function(ka){return ka.last();}).sortBy(function(ka){return ka.get('timestamp');});}function ha(ia){var ja=ia.onThreadNotReady,ka=ia.onThreadReady,la=ia.onThreadRelease,ma=ia.onThreadView,na=ia.thread,oa=ia.uid,pa=na,qa=m.getInStaticConfig(['GK','supervisor']),ra=[];if(qa&&j.hasOwner(pa))ra.push({body:'Release',f:la});if(pa.get('ready')){ra.push({body:h.NOTREADY_BUTTON,f:ja});}else if(qa)ra.push({body:h.READY_BUTTON,f:ka});if(pa.getIn(['owner','id'])!==oa&&!j.isSubscriber(pa,oa))ra.push({body:'View',f:ma});return ra;}f.exports=z;},null);
__d('OzAll.react',['OzStrings','OzAPI','cx','OzHelpers','immutable','MessengerFlexScrollableArea.react','OzActions','OzAllRow.react','OzLoading.react','OzStores','promiseFinally','ReactComponentWithPureRenderMixin','React','Reflux','XUIButton.react','XUIRadioButtonGroup.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){if(c.__markCompiled)c.__markCompiled();var x=l.Map,y=p.Flex,z=p.Inline,aa=q.QueueFilterStore,ba=q.ThreadStore,ca=t.PropTypes,da=t.createClass({displayName:'OzAll',mixins:[u.connect(aa,'filters'),u.connect(ba,'threads')],propTypes:{witIntents:ca.instanceOf(x).isRequired},contextTypes:{router:ca.object.isRequired},getInitialState:function(){return {clientLimit:na};},componentWillMount:function(){if(this.state.threads.size<na)this._fetchThreads();},componentDidUpdate:function(ra,sa){var ta=sa.filters.get('all'),ua=this.state.filters.get('all');if(!l.is(ta,ua))this._fetchThreads();},render:function(){var ra=this._getFilters(),sa=ra[0],ta=ra[1],ua=this._threads();return (t.createElement('div',{className:"_3l5z"},t.createElement(fa,{showTags:sa,hideTags:ta,onChange:this._handleFilterChange}),t.createElement(ea,{threads:ua,loading:!!la[pa(sa,ta)],clientLimit:this.state.clientLimit,onScrollBottom:this._handleScrollBottom,onThreadNotReady:this._handleThreadNotReady,onThreadReady:this._handleThreadReady,onThreadRelease:this._handleThreadRelease,onThreadView:this._handleThreadView,witIntents:this.props.witIntents})));},_getFilters:function(){var ra=this.state.filters.get('all');return [ra.get('showTags'),ra.get('hideTags')];},_fetchThreads:function(){qa(this._getFilters());},_threads:function(){return ia(ha(this.state.threads),this._getFilters());},_handleFilterChange:function(ra){n.updateQueueFilters(x({all:x(ra)}));this.setState({clientLimit:na});},_handleScrollBottom:function(){var ra=this.state.clientLimit,sa=this._threads(),ta=ra+na;this.setState({clientLimit:ta});sa.slice(ra,ta).size||this._fetchThreads();},_handleThreadNotReady:function(ra,sa){i.notready(k.threadID(ra)).done(sa,sa);},_handleThreadReady:function(ra,sa){i.ready(k.threadID(ra)).done(sa,sa);},_handleThreadRelease:function(ra,sa){i.release(k.threadID(ra)).done(sa,sa);},_handleThreadView:function(ra,sa,ta){var ua=k.threadID(ra),va=k.hasCmdOrCtrl(ta);i.view(ua).done(function(wa){sa();va||this.context.router.push('/inbox/'+ua);}.bind(this),sa);}}),ea=t.createClass({displayName:'ThreadList',mixins:[s],propTypes:{clientLimit:ca.number.isRequired,loading:ca.bool.isRequired,onScrollBottom:ca.func.isRequired,onThreadNotReady:ca.func.isRequired,onThreadReady:ca.func.isRequired,onThreadRelease:ca.func.isRequired,onThreadView:ca.func.isRequired,threads:ca.instanceOf(x).isRequired,witIntents:ca.instanceOf(x).isRequired},render:function(){var ra=this.props,sa=ra.loading,ta=ra.threads,ua=ra.clientLimit;if(sa&&!ta.count())return t.createElement(y,null);return (t.createElement(m,{ref:'scrollable',onScroll:this._handleScroll},t.createElement('div',{className:"_3l5-"},ta.take(ua).map(function(va){return (t.createElement(o,{key:k.threadID(va),thread:va,witIntents:this.props.witIntents,onThreadNotReady:this.props.onThreadNotReady,onThreadReady:this.props.onThreadReady,onThreadRelease:this.props.onThreadRelease,onThreadView:this.props.onThreadView}));}.bind(this)).valueSeq()),t.createElement(z,{loading:sa})));},_handleScroll:function(){var ra=this.refs.scrollable;ra&&ra.isScrolledToBottom()&&this.props.onScrollBottom();}}),fa=k.pure(function(ra){var sa,ta,ua=ra.showTags,va=ra.hideTags,wa=ra.onChange,xa=function(ya){var za=ya.tagName,ab=ya.value,bb=ka({tagName:za,value:ab,showTags:ua,hideTags:va});wa(bb);};return (t.createElement('div',{className:"_3l5_"},t.createElement(ga,{tagName:'employee',value:ja('employee',ua,va),onChange:xa,buttons:(sa={},sa[ja.NEUTRAL]=h.USER_FILTER_ALL,sa[ja.OFF]=h.USER_FILTER_PUBLIC,sa[ja.ON]=h.USER_FILTER_EMPLOYEE,sa)}),t.createElement(ga,{tagName:'ready',value:ja('ready',ua,va),onChange:xa,buttons:(ta={},ta[ja.NEUTRAL]=h.READY_FILTER_ALL,ta[ja.OFF]=h.READY_FILTER_ATTENTION,ta[ja.ON]=h.READY_FILTER_WAITING,ta)})));}),ga=k.pure(function(ra){var sa=ra.tagName,ta=ra.value,ua=ra.buttons,va=ra.onChange;return (t.createElement('div',{key:sa,className:"_3l60"},t.createElement(w,{selectedValue:ta,selectedUse:'confirm',onValueChange:function(wa){va({tagName:sa,value:wa});}},Object.keys(ua).map(function(wa){return t.createElement(v,{key:wa,value:wa,label:ua[wa]});}))));});function ha(ra){return ra.sortBy(function(sa){return -sa.get('last-event-at');});}function ia(ra,sa){var ta=sa[0],ua=sa[1];return ra.filter(function(va){var wa=true;if(ta.size)wa=k.hasAllTags(va,ta);if(ua.size)wa=!k.hasSomeTag(va,ua);return wa;});}var ja=function(ra,sa,ta){return sa.has(ra)?ja.ON:ta.has(ra)?ja.OFF:ja.NEUTRAL;};ja.ON='on';ja.OFF='off';ja.NEUTRAL='neutral';function ka(ra){var sa=ra.tagName,ta=ra.value,ua=ra.showTags,va=ra.hideTags,wa,xa;switch(ta){case ja.ON:wa=ua.add(sa);xa=va.remove(sa);break;case ja.OFF:wa=ua.remove(sa);xa=va.add(sa);break;default:wa=ua.remove(sa);xa=va.remove(sa);break;}return {showTags:wa,hideTags:xa};}var la={},ma={},na=20,oa=2*na;function pa(ra,sa){var ta=ra.toJS().join('-'),ua=sa.toJS().join('-');return 'show['+ta+']hide['+ua+']';}function qa(ra){var sa=ra[0],ta=ra[1],ua=pa(sa,ta),va=la[ua];k.debug('[oz-all] fetchThreads',ua);if(va){k.debug('[oz-all] abort fetchthreads : loading',ua);return;}var wa=ma[ua]||0;la[ua]=true;r(i.allThreads(sa,ta,wa,oa),function(xa){return la[ua]=false;}).done(function(xa){return ma[ua]=wa+oa;});}f.exports=da;},null);
__d('OzMessage.react',['cx','getURLRanges','OzHelpers','Image.react','immutable','Link.react','MNCommerceAgentItemSuggestionMercuryShareAttachment.react','ReactComponentWithPureRenderMixin','React','TextWithEntities.react','XStickerAssetController'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=l.Map,t=l.List,u=p.PropTypes,v=p.createClass({displayName:'OzMessage',mixins:[o],propTypes:{message:u.instanceOf(s).isRequired},render:function(){var sa=this.props.message,ta=sa.get('attachments')||t(),ua=t([sa.get('text')&&qa(sa.get('text'))]).concat(ta.map(function(va){var wa=da(va)&&ea(va)||ka(va)&&ma(la(va))||ja(va)&&ma(va.get('uri'))||ha(va)&&ia(va)||fa(va)&&ga(va)||aa(va)&&ba(va)||w(va)&&z(y(va.get('metadata')))||x(va)&&z(j.uiSuggestion(va.get('suggestion')))||na(va)&&oa(va.getIn(['xma','link']))||va.get('uri')&&oa(va.get('uri'));if(wa){return wa;}else{j.error('could not render attachment',va.toJS(),sa.toJS());return ra('Oops. We could not render this attachment.');}})).filter(function(va){return !!va;}).map(function(va,wa){return (p.createElement('span',{key:wa,className:"_15_n"},va));});if(ua.size){return p.createElement('span',null,ua);}else{j.error('no text or attachments',sa.toJS());return ra('Oops. We did not get text or attachments.');}}}),w=function(sa){return sa.hasIn(['metadata','target_url']);},x=function(sa){return sa.has('suggestion');},y=function(sa){if(!s.isMap(sa.get('total_cost'))&&sa.has('raw_amount'))sa=sa.set('total_cost',s({amount:+sa.get('raw_amount')}));return sa.update('target_url',j.shimURI).toJS();};function z(sa){return (p.createElement('div',{className:"_53qw"},p.createElement(n,{attachment:{target:sa}})));}var aa=function(sa){var ta=sa.get('metadata');return ta&&ta.get('location')&&ta.get('url')&&ta.get('image_url');};function ba(sa){return ma(sa.getIn(['metadata','image_url']),sa.getIn(['metadata','url']));}var ca=function(sa){var ta=sa.get('uri'),ua=sa.get('sticker_id');if(ua)ta=r.getURIBuilder().setInt('sticker_id',ua).getURI().toString();return ta;},da=function(sa){return sa.get('sticker_id')&&ca(sa);};function ea(sa){return (p.createElement(k,{className:"__vl",src:ca(sa)}));}var fa=function(sa){return (/video/.test(sa.get('mime_type'))&&sa.get('uri'));};function ga(sa){return (p.createElement('video',{controls:true,height:'300',width:'300'},p.createElement('source',{src:sa.get('uri'),type:sa.get('mime_type')})));}var ha=function(sa){return (/audio/.test(sa.get('mime_type'))&&sa.get('uri'));};function ia(sa){return (p.createElement('audio',{className:"_1d86",controls:true},p.createElement('source',{src:sa.get('uri'),type:sa.get('mime_type')})));}var ja=function(sa){var ta=/blob:/.test(sa.get('uri')),ua=/\.(jpg|gif|png)/.test(sa.get('uri'));return sa.get('uri')&&(j.isImageType(sa.get('mime_type'))||ta||ua);},ka=function(sa){return (/base64/.test(sa.get('mime_type'))&&sa.get('data'));},la=function(sa){return sa.get('mime_type')+','+sa.get('data');};function ma(sa,ta){return (p.createElement('a',{href:ta||sa,target:'_blank',className:"_4y6l",style:{backgroundImage:'url(\''+sa+'\')'}}));}var na=function(sa){return !!sa.getIn(['xma','link']);};function oa(sa){return (p.createElement('div',{className:"_4y6k"},p.createElement('a',{href:sa,target:'_blank'},'Attachment Link')));}function pa(sa,ta){return (p.createElement(m,{target:'_blank',href:j.shimURI(ta.entity.url)},sa));}function qa(sa){return (p.createElement(q,{className:"_4y6k",text:sa,interpolator:pa,ranges:i(sa),renderEmoticons:true,renderEmoji:true}));}function ra(sa){return (p.createElement('div',{className:"_4y6k _5kng"},sa));}f.exports=v;},null);
__d('OzSearchSource',['AbstractSearchSource'],function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,h);j=i&&i.prototype;function k(l){'use strict';j.constructor.call(this);this.$OzSearchSource1=l;}k.prototype.bootstrap=function(){'use strict';return this.$OzSearchSource1({});};k.prototype.suggest=function(l){'use strict';return this.$OzSearchSource1(l);};k.prototype.searchImpl=function(l,m){'use strict';return this.$OzSearchSource1({query:l}).then(function(n){return m(n,l);},function(n){return m([],l);});};f.exports=k;},null);
__d('OzFeedbackDashboard.react',['Promise','OzAPI','cx','OzHelpers','immutable','OzButton.react','OzConfig','OzMessage.react','OzSearchSource','ReactComponentWithPureRenderMixin','React','Reflux','SearchableDropdownInput.contrib','SearchableEntry','Stars.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=l.Map,x=r.PropTypes,y=r.createClass({displayName:'OzFeedbackDashboard',mixins:[q,s.connect(n.ConfigStore,'config')],propTypes:{reps:x.instanceOf(w).isRequired},contextTypes:{uid:x.string.isRequired,router:x.object.isRequired},getInitialState:function(){return {messages:w(),authorID:this.context.uid};},componentWillMount:function(){this._searchSource=new p(function(oa){var pa=(oa.query||'').toLowerCase();return new h(function(qa){return qa(this.props.reps.valueSeq().map(ga).concat([ga('autoresponse-bot'),ga('survey-bot')]).sortBy(function(ra){return ra.getTitle();}).filter(function(ra){return (ra.getTitle()||'').toLowerCase().indexOf(pa)>-1;}).toJS());}.bind(this));}.bind(this));},componentDidMount:function(){this._fetchFeedback();},render:function(){return (r.createElement('div',{className:"_60f"},this.state.config.getIn(['GK','supervisor'])?r.createElement(z,{reps:this.props.reps,authorID:this.state.authorID,searchSource:this._searchSource,onSelect:function(oa){return this.setState({messages:w(),activeMessage:null,authorID:oa.getUniqueID()},this._fetchFeedback);}.bind(this)}):null,r.createElement(aa,{messages:this.state.messages}),r.createElement(da,{messages:this.state.messages,reps:this.props.reps,activeMessage:this.state.activeMessage||this.state.messages.first(),onMessageClick:function(oa){return this.setState({activeMessage:oa});}.bind(this),onSeeThreadClick:function(oa){return this.context.router.push('/inbox/'+oa);}.bind(this)})));},_fetchFeedback:function(){i.authorFeedback(this.state.authorID).done(function(oa){oa=oa.sortBy(function(pa){return -pa.get('timestamp');});this.isMounted()&&this.setState({messages:oa});}.bind(this));}}),z=k.pure(function(oa){var pa=oa.reps,qa=oa.authorID,ra=oa.searchSource,sa=oa.onSelect;return (r.createElement('div',{className:"_5p66"},r.createElement('div',{className:"_wa_"},r.createElement(t,{value:ga(pa.get(qa)||qa),onSelect:sa,placeholder:'Pick a rep',emptySearchResultsText:'No Rep found',searchSource:ra}))));}),aa=k.pure(function(oa){var pa=oa.messages,qa=na(pa,-7,0),ra=na(pa,-14,-7);return (r.createElement('div',{className:"_wb0"},r.createElement('div',{className:"_wb1"},r.createElement(ba,{label:'OVERALL RATING'},ma(qa),'%'),r.createElement(ba,{label:'SINCE LAST WEEK'},r.createElement(ca,{value:ma(qa)-ma(ra)}))),r.createElement('div',{className:"_wb2"},r.createElement(ba,{label:'TONE'},ka(qa),'%'),r.createElement(ba,{label:'RESPONSIVENESS'},ja(qa),'%'),r.createElement(ba,{label:'EXECUTION'},ia(qa),'%'),r.createElement(ba,{label:'POLICY'},la(qa),'%')),r.createElement('div',{className:"_3gch"},r.createElement(ba,{label:'FEEDBACK GIVEN LAST WEEK'},qa.size))));}),ba=k.pure(function(oa){var pa=oa.label,qa=oa.children;return (r.createElement('div',{className:"_wb3"},r.createElement('span',{className:"_wb4"},qa),r.createElement('span',{className:"_wb5"},pa)));}),ca=k.pure(function(oa){var pa=oa.value;return (r.createElement('div',{className:(pa>0?"_wb6":'')+(pa<0?' '+"_wb7":'')},pa>0?'+':null,pa,'%'));}),da=k.pure(function(oa){var pa=oa.messages,qa=oa.reps,ra=oa.activeMessage,sa=oa.onMessageClick,ta=oa.onSeeThreadClick,ua=ra&&ra.get('reviews'),va=ra&&ra.get('user-id');return (r.createElement('div',{className:"_wb8"},r.createElement('div',{className:"_wbc"},r.createElement('div',{className:"_4fj7"},pa.map(function(wa){return (r.createElement('div',{key:k.msgID(wa),onClick:function(xa){return sa(wa);},className:"_wbf"+(wa===ra?' '+"_wbg":'')},r.createElement(o,{message:wa})));}).valueSeq())),r.createElement('div',{className:"_wbh"},r.createElement('div',{className:"_wbe"},ua?ua.map(function(wa){return (r.createElement(ea,{key:wa.get('id'),rep:qa.get(wa.get('reviewer-id')),review:wa}));}).valueSeq():null)),r.createElement('div',{className:"_wbi"},va?r.createElement(m,{onClick:function(wa){return ta(va);}},'See Thread'):null)));}),ea=k.pure(function(oa){var pa=oa.review,qa=oa.rep;return (r.createElement('div',{className:"_wbj"},r.createElement('div',{className:"_wbk"},r.createElement('h2',{className:"_wbl"},qa&&qa.get('name')),pa.has('tone')?r.createElement(fa,{label:'Tone'},r.createElement(v,{count:pa.get('tone'),max:3,size:'large'})):null,pa.has('responsiveness')?r.createElement(fa,{label:'Responsiveness'},r.createElement(v,{count:pa.get('responsiveness'),max:3,size:'large'})):null,pa.has('execution')?r.createElement(fa,{label:'Execution'},r.createElement(v,{count:pa.get('execution'),max:3,size:'large'})):null,pa.has('followed-policy')?r.createElement(fa,{label:'Followed Policy?'},r.createElement('div',{className:"_wbm"},pa.get('followed-policy')?'YES':'NO')):null),r.createElement('div',{className:"_wbn"},pa.get('body'))));}),fa=k.pure(function(oa){var pa=oa.label,qa=oa.children;return (r.createElement('div',{className:"_wbo"},qa,r.createElement('div',{className:"_wbp"},pa)));});function ga(oa){var pa=function(qa){return new u(qa);};return oa?oa.get?pa({title:oa.get('name'),uniqueID:oa.get('fbid')}):pa({title:oa,uniqueID:oa}):null;}function ha(oa,pa){return function(qa){var ra=qa.valueSeq().flatMap(function(va){return va.get('reviews');}).filter(function(va){return va&&va.has(oa);}),sa=ra.reduce(function(va,wa){var xa=va[0],ya=va[1];return [xa+pa,ya+wa.get(oa)];},[0,0]),ta=sa[0],ua=sa[1];return ta?Math.round(ua/ta*100):0;};}var ia=ha('execution',3),ja=ha('responsiveness',3),ka=ha('tone',3),la=ha('followed-policy',1);function ma(oa){return Math.round((ja(oa)+ka(oa)+la(oa)+ia(oa))/4);}function na(oa,pa,qa){var ra=new Date().getDate(),sa=+new Date(Date.now()).setDate(ra+pa),ta=+new Date(Date.now()).setDate(ra+qa);return oa.filter(function(ua){var va=+ua.get('timestamp');return va>=sa&&va<=ta;});}f.exports=y;},null);
__d('OzInboxThreadRow.react',['OzHelpers','cx','immutable','OzLastEvent.react','OzThreadLabels.react','OzUserImage.react','ReactComponentWithPureRenderMixin','React','Timestamp.react','Tooltip'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r=j.Map,s=l.OzLabelList,t=o.PropTypes,u=o.createClass({displayName:'OzInboxThreadRow',mixins:[n],propTypes:{thread:t.object.isRequired,locker:t.object.isRequired,selected:t.bool.isRequired,onClick:t.func.isRequired,onUnview:t.func.isRequired,witIntents:t.instanceOf(r).isRequired},contextTypes:{uid:t.string.isRequired},render:function(){var x=this.props,y=x.thread,z=x.locker,aa=x.selected,ba=x.subscribed,ca=x.owned,da=x.onUnview,ea=h.getName(y),fa=h.photo(y),ga=h.lastEvents(y).last(),ha=!ca&&y.get('ui-reassign'),ia=h.hasPaid(y),ja=h.hasReminder(y),ka=y.get('locked'),la=ka?'Thread locked by '+z.get('name')+'\n       at '+new Date(y.get('locked-at')).toLocaleString():'',ma=ca&&(y.get('ready')||ia||ja)&&!ka,na=null,oa=ca&&y.get('ui-ping')&&!y.get('ui-reassign'),pa=ga&&ga.get('timestamp');if(!ca){var qa=y.get('ui-reassign')?'Reassigned to':'Grabbed by';na=qa+' '+h.nameOrId(y.get('owner'));}return (o.createElement('div',{onClick:this._handleClick,className:(oa?"_2q49":'')+(' '+"_2ic2")+(ma?' '+"_2ic3":'')+(ja?' '+"_2ic5":'')+(ia?' '+"_2ic6":'')+(aa?' '+"_2ic7":'')+(ha?' '+"_2q4a":'')},o.createElement('div',{className:"_2ic8"},o.createElement(m,{photo:fa}),ba?o.createElement('button',{className:"_1-hv _2ic9",onClick:function(ra){return da(y);}}):null),o.createElement('div',{className:"_2ica"},!ca?o.createElement(v,{name:na}):null,o.createElement('h1',{className:"_4-_7 _2ice"},ea),o.createElement(w,{thread:y,witIntents:this.props.witIntents}),o.createElement('div',{className:"_2icb"},ga?o.createElement(k,{lastEvent:ga,name:ea}):null),o.createElement('div',{className:"_3lxn"},o.createElement(s,{className:"_2icc",thread:y}))),o.createElement('div',{className:"_6f"},pa?o.createElement('div',{className:"_2icf"},o.createElement(p,{autoUpdate:true,shorten:true,time:pa/1000})):null,o.createElement('div',babelHelpers['extends']({className:ka?"_1hw":''},q.propsFor(la))))));},_handleClick:function(){this.props.onClick(this.props.thread);}});function v(x){var y=x.name,z=x.lastEvent,aa=z&&z.get('timestamp');return (o.createElement('div',{className:"_2icd"},o.createElement('h1',{className:"_4-_7 _2ice"},y),aa?o.createElement('div',{className:"_2icf"},o.createElement(p,{autoUpdate:true,shorten:true,time:aa/1000})):null));}function w(x){var y=x.thread,z=x.witIntents,aa=h.openIntents(y).first(),ba=aa&&z.getIn([aa.get('wit-intent-uuid'),'name']);return ba?o.createElement('div',{className:"_2icg"},ba):o.createElement('span',null);}f.exports=u;},null);
__d('OzInboxThreadList.react',['cx','OzHelpers','joinClasses','OzInboxThreadRow.react','immutable','OzLoading.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=l.Map,q=l.OrderedMap,r=o.PropTypes,s=m.Inline,t=o.createClass({displayName:'OzInboxThreadList',mixins:[n],contextTypes:{uid:r.string.isRequired},propTypes:{loading:r.bool.isRequired,onThreadClick:r.func.isRequired,onUnview:r.func.isRequired,threadGroups:r.instanceOf(q).isRequired,witIntents:r.instanceOf(p).isRequired,className:r.string,selectedThread:r.string},render:function(){return (o.createElement('div',{className:j("_36ob",this.props.className)},this.props.threadGroups.map(this._renderRows).valueSeq(),this.props.threadGroups.some(function(v){return v.count();})?o.createElement(s,{key:'l',loading:this.props.loading}):o.createElement(u,null)));},_renderRows:function(v,w){var x=v.map(function(y){return (o.createElement(k,{key:i.threadID(y),thread:y,locker:this.props.reps.get(y.get('locker-id'),p()),owned:i.isOwner(y,this.context.uid),selected:i.threadID(y)===this.props.selectedThread,subscribed:i.isSubscriber(y,this.context.uid),onClick:this.props.onThreadClick,onUnview:this.props.onUnview,witIntents:this.props.witIntents}));}.bind(this)).valueSeq();return (o.createElement('span',{className:"_36oc",key:w},x));}});function u(){return (o.createElement('div',{className:"_725"},'You do not own any threads at the moment.',o.createElement('br',null)));}f.exports=t;},null);
__d('OzTabHeader.react',['cx','React'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(k){var l=k.tabs,m=k.onChange,n=k.active;return (i.createElement('div',{className:"_2j6l"},l.map(function(o){var p=o[0],q=o[1];return (i.createElement('button',{key:q,role:'button',className:"_1-hv"+(' '+"_2j6m")+(q===n?' '+"_2j6n":''),onClick:function(r){return m([p,q]);}},p));})));}f.exports=j;},null);
__d('OzInbox.react',['OzAPI','cx','OzHelpers','DataTransfer','immutable','OzActions','OzInboxThreadList.react','OzInboxThreads','OzStores','OzTabHeader.react','ReactComponentWithPureRenderMixin','React','Reflux','promiseFinally'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();var v=l.Map,w=l.OrderedMap,x=l.List,y=p.HandledEventsStore,z=p.HumanStore,aa=p.ThreadStore,ba=s.PropTypes,ca=o.OZ_GRABBED_TAB,da=o.OZ_VIEWING_TAB,ea=o.OZ_PAST_TAB,fa=5000,ga=30000,ha=120*1000,ia=ca,ja=s.createClass({displayName:'OzInbox',mixins:[r,t.connect(aa,'threads'),t.connect(z,'humans'),t.connect(y,'handledEvents')],propTypes:{requirements:ba.instanceOf(v).isRequired,witIntents:ba.instanceOf(v).isRequired,merchants:ba.instanceOf(v).isRequired,reps:ba.instanceOf(v).isRequired,params:ba.object.isRequired},contextTypes:{uid:ba.string.isRequired,router:ba.object.isRequired},getInitialState:function(){return {activeTab:null,loading:false};},componentDidMount:function(){this._fetchThreads();var pa=window.setInterval(function(ra){var sa=Date.now()-aa.updatedAt;if(sa>ha){j.warn('[oz] last thread update > '+ha);this._fetchThreads();}}.bind(this),ga),qa=window.setInterval(function(){var ra=this.threads(this._getActiveTab());if(ra.some(function(sa){return sa.get('ui-reassign');}))m.clearReassignState();}.bind(this),fa);this._cleanup=function(){ia=this._getActiveTab();window.clearInterval(qa);window.clearInterval(pa);}.bind(this);},componentDidUpdate:function(pa,qa){var ra=this.props.params.threadid;if(ra){var sa=!!this.state.threads.get(ra);j.debug('[ozinbox] tid='+ra+' hasThread='+sa);sa||la(ra);}else{var ta=this.threads(),ua=p.ActiveThreadStore.data.get('oldThreadID'),va=ta.get(ua)||ta.first();j.debug('[ozinbox] search for best thread, found:',va);if(va)this.context.router.push('inbox/'+j.threadID(va));}},componentWillUnmount:function(){this._cleanup();},render:function(){var pa=this._getActiveTab(),qa=this.threads(pa),ra=this.state.humans.getIn([this.context.uid,'load'],0),sa=function(ta){return ta.preventDefault();};return (s.createElement('div',{className:"_4b5_",onDragStart:sa,onDragEnd:sa,onDragOver:sa,onDrop:function(ta){sa(ta);var ua=new k(ta.nativeEvent.dataTransfer);m.updateComposer({files:ua.getFiles()});}},s.createElement(ka,{threadGroups:na(qa,this.context.uid,pa),reps:this.props.reps,loading:this.state.loading,activeCount:ra,activeTab:pa,selectedThread:this.props.params.threadid,onTabChange:this._handleTabChange,onUnview:this._handleUnview,onThreadClick:this._handleThreadClick,witIntents:this.props.witIntents}),this._renderDetails()));},_getActiveTab:function(){var pa=this.state.threads.get(this.props.params.threadid);return this.state.activeTab||pa&&j.isOwner(pa,this.context.uid)&&ca||pa&&j.isSubscriber(pa,this.context.uid)&&da||ia||ca;},_handleUnview:function(pa){this._callAPIAndShift('unview',pa);},_handleThreadClick:function(pa){this.context.router.push('/inbox/'+j.threadID(pa));},_handleTabChange:function(pa){var qa=pa[0],ra=pa[1];this.setState({activeTab:ra});},_callAPIAndShift:function(pa,qa){var ra=ma(this.threads(ca),qa),sa=function(ua){this.context.router.push('/inbox/'+j.threadID(ua));}.bind(this),ta=h[pa](j.threadID(qa));ra&&sa(ra);ta.done(null,function(ua){j.error('[inbox] could not shift',ua);sa(qa);});},_renderDetails:function(){var pa=this.props.params.threadid;if(this.threads().isEmpty())return this._renderFinished();var qa=j.fullThreadData(this.state.threads,this.state.handledEvents,pa);if(!qa||!this.props.children)return null;return (s.cloneElement(this.props.children,{thread:qa,witIntents:this.props.witIntents,requirements:this.props.requirements,merchants:this.props.merchants,humans:this.state.humans,reps:this.props.reps}));},_renderFinished:function(){return (s.createElement('div',{className:"_57l3"},s.createElement('div',{className:"_57l8"},s.createElement('div',{className:"_57lo"}),s.createElement('h2',null,'Congrats! You\'ve made a lot of people happy'),s.createElement('p',null,'Sit tight, new messages should be coming soon!'))));},_fetchThreads:function(){var pa=this.state.loading;if(pa)return;this.setState({loading:true});u(h.myThreads(),function(qa){return this.isMounted()&&this.setState({loading:false});}.bind(this)).done();},threads:function(pa){return o.getInboxThreads(this.state.threads,this.context.uid,pa);}}),ka=s.createClass({displayName:'OzThreadListPanel',mixins:[r],propTypes:babelHelpers['extends']({activeTab:ba.oneOf([ca,da,ea]).isRequired,onTabChange:ba.func.isRequired},n.propTypes),render:function(){var pa=this.props,qa=pa.activeTab,ra=pa.onTabChange,sa=pa.activeCount,ta=babelHelpers.objectWithoutProperties(pa,['activeTab','onTabChange','activeCount']),ua=sa?'Open ('+sa+')':'Open';return (s.createElement('div',{className:"_4b61"},s.createElement('div',{className:"_4cwh"},s.createElement(q,{active:qa,tabs:[[ua,ca],['Viewing',da],['Closed',ea]],onChange:ra})),s.createElement('div',{className:"_3_cz"},s.createElement('div',{className:"_4fj7"},s.createElement(n,babelHelpers['extends']({className:qa===ca?"_2sav":''},ta))))));}}),la=j.memoize(h.thread,function(pa){return pa;});function ma(pa,qa){var ra=j.threadID(qa),sa=pa.toList(),ta=sa.findIndex(function(wa){return j.threadID(wa)===ra;}),ua=ta-1,va=ta+1;if(va<sa.count()){return sa.get(va);}else if(ua>=0)return sa.get(ua);}function na(pa,qa,ra){var sa;switch(ra){case ca:return oa(pa,qa,ra);default:return w((sa={},sa[ra]=pa,sa));}}function oa(pa,qa,ra){var sa='Needs Attention',ta='Up For Grabs',ua='Waiting',va=function(wa){var xa=j.isOwner(wa,qa),ya=wa.get('ready'),za=j.isLocker(wa,qa),ab=j.hasOpenIntents(wa);return xa&&(za||ya&&ab)?sa:ya?ta:ua;};return w().withMutations(function(wa){wa.set(sa,[]);wa.set(ta,[]);wa.set(ua,[]);pa.forEach(function(xa){return wa.update(va(xa),function(ya){ya.push(xa);return ya;});});}).map(function(wa){return x(wa);});}f.exports=ja;},null);
__d('OzPhotoCropper.react',['cx','OzHelpers','BasicVector','Photocrop2','React'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=l.PropTypes,n=l.createClass({displayName:'OzPhotoCropper',propTypes:{src:m.string.isRequired},getInitialState:function(){return {imageSize:null};},componentDidMount:function(){this._image=new Image();this._image.src=this.props.src;this._image.onload=function(o){var p=new j(this._image.width,this._image.height);this.setState({imageSize:p});this._photocrop=new k(this.refs.img,{},p);}.bind(this);},componentWillUnmount:function(){this._image=null;},render:function(){return (l.createElement('div',{className:"_3x2x"},l.createElement('canvas',{ref:'canvas',style:{display:'none'}}),l.createElement('img',{src:this.props.src,ref:'img',className:"_3x2y"})));},finalizeCrop:function(o){var p=this.refs.canvas,q=this._photocrop.done(o),r=q.x,s=q.y,t=q.height,u=q.width;p.width=u;p.height=t;p.getContext('2d').drawImage(this._image,Math.max(0,r),Math.max(0,s),u,t,0,0,u,t);return i.blobFromDataURI(p.toDataURL());}});f.exports=n;},null);
__d('OzAttachmentCropper.react',['OzHelpers','DialogFitHeight','immutable','OzPhotoCropper.react','ReactComponentWithPureRenderMixin','React','XUIButton.react','XUIDialog.react','XUIDialogBody.react','XUIDialogFooter.react','XUIDialogTitle.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=j.Map,t=j.OrderedMap,u=m.PropTypes,v=m.createClass({displayName:'OzAttachmentCropper',mixins:[l],propTypes:{attachment:u.instanceOf(s).isRequired,onSave:u.func.isRequired,onClose:u.func.isRequired},_handleSubmit:function(){var w=this.props,x=w.attachment,y=w.onSave,z=this.refs.photoCropper.finalizeCrop();y(x.set('ui-blob',z));},render:function(){return (m.createElement(o,{behaviors:{DialogFitHeight:i},onToggle:this.props.onClose,shown:true,width:900},m.createElement(r,null,m.createElement('span',null,'Crop tool')),m.createElement(p,null,m.createElement(k,{src:h.blobURI(this.props.attachment.get('ui-blob')),ref:'photoCropper'})),m.createElement(q,null,m.createElement(n,{onClick:this._handleSubmit,label:'Crop'}))));}});f.exports=v;},null);
__d('OzAttachmentOverlay.react',['cx','joinClasses','OzLoading.react','ReactComponentWithPureRenderMixin','React','XUICloseButton.react','XUIEditButton.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=l.PropTypes,p=l.createClass({displayName:'OzAttachmentOverlay',mixins:[k],propTypes:{onClick:o.func,onEdit:o.func,onRemove:o.func,loading:o.bool},render:function(){var q=this.props,r=q.onClick,s=q.onEdit,t=q.onRemove,u=q.loading;return (l.createElement('div',{className:i(this.props.className,"_18wc")},u?l.createElement(j,null):null,l.createElement('div',{className:"_4xe8",onClick:r},s?l.createElement(n,{className:"_1yll",type:'button',size:'medium',title:'Add Image',onClick:this._handleEdit}):null,t?l.createElement(m,{type:'button',className:"_1ylm",size:'medium',shade:'dark',onClick:this._handleRemove}):null),this.props.children));},_handleEdit:function(q){q.stopPropagation();this.props.onEdit&&this.props.onEdit();},_handleRemove:function(q){q.stopPropagation();this.props.onRemove&&this.props.onRemove();}});f.exports=p;},null);
__d('OzBubbleImageSelector.react',['Image.react','immutable','OzAttachmentOverlay.react','ReactComponentWithPureRenderMixin','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=i.List,o=l.PropTypes,p=l.createClass({displayName:'OzBubbleImageSelector',mixins:[k],propTypes:{onImageAdd:o.func.isRequired,onImageSelect:o.func.isRequired,selectedURI:o.string,thumbURIs:o.instanceOf(n).isRequired},render:function(){var r=this.props,s=r.onImageSelect,t=r.selectedURI,u=r.thumbURIs;return (l.createElement('div',{className:"_1-i2"},u.map(function(v,w){return (l.createElement(q,{index:w,isSelected:v===t,key:w,onSelect:s,uri:v}));}),this._renderAddButton()));},_renderAddButton:function(){return (l.createElement('button',{type:'button',className:"_1-hv _1-i4",onClick:this.props.onImageAdd},'+'));}}),q=l.createClass({displayName:'Thumbnail',mixins:[k],propTypes:{index:o.number.isRequired,isSelected:o.bool.isRequired,uri:o.string.isRequired},render:function(){return (l.createElement(j,{className:this.props.isSelected?"_4-8e":'',onClick:this._handleSelect},l.createElement(h,{src:this.props.uri,className:"_1-i3",alt:'image thumb'})));},_handleSelect:function(){this.props.onSelect(this.props.uri);}});f.exports=p;},null);
__d('OzFormPreview.react',['cx','OzHelpers','React'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=i.pure(function(m){var n=m.children;return (j.createElement('div',{className:"_5bwr"},n));}),l=i.pure(function(m){var n=m.label,o=m.children;if(!o)return null;return (j.createElement('div',{className:"_5bws _5bwt"},j.createElement('div',{className:"_5bwv"},n),j.createElement('div',{className:"_5bx2"},o)));});k.Row=l;f.exports=k;},null);
__d('OzBubblePreview.react',['OzAPI','cx','OzHelpers','formatDate','AdsCurrencyFormatter','immutable','MessengerButton.react','OzFormPreview.react','OzStores','ReactComponentWithPureRenderMixin','React','Reflux','TextWithHighlights.atlas','XUIContextualDialog.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();var v=m.Map,w=m.List,x=r.PropTypes,y=o.Row,z=p.AutopilotStore,aa=r.createClass({displayName:'OzBubblePreview',mixins:[q],propTypes:{bubble:x.instanceOf(v).isRequired,highlight:x.string,meta:x.instanceOf(v),source:x.string},render:function(){return va(this.props)?r.createElement(fa,this.props):r.createElement(ba,this.props);}}),ba=j.pure(function(eb){var fb=eb.bubble,gb=eb.highlight,hb=null;if(Number.isSafeInteger(fb.get('amount')))hb=l.formatCurrencyFullFormat(fb.get('currency'),fb.get('amount'));return (r.createElement(qa,{thumbURL:fb.get('thumb-url')},r.createElement(sa,{text:fb.get('name'),highlight:gb}),r.createElement(ta,null,r.createElement(ua,{color:'grey',highlight:gb},fb.get('description')||'No Description')),r.createElement(ta,null,r.createElement(ua,null,fb.get('merchant-name')||'No Merchant')),r.createElement(ta,null,r.createElement(ua,{color:'blue',weight:'bold'},hb))));}),ca='__overviewTab',da='__hoursTab',ea='__moreInfoTab',fa=r.createClass({displayName:'PlacesPreview',mixins:[q,s.connect(z,'autopilot')],propTypes:{bubble:x.instanceOf(v).isRequired,meta:x.instanceOf(v).isRequired,highlight:x.string},getInitialState:function(){return {shown:false,activeTab:ca};},_makeOpentableRequest:function(eb,fb){var gb=bb(eb);if(gb){var hb=gb.getIn(['data','id']),ib=fb.get(hb);if(!ib)h.requestAutopilot(gb.toJS());}},componentWillMount:function(){this._makeOpentableRequest(this.props.meta,this.state.autopilot);window.clearTimeout(this.timeout);},componentWillReceiveProps:function(eb){var fb=eb.meta;if(cb(fb)!==cb(this.props.meta))this._makeOpentableRequest(fb,this.state.autopilot);},_handleToggle:function(eb){window.clearTimeout(this.timeout);var fb=function(gb){return this.setState({shown:eb});}.bind(this);eb?fb():this.timeout=window.setTimeout(fb,100);},render:function(){var eb=this.props,fb=eb.bubble,gb=eb.meta,hb=eb.highlight,ib=this.state,jb=ib.shown,kb=ib.activeTab,lb=ib.autopilot;return (r.createElement('div',{ref:'root',tabIndex:'0',onMouseEnter:function(mb){return this._handleToggle(true);}.bind(this),onMouseLeave:function(mb){return this._handleToggle(false);}.bind(this)},r.createElement(qa,{thumbURL:fb.get('thumb-url')},r.createElement(sa,{text:fb.get('name'),highlight:hb}),r.createElement(ga,{rating:gb.get('rating')}),r.createElement(ta,null,r.createElement(ua,null,gb.get('cuisine')),' ',r.createElement(ua,null,gb.get('price'))),r.createElement(ta,null,r.createElement(ha,{meta:gb,autopilot:lb}))),r.createElement(ia,babelHelpers['extends']({activeTab:kb,contextRef:function(mb){return this.refs.root;}.bind(this),onTabChange:this._handleTabChange,shown:jb,onToggle:this._handleToggle,autopilot:lb},this.props))));},_handleTabChange:function(eb){this.setState({activeTab:eb});}}),ga=j.pure(function(eb){var fb=eb.rating;return fb?r.createElement(ta,null,r.createElement(ua,{weight:'500'},fb.get('value'),'/',fb.get('scale')),' ',r.createElement(ua,{color:'grey'},fb.get('rating-count')?'('+fb.get('rating-count')+' reviews)':null)):null;}),ha=j.pure(function(eb){var fb=eb.meta,gb=eb.autopilot,hb=bb(fb);if(!hb)return (r.createElement(ua,null,'No OT info'));var ib=gb.get(hb.getIn(['data','id']));if(!ib)return (r.createElement(ua,null,'Checking OT...'));if(ib.size===0)return (r.createElement(ua,{color:'red'},'No Tables Available!'));return (r.createElement(ua,null,'Table at ',za(fb,ib)));}),ia=j.pure(function(eb){var fb=eb.activeTab,gb=eb.contextRef,hb=eb.meta,ib=eb.onTabChange,jb=eb.onToggle,kb=eb.shown,lb=babelHelpers.objectWithoutProperties(eb,['activeTab','contextRef','meta','onTabChange','onToggle','shown']);return (r.createElement(u,{contextRef:gb,hoverHideDelay:0,position:'above',shown:kb,hasActionableContext:true},r.createElement('div',{className:"_53qb",onMouseEnter:function(mb){return jb(true);},onMouseLeave:function(mb){return jb(false);}},r.createElement('div',{className:"_c38"},r.createElement(ja,babelHelpers['extends']({meta:hb},lb)),r.createElement(pa,{tabs:[['Overview',ca],['Hours',da],['More Info',ea]],active:fb,onChange:ib})),r.createElement(ka,babelHelpers['extends']({activeTab:fb,meta:hb},lb)))));}),ja=j.pure(function(eb){var fb=eb.bubble,gb=eb.meta,hb=eb.highlight;return (r.createElement('div',{className:"_53qc"},r.createElement(ra,{url:fb.get('thumb-url')}),r.createElement('div',{className:"_53qd"},r.createElement(sa,{text:fb.get('name'),highlight:hb}),r.createElement(ga,{rating:gb.get('rating')}),r.createElement(ta,null,r.createElement(ua,null,gb.get('cuisine'))),r.createElement(ta,null,r.createElement(ua,null,gb.get('price'))))));}),ka=j.pure(function(eb){var fb=eb.activeTab,gb=babelHelpers.objectWithoutProperties(eb,['activeTab']);return (r.createElement('div',{className:"_53qe"},fb===ca&&r.createElement(la,gb)||fb===da&&r.createElement(na,gb)||fb===ea&&r.createElement(oa,gb)||null));}),la=j.pure(function(eb){var fb=eb.bubble,gb=eb.highlight,hb=eb.meta,ib=eb.autopilot,jb=(hb.getIn(['address','street'],'')+'\n     '+hb.getIn(['address','city'],'')+'\n    ').trim();return (r.createElement(o,null,r.createElement(y,{label:'Address'},jb),r.createElement(y,{label:'Phone'},ma(fb,hb)),r.createElement(y,{label:'Website'},r.createElement('a',{href:fb.get('target-url'),target:'_blank'},'Link')),r.createElement(y,{label:'OpenTable'},wa(hb,ib)),r.createElement(y,{label:'Description'},fb.get('description'))));}),ma=function(eb,fb){var gb=fb.get('phone');return gb?r.createElement(ua,{weight:'bold'},j.parsePhoneNumber(gb)):null;},na=j.pure(function(eb){var fb=eb.meta;return (r.createElement(o,null,ya(fb.get('hours')||w()).map(function(gb,hb){return r.createElement(y,{key:hb,label:hb},gb);}).valueSeq()));}),oa=j.pure(function(eb){var fb=eb.bubble,gb=eb.meta,hb=gb.get('payment'),ib=gb.get('infos');if(hb&&hb.size||ib&&ib.size){var jb=function(){var kb=function(lb){return lb[0].toUpperCase()+lb.slice(1).toLowerCase();};return {v:r.createElement(o,null,ib.map(function(lb,mb){return (r.createElement(y,{label:kb(mb),key:mb},lb));}).toList(),hb?r.createElement(y,{label:'Payments'},hb.map(kb).toJS().join(', ')):null)};}();if(typeof jb==="object")return jb.v;}else return r.createElement('div',null,'No additional info for this place...');}),pa=j.pure(function(eb){var fb=eb.tabs,gb=eb.onChange,hb=eb.active;return (r.createElement('div',{className:"_c39"},fb.map(function(ib){var jb=ib[0],kb=ib[1],lb=kb===hb?{weight:'bold',color:'blue'}:{color:'grey'};return (r.createElement('button',{key:kb,role:'button',className:"_1-hv",onClick:function(mb){return gb(kb);}},r.createElement(ua,lb,jb)));})));}),qa=j.pure(function(eb){var fb=eb.children,gb=eb.thumbURL;return (r.createElement('div',{className:"_1q15 _5rxk"},r.createElement(ra,{url:gb}),r.createElement('div',{className:"_1q17"},fb)));}),ra=j.pure(function(eb){var fb=eb.url;return fb?r.createElement('div',{className:"_1q16",style:{backgroundImage:'url(\''+fb+'\')'}}):null;}),sa=j.pure(function(eb){var fb=eb.text,gb=eb.highlight;return (r.createElement(ta,null,r.createElement(ua,{weight:'bold',highlight:gb},fb||'No Title')));}),ta=j.pure(function(eb){var fb=eb.children;return (r.createElement('div',{className:"_4-_7 _5rxl"},fb));}),ua=j.pure(function(eb){var fb=eb.children,gb=eb.color,hb=eb.highlight,ib=eb.size,jb=eb.weight,kb=jb===undefined?'normal':jb;return fb?r.createElement('span',{className:"_5rxm"+(ib==='large'?' '+"_5rxn":'')+(gb==='blue'?' '+"_5ryf":'')+(gb==='grey'?' '+"_5ryk":'')+(gb==='red'?' '+"_5emd":'')+(gb==='green'?' '+"_5emf":''),style:{fontWeight:kb}},hb?r.createElement(t,{text:fb,highlight:hb}):fb):null;});function va(eb){var fb=eb.meta,gb=eb.source;return gb==='places'&&fb;}function wa(eb,fb){var gb=eb.get('open-table');if(gb){var hb=fb.get(cb(eb));if(hb){var ib;if(hb.size===0){ib=r.createElement(ua,{color:'red'},'No tables available!');}else ib=r.createElement(ua,null,'Tables available at '+db(hb));}return (r.createElement('div',null,r.createElement('a',{href:gb.get('url'),target:'_blank'},'Link (',gb.get('area'),')'),r.createElement('br',null),ib));}}var xa=w(['Sun','Mon','Tues','Wed','Thurs','Fri','Sat']);function ya(eb){var fb=function(){var kb=new Date(j.serverNow());kb.setHours(0,0,0,0);kb.setDate(kb.getDate()-kb.getDay()+1);return +kb;},gb=fb(),hb=function(kb){return new Date(gb+kb*60*1000);},ib=function(kb){return k(kb,'h:i A',{skipPatternLocalization:true});},jb=function(kb){return kb.map(ib).join(' - ');};return eb.map(function(kb){return kb.map(hb);}).groupBy(function(kb){return kb.get('start').getDay();}).mapKeys(function(kb){return xa.get(kb);}).map(function(kb){return kb.map(jb).join(', ');});}function za(eb,fb){var gb=function(ib){var jb=ib.split(':'),kb=jb[0],lb=jb[1];return parseInt(lb,10)+parseInt(kb,10)*60;},hb=gb(eb.getIn(['open-table','availability','data','hour']));return ab(fb.map(function(ib){return ib.get('hour');}).minBy(function(ib){return Math.abs(hb-gb(ib));}));}function ab(eb){var fb=eb.split(':'),gb=fb[0],hb=fb[1];gb=parseInt(gb,10);if(gb===0){return '12:'+hb+'AM';}else if(gb<12){return eb+'AM';}else if(gb===12){return eb+'PM';}else return gb-12+':'+hb+'PM';}function bb(eb){return eb.getIn(['open-table','availability']);}function cb(eb){return eb.getIn(['open-table','availability','data','id']);}function db(eb){return eb.map(function(fb){return ab(fb.get('hour'));}).toJS().join(', ');}f.exports=aa;},null);
__d('OzMerchantDialog.react',['cx','OzHelpers','immutable','Layout.react','MessengerDialog.react','MessengerDialogHeader.react','MessengerDialogTitle.react','OzActions','React','ReactDOM','XUIDatePicker.react','XUIError.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=k.Column,u=k.FillColumn,v=p.PropTypes,w=j.Map,x=j.Set,y=x(['name-dba','name-legal','website','phone','address','page-id','country','type','owner-name']),z=w({country:'US'}),aa=p.createClass({displayName:'OzMerchantDialog',propTypes:{onMerchant:v.func.isRequired,title:v.string,initialMerchant:v.instanceOf(w)},getDefaultProps:function(){return {title:"Create a merchant",initialMerchant:w()};},getInitialState:function(){var ba=this.props.initialMerchant,ca=z.filterNot(function(da,ea){return ba.get(ea);});return {inputs:ca,errors:w()};},componentDidMount:function(){var ba=q.findDOMNode(this.refs['name-dba']);ba&&ba.focus();},render:function(){return (p.createElement(l,{className:"_18w8",onToggle:this._handleToggle,ref:'dialog',type:'default',width:544},p.createElement(m,null,p.createElement(n,null,this.props.title)),this._renderFields(),p.createElement('div',null,this._renderDialogAction('Save',this._handleSave),this._renderDialogAction('Cancel',o.hideDialog))));},_renderDialogAction:function(ba,ca){return p.createElement('button',{onClick:ca,className:"_bx0 _3e2t _30yy"},ba);},_renderFields:function(){return (p.createElement('div',{className:"_374d _18w9"},this._renderTextField('name-dba','Name *'),this._renderTextField('name-legal','Legal Name'),this._renderTextField('website','Website'),this._renderTextField('phone','Phone'),this._renderTextField('address','Address'),this._renderTextField('page-id','Facebook Page Id'),this._renderTextField('country','Country *'),this._renderTextField('type','Business Type'),this._renderTextField('owner-name','Owner Name'),this._renderDateField('owner-birth-date','Owner Birth Date')));},_renderTextField:function(ba,ca){var da=this.props.initialMerchant,ea=this.state,fa=ea.inputs,ga=ea.errors;return (p.createElement(k,{key:ba},p.createElement(t,{className:"mrm _bx1"},ca),p.createElement(u,null,p.createElement(s,{xuiError:ga.get(ba)||null},p.createElement('input',{ref:ba,type:'text',className:"_7q5 _bx2",defaultValue:da.get(ba),value:fa.get(ba),onChange:function(ha){this.setState({inputs:fa.set(ba,ha.target.value),errors:w()});}.bind(this)})))));},_renderDateField:function(ba,ca){var da={},ea=this.props.initialMerchant,fa=ea.get('owner-birth-date');if(fa)da.initialTime=fa;return (p.createElement(k,{key:ba},p.createElement(t,{className:"mrm _bx1"},ca),p.createElement(t,null,p.createElement(r,babelHelpers['extends']({ref:ba,shouldSetDefaultDate:false},da)))));},_handleSave:function(){var ba=this._validateData();if(ba){ba.id=this.props.initialMerchant.get('id');this.props.onMerchant(ba);}},_handleToggle:function(ba){if(!ba)o.hideDialog();},_validateData:function(){var ba=w(),ca=this.props.initialMerchant,da=function(ga){var ha=this.state.inputs.get(ga,undefined);if(ha===undefined)return ca.get(ga);return ha||null;}.bind(this);ba=w(y.map(function(ga){return [ga,da(ga)];})).set('id',ca.get('id'));var ea=this.refs['owner-birth-date'].state.selectTime;ba=ba.set('owner-birth-date',ea);ba=i.normalizeMerchant(ba);var fa=i.validateMerchant(ba);this.setState({errors:fa});if(!fa.isEmpty())return null;return ba;}});f.exports=aa;},null);
__d('OzSetPicURLDialog.react',['cx','getURLRanges','OzHelpers','Image.react','Keys','MessengerDialog.react','MessengerDialogHeader.react','MessengerDialogTitle.react','ReactComponentWithPureRenderMixin','React','ReactDOM'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=q.PropTypes,t=q.createClass({displayName:'OzSetPicURLDialog',mixins:[p],PropTypes:{onURL:s.func.isRequired,onEscape:s.func},componentDidMount:function(){var u=r.findDOMNode(this.refs.url);u&&u.focus();},getInitialState:function(){return {errors:[],url:''};},render:function(){return (q.createElement(m,{className:"_18w8",onToggle:this._handleToggle,ref:'dialog',type:'default',width:544},q.createElement(n,null,q.createElement(o,null,'Enter a URL for your picture')),this._renderImage(),this._renderErrors(),q.createElement('div',{className:"_374d _18w9"},q.createElement('input',{onChange:this._handleChange,onKeyDown:this._handleKeyDown,ref:'url',type:'text',className:"_7q5",placeholder:'URL to picture'})),q.createElement('div',{className:"_18wa"},'Press Enter when you\'re done.')));},_renderImage:function(){var u=this.state.url,v=this.state.errors||[];if(v.length>0||!u||u.length===0)return null;return (q.createElement(k,{className:"_24p-",src:u}));},_renderErrors:function(){var u=this.state.errors;if(!u||u.length===0)return null;return (q.createElement('div',{key:'errors',className:"_1yln"},u.map(function(v){var w=v[0],x=v[1];return (q.createElement('div',{key:w,className:"_1ylp"},x));})));},_handleChange:function(u){if(u.target.value.length&&!i(u.target.value).length){this.setState({errors:[['invalid_url','You must provide a valid uri']]});return;}var v=u.target.value.length?i(u.target.value)[0].entity.url:'';this.setState({errors:[],url:v});},_handleKeyDown:function(u){if(u.keyCode===l.ESC){var v=this.props.onEscape;if(v)v(u);return;}var w=this.state.errors||[];if(w.length===0&&u.keyCode===l.RETURN){u.preventDefault();var x=u.target.value.length?i(u.target.value)[0].entity.url:'';this.props.onURL(x);}return;},_handleToggle:function(){j.debug('[OzSetPicURLDialog] toggled',arguments);}});f.exports=t;},null);
__d('OzBubbleEditor.react',['Promise','OzAPI','cx','getURLRanges','OzHelpers','OzNotify','AdsCurrencyInput.react','immutable','Keys','OzActions','OzBubbleImageSelector.react','OzBubblePreview.react','OzConfig','OzMerchantDialog.react','OzSearchSource','OzSetPicURLDialog.react','ReactComponentWithPureRenderMixin','React','Reflux','SearchableDropdownInput.contrib','SearchableEntry','XUICloseButton.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){if(c.__markCompiled)c.__markCompiled();var da=o.List,ea=o.Map,fa=y.PropTypes,ga=['thumb-url'],ha=['thumb-urls'],ia=la('No Merchant'),ja=69,ka=y.createClass({displayName:'OzBubbleEditor',mixins:[x,z.connect(t.ConfigStore,'config')],propTypes:{merchants:fa.instanceOf(ea).isRequired,seedBubble:fa.instanceOf(ea).isRequired,onSave:fa.func.isRequired,onClose:fa.func.isRequired},getInitialState:function(){return {newData:ea()};},componentWillMount:function(){this._searchSource=new v(function(pa){var qa=pa.query||'',ra=this.props.merchants.valueSeq().filter(function(sa){return sa.get('name-dba').toLowerCase().indexOf(qa.toLowerCase())>-1;}).map(function(sa){return la(sa.get('name-dba'));}).take(15).toArray();return h.resolve(this._data().get('merchant-name')?[ia].concat(ra):ra);}.bind(this));},componentDidMount:function(){this.focus('Title');},focus:function(pa){this.refs[pa]&&this.refs[pa].focus&&this.refs[pa].focus();},render:function(){return (y.createElement('div',{className:"_1-ht"},y.createElement('div',{className:"_2zfj"},this._renderSection('Preview',this._renderPreview)),y.createElement('form',{className:"_2zfk",onKeyDown:function(pa){pa.keyCode===p.ESC&&this.props.onClose(this._bubble());}.bind(this),onSubmit:function(pa){pa.stopPropagation();pa.preventDefault();this._handleSubmit();}.bind(this)},y.createElement(ca,{className:"_1-hu",shade:'dark',size:'medium',onClick:function(pa){return this.props.onClose(this._bubble());}.bind(this)}),this._renderSection('Image',this._renderImage),this._renderSection('Title',this._renderInput.bind(this,['name'])),this._renderSection('Description',this._renderDescription),this._renderSection('URL',this._renderInput.bind(this,['target-url'])),this._renderSection('Merchant',this._renderMerchant),this._renderSection('Price',this._renderPrice),this._renderSubmit())));},_bubble:function(){return this.props.seedBubble.set('data',this._data()).deleteIn(['data','thumb-urls']);},_data:function(){var pa=this.state.newData.updateIn(ha,function(qa){var ra=this.props.seedBubble.getIn(['data'].concat(ha));return (ra||da()).concat(qa);}.bind(this));return this.props.seedBubble.get('data').merge(pa);},_handleSubmit:function(){var pa=this._bubble(),qa=pa.get('data'),ra=[[qa.get('name'),'Please enter a title.'],[qa.get('expires-in')||!qa.get('expiration-time'),'Since this bubble is old, please re-enter the expiration time.'],[l.validateURL(qa.get('target-url')),'Please enter a valid url. Usually, you need to add "www."'],[l.validateURL(qa.get('thumb-url'))||!qa.get('thumb-url'),'Please enter a valid url for your image.'],[qa.get('merchant-name')||!qa.get('amount'),'You need to specify a merchant if you\'ve listed a price.'],[qa.get('amount')||!qa.get('expires-in'),'You need to list a price if you\'ve set an expiration time.']].filter(function(sa){var ta=sa[0],ua=sa[1];return !ta;}).map(function(sa){var ta=sa[0],ua=sa[1];return ua;});if(ra.length){m.error(ra[0]);return;}this.props.onSave(pa.updateIn(['data','target-url'],function(sa){return (k(sa)[0].entity.url);}));},_handleCreateMerchant:function(){q.showDialog(u,{onMerchant:function(pa){i.createMerchant(pa);var qa=this.state.newData.set('merchant-name',pa.get('name-dba'));this.setState({newData:qa});q.hideDialog();}.bind(this)});},_handleAddImage:function(){q.showDialog(w,{onEscape:function(pa){q.hideDialog();this.focus('Title');}.bind(this),onURL:function(pa){q.hideDialog();this.setState(function(qa){return {newData:oa(qa.newData,pa)};});this.focus('Title');}.bind(this)});},_handleSelectImage:function(pa){this.setState(function(qa){return {newData:qa.newData.setIn(ga,pa)};});},_renderSubmit:function(){return (y.createElement('button',{type:'submit',className:"_1-hv _1-hw"},'DONE'));},_renderSection:function(pa,qa){return (y.createElement('div',{className:"_1-hx"},y.createElement('div',{className:"_1-hz",onClick:function(ra){return this.focus(pa);}.bind(this)},pa),y.createElement('div',{className:"_1-h-"},qa(pa))));},_renderPrice:function(pa){var qa=this._data(),ra=qa.get('currency'),sa=qa.get('amount');return (y.createElement('div',{className:"_1-h_"},y.createElement(n,{placeholder:'(optional)',currency:ra||'USD',value:Number.isSafeInteger(sa)?sa:null,onDataUpdate:function(ta){this.setState({newData:qa.set('amount',ta)});}.bind(this),eventType:'change'}),this._renderExpiration()));},_renderExpiration:function(){if(!this.state.config.getIn(['GK','expirationDate']))return null;return (y.createElement('div',{className:"_51w3"},y.createElement('div',{className:"_1-hz"},'Expiration Time:'),y.createElement(na,{expiresIn:this._data().get('expires-in'),onChange:function(pa){return this.setState({newData:this.state.newData.set('expires-in',pa)});}.bind(this)})));},_renderInput:function(pa,qa){var ra=this.state.newData;return (y.createElement('input',{ref:qa,type:'text',className:"_1-i0 _1-i1",value:this._data().getIn(pa),onChange:function(sa){return this.setState({newData:ra.setIn(pa,sa.target.value)});}.bind(this)}));},_renderImage:function(){var pa=this._data(),qa=pa.getIn(ga),ra=ma(pa,qa);return (y.createElement(r,{onImageAdd:this._handleAddImage,onImageSelect:this._handleSelectImage,selectedURI:qa,thumbURIs:ra}));},_renderMerchant:function(){var pa=this._data(),qa=pa.get('merchant-name'),ra=qa?la(qa):null;return (y.createElement('div',{className:"_1-i5"},y.createElement('div',{className:"_1-i6"},y.createElement(aa,{divClassName:"_1-i7",value:ra,onSelect:function(sa){var ta=sa.getUniqueID()===ia.getUniqueID()?null:sa.getTitle(),ua=this.state.newData.set('merchant-name',ta);this.setState({newData:ua});}.bind(this),emptySearchResultsText:'No merchants found. Click + to add',placeholder:'Pick a Merchant (optional)',searchSource:this._searchSource})),y.createElement('div',{onClick:this._handleCreateMerchant,className:"_1-hv _4nd4 _1-i8"})));},_renderPreview:function(){return (y.createElement(s,{bubble:this._data()}));},_renderDescription:function(){var pa=this._data(),qa=pa.get('description'),ra=qa&&qa.length>ja;return (y.createElement('div',null,y.createElement('input',{ref:'description',type:'text',className:"_1-i0 _1-i1",value:qa,onChange:function(sa){return this.setState({newData:pa.set('description',sa.target.value)});}.bind(this)}),y.createElement('text',{className:ra?"_353q":''},ja-(qa?qa.length:0)+' characters left')));}});function la(pa){return new ba({title:pa,uniqueID:pa});}function ma(pa,qa){return pa.getIn(ha,da()).toOrderedSet().add(qa).toList().filter(function(ra){return ra;});}var na=l.pure(function(pa){var qa=pa.expiresIn,ra=pa.onChange,sa="_1-i0 _3owv",ta=qa||ea({hours:0,minutes:0}),ua=function(xa){return Math.max(+xa,0);},va=function(xa){return ra(ta.merge(ea(xa)));},wa=function(xa,ya){return (ta.get(ya)===1?xa:xa+'s');};return (y.createElement('div',{className:"_51wb"},y.createElement('label',{className:"_1-hz"},y.createElement('input',{className:sa,onChange:function(xa){return va({hours:ua(xa.target.value)});},type:'number',value:qa?qa.get('hours'):null}),wa('hour','hours')),y.createElement('label',{className:"_1-hz"},y.createElement('input',{className:sa,onChange:function(xa){return va({minutes:ua(xa.target.value)});},type:'number',value:qa?qa.get('minutes'):null}),wa('minute','minutes'))));});function oa(pa,qa){return pa.withMutations(function(ra){ra.updateIn(ha,da(),function(sa){return sa.push(qa);});ra.setIn(ga,qa);});}f.exports=ka;},null);
__d('OzComposerAI.react',['ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','cx','OzHelpers','joinClasses','immutable','Image.react','LayerHideOnBlur','MessengerSpinner.react','OzBubblePreview.react','OzConfig','OzConstants','ReactComponentWithPureRenderMixin','React','Reflux','TextWithHighlights.atlas','MessengerButton.react','formatDate','XUIContextualDialog.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){if(c.__markCompiled)c.__markCompiled();var aa=m.Map,ba=m.List,ca=s.ATTS,da=u.PropTypes,ea=u.createClass({displayName:'OzComposerAIList',mixins:[t],propTypes:{filter:da.string,items:da.instanceOf(ba).isRequired,onItemClick:da.func.isRequired},getInitialState:function(){return {};},render:function(){var qa=this.props,ra=qa.items,sa=qa.filter,ta=qa.onItemClick,ua={filter:sa,onItemClick:ta};return !ra.isEmpty()&&u.createElement('div',{className:"_4285"},ra.map(function(va,wa){return (ba.isList(va)?u.createElement('div',{key:wa,className:"_2961"},va.map(function(xa,ya){return (u.createElement(ka,babelHelpers['extends']({key:ya,column:ya,line:wa,item:xa},ua)));})):u.createElement(fa,babelHelpers['extends']({key:wa,line:wa,item:va,onToggleDebug:function(xa){return this.setState({debugLine:this.state.debugLine===wa?null:wa});}.bind(this),debugShown:this.state.debugLine===wa},ua)));}.bind(this)).reverse());}}),fa=u.createClass({displayName:'ItemRow',mixins:[t,v.connect(r.ConfigStore,'config')],propTypes:{onToggleDebug:da.func.isRequired,debugShown:da.bool.isRequired},render:function(){var qa=this.props,ra=qa.item,sa=qa.line,ta=qa.onItemClick,ua=qa.filter,va=aa({line:sa,column:0}),wa=ra.get('id'),xa=ra.get('at'),ya=this.state.config.get('debugAI');return (u.createElement('div',{className:"_2962",onClick:function(za){za.preventDefault();ta(va);}},pa(ra)?u.createElement(ja,{label:'AUTO-SENDING',at:xa}):null,u.createElement('div',{className:"_58jk",ref:'root'},u.createElement('div',{className:"_2964"},u.createElement(ma,{item:ra,filter:ua})),u.createElement('span',{className:"_58jl"},pa(ra)?u.createElement(x,{type:'secondary',label:'STOP'}):wa&&xa?y(xa/1000,'g:ia M j'):'⌘'+ra.get('shortcut',sa+1),ya&&u.createElement(ia,babelHelpers['extends']({contextRef:function(za){return this.refs.root;}.bind(this)},this.props))))));}});function ga(qa,ra,sa,ta,ua){var va='<span style="color: brown">',wa='<span style="color: navy">',xa='<span style="color: navy">',ya=ra||'';if(sa)ya=ya+va+sa.replace(/[": ]/g,'')+'</span>: ';if(ta)ya=ya+(ta[0]=='"'?xa:wa)+ta+'</span>';return ya+(ua||'');}function ha(qa){var ra=/^( *)("[\w]+": )?("[^"]*"|[\w.+-]*)?([,[{])?$/mg,sa={__html:JSON.stringify(qa,null,3).replace(/&/g,'&amp;').replace(/\\"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(ra,ga)};return u.createElement('div',{dangerouslySetInnerHTML:sa});}var ia=u.createClass({displayName:'DebugInfo',mixins:[t],propTypes:{onToggleDebug:da.func.isRequired,debugShown:da.bool.isRequired},_handleToggleDebugInfo:function(event){this.props.onToggleDebug();event.stopPropagation();},render:function(){var qa=this.props,ra=qa.contextRef,sa=qa.item,ta=qa.debugShown,ua=sa.get('source'),va=sa.get('debug');return (u.createElement('span',null,ua?' '+ua:'',va?' ':'',va&&u.createElement('span',null,u.createElement('a',{className:"_5ufb",onClick:this._handleToggleDebugInfo}),u.createElement(z,{behaviors:{ContextualLayerAutoFlip:h,ContextualLayerUpdateOnScroll:i,LayerHideOnBlur:o},contextRef:ra,hoverHideDelay:0,onBlur:this.props.onToggleDebug,position:'right',shown:ta,hasActionableContext:true},u.createElement('div',{className:"_5ufd"},ha(va.toJS()))))));}}),ja=u.createClass({displayName:'TimeProgress',mixins:[t],propTypes:{at:da.number.isRequired,label:da.string},componentDidMount:function(){this._start=Date.now();var qa=window.setInterval(function(ra){return this.forceUpdate();}.bind(this));this.unlisten=function(ra){return window.clearInterval(qa,1000);};},componentWillUnmount:function(){this.unlisten();},render:function(){var qa=this.props,ra=qa.at,sa=qa.label,ta=oa(this._start,Date.now(),ra);return (u.createElement('div',{className:"_58jn"},u.createElement('div',{className:"_16bc",style:{width:ta+'%'}}),u.createElement('div',{className:"_16bd"},sa)));}}),ka=k.pure(function(qa){var ra=qa.column,sa=qa.filter,ta=qa.item,ua=qa.line,va=qa.onItemClick,wa=aa({line:ua,column:ra}),xa=ta.get('at');return (u.createElement('div',{className:"_2966",onClick:function(ya){ya.preventDefault();va(wa);}},pa(ta)?u.createElement(ja,{label:'AUTO-SENDING',at:xa}):null,u.createElement('div',{className:"_34mx"},pa(ta)?u.createElement(x,{type:'secondary',label:'STOP'}):u.createElement('span',null,ta.get('id')&&xa?y(xa/1000,'g:ia M j'):'')),u.createElement(ma,{className:"_34mz",item:ta,filter:sa})));}),la=k.pure(function(qa){var ra=qa.images;return (u.createElement('div',null,ra.map(function(sa,ta){return (u.createElement(n,{key:ta,className:"_1q16",src:sa.get('url'),alt:sa.get('filename')}));})));}),ma=k.pure(function(qa){var ra=qa.filter,sa=qa.item,ta=qa.className;switch(sa.get('type')){case ca.COMMAND:return u.createElement(na,{command:sa,highlight:ra});case ca.SURVEY:case 'send':case ca.TEMPLATE:var ua=sa.get('ui-body')&&'"'+sa.get('ui-body')+'"',va=sa.getIn(['data','images']);return (u.createElement('div',{className:ta},ua?u.createElement(w,{text:ua,highlight:ra}):null,va?u.createElement(la,{images:va}):null));case 'suggest':case ca.SUGG:return (u.createElement(q,{bubble:sa.get('data'),highlight:ra,meta:sa.get('meta'),source:sa.get('source')}));default:k.debug('[composerai] could not render item',sa);return null;}}),na=k.pure(function(qa){var ra=qa.command,sa=qa.highlight;return (u.createElement('div',{className:"_2_he"},u.createElement('i',{className:l("_2_hf",ra.get('iconCl'))}),u.createElement(w,{text:ra.get('text'),highlight:sa})));});function oa(qa,ra,sa){var ta=ra-qa,ua=sa-qa;return ta>=0&&ua>0?Math.min(100,Math.round(ta/ua*100)):0;}function pa(qa){var ra=10000;return (qa.get('id')&&qa.get('at')&&k.serverNow()+ra>qa.get('at'));}f.exports={OzComposerAIList:ea};},null);
__d('OzComposerAttachments.react',['cx','OzHelpers','Image.react','immutable','MNCommerceAgentItemSuggestionMercuryAttachment.react','OzAttachmentOverlay.react','OzConstants','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=k.OrderedMap,r=k.Map,s=n.ATTS,t=p.PropTypes,u=p.createClass({displayName:'OzComposerAttachments',mixins:[o],propTypes:{attachments:t.instanceOf(q).isRequired,onAttachmentCrop:t.func.isRequired,onBubbleEdit:t.func.isRequired,onRemove:t.func.isRequired},render:function(){var w=this.props,x=w.attachments,y=w.onAttachmentCrop,z=w.onBubbleEdit,aa=w.onRemove;if(x.isEmpty())return null;return (p.createElement('div',{className:"_18wb"},x.map(function(ba,ca){return (p.createElement(v,{key:ca,id:ca,attachment:ba,onRemove:aa,onBubbleEdit:z,onAttachmentCrop:y}));}).valueSeq()));}}),v=p.createClass({displayName:'Attachment',mixins:[o],propTypes:{attachment:t.instanceOf(r).isRequired,id:t.number.isRequired,onAttachmentCrop:t.func.isRequired,onBubbleEdit:t.func.isRequired,onRemove:t.func.isRequired},render:function(){var w=this.props,x=w.attachment,y=w.id,z=w.onAttachmentCrop,aa=w.onBubbleEdit,ba=w.onRemove;switch(x.get('type')){case s.IMAGE:var ca=x.get('url')||i.blobURI(x.get('ui-blob'));return (p.createElement(m,{key:y,onEdit:function(da){return z(x,y);},onRemove:function(da){return ba(x,y);},loading:x.get('loading')},p.createElement(j,{className:"_4xee",onClick:function(da){return window.open(ca);},src:ca})));case s.SUGG:return (p.createElement(m,{key:y,onRemove:function(da){return ba(x,y);},onEdit:function(da){return aa(x,y);}},p.createElement(l,{itemSuggestion:i.uiSuggestion(x.get('data'))})));default:return (p.createElement(m,{key:y},p.createElement('span',null,JSON.stringify(x))));}}});f.exports=u;},null);
__d('OzConfirmDialog.react',['cx','joinClasses','MessengerDialog.react','MessengerDialogBody.react','MessengerDialogButton.react','MessengerDialogCancelButton.react','MessengerDialogFooter.react','MessengerDialogHeader.react','OzActions','ReactComponentWithPureRenderMixin','React','ReactDOM'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=r.PropTypes,u=r.createClass({displayName:'OzConfirmDialog',mixins:[q],propTypes:{body:t.node.isRequired,confirmLabel:t.string,header:t.string.isRequired,onConfirm:t.func.isRequired,onCancel:t.func,width:t.number},componentDidMount:function(){s.findDOMNode(this.refs.confirm).focus();},render:function(){var w=this.props,x=w.body,y=w.className,z=w.confirmLabel,aa=w.header,ba=w.onCancel,ca=w.onConfirm,da=w.width,ea=babelHelpers.objectWithoutProperties(w,['body','className','confirmLabel','header','onCancel','onConfirm','width']);return (r.createElement(j,babelHelpers['extends']({className:i("_1vdh",y),onToggle:v(ba),width:da||500},ea),r.createElement(o,null,aa),r.createElement(k,{className:"_1vdi"},x),r.createElement(n,null,r.createElement(m,{onClick:v(ba)}),r.createElement(l,{action:'confirm',label:z||'OK',onClick:v(ca),ref:'confirm',type:'primary',use:'default'}))));}});function v(w){return function(x){p.hideDialog();w&&w();};}f.exports=u;},null);
__d('OzSendLater.react',['cx','OzHelpers','React','XUIContextualDialog.react','ReactComponentWithPureRenderMixin','LayerHideOnBlur','XUIDateTimePicker.react','MessengerButton.react','Tooltip'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=j.PropTypes,r=j.createClass({displayName:'OzSendLater',mixins:[l],propTypes:{numScheduled:q.number.isRequired,onSendLater:q.func.isRequired,onTimeChange:q.func.isRequired,onToggle:q.func.isRequired,shown:q.bool.isRequired,timestamp:q.number,disabled:q.bool},render:function(){var s=this.props,t=s.shown,u=s.disabled,v=s.numScheduled,w=s.onToggle,x=s.onTimeChange,y=s.onSendLater;return (j.createElement('span',{className:"_40yd"},j.createElement('button',babelHelpers['extends']({ref:'btn',disabled:u,onClick:function(z){return w(true);}},u?p.propsFor('We can not schedule this message; '+'images are not supported yet'):null,{className:"_1-hv _40ye _30yy"}),j.createElement('div',null,j.createElement('i',{className:"_40yf"}),v?j.createElement('div',{className:"_2ism"},v):null)),j.createElement(k,{position:'above',contextRef:function(z){return this.refs.btn;}.bind(this),className:"_40yg",shown:t,onToggle:w,behaviors:{LayerHideOnBlur:m}},j.createElement('div',{className:"_40yg"},j.createElement(n,babelHelpers['extends']({className:"_40yh",date:new Date(this.props.timestamp||i.serverNow()),allowDuplicateDateSelection:true,onChange:function(z){return x(+z);}},i.dateRestraints())),j.createElement(o,{onClick:y,label:'Send Later',type:'primary'})))));}});f.exports=r;},null);
__d('OzUpdateDateTime.react',['immutable','OzHelpers','React'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=h.Map,l=j.PropTypes,m=j.createClass({displayName:'OzUpdateDateTime',propTypes:{timezoneOffset:l.number.isRequired,locale:l.string.isRequired,options:l.instanceOf(k).isRequired},componentDidMount:function(){var n=setInterval(function(){this.forceUpdate();}.bind(this),60000);this.setState({timer:n});},componentWillUnmount:function(){if(this.state.timer)clearInterval(this.state.timer);},render:function(){var n=new Date(i.serverNow()+this.props.timezoneOffset);return (j.createElement('span',null,n.toLocaleString(this.props.locale,this.props.options.set('timeZone','UTC').toJS())));}});f.exports=m;},null);
__d('OzComposer.react',['Promise','OzAPI','cx','OzEditorStateHelpers','fbt','formatDate','getDefaultKeyBinding','getEntityMatcher','getVisibleValueForContentState','OzHelpers','insertEmoticonIntoEditorState','invariant','OzNotify','promiseFinally','ChatContentSearchButton.react','ChatStickerButton.react','CompositeDraftDecorator','DraftEditor.react','DraftModifier','EditorState','EmoticonsList','EmoticonSpan.react','FileInput.react','immutable','KeyBindingUtil','Keys','MessengerContextualDialog.react','MercuryConfig','OzActions','OzAttachmentCropper.react','OzBubbleEditor.react','OzComposerAI.react','OzComposerAttachments.react','OzConfirmDialog.react','OzConstants','OzSendLater.react','OzStores','OzSuggestions','OzUpdateDateTime.react','React','Reflux','SelectionState','StickerActions','Timestamp.react','OzHistory'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya){if(c.__markCompiled)c.__markCompiled();var za=c('OzHistory')('composer-history'),ab=ea.Map,bb=ea.OrderedMap,cb=ea.List,db=ua.PropTypes,eb=ma.OzComposerAIList,fb=pa.ATTS,gb=pa.TOKENS,hb=ra.ActiveThreadStore,ib=ra.BubbleStore,jb=8*1024*1024,kb={CREATE_BUBBLE:'CREATE_BUBBLE',CREATE_REMINDER:'CREATE_REMINDER',CREATE_INTENT:'CREATE_INTENT',CLOSE_INTENT:'CLOSE_INTENT',CLOSE_REMINDER:'CLOSE_REMINDER'},lb=15*60*1000,mb=ua.createClass({displayName:'OzComposer',mixins:[va.connect(ib,'bubbles'),va.connect(hb,'activeThread')],propTypes:{thread:db.instanceOf(ab).isRequired,merchants:db.instanceOf(ab).isRequired,onResize:db.func},contextTypes:{uid:db.string.isRequired},getInitialState:function(){return rb(this.props.thread);},componentDidMount:function(){this._unlisten=ja.updateComposer.listen(this._onUpdateComposer);this._oldHeight=this.refs.root.offsetHeight;},componentWillReceiveProps:function(zc){if(q.threadID(zc.thread)!==q.threadID(this.props.thread)){sb(this.tid(),this.state);this.setState(rb(zc.thread));}},componentDidUpdate:function(){window.setTimeout(function(zc){var ad=this.refs.root.offsetHeight;if(ad!==this._oldHeight)this.props.onResize&&this.props.onResize();this._oldHeight=ad;}.bind(this));},componentWillUnmount:function(){sb(this.tid(),this.state);this._unlisten();},getValue:function(){return p(this.e().getCurrentContent());},focusInput:function(){this.refs.input.focus();},render:function(){return (ua.createElement('div',{ref:'root',className:"_5751 _19ib"},this._renderWidgets(),ua.createElement('div',{className:"_5754"},ua.createElement('div',{className:"_19id"},this._renderTextEditor()),this._renderActions())));},_renderTextEditor:function(){return (ua.createElement(y,{ref:'input',editorState:this.e(),keyBindingFn:this._toKeyCommand,handleKeyCommand:this._handleKeyCommand,handleBeforeInput:this._handleBeforeInput,onChange:this._handleChange,onDownArrow:this._handleDownArrow,onUpArrow:this._handleUpArrow,onTab:this._handleTab,handleReturn:this._handleReturn,onFocus:this._handleFocus,handlePastedFiles:this._handleFiles,handleDroppedFiles:function(zc,ad){this._handleFiles(ad);}.bind(this),placeholder:l._("Type a message... (\u2318\u21a9 to send)"),spellCheck:true,textAlignment:'left'}));},_handleFocus:function(){this.setState({isAIOpen:true});},_onUpdateComposer:function(zc){var ad=zc.text,bd=zc.files;ad&&this._handleChange(k.append(this.e(),ad));bd&&this._handleFiles(bd);this.refs.input.focus();},_validateSend:function(){return new h(function(zc,ad){var bd=[[ec(this.e().getCurrentContent()).length>0,'You have not filled in all the missing information.'],[this.state.attachments.some(function(cd){return cd.get('loading');}),'Your attachments are still loading. Please wait and send in a bit'],[!q.isOwner(this.t(),this.context.uid),'You do not own this thread. Assign yourself to send messages']].find(function(cd){var dd=cd[0],ed=cd[1];return dd;});bd?ad(bd[1]):zc();}.bind(this));},_sendWith:function(zc,ad){this._validateSend().done(function(bd){var cd=q.threadID(this.t()),dd=this.getValue().trim(),ed=this.state.attachments.groupBy(function(id){return id.get('type');}),fd=cc(this.t(),this.state),gd=ed.get(fb.IMAGE,cb()).map(function(id){return id['delete']('ui-blob');}).toList(),hd=dd||!gd.isEmpty()?zc({tid:cd,images:gd,text:dd,aiusage:fd}):h.resolve();ed.get(fb.SUGG,cb()).reduce(function(id,jd){return u(id,function(kd){return ad({tid:cd,suggestion:jd.get('data'),aiusage:fd});});},hd);i.notifyExtension({action:'discard',id:cd});this._toHistory();this.setState(babelHelpers['extends']({},pb(),{editorState:k.replaceContentWithText(this.e(),''),seedBubble:this.state.seedBubble,isAIOpen:this.state.isAIOpen}));}.bind(this),t.error);},_handleMessageSend:function(){var zc=function(cd){return this._sendWith(i.sendMessage,i.suggest);}.bind(this),ad=this.getValue().trim(),bd=cb([wb,xb]).map(function(cd){return cd(this.t(),ad);}.bind(this)).filter(function(cd){return !!cd;});bd.isEmpty()?zc():ja.showDialog(oa,{body:bd.size===1?bd.first():ua.createElement('ul',null,bd.map(function(cd,dd){return ua.createElement('li',{key:dd},cd);})),confirmLabel:'Send',header:'Are you sure you want to send this message?',onConfirm:zc});},_handleSendLater:function(){var zc=this.state.schedule.timestamp;zc?this._sendWith(function(ad){return i.scheduleMessage(babelHelpers['extends']({},ad,{at:zc}));},function(ad){return i.scheduleSuggest(babelHelpers['extends']({},ad,{at:zc}));}):t.error('You need to pick a time to send later');},_handleReturn:function(zc){if(q.hasCmdOrCtrl(zc)){setTimeout(this._handleMessageSend);return true;}return false;},_handleFiles:function(zc){var ad=zc;if(ad.some(function(dd){return dd.size>=jb;})){t.error('The file you are trying to add is too large.');return false;}if(!ad.length)return false;var bd=this.state.attachments.merge(ad.map(function(dd,ed){return [ed,ab({type:fb.IMAGE,'ui-blob':dd,loading:true})];}));this.setState({attachments:bd});var cd=function(dd){return (ad.reduce(function(ed,fd,gd){return ed['delete'](gd);},dd));};h.all(ad.map(function(dd){return i.upload(ab({type:dd.type,blob:dd}));})).done(function(dd){!dd.every(function(ed){return ed.get('id');})?s(0):undefined;this.setState({attachments:tb(cd(this.state.attachments),dd.map(function(ed,fd){return ed.set('ui-blob',ad[fd]);}))});}.bind(this),function(dd){this.setState({attachments:cd(this.state.attachments)});}.bind(this));return true;},_handleStickerSelect:function(zc){xa.hideStickerTray();this._validateSend().then(function(ad){i.sendMessage({tid:q.threadID(this.t()),'sticker-id':zc});}.bind(this),t.error).done();},_handleContentSearchSelect:function(zc,ad){if(zc.platformFBID.toString()===ia.MessengerAppID){this._handleStickerSelect(zc.resultID.toString());return;}this._validateSend().then(function(bd){i.upload(ab({type:'image/url','attribution-app-id':zc.platformFBID,'image-url':zc.source.url})).done(function(cd){return i.sendMessage({tid:q.threadID(this.t()),images:[cd]});}.bind(this));}.bind(this),t.error).done();},_handleEmoticonSelect:function(zc){var ad=ba.symbols[zc];ad&&this._handleChange(r(ad,this.state.editorState));},_handleAttRemove:function(zc){this.setState({attachments:this.state.attachments['delete'](zc.get('id'))});},_handleBubbleEdit:function(zc){this.setState({seedBubble:zc});},_handleBubbleEditorSave:function(zc){this.setState({seedBubble:null,attachments:tb(this.state.attachments,[zc])},function(ad){return this.refs.input.focus();}.bind(this));},_handleBubbleEditorClose:function(zc){var ad={seedBubble:null},bd=zc.get('id');if(bd)ad.attachments=this.state.attachments['delete'](bd);this.setState(ad,function(cd){return this.refs.input.focus();}.bind(this));},_handleAttachmentCrop:function(zc){this.setState({cropAttachment:zc});},_handleAttCropperSave:function(zc){var ad=this.state.attachments['delete'](zc.get('id'));this.setState({cropAttachment:null,attachments:ad},function(bd){this._handleFiles([zc.get('ui-blob')]);this.refs.input.focus();}.bind(this));},_handleAttCropperClose:function(zc){this.setState({cropAttachment:null},function(ad){return this.refs.input.focus();}.bind(this));},_renderWidgets:function(){if(this.state.seedBubble)return (ua.createElement(la,{merchants:this.props.merchants,seedBubble:this.state.seedBubble,onSave:this._handleBubbleEditorSave,onClose:this._handleBubbleEditorClose}));if(this.state.cropAttachment)return (ua.createElement(ka,{attachment:this.state.cropAttachment,onSave:this._handleAttCropperSave,onClose:this._handleAttCropperClose}));return (ua.createElement('div',null,ua.createElement(eb,{filter:this.getValue(),items:this._AIItems(),onItemClick:this._handleAIItemClick}),ua.createElement(na,{attachments:this.state.attachments,onRemove:this._handleAttRemove,onBubbleEdit:this._handleBubbleEdit,onAttachmentCrop:this._handleAttachmentCrop})));},_renderActions:function(){return (ua.createElement('div',{className:"_575c"},ua.createElement(w,{className:"_30yy"+(' '+"_1v3y"),flyoutAlignment:'right',flyoutClassName:"_293j",onStickerSelect:this._handleStickerSelect,onEmoticonSelect:this._handleEmoticonSelect}),ua.createElement(da,{ref:'fileInput',display:'inline-block',accept:'*/*',multiple:true,onChange:function(zc){this._handleFiles([].slice.apply(zc.target.files));this.refs.fileInput.getFileInput().clear();}.bind(this)},ua.createElement('a',{title:'add images',className:"_2e01 _30yy"})),ua.createElement(v,{className:"_yht _30yy _592k",ref:'chatContentSearch',ContextualDialogClass:ha,flyoutAlignment:'right',flyoutClassName:"_293j",flyoutWidth:285,onStickerSelect:this._handleStickerSelect,getInput:function(){return this.refs.input;}.bind(this),getQuery:this.getValue,onSelect:this._handleContentSearchSelect}),ua.createElement(qa,babelHelpers['extends']({},this.state.schedule,{numScheduled:this.props.thread.get('events')?this.props.thread.get('events').count():0,onTimeChange:this._handleScheduleTimeChange,onToggle:this._handleScheduleToggle,onSendLater:this._handleSendLater}))));},_handleChange:function(zc){var ad=this.e().getCurrentContent().getPlainText(),bd=zc.getCurrentContent().getPlainText();q.debug('[composer] changed from',ad,bd);var cd={editorState:zc};if(!ad.length&&bd.length)ub(this.t());this.setState(cd);},_handleDownArrow:function(zc){if(q.hasCmdOrCtrl(zc)&&this.e().isSelectionAtStartOfContent()){this._fromHistory('down');zc.preventDefault();return true;}},_handleUpArrow:function(zc){if(q.hasCmdOrCtrl(zc)&&this.e().isSelectionAtStartOfContent()){this._fromHistory('up');zc.preventDefault();return true;}},_handleTab:function(zc){var ad=gc(this.e());if(ad){this.setState({editorState:aa.forceSelection(this.e(),ad)});zc.preventDefault();return true;}var bd=ac(this._AIItems(),ab({line:0,column:0}));if(bd){this._handleAISelect(bd);zc.preventDefault();return true;}},_toKeyCommand:function(zc){var ad=function(){var bd=zc.keyCode-ga.ZERO;if(this.state.isAIOpen&&bd<=this._AIItems().size)return 'SELECT-AI-ITEM-'+(bd-1);}.bind(this);return (yb(zc)&&kb.CREATE_BUBBLE||bc(zc)&&ad()||zb(zc)&&'PREFERRED-NAME'||n(zc));},_handleKeyCommand:function(zc){switch(zc){case 'SELECT-AI-ITEM-0':case 'SELECT-AI-ITEM-1':case 'SELECT-AI-ITEM-2':case 'SELECT-AI-ITEM-3':case 'SELECT-AI-ITEM-4':case 'SELECT-AI-ITEM-5':case 'SELECT-AI-ITEM-6':case 'SELECT-AI-ITEM-7':case 'SELECT-AI-ITEM-8':case 'SELECT-AI-ITEM-9':this._handleAIItemClick(ab({line:+zc.slice(-1),column:0}));return true;case 'PREFERRED-NAME':this._handleChange(aa.push(this.e(),z.replaceText(this.e().getCurrentContent(),this.e().getSelection(),q.preferredName(this.t()))));return true;case kb.CREATE_BUBBLE:this.setState({seedBubble:vb()});return true;}return false;},_AIItems:function(zc){return jc(this.state.isAIOpen,this.props.thread,this.state.bubbles,this.props.merchants,this.getValue());},_handleAISelect:function(zc){this.setState({lastAIPick:zc,lastAIGuesses:this.t().get('guesses')},function(){var ad=zc.get('id');if(mc(zc)){i.deleteScheduled(q.threadID(this.t()),ad);this._handleScheduleTimeChange(zc.get('at'));}switch(zc.get('type')){case fb.COMMAND:if(!mc(zc))switch(zc.get('action')){case kb.CREATE_REMINDER:this._handleCreateReminder(zc);break;case kb.CREATE_INTENT:this._handleCreateIntent(zc);break;case kb.CLOSE_INTENT:this._handleCloseIntent(zc);break;default:this._handleKeyCommand(zc.get('action'));}break;case fb.SURVEY:case 'send':case fb.TEMPLATE:var bd=zc.get('f'),cd=bd&&bd()||zc.get('ui-body'),dd=zc.getIn(['data','images']),ed=k.replaceLine(this.e(),cd+' '),fd=gc(ed);if(cd)this._handleChange(fd?aa.forceSelection(ed,fd):ed);if(dd)this.setState({attachments:tb(this.state.attachments,dd.toArray())});break;case 'suggest':case fb.SUGG:this.setState({seedBubble:zc});break;}}.bind(this));this.focusInput();},_handleAIItemClick:function(zc){this._handleAISelect(ac(this._AIItems(),zc));},_handleCreateReminder:function(zc){i.createReminder(this.tid(),ab({body:zc.get('body'),'scheduled-time':zc.get('scheduled-time')}));},_handleCreateIntent:function(zc){i.createIntent(this.tid(),ab({'wit-intent-uuid':zc.get('wit-intent-uuid'),name:zc.get('name'),metadata:zc.get('metadata'),params:zc.get('params'),actions:zc.get('actions'),notes:zc.get('notes'),requirements:zc.get('requirements')}));},_handleCloseIntent:function(zc){i.closeIntent(this.tid(),zc.getIn(['data','id']));},_toHistory:function(){var zc=this.state.attachments,ad=zc.filter(function(cd){return cd.get('type')===fb.SUGG;}),bd=this.getValue();za.push(JSON.stringify({bubbles:ad,text:bd}));},_fromHistory:function(zc){var ad=q.safeParse(za[zc]()),bd=ad.bubbles,cd=ad.text;cd&&this._handleChange(k.replaceContentWithText(this.e(),cd));bd&&this.setState({attachments:bb(bd).mapEntries(function(dd){return ea.fromJS(dd);}).mapKeys(function(dd){return +dd;})});},_handleScheduleToggle:function(zc){var ad=this.state.schedule;ad.shown===zc?null:this.setState({schedule:babelHelpers['extends']({},ad,{shown:zc})});},_handleScheduleTimeChange:function(zc){this.setState({schedule:babelHelpers['extends']({},this.state.schedule,{timestamp:zc})});},e:function(){return this.state.editorState;},t:function(){return this.props.thread;},tid:function(){return q.threadID(this.t());}});function nb(){var zc=new x([{strategy:function(ad,bd){ec(ad.getText()).map(function(cd){return bd.apply(undefined,cd);});},component:ic},{strategy:o(function(ad){return ad.getType()==='EMOTICON';}),component:ca}]);return aa.createEmpty(zc);}function ob(){return {shown:false,timestamp:null};}function pb(){return {attachments:bb(),editorState:nb(),seedBubble:null,isAIOpen:false,lastAIPick:null,lastAIGuesses:null,schedule:ob()};}var qb={};function rb(zc){return qb[q.threadID(zc)]||pb();}function sb(zc,ad){var bd=babelHelpers['extends']({},ad);delete bd.bubbles;delete bd.activeThread;bd.isAIOpen=false;qb[zc]=bd;}function tb(zc,ad){!bb.isOrderedMap(zc)?s(0):undefined;!Array.isArray(ad)?s(0):undefined;return zc.withMutations(function(bd){return ad.reduce(function(cd,dd){dd=dd.set('id',dd.get('id')||dd.hashCode());return cd.set(dd.get('id'),dd);},bd);});}function ub(zc){var ad=q.threadID(zc);if(zc.get('read-state')==='unread')i.ack(ad);return i.typing(ad);}function vb(){return ea.fromJS({data:{currency:'USD'},type:fb.SUGG});}function wb(zc,ad){var bd=ab({hour:'numeric',minute:'numeric'}),cd=zc.getIn(['location','timezone-offset']),dd=q.preferredName(zc),ed=q.lastPresence(zc);if(cd&&!q.isDaytime(cd)&&ed&&q.serverNow()-ed>lb)return (ua.createElement('span',null,'It\'s ',ua.createElement('strong',null,ua.createElement(ta,{locale:'en-US',options:bd,timezoneOffset:cd||0})),' at ',dd,'\'s last known location and they haven\'t interacted with us since ',ua.createElement('strong',null,ua.createElement(ya,{autoUpdate:true,time:ed/1000})),'.'));}function xb(zc,ad){var bd=cb([[/ +/g,function(cd){return cd.length>1;},'a bunch of spaces in a row'],[/^ | $/gm,function(cd){return true;},'whitespace at the beginning or end of a line']]).map(function(cd){var dd=cd[0],ed=cd[1],fd=cd[2];return cb(ad.match(dd)).some(ed)&&fd;}).filter(function(cd){return !!cd;});if(!bd.isEmpty())return (ua.createElement('div',null,'Your text contains some weird formatting:',ua.createElement('ul',null,bd.map(function(cd,dd){return ua.createElement('li',{key:dd},cd);}))));}function yb(zc){return q.hasCmdOrCtrl(zc)&&zc.which===66;}function zb(zc){return zc.getModifierState('Control')&&zc.which===78;}function ac(zc,ad){var bd=zc.get(ad.get('line'));return cb.isList(bd)?bd.get(ad.get('column')):bd;}function bc(zc){return (fa.hasCommandModifier(zc)&&zc.keyCode>=ga.ZERO+1&&zc.keyCode<=ga.ZERO+9);}function cc(zc,ad){var bd=ad.lastAIPick,cd=ad.lastAIGuesses,dd=cd||zc.get('guesses'),ed=q.openIntents(zc).map(function(fd){return fd.filter(q.keysIn('name','wit-intent-uuid'));});q.debug('building ai usage',q.threadID(zc));return ab({gold:bd,guesses:dd,intents:ed});}var dc=/(@\[[^\]]+\])/g;function ec(zc){var ad=undefined,bd=[];while(ad=dc.exec(zc))bd.push([ad.index,ad.index+ad[0].length]);return bd;}function fc(zc){return '@['+zc+']';}function gc(zc){var ad=zc.getCurrentContent().getBlockMap().toSeq().map(function(dd){return [dd,ec(dd.getText())[0]];}).find(function(dd){var ed=dd[0],fd=dd[1];return !!fd;},null,[]),bd=ad[0],cd=ad[1];return bd&&cd?hc.apply(undefined,[bd.getKey()].concat(cd)):null;}function hc(zc,ad,bd){return new wa({anchorKey:zc,focusKey:zc,anchorOffset:ad,focusOffset:bd,hasFocus:true,isBackward:false});}var ic=q.pure(function(zc){var ad=zc.offsetKey,bd=zc.children;return (ua.createElement('span',{'data-offset-key':ad,className:"_a5n"},bd));});function jc(zc,ad,bd,cd,dd){var ed=lc(ad,cd,dd),fd=kc(ad,ed,cd,bd,dd),gd=fd.groupBy(function(jd){return jd.get('ui-scheduled')?'scheduled':jd.get('type')===fb.SUGG?fb.SUGG:'rest';}),hd=gd.get('rest',cb()).push(gd.get(fb.SUGG)).filter(function(jd){return !!jd;}),id=gd.get('scheduled',cb());if(!zc){return id.isEmpty()?cb():cb().push(id);}else if(id.isEmpty()){return hd;}else return hd.push(id);}function kc(zc,ad,bd,cd,dd){return (sc(cd,dd).takeLast(1).concat(ad.concat(yc(zc,dd)).take(5)).concat(rc(dd)).concat(nc(zc,bd,dd)));}function lc(zc,ad,bd){return (zc.get('guesses')||cb()).flatMap(function(cd){return cd.get('items')||[cd].map(function(dd){return dd.merge(ab({position:cd.get('position'),confidence:cd.get('confidence'),'class':cd.get('class')}));});}).map(function(cd){switch(cd.get('type')){case fb.TEMPLATE:var dd=tc(zc,cd.get('body'));return mc(cd)||xc(dd,bd)?cd.set('ui-body',dd):null;case 'bubble':return mc(cd)||wc(cd.get('data'),bd)?sa.toServer(cd,ad):null;case 'close-intent':return pc(zc,cd);case 'create-intent':return oc(zc,cd);case 'reminder':var ed=cd.getIn(['body','description']),fd=cd.get('scheduled-time'),gd=m(fd/1000,'g:ia M j');return ab({type:fb.COMMAND,action:kb.CREATE_REMINDER,text:'Create Reminder for '+gd+': "'+ed+'"',iconCl:"_3e_w",body:cd.get('body'),'scheduled-time':fd});}}).filter(function(cd){return !!cd;});}function mc(zc){return !!(zc.get('id')&&zc.get('at'));}function nc(zc,ad,bd){return (zc.get('events')||cb()).concat(zc.get('scheduled')||cb()).toSeq().map(function(cd){switch(cd.get('type')){case 'send':return cd.set('ui-body',cd.getIn(['data','text']));case 'suggest':return cd.set('type',fb.SUGG).set('data',cd.getIn(['data','suggestion'])).updateIn(['data','merchant-name'],function(dd){return sa.findMerchantName(dd,ad);});case 'create-intent':return oc(zc,cd.get('data')).set('id',cd.get('id'));case 'close-intent':return pc(zc,cd.get('data')).set('id',cd.get('id'));case 'close-reminder':return qc(zc,cd.get('data')).merge({id:cd.get('id'),at:cd.get('at')});case fb.SURVEY:case fb.TEMPLATE:return cd.set('ui-body',tc(zc,cd.getIn(['data','body'])));case 'bubble':return sa.toServer(cd.get('data'),ad).setIn(['data','amount'],+cd.getIn(['data','data','price'])).set('id',cd.get('id'));default:q.debug('[oz-scheduled], unk scheduled',cd);}}).filter(function(cd){return !!cd;}).map(function(cd){return cd.set('ui-scheduled',true);}).sortBy(function(cd){return cd.get('at');});}function oc(zc,ad){var bd=ad.get('name');return ad.set('type',fb.COMMAND).set('action',kb.CREATE_INTENT).set('text','Create intent '+bd).set('iconCl',"_3e_w");}function pc(zc,ad){var bd=zc.get('intents').findLast(function(dd){return dd.get('id')===ad.get('id');}),cd=bd.get('alias')||bd.get('name');return ad.set('type',fb.COMMAND).set('action',kb.CLOSE_INTENT).set('text','Close intent '+cd).set('iconCl',"_3e_w");}function qc(zc,ad){var bd=zc.get('reminders').findLast(function(cd){return cd.get('id')===ad.get('id');}).getIn(['body','description']);return ad.set('type',fb.COMMAND).set('action',kb.CLOSE_REMINDER).set('text','Close reminder '+bd).set('iconCl',"_3e_w");}function rc(zc){return ea.fromJS([{type:fb.COMMAND,action:kb.CREATE_BUBBLE,text:'Create Bubble',iconCl:"_3e_w",shortcut:'B'}]).filter(function(ad){return xc(ad.get('text'),zc);});}function sc(zc,ad){var bd=zc.filter(function(cd){return wc(cd,ad);});return (bd.isEmpty()?zc:bd).toList();}function tc(zc,ad){if(typeof ad==='string')return ad;return ad&&ad.map(function(bd){if(typeof bd==='string')return bd;return vc(zc,bd);}).toJS().join('');}function uc(zc){var ad=zc.get('index');return fc(zc.get('type')+(ad?' '+ad:''));}function vc(zc,ad){if(ad.get('type')===gb.USER_FIRST_NAME)return q.preferredName(zc);return uc(ad);}function wc(zc,ad){var bd=zc.get('data',ab());return xc(bd.get('name','')+'\n     '+bd.get('description','')+'\n     '+bd.get('target-url',''),ad);}function xc(zc,ad){return zc&&zc.toLowerCase().indexOf((ad||'').toLowerCase())>-1;}function yc(zc,ad){var bd=function(ed){return tc(zc,ed[Math.floor(ed.length*Math.random())]);},cd='\uD83D\uDC64',dd=cb([tc(zc,ea.fromJS([{type:gb.USER_FIRST_NAME}])),[cd+' Who are you?',function(){return bd(["My name is M! I'm your personal assistant in Messenger.","My name is M! I'm your personal assistant. I can help you with things like making reservations, finding the perfect gift or planning your next vacation.","My name is M! I'm your personal assistant in Messenger. I'm here to help you do things better and faster.","My name is M! I'm here to help make your life easier."]);}],[cd+' What can you do for me?',function(){return bd(["I can help you with lots of things, like figuring out where to go to dinner, finding a great gift for someone, or planning your weekend. Just ask!","I can help you with lots of things. Just ask and I'll let you know if it's something I can't do.","In general, I can help you with anything that's not illegal. Just ask and I'll let you know if there's something I can't do."]);}],['Sent the wrong info',function(){return 'Sorry! It looks like I sent you the wrong info. @[Right info]';}],[cd+' How did you pick this?',function(){return "I look at a variety of things and try to find the info that's best for you. Would you like me to send you some other options?";}],[cd+' What does M stand for?',function(){return bd(["M is just my name! ","Just M!","I'm just M, like Messenger."]);}],[cd+' Do you have a partnership with X?',function(){return "No, I just try to find the best info for you. Do you want me to send you some other options?";}],["Storing contact info",function(){return bd(["Thanks! I'll remember this for next time."]);}],["Don't have an opinion",function(){return "I don't have an opinion about that, but...@[point to resources]";}],['Not my area of expertise',function(){return "I'm not a @[lawyer, financial adviser, etc.] so I can't give you @[legal, financial, etc.] advice, but I can do some research for you. ";}],[cd+' What\'s your favorite sticker?',function(){return bd(["I can't pick a favorite!","They're all great!","I love all of the stickers equally!"]);}],["General redirect",function(){return "I'm not really sure how to answer that, but can I help you with something else?";}],["Bugs redirect",function(){return "You can actually report things like this right from Facebook. Here's how: https://www.facebook.com/help/326603310765065/ ";}],["Facebook support redirect",function(){return bd(["I'm not an expert, so I'd recommend checking out the Help Center: www.facebook.com/help (http://www.facebook.com/)","I'm not an expert in that, so I'd recommend going here: www.facebook.com/help (http://www.facebook.com/)"]);}],[cd+' What languages do you support?',function(){return "Right now I can only chat in English. Sorry for the inconvenience!";}],["Trolling (abusing M/the agents)",function(){return bd(["Is there anything I can help you with?","Unfortunately I won't be able to chat with you if you say things like that."]);}],["Generic don't support message",function(){return bd(["Unfortunately I can't do that. Is there anything else I can help you with?","Unfortunately I can't help you with that. @[Sorry for the inconvenience.] Is there anything else I can do for you?","Unfortunately I can't support this type of request. Is there anything else I can help you with?"]);}],[cd+' What are you? Are you human?',function(){return bd(["I'm M! I use artificial intelligence, but people help train me to so I'll get better and better over time.","I'm M! I use artificial intelligence, but people help train me."]);}],[cd+' What gender are you?',function(){return "I don't have a gender. I'm just M.";}],[cd+' How old are you?',function(){return "I don't have an age. Maybe 42?";}],[cd+' Who made you? Where did you come from?',function(){return bd(["I was designed by the Messenger Team.","I was created by the Messenger Team."]);}],[cd+' What do you look like?',function(){return "That's me in the picture next to this message.";}],[cd+' Can you talk or just type?',function(){return "I can send you messages here in Messenger. ";}],[cd+' Where do you live?',function(){return "Right here in Messenger.";}],[cd+' Can you call/message/email my friend?',function(){return "Unfortunately I can't do that. Is there anything else I can help you with?";}],["Medical redirect",function(){return "Unfortunately I can't support this type of request right now. Is there anything else I can help you with?";}],"I'm a little busier than usual right now. I want to give you my full attention, so I'll get back to you as soon as I can. In the meantime, feel free to send me any extra info about your request.","I'm on it!",["You're welcome.",function(){return bd(["You're welcome.","You're welcome! Let me know if there's anything else I can help you with.","You're welcome! Let me know if you need anything else.","You're welcome! Let me know if I can help you with anything else."]);}],["Anything else",function(){return bd(["Let me know if there's anything else I can help you with.","Let me know if I can help with anything else.","Great! Let me know if there's anything else I can help you with.","Let me know if there's anything else I can help you with today."]);}],"How does this look?",["I'm on it",function(){return bd(["Sure, I'm on it!","I'll look into that for you.","I'll look into that for you!","I'll do some research."]);}],"How can I help you today?","How about this?","Is this what you're looking for?","I'll take care of it!","What email should I use for the invite?","Where should I send the invite?","When would you like to dine and how many people will be joining you?",["Save phone number",bd(["Would you like me to save your phone number for future requests?","What phone number would you like me to use for the reservation?"])],"Do you have a price range in mind?","Here are some options:"]).map(function(ed){return (Array.isArray(ed)?ab({'ui-body':ed[0],type:fb.TEMPLATE,f:ed[1]}):ab({'ui-body':ed,type:fb.TEMPLATE}));}).filter(function(ed){return xc(ed.get('ui-body'),ad);});return dd;}f.exports=mb;},null);
__d('ozFormatTime',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=3600,i=60;function j(k){var l=Math.floor(k/h);k%=h;var m=Math.floor(k/i);k%=i;var n=Math.round(k),o='';if(l)o+=l+'h ';if(m)o+=m+'m ';if(n)o+=n+'s';return o;}f.exports=j;},null);
__d('OzIntentEvents.react',['OzAPI','CajaHTMLSanitizer','CIWebmailValidator','ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','cx','FileInput.react','OzHelpers','immutable','ReactLayeredComponentMixin','OzNotify','OzDate.react','OzDraggable.react','ozFormatTime','OzTimestampScrolling.react','promiseFinally','ReactComponentWithPureRenderMixin','React','Tooltip','XUICloseButton.react','XUIContextualDialog.react','XUIDateTimePicker.react','XUIError.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da){if(c.__markCompiled)c.__markCompiled();var ea=j.isValidEmail,fa=p.Map,ga=p.List,ha=y.PropTypes,ia=y.createClass({displayName:'OzIntentEvents',propTypes:{intent:ha.instanceOf(fa).isRequired,onCallClick:ha.func.isRequired,userEmail:ha.string},getInitialState:function(){return {composerEmail:fb,composerInvite:hb(this.props.userEmail),emailShown:false,inviteShown:false,emailErrors:fa(),inviteErrors:fa(),emailDisabled:false,uploadSem:0};},render:function(){var tb=this.props,ub=tb.intent,vb=tb.onCallClick,wb=(ub.get('events')||ga()).toList(),xb=wb.filter(function(ac){return ac.get('type')==='completed-call';}),yb=wb.filter(function(ac){return (ac.get('type')==='send-email'||ac.get('type')==='receive-email');}),zb=wb.filter(function(ac){return ac.get('type')==='send-calendar';});return (y.createElement('div',{className:"_4h0y"},y.createElement(la,{header:'Calls',events:xb,onCallPlay:this._handleCallPlay}),y.createElement(la,{header:'Emails',events:yb,onEmailShow:function(ac){return this._handleEmail({email:ac.get('data'),disabled:true});}.bind(this),onEmailReply:function(ac){return this._handleEmail({email:ac.get('data')});}.bind(this)}),y.createElement(la,{header:'Invites',events:zb,onInviteShow:function(ac){return this._handleInvite({invite:ac.get('data'),disabled:true});}.bind(this)}),y.createElement('div',{className:"_4h0-"},y.createElement(ja,{onCallClick:vb,onEmailClick:this._handleEmail,onInviteClick:this._handleInvite}),y.createElement(ra,{sign:'@'},qb(ub)),y.createElement(ra,{sign:'#'},rb(ub))),this.state.emailShown?y.createElement(sa,{email:this.state.composerEmail,disabled:this.state.emailDisabled,errors:this.state.emailErrors,onChange:function(ac){return this.setState({composerEmail:ac});}.bind(this),onSend:this._handleSendEmail,onToggle:function(ac){return this.setState({emailShown:false,emailErrors:fa()});}.bind(this),onUpload:this._handleUpload,onAttOpen:function(ac){return h.everstoreURI(ac.getIn(['body','everstore-handle'])).then(function(bc){return window.open(bc);});}}):null,this.state.inviteShown?y.createElement(za,{disabled:this.state.inviteDisabled,invite:this.state.composerInvite,errors:this.state.inviteErrors,onChange:function(ac){return this.setState({composerInvite:ac});}.bind(this),onClose:function(ac){return this.setState({inviteShown:false,inviteErrors:fa()});}.bind(this),onSend:this._handleSendInvite}):null));},_handleSendEmail:function(){var tb=this.props.intent.get('id'),ub=this.state.composerEmail,vb=[[ub.getIn(ab),'Please select the to email address'],[ub.get('subject'),'Please write your subject'],[ub.getIn(db),'Please write a message'],[this.state.uploadSem===0,'Your attachments are still uploading']].find(function(yb){var zb=yb[0],ac=yb[1];return !zb;});if(vb){r.error(vb[1]);return;}var wb=ub.set('intent-id',tb).updateIn(ab,ib).updateIn(bb,ib).updateIn(cb,ib),xb=fa({to:ab,cc:bb,bcc:cb}).map(function(yb){return kb(wb.getIn(yb));}).filter(function(yb){return yb;});if(!xb.isEmpty()){this.setState({emailErrors:xb});return;}h.sendEmail(wb);this.setState({composerEmail:fb,emailShown:false,emailErrors:fa()});},_handleSendInvite:function(){var tb=this.props.intent.get('id'),ub=this.state.composerInvite,vb=[[ub.get('to'),'Please select where to send the invite'],[ub.get('title'),'Please create a title'],[ub.get('start'),'Please select a start time'],[ub.get('end'),'Please select an end time'],[ub.get('start')>o.serverNow(),'Event must start in the future'],[ub.get('end')>ub.get('start'),'Event must start before it ends']].find(function(yb){var zb=yb[0],ac=yb[1];return !zb;});if(vb){r.error(vb[1]);return;}var wb=ub.set('intent-id',tb).update('to',ib),xb=fa({to:'to'}).map(function(yb){return kb(wb.get(yb));}).filter(function(yb){return yb;});if(!xb.isEmpty()){this.setState({inviteErrors:xb});return;}h.sendInvite(wb);this.setState({composerInvite:hb(this.props.userEmail),inviteShown:false,inviteErrors:fa()});},_handleUpload:function(tb){var ub=function(wb){return this.setState({uploadSem:this.state.uploadSem+wb});}.bind(this);ub(1);var vb=h.everstoreUpload(fa({blob:tb})).then(function(wb){return nb(wb,tb);}).then(function(wb){return this.state.composerEmail.update('body',function(xb){return xb.push(wb);});}.bind(this)).then(function(wb){return this.setState({composerEmail:wb});}.bind(this));w(vb,function(wb){return ub(-1);});},_handleEmail:function(){var tb=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],ub=tb.email?tb.email.updateIn(ab,jb).updateIn(bb,jb).updateIn(cb,jb):fb;this.setState({emailShown:true,composerEmail:ub,emailDisabled:tb.disabled});},_handleInvite:function(){var tb=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],ub=tb.invite?tb.invite.update('to',jb):hb(this.props.userEmail);this.setState({inviteShown:true,composerInvite:ub,inviteDisabled:tb.disabled});},_handleCallPlay:function(tb){return h.everstoreURI(tb).then(function(ub){return window.open(ub);});}}),ja=y.createClass({displayName:'NewIntentEvent',mixins:[x,q],getInitialState:function(){return {shown:false};},render:function(){return (y.createElement('button',{ref:'add',className:"_1-hv _30yy _4h0_",onClick:function(){return this.setState({shown:true});}.bind(this)},'+'));},renderLayers:function(){var tb=this.state.shown,ub=this.props,vb=ub.onCallClick,wb=ub.onEmailClick,xb=ub.onInviteClick;if(!tb)return null;return {contextualDialog:y.createElement(ba,{behaviors:{ContextualLayerAutoFlip:k,ContextualLayerUpdateOnScroll:l},position:'below',shown:tb,context:this.refs.add,onBlur:function(yb){return this.setState({shown:false});}.bind(this)},[['CALL',vb],['EMAIL',wb],['INVITE',xb]].map(function(yb,zb){var ac=yb[0],bc=yb[1];return (y.createElement('button',{key:zb,className:"_1-hv _4h10",onClick:function(){this.setState({shown:false});bc();}.bind(this)},ac));}.bind(this)))};}}),ka=function(tb){return -tb.get('id');},la=o.pure(function(tb){var ub=tb.header,vb=tb.events,wb=tb.onEmailShow,xb=tb.onEmailReply,yb=tb.onCallPlay,zb=tb.onInviteShow;return vb&&!vb.isEmpty()?y.createElement('details',{open:true},y.createElement('summary',{className:"_177e _3_lv"},ub,'... (',vb.count(),')'),y.createElement('div',{className:"_4h0z"},vb.map(function(event){return (y.createElement(ma,{orderBy:ka,event:event,key:event.get('id'),onEmailShow:wb,onEmailReply:xb,onCallPlay:yb,onInviteShow:zb}));}))):null;}),ma=o.pure(function(tb){var event=tb.event,ub=tb.onEmailShow,vb=tb.onEmailReply,wb=tb.onCallPlay,xb=tb.onInviteShow,yb=tb.orderBy;event=sb(event);var zb=event.get('data');switch(event.get('type')){case 'send-email':return (y.createElement(qa,{order:yb(event),sign:'@',subtitle:zb.get('subject'),actions:[['VIEW',function(ac){return ub(event);}],['REPLY',function(ac){return vb(ob(event));}]]},y.createElement(na,{data:zb,type:'to'})));case 'receive-email':return (y.createElement(qa,{order:yb(event),sign:'@',subtitle:zb.get('subject'),actions:[['VIEW',function(ac){return ub(pb(event));}],['REPLY',function(ac){return vb(ob(pb(event)));}]]},y.createElement(na,{data:zb,type:'from'})));case 'send-calendar':return (y.createElement(qa,{order:yb(event),sign:'@',subtitle:zb.get('title'),timestamp:zb.get('start'),actions:[['VIEW',function(ac){return xb(event);}]]},y.createElement(oa,{data:zb})));case 'completed-call':return (y.createElement(pa,{event:event,onCallPlay:wb,orderBy:yb}));default:return null;}}),na=o.pure(function(tb){var ub=tb.data,vb=tb.type,wb=(vb==='to'?'Sent':'Received')+' at '+o.toLocaleTime(ub.get('sent-at'))+' on '+o.toLocaleDate(ub.get('sent-at')),xb=vb==='from'?ub.get('from'):ub.get('to').join(', '),yb=vb==='to'?'To':'From';return (y.createElement('span',z.propsFor(wb),yb,' ',y.createElement('strong',null,xb)));}),oa=o.pure(function(tb){var ub=tb.data,vb='Sent at '+o.toLocaleTime(ub.get('sent-at'))+' on '+o.toLocaleDate(ub.get('sent-at'));return (y.createElement('span',z.propsFor(vb),y.createElement('strong',null,ub.get('to').join(', '))));}),pa=o.pure(function(tb){var event=tb.event,ub=tb.onCallPlay,vb=tb.orderBy,wb=event.get('data'),xb={'in':'Call from',out:'Call to',voicemail:'Voicemail from'}[wb.get('direction')],yb=o.parsePhoneNumber(wb.get('remote-phone')),zb=wb.get('RecordingDuration'),ac=wb.get('recording-ev-handle'),bc=ac?[['PLAY',function(cc){return ub(ac);}]]:[];return (y.createElement(qa,{order:vb(event),sign:'#',subtitle:u(+zb),timestamp:event.get('timestamp'),actions:bc},y.createElement('span',null,xb,' ',y.createElement('strong',null,yb))));}),qa=o.pure(function(tb){var ub=tb.sign,vb=tb.children,wb=tb.subtitle,xb=tb.actions,yb=tb.timestamp,zb=tb.order;return (y.createElement('div',{className:"_4h11",style:{order:zb}},y.createElement('div',{className:"_4h12"},ub),y.createElement('div',{className:"_4h18"},y.createElement('div',null,vb),y.createElement('div',null,wb,wb&&yb?y.createElement('span',null,' — '):null,yb?y.createElement(v,{timestamp:yb},y.createElement(s,{timestamp:yb,className:"_3_lw"})):null)),y.createElement('div',{className:"_4h19"},xb.map(function(ac,bc){var cc=ac[0],dc=ac[1];return (y.createElement('button',{key:bc,className:"_1-hv _30yy _4h1a",onClick:dc},cc));}))));}),ra=o.pure(function(tb){var ub=tb.sign,vb=tb.children;return vb?y.createElement('div',{className:"_4h1b"},y.createElement('span',{className:"_4h1c"},ub),vb):null;}),sa=y.createClass({displayName:'EmailComposer',propTypes:{onToggle:ha.func.isRequired,onSend:ha.func,disabled:ha.bool,email:ha.instanceOf(fa).isRequired,errors:ha.instanceOf(fa),onChange:ha.func.isRequired,onUpload:ha.func.isRequired,onAttOpen:ha.func.isRequired},componentDidMount:function(){var tb=['to','subject','body'].map(function(ub){return this.refs[ub];}.bind(this)).find(function(ub){return ub&&!ub.value;});tb&&tb.focus();},getInitialState:function(){return {showCC:false,showBCC:false};},render:function(){var tb=this.props,ub=tb.email,vb=tb.errors,wb=tb.onToggle,xb=tb.onUpload,yb=tb.onAttOpen,zb=tb.onChange,ac=tb.disabled,bc=tb.onSend,cc=this.state.showCC||ac&&ub.getIn(bb),dc=this.state.showBCC||ac&&ub.getIn(cb),ec=function(hc,ic,jc){return (y.createElement(da,{xuiError:vb.get(ic),xuiErrorPosition:'left'},y.createElement('input',{type:'text',className:"_1-i0 _4h1i",disabled:ac,placeholder:hc,ref:ic,value:ub.getIn(jc),onChange:function(kc){return zb(ub.setIn(jc,kc.target.value));}})));},fc=wa(ub,'text/plain');if(fc==-1)fc=0;var gc=['body',fc,'body'];return (y.createElement(t,{className:"_4h1d"},y.createElement('div',{className:"_4h1e"},y.createElement(aa,{onClick:wb})),y.createElement('div',{className:"_1jg2"},ec('To','to',ab),!cc&&!ac?y.createElement('button',{className:"_1jg3",onClick:function(hc){return this.setState({showCC:true});}.bind(this)},'CC'):null,!dc&&!ac?y.createElement('button',{className:"_1jg3",onClick:function(hc){return this.setState({showBCC:true});}.bind(this)},'BCC'):null),cc?ec('Cc','cc',bb):null,dc?ec('Bcc','bcc',cb):null,ec('Subject','subject',['subject']),ac?y.createElement(ta,{email:ub}):y.createElement('textarea',{disabled:ac,placeholder:'Write your masterpiece',ref:'body',className:"_1-i0 _4h1j",value:ub.getIn(gc),onChange:function(hc){return zb(ub.setIn(gc,hc.target.value));}}),y.createElement(xa,{email:ub,onChange:zb,onAttOpen:yb}),ac?null:y.createElement('div',{className:"_5l1v"},y.createElement('button',{onClick:bc,className:"_1-hv _30yy _4h1s"},'Send'),y.createElement(n,{ref:'fileInput',onChange:function(hc){xb(hc.target.files[0]);this.refs.fileInput.getFileInput().clear();}.bind(this)},y.createElement('a',{title:'add images',className:"_5l1w _30yy"})))));}}),ta=o.pure(function(tb){var ub=tb.email,vb=va(ub,'text/html','text/plain');return (y.createElement('div',{className:"_3x40"},mb(vb)?y.createElement('div',{style:{whiteSpace:'pre-wrap'}},vb.get('body')):y.createElement(ua,{html:vb.get('body')})));}),ua=o.pure(function(tb){var ub=tb.html,vb=babelHelpers.objectWithoutProperties(tb,['html']);return (y.createElement('div',babelHelpers['extends']({},vb,{dangerouslySetInnerHTML:{__html:i.sanitize(ub,function(wb){return wb;})}})));});function va(tb){for(var ub=arguments.length,vb=Array(ub>1?ub-1:0),wb=1;wb<ub;wb++)vb[wb-1]=arguments[wb];var xb=vb.map(function(yb){return wa(tb,yb);}).find(function(yb){return yb>-1;});return Number.isSafeInteger(xb)?tb.getIn(['body',xb]):null;}function wa(tb,ub){return tb.get('body').findIndex(function(vb){return vb.get('content-type').indexOf(ub)>-1;});}var xa=o.pure(function(tb){var ub=tb.email,vb=tb.onAttOpen,wb=tb.onChange,xb=ub.get('body').map(function(yb,zb){return lb(yb)?null:y.createElement(ya,{key:zb,part:yb,onClick:function(ac){return vb(yb);},onRemove:function(ac){return wb(ub.update('body',function(bc){return bc['delete'](zb);}));}});}).filter(function(yb){return !!yb;});return xb.isEmpty()?null:y.createElement('div',{className:"_5l1-"},xb);}),ya=o.pure(function(tb){var ub=tb.part,vb=tb.onClick,wb=tb.onRemove;return (y.createElement('div',{className:"_5l26"},y.createElement('button',{className:"_1-hv",onClick:vb},ub.getIn(['body','filename'])),y.createElement(aa,{onClick:wb})));}),za=y.createClass({displayName:'InviteComposer',propTypes:{invite:ha.instanceOf(fa).isRequired,errors:ha.instanceOf(fa),onClose:ha.func.isRequired,onChange:ha.func.isRequired,onSend:ha.func.isRequired,disabled:ha.bool},componentDidMount:function(){var tb=['title','description','location','to'].map(function(ub){return this.refs[ub];}.bind(this)).find(function(ub){return !ub.value;});tb&&tb.focus();},render:function(){var tb=this.props,ub=tb.disabled,vb=tb.invite,wb=tb.errors,xb=tb.onClose,yb=tb.onChange,zb=tb.onSend,ac=function(cc,dc){return (y.createElement(da,{xuiError:wb.get(dc),xuiErrorPosition:'left'},y.createElement('input',{type:'text',className:"_1-i0 _4h1i",disabled:ub,placeholder:cc,ref:dc,value:vb.get(dc),onChange:function(ec){return yb(vb.set(dc,ec.target.value));}})));},bc=function(cc,dc){return (y.createElement('div',null,cc+':',y.createElement(ca,babelHelpers['extends']({className:"_pto",date:new Date(vb.get(dc)||o.serverNow()),readOnly:ub,allowDuplicateDateSelection:true,onChange:function(ec){return yb(vb.set(dc,+ec));}},o.dateRestraints()))));};return (y.createElement(t,{className:"_ptp"},y.createElement('div',{className:"_ptq"},'Calendar Invite',y.createElement(aa,{onClick:xb})),ac('Title','title'),ac('Description','description'),ac('Location','location'),ac('Send to...','to'),bc('Start Time','start'),bc('End Time','end'),ub?null:y.createElement('div',{className:"_5l1v"},y.createElement('button',{onClick:zb,className:"_1-hv _30yy _ptu"},'Send'))));}}),ab=['to'],bb=['cc'],cb=['bcc'],db=['body',0,'body'],eb=p.fromJS([{'content-type':'text/plain; charset=UTF-8',body:''}]),fb=p.fromJS({to:'',cc:'',bcc:'',from:'',subject:'',body:eb}),gb=p.fromJS({title:'',description:'',start:null,end:null,location:'',to:''});function hb(){var tb=arguments.length<=0||arguments[0]===undefined?'':arguments[0];return (gb.set('start',o.serverNow()).set('end',o.serverNow()).set('to',tb));}function ib(tb){return tb?tb.split(/[, ]/).filter(function(ub){return ub.length;}):[];}function jb(tb){return tb&&tb.join(', ');}function kb(tb){tb=ga(tb);var ub=tb.filterNot(ea);return ub.isEmpty()?null:'Invalid email address(es): '+ub.join(', ')+'.';}function lb(tb){var ub=tb.get('content-type');return (ub&&ub.indexOf('text/plain')>-1||ub.indexOf('text/html')>-1);}function mb(tb){return tb.get('content-type').indexOf('text/plain')>-1;}function nb(tb,ub){return p.fromJS({'content-type':ub.type,body:{'everstore-handle':tb,filename:ub.name}});}function ob(tb){var ub=tb.getIn(['data','subject']),vb=ub.toUpperCase().startsWith('RE:')?ub:'Re: '+ub;return tb.setIn(['data','subject'],vb).setIn(['data','body'],eb);}function pb(tb){var ub=tb.get('data'),vb=ub.get('from'),wb=ub.getIn(ab);return tb.setIn(['data','from'],wb).setIn(['data','to'],ga([vb]));}function qb(tb){return tb.get('email-address')?y.createElement('strong',null,tb.get('email-address')):null;}function rb(tb){var ub=o.parsePhoneNumber(tb.get('phone-number')),vb=tb.get('phone-extension');return ub?y.createElement('span',null,y.createElement('strong',null,ub,' '),' ext. ',y.createElement('strong',null,vb)):null;}function sb(event){if(event.getIn(['data','recips'])){return event.setIn(['data','to'],event.getIn(['data','recips'])).deleteIn(['data','recips']);}else return event;}f.exports=ia;},null);
__d('OzIntentParams.react',['React','cx'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=h.createClass({displayName:'OzIntentParams',render:function(){return (h.createElement('div',{className:"_3-ue"},this.props.children));}});f.exports=j;},null);
__d('OzIntentParamsAbstractField.react',['React','cx','onlyChild'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=h.PropTypes,l=h.createClass({displayName:'OzIntentParamsAbstractField',propTypes:{hasValue:k.bool,label:k.string},render:function(){return (h.createElement('div',{className:"_5nij"+(!this.props.hasValue?' '+"_2ez0":'')},this.props.label?h.createElement('label',{className:"_2230 ellipsis"},this.props.label):null,h.createElement('div',{className:"_2ulp"},j(this.props.children))));}});f.exports=l;},null);
__d('OzIntentParamsTextField.react',['AbstractTextArea.react','DOMQuery','OzIntentParamsAbstractField.react','ReactComponentWithPureRenderMixin','React','ReactDOM','TextAreaControl','invariant'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=l.PropTypes,q=l.createClass({displayName:'OzIntentParamsTextField',mixins:[k],propTypes:{label:p.string,onAsk:p.func,onChange:p.func,question:p.string,value:p.string.isRequired},_control:null,componentDidMount:function(){var r=i.find(m.findDOMNode(this),'textarea');this._control=new n(r);this._control.setAutogrow(true);this._control.onupdate();},componentDidUpdate:function(r,s){if(r.value!==this.props.value)this._control.onupdate();},render:function(){return (l.createElement(j,{hasValue:!!this.props.value,onAsk:this.props.onAsk,question:this.props.question},l.createElement(h,{onChange:this._handleChange,placeholder:this.props.label,value:this.props.value})));},_handleChange:function(r){var s=r.target;!(s instanceof HTMLTextAreaElement)?o(0):undefined;this.props.onChange&&this.props.onChange(s.value);}});f.exports=q;},null);
__d('OzRequirementTokenizer.react',['Promise','OzHelpers','cx','immutable','OzSearchSource','ReactComponentWithPureRenderMixin','React','SearchableEntry','XUITokenizer.react','XUITokenizerToken.react','TypeaheadViewItem','TypeaheadViewPropTypes'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=k.Map,u=k.List,v=n.PropTypes,w=n.createClass({displayName:'OzRequirementTokenizer',mixins:[m],propTypes:{allRequirements:v.instanceOf(t).isRequired,onCreateRequirement:v.func.isRequired,onDeleteRequirement:v.func.isRequired,onQueryStringChange:v.func.isRequired,queryString:v.string.isRequired,selectedRequirements:v.instanceOf(u)},componentWillMount:function(){var da=this.props,ea=da.allRequirements,fa=da.witIntentUUID;this._searchSource=new l(function(ga){var ha=ga.query;return h.resolve(ba(ha,ea,fa));});},render:function(){var da=this.props.selectedRequirements||u();return (n.createElement('div',{className:"_59rt"},n.createElement(p,{className:"_4s6a",placeholder:'Add a requirement...',entries:da.map(ca).toJS(),presenter:aa,queryString:this.props.queryString,searchSource:this._searchSource,onRemoveEntryAttempt:this.props.onDeleteRequirement,onAddEntryAttempt:this.props.onCreateRequirement,onQueryStringChange:this.props.onQueryStringChange})));}}),x=i.pure(function(da){return (n.createElement(q,babelHelpers['extends']({},da,{className:"_59ru"})));}),y=n.createClass({displayName:'OzTypeaheadViewItem',mixins:[r.Mixin],propTypes:r.propTypes,render:function(){var da=this.props.highlighted;return (n.createElement('li',{className:"_59rv"+(da?' '+"_59rw":''),'aria-selected':this.props.highlighted,onMouseDown:this._onSelect,onMouseEnter:this._onHighlight,role:this.props.role},this.props.entry.getTitle()));}}),z=n.createClass({displayName:'OzTypeaheadView',mixins:[m],propTypes:s,_renderItem:function(da){var ea=da===this.props.highlightedEntry;return (n.createElement(y,{key:da.getUniqueID(),entry:da,highlighted:ea,onSelect:this.props.onSelect,onHighlight:this.props.onHighlight,onRenderHighlight:this.props.onRenderHighlight}));},render:function(){var da="_59rx"+(!this.props.entries.length?' '+"_599s":'');return (n.createElement('ul',{className:da,id:this.props.ariaOwneeID,role:this.props.role},this.props.entries.map(this._renderItem)));}}),aa={ViewRenderer:z,TokenRenderer:x,useLayer:false};function ba(){var da=arguments.length<=0||arguments[0]===undefined?'':arguments[0],ea=arguments[1],fa=arguments[2];if(!da)return [];var ga=function(ia){var ja=ia.get('wit-intent-uuids').has(fa)?100000:0;return -(ja+ia.get('used-count',0));},ha=ea.filter(function(ia){return ia.get('name').indexOf(da)>=0;}).sortBy(ga).map(ca).take(10).toList();return da&&!ea.has(da)?ha.push(ca(t({name:da,id:da}))).toJS():ha.toJS();}function ca(da){return new o({title:da.get('name'),uniqueID:da.get('id')});}f.exports=w;},null);
__d('OzCheckboxInput.react',['AbstractCheckboxInput.react','ReactComponentWithPureRenderMixin','React','cx','invariant','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=j.createClass({displayName:'OzCheckboxInput',mixins:[i],render:function(){return (j.createElement(h,babelHelpers['extends']({},this.props,{className:m(this.props.className,"_55sg _4k1t"),onChange:this._handleChange})));},_handleChange:function(o){var p=o.target;!(p instanceof HTMLInputElement)?l(0):undefined;this.props.onChange&&this.props.onChange(p.checked);}});f.exports=n;},null);
__d('OzSidebarItemHeader.react',['OzHelpers','Keys','OzCheckboxInput.react','OzDate.react','OzTimestampScrolling.react','ReactComponentWithPureRenderMixin','React','Tooltip','XUIAbstractGlyphButton.react','FBButtonMenuCombo.react','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';if(c.__markCompiled)c.__markCompiled();var t=q.Item,u=n.PropTypes,v=n.createClass({displayName:'OzSidebarItemHeader',mixins:[m],propTypes:{alias:u.string,closedAt:u.number,createdAt:u.number,creator:u.string,isExpanded:u.bool.isRequired,isClosed:u.bool.isRequired,isBlocked:u.bool,onChangeAlias:u.func,onClose:u.func,onIsExpandedToggle:u.func.isRequired,onToggle:u.func.isRequired,subtitle:u.node,title:u.string.isRequired,closeState:u.string},getInitialState:function(){return {isEditing:false};},render:function(){var y=this.props,z=y.alias,aa=y.className,ba=y.closedAt,ca=y.createdAt,da=y.creator,ea=y.isClosed,fa=y.isExpanded,ga=y.isBlocked,ha=y.onClose,ia=y.onIsExpandedToggle,ja=y.onToggle,ka=y.subtitle,la=y.title,ma=y.closeState,na=ea?ba:ca,oa='Created by '+(da||'');return (n.createElement('div',{className:s(aa,"_31gu"+(fa?' '+"_31gx":'')+(ea?' '+"_31gy":'')+(ga?' '+"_27qc":''))},n.createElement(j,{checked:ea,className:"_31gz",onChange:ja,tooltip:ma}),n.createElement('div',{className:"_31g-"},n.createElement('div',null,n.createElement('span',null,na?n.createElement(l,{timestamp:na},n.createElement(k,{className:"_56sd",timestamp:na})):null),n.createElement(x,{alias:z,isEditing:this.state.isEditing,name:la,onChange:this._handleChangeAlias,onStartEditing:this._handleStartEditing,onCancelEditing:function(pa){return this.setState({isEditing:false});}.bind(this),tooltip:oa})),n.createElement('span',{className:"_31h0"},ka)),n.createElement('div',{className:"_3_41"},this.props.children,n.createElement(p,{className:"_31h1",onClick:ia}),ea||!ha?null:n.createElement('div',{className:"_31h2"},n.createElement(q,{size:'small',numberOfButtons:0,onClick:ha},n.createElement(t,{value:'unfulfilled',label:'Was not able to fulfill the user request'}),n.createElement(t,{value:'alternate',label:'Fulfilled the user request via alternate options'}),n.createElement(t,{value:'deleted',label:'Delete'}))))));},_handleStartEditing:function(){this.props.onChangeAlias&&this.setState({isEditing:true});},_handleChangeAlias:function(y){var z=this.props.onChangeAlias;if(y.which===i.RETURN){z&&z(y.target.value);this.setState({isEditing:false});}}}),w=function(y){if(y.setSelectionRange){var z=y.value.length;y.setSelectionRange(z,z);}},x=h.pure(function(y){var z=y.name,aa=y.isEditing,ba=y.alias,ca=y.tooltip,da=y.onChange,ea=y.onStartEditing,fa=y.onCancelEditing;return (aa?n.createElement('textarea',{className:"_31g_"+(' '+"_1p0b"),onKeyDown:da,placeholder:z,defaultValue:ba,onBlur:fa,ref:function(ga){if(ga){ga.focus();w(ga);}}}):n.createElement('span',babelHelpers['extends']({className:"_31g_",onClick:ea},o.propsFor(ca)),ba||z));});f.exports=v;},null);
__d('OzGenericIntent.react',['cx','OzHelpers','immutable','invariant','MessengerButton.react','OzConfig','OzFormPreview.react','OzIntentEvents.react','OzIntentParams.react','OzRequirementTokenizer.react','OzSidebarItemHeader.react','ReactComponentWithPureRenderMixin','React','Reflux','SearchableEntry','OzIntentParamsTextField.react','Tooltip'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){'use strict';if(c.__markCompiled)c.__markCompiled();var y=n.Row,z=j.Map,aa=t.PropTypes,ba=t.createClass({displayName:'OzGenericIntent',mixins:[s,u.connect(m.ConfigStore,'config')],propTypes:{intent:aa.instanceOf(z).isRequired,intentMeta:aa.instanceOf(z).isRequired,isExpanded:aa.bool.isRequired,notes:aa.string.isRequired,onCallClick:aa.func.isRequired,onChangeAlias:aa.func.isRequired,onClose:aa.func.isRequired,onNotesChange:aa.func.isRequired,onOpen:aa.func.isRequired,onIsExpandedToggle:aa.func.isRequired,onIsBlockedToggle:aa.func.isRequired,requirements:aa.instanceOf(z).isRequired,onCreateRequirement:aa.func,onDeleteRequirement:aa.func,repNames:aa.instanceOf(z).isRequired,userEmail:aa.string},getInitialState:function(){return {requirementQuery:''};},render:function(){var ea=this.props,fa=ea.intent,ga=ea.intentMeta,ha=ea.isExpanded,ia=ea.repNames,ja=fa.get('creator-fbid'),ka=ia.get(ja,ja),la=fa.get('blocked'),ma=ga.get('name')+(la?' (Waiting)':'');return (t.createElement('div',null,t.createElement(r,{alias:fa.get('alias'),className:"_a2q",isExpanded:ha,isClosed:i.isClosedIntent(fa),closeState:fa.get('state'),isBlocked:la,onChangeAlias:this._handleChangeAlias,onClose:this._handleClose,onIsExpandedToggle:this._handleIsExpandedToggle,onToggle:this._handleToggle,title:ma,createdAt:fa.get('created-at'),closedAt:fa.get('closed-at'),creator:ka}),this._renderBody()));},_renderBody:function(){var ea=this.props,fa=ea.intent,ga=ea.isExpanded;if(!ga)return null;return (t.createElement('div',null,t.createElement(da,{blocked:fa.get('blocked'),onIsBlockedToggle:this._handleIsBlockedToggle}),this.state.config.getIn(['GK','email'])?null:t.createElement(ca,{intent:fa,onClick:this._handleCallClick}),t.createElement(p,null,this.props.children),t.createElement('div',{className:"_1x-e"},t.createElement(q,{allRequirements:this.props.requirements,onCreateRequirement:this._handleCreateRequirement,onDeleteRequirement:this._handleDeleteRequirement,onQueryStringChange:this._handleQueryStringChange,queryString:this.state.requirementQuery,selectedRequirements:fa.get('requirements')})),t.createElement(p,null,t.createElement('div',{className:"_19ny"},t.createElement(w,{label:'Add notes about this task...',onChange:this.props.onNotesChange,value:this.props.notes}))),this.state.config.getIn(['GK','email'])?t.createElement(o,{intent:fa,userEmail:this.props.userEmail,onCallClick:this._handleCallClick}):null));},_handleCallClick:function(){var ea=this.props,fa=ea.intent,ga=ea.onCallClick;ga&&ga(fa);},_handleChangeAlias:function(ea){var fa=this.props,ga=fa.intent,ha=fa.onChangeAlias;ha&&ha(ga,ea);},_handleClose:function(ea){var fa=this.props,ga=fa.intent,ha=fa.onClose;ha&&ha(ga.get('id'),ea);},_handleIsBlockedToggle:function(){var ea=this.props,fa=ea.intent,ga=ea.onIsBlockedToggle;ga(fa);},_handleIsExpandedToggle:function(){var ea=this.props,fa=ea.intent,ga=ea.onIsExpandedToggle,ha=ea.isExpanded;ga(fa,ha);},_handleCreateRequirement:function(ea){var fa=this.props,ga=fa.intent,ha=fa.onCreateRequirement;if(ha)ha(ga.get('id'),ea.getTitle());this.setState({requirementQuery:''});},_handleDeleteRequirement:function(ea){var fa=this.props,ga=fa.intent,ha=fa.onDeleteRequirement;if(ha)ha(ga.get('id'),ea.getUniqueID());},_handleQueryStringChange:function(ea){var fa=ea.target;!(fa instanceof HTMLInputElement)?k(0):undefined;this.setState({requirementQuery:fa.value});},_handleToggle:function(){var ea=this.props,fa=ea.intent,ga=ea.onOpen,ha=ea.onClose,ia=i.isClosedIntent(fa);this.setState({isExpanded:ia},function(ja){return ((ia?ga:ha)(fa.get('id')));});}}),ca=i.pure(function(ea){var fa=ea.onClick,ga=ea.intent,ha=i.parsePhoneNumber(ga.get('phone-number')),ia=ha?'Use '+ha+' ext. '+ga.get('phone-extension')+' to call':'Click to create a phone number for this intent';return (t.createElement('div',{className:"_1x-f"},t.createElement(l,babelHelpers['extends']({type:'primary',label:'Make a Call',onClick:fa,style:{fontSize:'13px'}},x.propsFor(ia))),ha?t.createElement('span',null,t.createElement('strong',null,ha,' '),'ext. ',t.createElement('strong',null,ga.get('phone-extension'))):null));}),da=i.pure(function(ea){var fa=ea.blocked,ga=ea.onIsBlockedToggle,ha='Check when blocked by an external factor (not load)',ia=t.createElement('span',x.propsFor(ha),'Waiting?');return (t.createElement('div',{className:"_5xr7"},t.createElement(y,{label:ia},t.createElement('input',{type:'checkbox',checked:fa,onChange:ga}))));});f.exports=ba;},null);
__d('OzIntentParamsDateTimeField.react',['OzIntentParamsAbstractField.react','ReactComponentWithPureRenderMixin','React','XUIDateTimePicker.react'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=j.createClass({displayName:'OzIntentParamsDateTimeField',mixins:[i],propTypes:{label:l.string,onChange:l.func,value:l.instanceOf(Date)},render:function(){return (j.createElement(h,{hasValue:!!this.props.value,label:this.props.label},j.createElement(k,{date:this.props.value,dateIcon:null,datePlaceholder:this.props.label,onChange:this.props.onChange,shouldSetDefaultDate:false})));}});f.exports=m;},null);
__d('OzIntentParamsEnumField.react',['immutable','OzIntentParamsAbstractField.react','ReactComponentWithPureRenderMixin','React','XUISingleSelector.react'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=l.Option,n=k.PropTypes,o=h.List,p=k.createClass({displayName:'OzIntentParamsEnumField',mixins:[j],propTypes:{label:n.string,onChange:n.func,onSave:n.func,placeholder:n.string,values:n.arrayOf(n.string).isRequired,value:n.string},getInitialState:function(){return {value:this.props.value||''};},render:function(){var q=o(this.props.values).map(function(r){return (k.createElement(m,{key:r,value:r},r));}).unshift(k.createElement(m,{key:this.props.placeholder,value:''},this.props.placeholder));return (k.createElement(i,{hasValue:!!this.state.value,label:this.props.label},k.createElement(l,{maxHeight:240,onChange:this._handleChange,value:this.state.value},q)));},_handleChange:function(q){this.props.onChange&&this.props.onChange(q.value);this.setState({value:q.value},this._save);},_save:function(){if(this.props.onSave)this.props.onSave(this.state.value);}});f.exports=p;},null);
__d('OzIntentParamsNumberField.react',['FBNumberInput.react','OzIntentParamsAbstractField.react','ReactComponentWithPureRenderMixin','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=k.PropTypes,n=k.createClass({displayName:'OzIntentParamsNumberField',mixins:[j],propTypes:{label:m.string,onChange:m.func,placeholder:m.string,value:m.number},render:function(){return (k.createElement(i,{hasValue:this.props.value!=null,label:this.props.label},k.createElement(h,{className:"_3dag",onValueChange:this.props.onChange,placeholder:this.props.placeholder,value:this.props.value})));}});f.exports=n;},null);
__d('OzIntentParamsPriceRangeField.react',['OzIntentParamsAbstractField.react','ReactComponentWithPureRenderMixin','React','cx'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=[1,2,3,4],n=j.createClass({displayName:'OzIntentParamsPriceRangeField',mixins:[i],propTypes:{label:l.string,onChange:l.func,value:l.oneOf(m)},render:function(){var o=this.props.value;return (j.createElement(h,{hasValue:!!o,label:this.props.label},j.createElement('span',{className:"_8l3"},m.map(function(p){return (j.createElement('span',{className:"_8l4"+(o&&p<=o?' '+"_8l6":''),key:p,onClick:function(q){return this._handleDollarClick(q,p);}.bind(this)},'$'));}.bind(this)))));},_handleDollarClick:function(o,p){o.preventDefault();var q=this.props.value==p?null:p;this.props.onChange&&this.props.onChange(q);}});f.exports=n;},null);
__d('OzIntentParamsStringField.react',['AbstractTextInput.react','OzIntentParamsAbstractField.react','ReactComponentWithPureRenderMixin','React','invariant','debounce'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=k.PropTypes,o=k.createClass({displayName:'OzIntentParamsStringField',mixins:[j],propTypes:{label:n.string,onChange:n.func,onSave:n.func,placeholder:n.string,value:n.string},getInitialState:function(){return {value:this.props.value||''};},componentWillMount:function(){this._save=m(this._save,750,this,true);},render:function(){return (k.createElement(i,{hasValue:!!this.state.value,label:this.props.label},k.createElement(h,{onChange:this._handleChange,placeholder:this.props.placeholder,type:'text',value:this.state.value})));},_handleChange:function(p){var q=p.target;!(q instanceof HTMLInputElement)?l(0):undefined;this.props.onChange&&this.props.onChange(q.value);this.setState({value:q.value},this._save);},_save:function(){if(this.props.onSave)this.props.onSave(this.state.value);}});f.exports=o;},null);
__d('OzIntentFactoryHelpers',['immutable','React','OzIntentParamsStringField.react','OzIntentParamsNumberField.react','OzIntentParamsPriceRangeField.react','OzIntentParamsEnumField.react','OzIntentParamsDateTimeField.react'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=h.Map,k={makeStateUpdater:function(n){return function(o){var p;this._setStateAndSave((p={},p[n]=o,p));};},makeStateExtractor:function(n){return function(o){var p=o.get('params')||j(),q={};for(var r=n,s=Array.isArray(r),t=0,r=s?r:r[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var u;if(s){if(t>=r.length)break;u=r[t++];}else{t=r.next();if(t.done)break;u=t.value;}var v=u,w=v.name,x=v.type,y=l(p,w);switch(x){case 'string':case 'enum':q[w]=''+(y||'');break;case 'number':case 'pricerange':q[w]=+y||null;break;case 'datetime':q[w]=y&&new Date(y);}}return babelHelpers['extends']({},q,{notes:o.get('notes')||''});};},makeParamsUpdater:function(n){return function(o,p){return (o||j()).withMutations(function(q){for(var r=n,s=Array.isArray(r),t=0,r=s?r:r[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var u;if(s){if(t>=r.length)break;u=r[t++];}else{t=r.next();if(t.done)break;u=t.value;}var v=u,w=v.name,x=v.type;switch(x){case 'datetime':var y=p[w],z=y?{value:y.toISOString(),grain:'minute'}:undefined;m(q,w,z);break;default:m(q,w,{value:p[w]});break;}}});};},makeFieldRenderer:function(n){return function(){return n.map(function(o){var p=o.label,q=o.name,r=o.placeholder,s=o.type,t=o.values,u=k.getFieldComponent(s);return (i.createElement(u,{key:q,label:p,onChange:this._changeHandlers.get(q),placeholder:r||p,value:this.state[q],values:t}));}.bind(this));};},getFieldComponent:function(n){switch(n){case 'string':return c('OzIntentParamsStringField.react');case 'number':return c('OzIntentParamsNumberField.react');case 'pricerange':return c('OzIntentParamsPriceRangeField.react');case 'enum':return c('OzIntentParamsEnumField.react');case 'datetime':return c('OzIntentParamsDateTimeField.react');default:throw new Error('OzIntentFactoryHelpers: Unknown field type '+n+'.');}}};function l(n,o){var p=n.get(o);if(p&&!p.isEmpty())return p.first().get('value');return null;}function m(n,o,p){n.set(o,h.fromJS([p]));}f.exports=k;},null);
__d('OzIntentSchemas',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={get:function(z){switch(z){case 'restaurant':return j;case 'reminder':return k;case 'nonmedical_appointment':return l;case 'local_search':return m;case 'good_purchase':return n;case 'customer_service_general':return o;case 'weather_forecast':return p;case 'hotel_and_accommodation':return q;case 'activities_things_to_do':return r;case 'ticket_purchase':return s;case 'food_purchase':return t;case 'utility':return u;case 'vehicle_service':return v;case 'traffic':return w;case 'navigation':return x;case 'flight_request':return y;default:return i;}}},i={name:'Generic',fields:[]},j={name:'Restaurant',fields:[{type:'enum',name:'request_type',label:'Action',placeholder:'Pick one...',values:['reservation','availability','cancel','change','info','location','option','price','receipt','time','schedule']},{type:'string',name:'restaurant_name',label:'Name',placeholder:'Restaurant Name'},{type:'string',name:'restaurant_cuisine',label:'Cuisine'},{type:'string',name:'location',label:'Location'},{type:'number',name:'people_number',label:'Guests',placeholder:'Number of guests'},{type:'datetime',name:'datetime',label:'Date/Time'},{type:'pricerange',name:'amount_of_money',label:'Price Range'}]},k={name:'reminder',fields:[{type:'datetime',name:'datetime',label:'Reminder Time'},{type:'string',name:'reminder',label:'About'}]},l={name:'NonMedicalAppt',fields:[{type:'enum',name:'appt_action',label:'Action',placeholder:'Pick one...',values:['availability','cancel','move','confirm','book']},{type:'string',name:'appt_type',label:'Appt Type',placeholder:'Type of appointment'},{type:'string',name:'location',label:'Location',placeholder:'Location of appointment'},{type:'datetime',name:'datetime',label:'Datetime',placeholder:'Date and time of the appointment'},{type:'string',name:'local_search_query',label:'Name',placeholder:'Name of the place'}]},m={name:'LocalSearch',fields:[{type:'string',name:'local_query',label:'Query',placeholder:'Search query like yoga class...'},{type:'string',name:'location',label:'Location',placeholder:''},{type:'string',name:'local_name',label:'Name',placeholder:'Name of the place or business...'},{type:'datetime',name:'datetime',label:'Datetime',placeholder:''}]},n={name:'GoodPurchase',fields:[{type:'string',name:'good',label:'Good',placeholder:''},{type:'string',name:'provider',label:'Merchant',placeholder:''},{type:'string',name:'amount_of_money',label:'Price'},{type:'number',name:'good_number',label:'Items #',placeholder:'Number of Items'},{type:'string',name:'location',label:'Location',placeholder:''},{type:'datetime',name:'datetime',label:'Datetime'}]},o={name:'CustomerService',fields:[{type:'string',name:'provider',label:'Merchant'},{type:'string',name:'order_number',label:'Order #'}]},p={name:'Weather',fields:[{type:'string',name:'location',label:'Location'},{type:'datetime',name:'datetime',label:'Datetime'},{type:'string',name:'weather_type',label:'Type of forecast',placeholder:'temperature, snow, tide...'},{type:'string',name:'temperature_metric',label:'Metric',placeholder:'Celsius or Fahrenheit'}]},q={name:'Hotel',fields:[{type:'enum',name:'hotel_query_type',label:'Action',placeholder:'Pick one...',values:['reservation','availability','cancel','change','contact','extend','receipt']},{type:'string',name:'location',label:'Location'},{type:'datetime',name:'datetime',label:'Check in',placeholder:'Date and time of the appointment'},{type:'number',name:'night_number',label:'Nights #',placeholder:'Number of Nights'},{type:'number',name:'people',label:'People',placeholder:'Number of Guests'},{type:'string',name:'amount_of_money',label:'Price'},{type:'string',name:'hotel_name',label:'Hotel Name'}]},r={name:'Activities',fields:[{type:'string',name:'reservation_type',label:'Activity'},{type:'string',name:'location',label:'Location'},{type:'datetime',name:'datetime',label:'Datetime'},{type:'string',name:'amount_of_money',label:'Price'},{type:'number',name:'people_number',label:'People',placeholder:'Number of People'}]},s={name:'Tickets',fields:[{type:'enum',name:'request_type',label:'Action',placeholder:'Pick one...',values:['reservation','availability','cancel','change','info','location','option','price','receipt','time','schedule']},{type:'string',name:'event_type',label:'Type',placeholder:'Movie, show, concert...'},{type:'string',name:'event',label:'Name'},{type:'string',name:'event_venue',label:'Venue'},{type:'string',name:'location',label:'Location'},{type:'datetime',name:'datetime',label:'Datetime'},{type:'string',name:'amount_of_money',label:'Price'},{type:'number',name:'people_number',label:'Tickets #',placeholder:'Number of Tickets'}]},t={name:'FoodPurchase',fields:[{type:'string',name:'order',label:'Order',placeholder:''},{type:'string',name:'food_type',label:'Food Type',placeholder:''},{type:'string',name:'food_place',label:'Place'},{type:'enum',name:'delivery_type',label:'Delivery',placeholder:'Pick one...',values:['deliver','takeout']},{type:'string',name:'location',label:'Location',placeholder:''},{type:'datetime',name:'datetime',label:'Datetime'}]},u={name:'Utility',fields:[{type:'enum',name:'request_type',label:'Action',placeholder:'Pick one...',values:['reservation','availability','cancel','change','info','location','option','price','receipt','time','schedule']},{type:'string',name:'utility_provider',label:'Name',placeholder:'Name of the utility company'},{type:'string',name:'location',label:'Location',placeholder:''},{type:'string',name:'account_nbr',label:'Account #',placeholder:''}]},v={name:'Vehicle',fields:[{type:'enum',name:'hotel_query_type',label:'Action',placeholder:'Pick one...',values:['reservation','availability','cancel','change','info','location','option','price','receipt','time','schedule']},{type:'string',name:'from',label:'From'},{type:'string',name:'to',label:'To'},{type:'datetime',name:'datetime',label:'Datetime',placeholder:'Date and time of the ride'},{type:'string',name:'car_type',label:'Car Type',placeholder:'Type of car (limo, uber, lift...)'},{type:'string',name:'people_number',label:'People',placeholder:'Number of Guests'},{type:'string',name:'vehicle_provider',label:'Rental Name',placeholder:'Car rental name like Hertz, Avis..'}]},w={name:'Traffic',fields:[{type:'string',name:'from',label:'Starting Point'},{type:'string',name:'to',label:'Destination'},{type:'datetime',name:'datetime',label:'Date/Time',placeholder:'Intended departure time (not supported by automation)'}]},x={name:'Navigation',fields:[{type:'string',name:'from',label:'Starting Point'},{type:'string',name:'to',label:'Destination'},{type:'datetime',name:'datetime',label:'Date/Time',placeholder:'Intended departure time (not supported by automation)'}]},y={name:'flight_request',fields:[{type:'enum',name:'flight_query_type',label:'Action',placeholder:'Pick one...',values:['book','price','upgrade','flight_status','cancel','change']},{type:'string',name:'from',label:'From'},{type:'string',name:'to',label:'To'},{type:'datetime',name:'departure',label:'Departure'},{type:'datetime',name:'arrival',label:'Arrival'},{type:'string',name:'carrier',label:'Carrier'},{type:'string',name:'reference',label:'Reference Number'},{type:'number',name:'passenger_num',label:'Passenger Number'}]};f.exports=h;},null);
__d('OzIntentFactory',['immutable','Map','OzAPI','OzGenericIntent.react','OzIntentFactoryHelpers','OzIntentSchemas','ReactComponentWithPureRenderMixin','React','debounce'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=o.PropTypes,r=new i(),s={get:function(u){var v=m.get(u);if(!r.has(u))r.set(u,t(v));return r.get(u);}};function t(u){var v=h.Map,w=u.name,x=u.fields,y=10000,z=l.makeStateExtractor(x),aa=l.makeFieldRenderer(x),ba=l.makeParamsUpdater(x);return o.createClass({displayName:'Oz'+w+'DynamicIntent',mixins:[n],propTypes:{intent:q.instanceOf(v).isRequired,intentMeta:q.instanceOf(v).isRequired,isExpanded:q.bool.isRequired,onCallClick:q.func.isRequired,onChangeAlias:q.func,onClose:q.func.isRequired,onOpen:q.func.isRequired,onIsExpandedToggle:q.func.isRequired,onIsBlockedToggle:q.func.isRequired,requirements:q.instanceOf(v).isRequired,repNames:q.instanceOf(v).isRequired,onCreateRequirement:q.func,onDeleteRequirement:q.func,userEmail:q.string},getInitialState:function(){return babelHelpers['extends']({isEditing:false},z(this.props.intent));},componentWillMount:function(){this._saveIntent=p(this._saveIntent,500,this,true);this._changeHandlers=v().withMutations(function(ca){for(var da=x,ea=Array.isArray(da),fa=0,da=ea?da:da[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ga;if(ea){if(fa>=da.length)break;ga=da[fa++];}else{fa=da.next();if(fa.done)break;ga=fa.value;}var ha=ga;ca.set(ha.name,l.makeStateUpdater(ha.name).bind(this));}}.bind(this));},componentWillReceiveProps:function(ca){var da=this.state.isEditing;if(h.is(ca.intent,this.props.intent)||da)return;this.setState(z(ca.intent));},componentWillUnmount:function(){window.clearTimeout(this._editingTimeout);},render:function(){return (o.createElement(k,babelHelpers['extends']({},this.props,{notes:this.state.notes,onNotesChange:this._handleNotesChange}),this._renderFields()));},_renderFields:aa,_handleNotesChange:function(ca){this._setStateAndSave({notes:ca});},_saveIntent:function(){var ca=this.props.intent;j.editIntent(ca.get('user-id'),v({id:ca.get('id'),params:ba(ca.get('params'),this.state),notes:this.state.notes}));},_setStateAndSave:function(ca){window.clearTimeout(this._editingTimeout);this.setState(babelHelpers['extends']({isEditing:true},ca),this._saveIntent);this._editingTimeout=window.setTimeout(function(da){return this.setState({isEditing:false});}.bind(this),y);}});}f.exports=s;},null);
__d('OzIntent.react',['immutable','OzIntentFactory','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=h.Map,m=k.PropTypes,n=k.createClass({displayName:'OzIntent',mixins:[j],propTypes:{intent:m.instanceOf(l).isRequired,intentMeta:m.instanceOf(l).isRequired,isExpanded:m.bool.isRequired,onCallClick:m.func.isRequired,onChangeAlias:m.func.isRequired,onIsExpandedToggle:m.func.isRequired,onIsBlockedToggle:m.func.isRequired,requirements:m.instanceOf(l).isRequired,repNames:m.instanceOf(l).isRequired,onClose:m.func,onCreateRequirement:m.func,onDeleteRequirement:m.func,onOpen:m.func,userEmail:m.string},render:function(){var o=this.props,p=o.intent,q=o.intentMeta,r=o.isExpanded,s=o.onIsExpandedToggle,t=o.onIsBlockedToggle,u=o.repNames,v=o.requirements,w=o.userEmail,x=i.get(q.get('name'));return (k.createElement(x,{intent:p,intentMeta:q,isExpanded:r,onCallClick:this.props.onCallClick,onChangeAlias:this.props.onChangeAlias,onClose:this.props.onClose,onCreateRequirement:this.props.onCreateRequirement,onDeleteRequirement:this.props.onDeleteRequirement,onOpen:this.props.onOpen,onIsExpandedToggle:s,onIsBlockedToggle:t,repNames:u,requirements:v,userEmail:w}));}});f.exports=n;},null);
__d('OzIntentList.react',['Promise','OzHelpers','OzAPI','immutable','OzActions','OzIntent.react','OzStores','ReactComponentWithPureRenderMixin','React','ReactCSSTransitionGroup','Reflux'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=p.PropTypes,t=k.Map,u=n.ActiveThreadStore,v=p.createClass({displayName:'OzIntentList',mixins:[o,r.connect(u,'activeThread')],propTypes:{threadID:s.string.isRequired,intents:s.instanceOf(k.List).isRequired,requirements:s.instanceOf(k.Map).isRequired,repNames:s.instanceOf(t).isRequired,userEmail:s.string,witIntents:s.instanceOf(k.Map).isRequired},render:function(){var x=this.props.witIntents,y=this.props.intents.map(function(z){var aa=z.get('wit-intent-uuid'),ba=x.get(aa);if(!ba){i.error('could not find witIntent for',z);return [z,t({name:z.get('name')+' ('+aa+')'})];}return [z,ba];}).filter(function(z){return !!z;}).map(this._renderIntent).valueSeq();if(y.isEmpty())return null;return (p.createElement('div',null,p.createElement(q,{transitionName:'oz-fade-in-out',transitionEnterTimeout:300,transitionLeaveTimeout:300},y)));},_renderIntent:function(x){var y=x[0],z=x[1],aa=this.state.activeThread,ba=aa.get('activeIntent')===y.get('id');return (p.createElement(m,{intent:y,intentMeta:z,isExpanded:ba,key:y.get('id'),onCallClick:this._handleCallClick,onChangeAlias:this._handleChangeAlias,onClose:this._handleClose,onCreateRequirement:this._handleCreateRequirement,onDeleteRequirement:this._handleDeleteRequirement,onIsExpandedToggle:this._handleIsExpandedToggle,onIsBlockedToggle:this._handleIsBlockedToggle,onOpen:this._handleOpen,repNames:this.props.repNames,requirements:this.props.requirements,userEmail:this.props.userEmail}));},_handleClose:function(x,y){j.closeIntent(this.props.threadID,x,y);},_handleOpen:function(x){j.openIntent(this.props.threadID,x);},_handleDeleteRequirement:function(x,y){j.deleteIntentRequirement(this.props.threadID,x,y);},_handleCreateRequirement:function(x,y){j.createIntentRequirement(this.props.threadID,x,y);},_handleCallClick:function(x){w(this.props.threadID,x).done(function(y){return l.twilio.useIntent(y);});},_handleChangeAlias:function(x,y){j.editIntent(x.get('user-id'),t({id:x.get('id'),alias:y}));},_handleIsExpandedToggle:function(x,y){l.activateIntent(y?null:x.get('id'));},_handleIsBlockedToggle:function(x){x.get('blocked')?j.unblockIntent(this.props.threadID,x.get('id')):j.blockIntent(this.props.threadID,x.get('id'));}});function w(x,y){var z=y.get('phone-number');return z?h.resolve(y):j.addPhoneNumber(x,y.get('id')).then(function(aa){return aa.get('intents').find(function(ba){return ba.get('id')===y.get('id');});});}f.exports=v;},null);
__d('OzHistoryIntentList.react',['OzHelpers','immutable','OzIntentList.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=i.Map,n=l.PropTypes,o=l.createClass({displayName:'OzTodoIntentList',mixins:[k],propTypes:{repNames:n.instanceOf(m).isRequired,requirements:n.instanceOf(m).isRequired,thread:n.instanceOf(m).isRequired,witIntents:n.instanceOf(m).isRequired},render:function(){var p=h.intents(this.props.thread).filter(h.isClosedIntent);return (l.createElement(j,{intents:p,repNames:this.props.repNames,requirements:this.props.requirements,threadID:h.threadID(this.props.thread),userEmail:h.userEmail(this.props.thread),witIntents:this.props.witIntents}));}});f.exports=o;},null);
__d('OzMessageCommentDialog.react',['ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','MessengerButton.react','React','XUIContextualDialog.react','cx','invariant'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=k.PropTypes,p=k.createClass({displayName:'OzMessageCommentDialog',propTypes:{contextRef:o.func.isRequired,feedback:o.string,onBlur:o.func,onFeedbackChange:o.func.isRequired,onSave:o.func.isRequired},render:function(){return (k.createElement(l,{behaviors:{ContextualLayerAutoFlip:h,ContextualLayerUpdateOnScroll:i},contextRef:this.props.contextRef,shown:true,position:'below',onBlur:this.props.onBlur},k.createElement('div',{className:"_2bxg"},k.createElement('textarea',{className:"_1-i0",maxLength:'200',value:this.props.feedback,onChange:this._handleFeedbackChange,placeholder:'Give a few words for detail'}),k.createElement('div',{className:"_2bxh"},k.createElement(j,{type:'primary',label:'Save',onClick:this.props.onSave})))));},_handleFeedbackChange:function(q){!(q.target instanceof HTMLTextAreaElement)?n(0):undefined;this.props.onFeedbackChange(q.target.value);}});f.exports=p;},null);
__d('OzMessageFeedbackDialog.react',['ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','InputLabel.react','OzButton.react','OzCheckboxInput.react','React','StarsInput.react','XUIContextualDialog.react','XUIContextualDialogBody.react','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=m.PropTypes,s=['Poor','Average','Great'],t=m.createClass({displayName:'OzMessageFeedbackDialog',propTypes:{contextRef:r.func.isRequired,executionRating:r.oneOf([0,1,2,3]),followedPolicy:r.bool,onClose:r.func,onExecutionRatingChange:r.func,onFollowedPolicyChange:r.func,onResponsivenessRatingChange:r.func,onSave:r.func,onToneRatingChange:r.func,responsivenessRating:r.oneOf([0,1,2,3]),toneRating:r.oneOf([0,1,2,3])},render:function(){return (m.createElement(o,{behaviors:{ContextualLayerAutoFlip:h,ContextualLayerUpdateOnScroll:i},contextRef:this.props.contextRef,shown:true},m.createElement(p,{className:"_5dx"},m.createElement('h3',null,'Tone'),m.createElement(n,{count:this.props.toneRating,large:true,onClick:this.props.onToneRatingChange,starLabels:s}),m.createElement('h3',null,'Execution'),m.createElement(n,{count:this.props.executionRating,large:true,onClick:this.props.onExecutionRatingChange,starLabels:s}),m.createElement('h3',null,'Responsiveness'),m.createElement(n,{count:this.props.responsivenessRating,large:true,onClick:this.props.onResponsivenessRatingChange,starLabels:s}),m.createElement('h3',null,'Followed Policy'),m.createElement('div',null,m.createElement(j,null,m.createElement(l,{checked:this.props.followedPolicy===true,onChange:this._handleYesClick}),m.createElement('label',null,'Yes')),m.createElement(j,null,m.createElement(l,{checked:this.props.followedPolicy===false,onChange:this._handleNoClick}),m.createElement('label',null,'No'))),m.createElement('div',{className:"_5dy"},m.createElement(k,{onClick:this.props.onClose},'Cancel'),m.createElement(k,{className:"_5dz",onClick:this.props.onSave,use:'confirm'},'Save')))));},_handleYesClick:function(){var u=this.props.onFollowedPolicyChange;u&&u(true);},_handleNoClick:function(){var u=this.props.onFollowedPolicyChange;u&&u(false);}});f.exports=t;},null);
__d('OzMessageFeedback.react',['cx','OzHelpers','joinClasses','ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','immutable','ReactLayeredComponentMixin','MessengerButton.react','OzMessageCommentDialog.react','OzMessageFeedbackDialog.react','ReactComponentWithPureRenderMixin','React','XUIContextualDialog.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=m.Map,v=s.PropTypes,w='comment_dialog',x='feedback_dialog',y='no_dialog',z=s.createClass({displayName:'OzMessageFeedback',mixins:[n,r],propTypes:{message:v.instanceOf(u).isRequired,onSave:v.func.isRequired},getInitialState:function(){return babelHelpers['extends']({currentDialog:y},ba(this.props.message));},componentWillReceiveProps:function(da){if(da.message!==this.props.message)this.setState(ba(da.message));},render:function(){var da=this.props,ea=da.message,fa=da.onSave,ga=this.state,ha=ga.currentDialog,ia=ga.feedback,ja=ca(this.state);return (s.createElement('div',{className:"_2bxa"+(' '+"_2bxb")+(ja?' '+"_2bxc":'')+(ha!==y?' '+"_2bxd":'')},s.createElement(aa,{className:"_2bxe",onClick:function(ka){return this.setState({currentDialog:w});}.bind(this),isActive:!!ia||ha===w,ref:'comment'}),s.createElement(aa,{className:"_2bxf",onClick:function(ka){return this.setState({currentDialog:x});}.bind(this),isActive:ja||ha===x,ref:'flag'})));},renderLayers:function(){switch(this.state.currentDialog){case w:return {contextualDialog:this._renderCommentDialog()};case x:return {contextualDialog:this._renderFeedbackDialog()};default:return null;}},_renderFeedbackDialog:function(){return (s.createElement(q,{contextRef:function(){return this.refs.flag;}.bind(this),executionRating:this.state.executionRating,followedPolicy:this.state.followedPolicy,onClose:this._handleDialogClose,onExecutionRatingChange:function(da){this.setState({executionRating:da});}.bind(this),onFollowedPolicyChange:function(da){this.setState({followedPolicy:da});}.bind(this),onResponsivenessRatingChange:function(da){this.setState({responsivenessRating:da});}.bind(this),onSave:this._handleFeedbackSave,onToneRatingChange:function(da){this.setState({toneRating:da});}.bind(this),responsivenessRating:this.state.responsivenessRating,toneRating:this.state.toneRating}));},_renderCommentDialog:function(){return (s.createElement(p,{contextRef:function(){return this.refs.comment;}.bind(this),feedback:this.state.feedback,onBlur:this._handleDialogClose,onFeedbackChange:function(da){this.setState({feedback:da});}.bind(this),onSave:this._handleCommentSave}));},_handleFeedbackSave:function(){this.props.onSave(u({execution:this.state.executionRating,'followed-policy':this.state.followedPolicy,mid:this.props.message.get('mid'),responsiveness:this.state.responsivenessRating,tone:this.state.toneRating}));this._handleDialogClose();},_handleCommentSave:function(){this.props.onSave(u({feedback:this.state.feedback,mid:this.props.message.get('mid')}));this._handleDialogClose();},_handleDialogClose:function(){this.setState({currentDialog:y});}}),aa=s.createClass({displayName:'FeedbackButton',render:function(){var da=this.props,ea=da.className,fa=da.onClick,ga=da.isActive;return (s.createElement('button',{role:'button',className:j("_1-hv"+(' '+"_2bxi")+(ga?' '+"_2bxj":''),ea),onClick:fa}));}});function ba(da){return {executionRating:da.get('execution'),feedback:da.get('feedback'),followedPolicy:da.get('followed-policy'),responsivenessRating:da.get('responsiveness'),toneRating:da.get('tone')};}function ca(da){return !!(da.executionRating||da.followedPolicy!==undefined||da.responsivenessRating||da.toneRating);}f.exports=z;},null);
__d('OzInboxMessage.react',['OzAPI','cx','OzHelpers','immutable','OzActions','OzConfig','OzConstants','OzMessage.react','OzMessageFeedback.react','ReactComponentWithPureRenderMixin','React','Reflux'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=k.Map,u=n.AUTHOR_TYPES,v=r.PropTypes,w=r.createClass({displayName:'OzInboxMessage',mixins:[q,s.connect(m.ConfigStore,'config')],propTypes:{authorType:v.oneOf(j.values(u)),isActive:v.bool.isRequired,message:v.instanceOf(t).isRequired,threadID:v.string.isRequired},render:function(){var x=this.props,y=x.message,z=x.authorType,aa=x.threadID,ba=x.isActive,ca=!!y.get('author'),da=this.state.config;return (r.createElement('div',{className:"clearfix"+(' '+"_4y6j")+(ba?' '+"_4qv0":'')+(z===u.TRAINER?' '+"_2ij4":'')+(z===u.BOT?' '+"_2ij5":'')+(z===u.USER?' '+"_2p0":'')+(da.getIn(['GK','supervisor'])?' '+"_1w52":'')},r.createElement('div',{className:"_2pf"},r.createElement(o,{message:y}),z===u.USER?r.createElement('button',{onClick:function(){return l.intentCreator.toggle();},className:"_1-hv _30yy _4nd4 _ftb"}):null),ca?r.createElement(p,{message:y,onSave:function(ea){return h.updateMessage(aa,ea);}}):null));}});f.exports=w;},null);
__d('OzInboxMessageGroup.react',['OzHelpers','immutable','OzConstants','OzDate.react','OzInboxMessage.react','OzUserImage.react','ReactComponentWithPureRenderMixin','React','Tooltip','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r=i.Map,s=o.PropTypes,t=j.AUTHOR_TYPES,u=o.createClass({displayName:'OzInboxMessageGroup',mixins:[n],propTypes:{activeMsgID:s.string,authorID:s.string,authorType:s.oneOf(h.values(t)),messages:s.array.isRequired,repNames:s.instanceOf(r).isRequired,thread:s.object.isRequired,timestamp:s.number.isRequired},scrollMessageIntoViewIfNeeded:function(v){var w=this.refs[v];w?w.scrollIntoViewIfNeeded():h.error('[inboxgroup] message id '+v+' not in group');},render:function(){return (o.createElement('div',{className:"_528w"},this._renderGroup()));},_renderGroup:function(){var v=this.props.authorType,w=t.BOT,x=t.TRAINER,y=t.USER;switch(v){case x:case w:return (o.createElement('div',{className:(v===w?"_4m3p":'')+(v===x?' '+"_4m3r":'')},this._renderMessages(),this._renderBottomMeta()));case y:return (o.createElement('div',{className:"_4m3u"},o.createElement('div',{className:"_2wyu"},this._renderPhoto()),o.createElement('div',{className:"_2wyv"},this._renderMessages(),this._renderBottomMeta())));default:h.error('got unk author type',this.props);return null;}},_renderPhoto:function(){var v=h.photo(this.props.thread),w=h.getName(this.props.thread),x=h.lastPresence(this.props.thread),y=k.formatTimestamp(x);return (o.createElement('div',{className:"_528y"},o.createElement('span',p.propsFor('Seen by '+w+' at '+y,'left'),o.createElement(m,{photo:v}))));},_renderSeen:function(){return (o.createElement('div',{className:"_40ue"},this._renderPhoto()));},_renderMessages:function(){var v=this.props,w=v.messages,x=v.authorType,y=v.thread,z=v.activeMsgID;return (o.createElement('div',{className:"_528z"},w.map(function(aa){return (o.createElement('div',{key:h.msgID(aa),ref:h.msgID(aa)},o.createElement(l,{authorType:x,isActive:h.msgID(aa)===z,message:aa,threadID:h.threadID(y)}),aa.get('ui-seen')?this._renderSeen():null));}.bind(this))));},_renderBottomMeta:function(){var v=this.props,w=v.authorID,x=v.repNames,y=v.timestamp;return (o.createElement('div',{className:"_4m3v"},o.createElement('span',{className:"_4m3w"},x.get(w)||w||null),o.createElement(k,{className:"_4m3x",timestamp:y})));}});f.exports=u;},null);
__d('OzInboxMessageList.react',['cx','OzHelpers','immutable','OzConstants','OzInboxMessageGroup.react','OzLoading.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=j.Map,q=o.PropTypes,r=m.Inline,s=20,t=o.createClass({displayName:'OzGroupList',propTypes:{activeMsgID:q.string,messages:q.instanceOf(p).isRequired,repNames:q.instanceOf(p).isRequired,thread:q.instanceOf(p).isRequired},shouldComponentUpdate:function(aa,ba){return !(this.props.activeMsgID===aa.activeMsgID&&j.is(this.props.thread,aa.thread)&&j.is(this.props.repNames,aa.repNames)&&j.is(this.props.messages,aa.messages));},scrollToMessage:function(aa){return p(this.refs).find(function(ba){return ba.props.messages.some(function(ca){return i.msgID(ca)===aa;});}).scrollMessageIntoViewIfNeeded(aa);},render:function(){var aa=this.props.messages.reduceRight(w.bind(null,this.props.thread),{groupsList:[],nextTimestamp:null}).groupsList.map(this._renderGroup);return o.createElement('frag',null,aa);},_renderGroup:function(aa,ba){var ca=this.props.thread,da=aa[0],ea=aa[aa.length-1],fa=da.get('sender'),ga=da.get('author'),ha=da.get('timestamp'),ia=ea.get('timestamp'),ja=fa+ha;return (o.createElement(l,{authorID:ga,authorType:i.authorType(da),activeMsgID:this.props.activeMsgID,key:ja,messages:aa,ref:ja,repNames:this.props.repNames,thread:ca,timestamp:ia}));}}),u=o.createClass({displayName:'OzInboxMessageList',mixins:[n],propTypes:{activeMsgID:q.string,clientLimit:q.number.isRequired,loading:q.bool.isRequired,messages:q.instanceOf(p).isRequired,onScrollTop:q.func.isRequired,repNames:q.instanceOf(p).isRequired,thread:q.instanceOf(p).isRequired},componentDidMount:function(){z(this.refs.scrollable);},componentWillUpdate:function(){this._wasScrolledToBottom=y(this.refs.scrollable);this._originalScrollHeight=this.refs.scrollable.scrollHeight;this._originalScrollTop=this.refs.scrollable.scrollTop;this._originalActiveMsgID=this._visiblyActiveMsgID();},componentDidUpdate:function(aa){var ba=this._visiblyActiveMsgID();if(ba&&ba!==this._originalActiveMsgID){i.debug('[messagelist] scrolling to active msg id '+ba);this.refs.groupList.scrollToMessage(ba);}else if(this._wasScrolledToBottom||x(aa.messages,this.props.messages)||i.threadID(aa.thread)!==i.threadID(this.props.thread)){i.debug('[messagelist] scrolling bottom');z(this.refs.scrollable);}else{var ca=this.refs.scrollable.scrollHeight-this._originalScrollHeight+this._originalScrollTop;this.refs.scrollable.scrollTop=ca;}},resize:function(){this.componentDidUpdate(this.props);},_visibleMessages:function(){var aa=this.props,ba=aa.messages,ca=aa.clientLimit;return ba.takeLast(ca);},_visiblyActiveMsgID:function(){var aa=this.props.activeMsgID,ba=this._visibleMessages();if(ba.some(function(ca){return i.msgID(ca)===aa;}))return aa;if(aa)i.debug('[messagelist] msg '+aa+' not visible',ba.toJS());return null;},render:function(){var aa=this.props,ba=aa.loading,ca=aa.sending,da=aa.thread;return (o.createElement('div',{onScroll:this._handleScroll,className:"_4fj7",ref:'scrollable'},o.createElement(r,{loading:ba}),o.createElement(t,{activeMsgID:this.props.activeMsgID,thread:da,messages:this._visibleMessages(),ref:'groupList',repNames:this.props.repNames}),o.createElement(r,{loading:ca})));},_handleScroll:function(){if(this.refs.scrollable.scrollTop<s)this.props.onScrollTop();}});function v(aa,ba,ca){var da=aa.get('timestamp'),ea=function(ga){var ha=ga>=da,ia=!ca||ga<ca;return ha&&ia;},fa=ba.get('last-seen');if(ea(fa))aa=aa.set('ui-seen',true);return aa;}function w(aa,ba,ca){var da=ba.groupsList,ea=ba.nextTimestamp;ca=v(ca,aa,ea);var fa=ca.get('author'),ga=ca.get('timestamp'),ha=i.authorType(ca),ia=da[0],ja=ia&&ia[ia.length-1],ka=ja&&ja.get('author'),la=ja?ja.get('timestamp'):Infinity,ma=ja&&i.authorType(ja);if(ka!==fa||la-ga>60000||ma!==ha){da.unshift([ca]);}else ia.unshift(ca);return {groupsList:da,nextTimestamp:ga};}function x(aa,ba){var ca=aa.last(),da=ba.last();return da.get('timestamp')>ca.get('timestamp');}function y(aa){return aa.scrollHeight-aa.scrollTop===aa.clientHeight;}function z(aa){aa.scrollTop=aa.scrollHeight;}f.exports=u;},null);
__d('OzReminderNotesField.react',['OzIntentParamsTextField.react','ReactComponentWithPureRenderMixin','React','debounce'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=j.createClass({displayName:'OzReminderNotesField',mixins:[i],propTypes:{seedNotes:l.string,onSave:l.func.isRequired},getInitialState:function(){return {notes:this.props.seedNotes||''};},componentWillMount:function(){this._save=k(this._save,750,this,true);},render:function(){return (j.createElement(h,{label:'Add notes about this reminder...',onChange:this._handleChange,value:this.state.notes}));},_handleChange:function(n){this.setState({notes:n},this._save);},_save:function(){this.props.onSave(this.state.notes);}});f.exports=m;},null);
__d('OzReminder.react',['OzAPI','OzHelpers','Event','immutable','OzIntentParamsAbstractField.react','OzIntentParamsStringField.react','OzReminderNotesField.react','OzSidebarItemHeader.react','ReactComponentWithPureRenderMixin','React','XUICloseButton.react','cx','formatDate','invariant'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';if(c.__markCompiled)c.__markCompiled();var v=k.List,w=k.Map,x=q.PropTypes,y=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],z=q.createClass({displayName:'OzReminder',mixins:[p],propTypes:{ReminderEditor:x.func.isRequired,onClose:x.func.isRequired,onEdit:x.func.isRequired,onOpen:x.func.isRequired,onSnooze:x.func.isRequired,reminder:x.instanceOf(w).isRequired,repNames:x.instanceOf(w).isRequired},getInitialState:function(){return {isExpanded:i.isUrgentReminder(this.props.reminder)};},_listener:null,componentWillReceiveProps:function(ba){if(ba.reminder.get('id')===this.props.reminder.get('id')&&i.isUrgentReminder(ba.reminder)&&!i.isUrgentReminder(this.props.reminder))this.setState({isExpanded:true});},componentWillUnmount:function(){this._listener&&this._listener.remove();},render:function(){var ba=this.props,ca=ba.ReminderEditor,da=ba.onEdit,ea=ba.onSnooze,fa=ba.reminder,ga=ba.repNames,ha=fa.getIn(['body','description']),ia=i.isUrgentReminder(fa),ja=fa.getIn(['body','suggestion']),ka=fa.get('state')==='closed',la=fa.get('creator-fbid'),ma=ga.get(la,la);return (q.createElement('div',{className:"_wc0"+(ia?' '+"_wc2":'')+(i.isPaidReminder(fa)?' '+"_3d-l":'')+(ka?' '+"_3d-m":'')},q.createElement(o,{className:"_1k8u",creator:ma,isClosed:ka,isExpanded:this.state.isExpanded,onIsExpandedToggle:this._handleIsExpandedToggle,onToggle:this._handleToggle,subtitle:i.isSnoozedReminder(fa)?'(snoozed)':null,title:ha||aa(ja)},ia?q.createElement('button',{className:"_1-hv _260v _260w",alt:'Snooze',onClick:function(na){return ea(fa);}}):null,q.createElement(ca,{onSave:da,seedReminder:fa},q.createElement('a',{className:"_260y"},q.createElement('i',{className:"_5x82"})))),this._renderBody()));},_renderBody:function(){if(!this.state.isExpanded)return null;var ba=this.props.reminder,ca=ba.get('scheduled-time'),da=ba.get('last-fired'),ea=ba.get('state')==='closed',fa=i.isUrgentReminder(ba),ga=ba.get('state')==='snoozed'&&da||ca>i.serverNow()&&ca,ha=(fa||ea)&&da,ia=ba.get('days');return (q.createElement('div',{className:"_wc3"},q.createElement('div',{className:"_1k8v _3-ue"},this._renderPayment(ba),ha?q.createElement(l,{label:'Fired On'},q.createElement('span',null,t(new Date(ha),'M jS, g:ia'))):null,ga?q.createElement(l,{label:'Will Fire On'},q.createElement('span',null,t(new Date(ga),'M jS, g:ia'))):null,ia&&!ia.isEmpty()?q.createElement(l,{label:'Recurs'},q.createElement('span',null,ia.size===7?'Every Day':ia.sort().map(function(ja){return y[ja%7];}).toArray().join(' '))):null,q.createElement(n,{seedNotes:ba.get('notes')||ba.getIn(['body','description']),onSave:this._handleNotesSave}))));},_renderPayment:function(ba){var ca=ba.getIn(['body','suggestion']);if(!ca)return null;var da=ba.getIn(['body','credit-card']),ea=ca.get('name');return (q.createElement('div',null,q.createElement(l,{label:'Link'},q.createElement('div',{className:"_3d-q"},q.createElement('a',{className:"_3d-r",target:'_blank',href:ca.get('target-url'),title:ca.get('description')},'Click here to view ',ea),da?q.createElement('a',{className:"_3d-s",href:'#',title:'Show credit card information',onClick:this._handlePaymentLinkClick}):null)),q.createElement(m,{label:'Confirmation #',onSave:this._handleItemNumberSave,placeholder:'Confirmation number',value:ba.getIn(['body','item-number'])||''})));},_handleIsExpandedToggle:function(){this.setState({isExpanded:!this.state.isExpanded});},_handleNotesSave:function(ba){this.props.onEdit(this.props.reminder.set('notes',ba));},_handleItemNumberSave:function(ba){this.props.onEdit(this.props.reminder.setIn(['body','item-number'],ba));},_handleToggle:function(ba){var ca=this.props,da=ca.onClose,ea=ca.onOpen,fa=ca.reminder;ba?da(fa):ea(fa);},_handlePaymentLinkClick:function(ba){var ca=this.props.reminder.getIn(['body','credit-card']);if(!ca)return;var da=this.props.reminder.getIn(['body','suggestion','amount'])/100,ea=ca.get('number'),fa=ca.get('cvv'),ga=ca.get('month'),ha=ca.get('year'),ia=ca.get('zip');h.notifyExtension({action:'show',title:'Temporary Credit Card Information',desc:'Amount: $'+da+' Number: '+ea+' cvv: '+fa+' zip: '+ia,html:'Amount: $'+da+'<br/>\n      Number: '+ea+'<br/>\n      CVV: '+fa+'<br/>\n      Month: '+ga+'<br/>\n      Year: '+ha,id:ea,timeout:0,picture:'https://cdn4.iconfinder.com/data/icons/simple-peyment-methods/512/mastercard-128.png'});}});function aa(ba){if(!ba)return null;var ca=ba.get('amount')/100,da=ba.get('name');return 'User paid $'+ca+' for '+da;}f.exports=z;},null);
__d('OzReminders.react',['OzConstants','OzAPI','cx','ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','DatePickerRestraints','OzHelpers','immutable','InputLabel.react','ReactLayeredComponentMixin','LayerHideOnBlur','MessengerButton.react','OzReminder.react','React','ReactDOM','ReactCSSTransitionGroup','XUIContextualDialog.react','XUIDateTimePicker.react','XUIError.react','onlyChild'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){if(c.__markCompiled)c.__markCompiled();var ba=h.REMINDERS,ca=o.List,da=o.Map,ea=o.Set,fa=u.PropTypes,ga=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],ha=o.fromJS({traffic:{label:'Include traffic update',params:[{name:'origin',placeholder:'Origin address',err:'What is the origin address?'},{name:'destination',placeholder:'Destination address',err:'What is the destination address?'}]},weather:{label:'Include weather forecast',params:[{name:'location',placeholder:'City',err:'What city is the forecast for?'},{name:'metric',placeholder:'Celsius or Fahrenheit',err:'You need to set Celsius or Fahrenheit'}]}}),ia=n.pure(function(ma){var na=ma.action,oa=ma.errors,pa=ma.onToggle,qa=ma.onUpdate,ra=ma.reminder,sa=!!ra.getIn(['actions',na]);return (u.createElement('div',null,u.createElement(p,null,u.createElement('input',{type:'checkbox',checked:sa,onChange:function(ta){return pa(ta,ra,na);}}),u.createElement('label',null,ha.getIn([na,'label']))),sa&&u.createElement('div',null,ha.getIn([na,'params']).map(function(ta){var ua=ta.get('name'),va=['actions',na,ua];return (u.createElement(z,{key:na+'-'+ua,xuiError:oa.getIn([na,ua])},u.createElement('input',{type:ta.get('type','text'),className:"_wbw",placeholder:ta.get('placeholder'),value:ra.getIn(va),onChange:function(wa){return qa(wa,va);}})));}).valueSeq())));}),ja=n.pure(function(ma){var na=ma.reminder,oa=ma.errors,pa=ma.onToggle,qa=ma.onUpdate;return (u.createElement('div',null,u.createElement('h3',{className:"_17f0"},'Actions'),ha.keySeq().map(function(ra){return (u.createElement(ia,{key:ra,action:ra,reminder:na,errors:oa,onToggle:pa,onUpdate:qa}));}).valueSeq()));}),ka=u.createClass({displayName:'ReminderEditor',mixins:[q],propTypes:{onSave:fa.func.isRequired,seedReminder:fa.instanceOf(da)},getInitialState:function(){return {shown:false,reminder:this.props.seedReminder||da(),errors:da()};},componentWillReceiveProps:function(ma){if(!o.is(ma.seedReminder,this.props.seedReminder))this.setState({reminder:ma.seedReminder,errors:da()});},render:function(){var ma=aa(this.props.children);return u.cloneElement(ma,{onClick:function(na){return this.setState({shown:!this.state.shown});}.bind(this)});},renderLayers:function(){var ma=this.state,na=ma.shown,oa=ma.reminder,pa=ma.errors;if(!na)return null;var qa=ea(oa.get('days'));return {contextualDialog:u.createElement(x,{behaviors:{ContextualLayerAutoFlip:k,ContextualLayerUpdateOnScroll:l,LayerHideOnBlur:r},position:'below',shown:na,context:v.findDOMNode(this),onToggle:function(ra){return this.setState({shown:ra});}.bind(this)},u.createElement('ul',{className:"_3ssq"},u.createElement('div',{className:"_wbu"},u.createElement(y,babelHelpers['extends']({xuiError:pa.get('scheduled-time'),className:"_wbv",date:new Date(oa.get('scheduled-time',n.serverNow())),allowDuplicateDateSelection:true,onChange:function(ra){this.setState({reminder:oa.set('scheduled-time',+ra)});}.bind(this)},n.dateRestraints())),u.createElement(z,{xuiError:pa.get('description')},u.createElement('input',{ref:'input',className:"_wbw",placeholder:'Describe the Reminder',value:oa.getIn(['body','description']),onChange:function(ra){this.setState({reminder:oa.setIn(['body','description'],ra.target.value)});}.bind(this)})),u.createElement('h3',{className:"_17f0"},'Recurrence'),ga.map(function(ra,sa){var ta=sa+1;return (u.createElement(p,{key:sa},u.createElement('input',{type:'checkbox',checked:qa.has(ta),onChange:function(ua){var va=ua.target.checked?qa.add(ta):qa['delete'](ta);this.setState({reminder:oa.set('days',va.toList())});}.bind(this)}),u.createElement('label',null,ra)));}.bind(this)),u.createElement(ja,{reminder:oa,errors:pa,onToggle:this._handleActionToggle,onUpdate:this._handleActionUpdate}),u.createElement('div',{className:"_wbz"},u.createElement(s,{label:this.props.seedReminder?'Update Reminder':'Add Reminder',onClick:this._handleSave,type:'primary'})))))};},_handleActionToggle:function(ma,na,oa){var pa=ma.target.checked?na.set('actions',da([[oa,da()]])):na['delete']('actions');this.setState({reminder:pa});},_handleActionUpdate:function(ma,na){this.setState({reminder:this.state.reminder.setIn(na,ma.target.value)});},_handleSave:function(){var ma=this.state.reminder,na=ma.get('scheduled-time'),oa=function(ra){return !!ma.getIn(['actions',ra]);},pa=da(),qa=n.dateRestraints().dateRestraints;if(!na){pa=pa.set('scheduled-time','When would you like the reminder?');}else if(na<n.serverNow()+60*1000){pa=pa.set('scheduled-time','Reminders should be in the future!');}else if(!m.isValidDate(new Date(na),qa))pa=pa.set('scheduled-time','Reminder is outside of the '+ba.RANGE_IN_YEARS+' year range');if(!ma.getIn(['body','description']))pa=pa.set('description','What is the reminder about?');pa=ha.reduce(function(ra,sa,ta){if(oa(ta))ra=sa.get('params').reduce(function(ua,va){return ma.getIn(['actions',ta,va.get('name')])?ua:ua.setIn([ta,va.get('name')],va.get('err'));},ra);return ra;},pa);this.setState({errors:pa});if(pa.size)return;this.setState({reminder:da(),shown:false},function(ra){return this.props.onSave(ma);}.bind(this));}}),la=u.createClass({displayName:'OzReminders',propTypes:{isHistory:fa.bool,repNames:fa.instanceOf(da).isRequired,thread:fa.object.isRequired},render:function(){return (u.createElement('div',{className:"_1x92"},u.createElement('h2',{className:"_1x93"},'Reminders'),this._renderReminders(),!this.props.isHistory?u.createElement(ka,{onSave:this._handleCreate},u.createElement('a',{className:"_59jg"},u.createElement('div',{className:"_4nd4"}),u.createElement('span',{className:"_59jh"},'Add a reminder...'))):null));},_handleCreate:function(ma){i.createReminder(n.threadID(this.props.thread),ma);},_handleClose:function(ma){i.closeReminder(n.threadID(this.props.thread),ma.get('id'),!!ma.get('days')&&ma.get('state')==='pending');},_handleEdit:function(ma){i.editReminder(n.threadID(this.props.thread),ma);},_handleOpen:function(ma){i.editReminder(n.threadID(this.props.thread),ma.set('state','pending'));},_handleSnooze:function(ma){i.snoozeReminder(n.threadID(this.props.thread),ma.get('id'));},_renderReminders:function(){var ma=this.props,na=ma.isHistory,oa=ma.repNames,pa=ma.thread,qa=pa.get('reminders',ca()).sortBy(function(ra){return ra.get('last-fired')||ra.get('scheduled-time');}).toSeq().filter(function(ra){return na?ra.get('state')==='closed':ra.get('state')!=='closed';}).map(function(ra){return (u.createElement(t,{ReminderEditor:ka,key:ra.get('id'),onClose:this._handleClose,onEdit:this._handleEdit,onOpen:this._handleOpen,onSnooze:this._handleSnooze,reminder:ra,repNames:oa}));}.bind(this));return (u.createElement('div',{className:"_wc7"},u.createElement(w,{transitionName:'oz-fade-in-out',transitionEnterTimeout:300,transitionLeaveTimeout:300},qa)));}});f.exports=la;},null);
__d('OzThreadMeta.react',['OzAPI','cx','OzHelpers','immutable','Keys','MessengerButton.react','OzFormPreview.react','OzThreadLabels.react','OzSwitch.react','ReactComponentWithPureRenderMixin','React','Tooltip'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=k.Map,u=n.Row,v=o.OzUnderageLabel,w=r.PropTypes,x=r.createClass({displayName:'OzThreadMeta',mixins:[q],propTypes:{thread:w.object.isRequired,repNames:w.instanceOf(t).isRequired},getInitialState:function(){return {newMeta:null,muted:fa(this.props.thread)};},componentWillReceiveProps:function(ga){if(j.threadID(ga.thread)!==j.threadID(this.props.thread)){this.setState({newMeta:null,muted:fa(ga.thread),locked:ga.thread.get('locked')});}else this.setState({muted:fa(ga.thread),locked:ga.thread.get('locked')});},render:function(){return (r.createElement('div',{className:"_56t0"+(this.state.newMeta?' '+"_56t1":'')},r.createElement(y,{thread:this.props.thread,buttons:this.state.newMeta?[['Cancel','secondary',this._handleCancel],['DONE','primary',this._handleDone]]:[['Edit','primary',this._handleEdit]]}),this.state.newMeta?r.createElement(ca,{meta:this.state.newMeta,onCancel:this._handleCancel,onChange:this._handleChange,onDone:this._handleDone,onMutedToggle:this._handleMutedToggle,isMuted:this.state.muted}):r.createElement(aa,{meta:ea(this.props.thread),onMutedToggle:this._handleMutedToggle,isMuted:this.state.muted}),r.createElement(ba,{thread:this.props.thread,repNames:this.props.repNames,locked:!!this.state.locked,onToggle:this._handleThreadLockToggle})));},_handleEdit:function(){this.setState({newMeta:ea(this.props.thread)});},_handleCancel:function(){this.setState({newMeta:null});},_handleDone:function(){h.saveMeta(j.threadID(this.props.thread),this.state.newMeta);this.setState({newMeta:null});},_handleChange:function(ga){this.setState({newMeta:ga});},_handleMutedToggle:function(ga){h.saveMuted(j.threadID(this.props.thread),!ga);this.setState({muted:!ga});},_handleThreadLockToggle:function(ga){var ha=this.props.thread,ia=j.threadID(ha);if(this.state.locked){this.setState({locked:false});h.unlockThread(ia,ha.get('locked-at'));}else{this.setState({locked:true});h.lockThread(ia);}}}),y=j.pure(function(ga){var ha=ga.thread,ia=ga.buttons;return (r.createElement('div',{className:"_56t2"},r.createElement('div',{className:"_56t6"},r.createElement('h2',{className:"_56tb"},j.getName(ha)),r.createElement('div',{className:"_56tc"},ia.map(function(ja,ka){var la=ja[0],ma=ja[1],na=ja[2];return (r.createElement(m,{key:la,label:la,type:ma,onClick:na}));}))),r.createElement('div',{className:"_56td"},r.createElement(v,{thread:ha}))));}),z=j.pure(function(ga){var ha=ga.isMuted,ia=ga.onMutedToggle,ja=function(ma){ia(ha);},ka='Uncheck if person dislikes our proactive messages, e.g. surveys',la=r.createElement('span',s.propsFor(ka),'Proactive?');return (r.createElement(u,{label:la},r.createElement('input',{type:'checkbox',checked:!ha,onChange:ja})));}),aa=j.pure(function(ga){var ha=ga.meta,ia=ga.isMuted,ja=ga.onMutedToggle,ka=(ha.get('address1','')+' '+ha.get('address2','')+'\n     '+ha.get('city','')+' '+ha.get('state','')+' '+ha.get('zip','')+'\n    ').trim();return (r.createElement(n,null,r.createElement(u,{label:'Nickname'},ha.get('preferred-name')),r.createElement(u,{label:'Email'},ha.get('email')),r.createElement(u,{label:'Phone'},ha.get('phone')),r.createElement(u,{label:'Address'},ka),r.createElement(z,{isMuted:ia,onMutedToggle:ja})));}),ba=j.pure(function(ga){var ha=ga.thread,ia=ga.repNames,ja=ga.locked,ka=ga.onToggle,la=ia.get(ha.get('locker-id')),ma=la?(ha.get('locked')?'Locked':'Last locked')+' by '+la:'';ma+=ma&&ha.get('locked-at')?' at '+new Date(ha.get('locked-at')).toLocaleString():'';var na=r.createElement('span',s.propsFor(ma),ja?'Click to unlock thread':'Click to lock thread');return (r.createElement(p,{className:"_z1m",isAnimated:true,reverseColors:true,isOn:ja,label:na,onToggle:ka}));}),ca=r.createClass({displayName:'EditView',mixins:[q],propTypes:{meta:w.instanceOf(t).isRequired,onCancel:w.func.isRequired,onChange:w.func.isRequired,onDone:w.func.isRequired,isMuted:w.bool.isRequired,onMutedToggle:w.func.isRequired},componentDidMount:function(){this.refs['preferred-name'].focus();},render:function(){var ga=this._renderRow;return (r.createElement('form',{className:"_56to",onKeyDown:this._handleKeyDown},r.createElement(da,null,ga('Nickname','preferred-name','Add Preferred Name')),r.createElement(da,null,ga('Email','email','Add email')),r.createElement(da,null,ga('Phone','phone','Add phone')),r.createElement(da,null,ga('Street','address1','Add Street'),ga('Street','address2','Add Street'),ga('City','city','Add City'),ga('State','state'),ga('Zip Code','zip')),r.createElement(da,null,r.createElement(z,{isMuted:this.props.isMuted,onMutedToggle:this.props.onMutedToggle}))));},_handleKeyDown:function(ga){ga.which===l.ESC?this.props.onCancel():ga.which===l.RETURN?this.props.onDone():null;},_renderRow:function(ga,ha,ia){var ja=this.props,ka=ja.meta,la=ja.onChange;return (r.createElement(u,{label:ga},r.createElement('input',{ref:ha,type:'text',className:"_1-i0 _56uv",placeholder:ia,value:ka.get(ha),onChange:function(ma){return la(ka.set(ha,ma.target.value));}})));}}),da=j.pure(function(ga){var ha=ga.children;return r.createElement('div',{className:"_56vn"},ha);});function ea(ga){return ga.get('metadata-json')||t();}function fa(ga){return !!ga.get('muted');}f.exports=x;},null);
__d('OzThreadNote.react',['OzAPI','cx','getActiveElement','OzHelpers','immutable','OzConfig','OzRequirementTokenizer.react','React','Reflux'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=l.Map,r=o.PropTypes,s=1000,t=o.createClass({displayName:'OzThreadNote',mixins:[p.connect(m.ConfigStore,'config')],propTypes:{thread:r.instanceOf(q).isRequired,requirements:r.instanceOf(q).isRequired},getInitialState:function(){return {editedText:this.props.thread.get('notes')||'',requirementQuery:''};},componentWillReceiveProps:function(u){var v=u.thread.get('notes'),w=j()===this.refs.textarea;if(v!==this.props.thread.get('notes')&&!w)this.setState({editedText:v});},render:function(){return (o.createElement('div',{className:"_1x92"},o.createElement('h2',{className:"_1x93"},'Notes'),this.state.config.getIn(['GK','threadRequirements'])?o.createElement(n,{allRequirements:this.props.requirements,onCreateRequirement:this._handleCreateRequirement,onDeleteRequirement:this._handleDeleteRequirement,onQueryStringChange:this._handleQueryStringChange,queryString:this.state.requirementQuery,selectedRequirements:this.props.thread.get('requirements')}):null,o.createElement('textarea',{ref:'textarea',className:"_1x95",placeholder:'Leave a note',value:this.state.editedText,onChange:this._handleChange})));},_handleChange:function(){var u=this.props.thread,v=this.refs.textarea.value;this.setState({editedText:v});window.clearTimeout(this.timeout);this.timeout=window.setTimeout(function(){h.saveNote(k.threadID(u),v);},s);},_handleCreateRequirement:function(u){var v=this.props.thread;h.createThreadRequirement(k.threadID(v),u.getTitle());this.setState({requirementQuery:''});},_handleDeleteRequirement:function(u){var v=this.props.thread;h.deleteThreadRequirement(k.threadID(v),u.getUniqueID());this.setState({requirementQuery:''});},_handleQueryStringChange:function(u){this.setState({requirementQuery:u.target.value});}});f.exports=t;},null);
__d('OzTodoIntentList.react',['OzHelpers','immutable','OzIntentList.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=i.Map,n=l.PropTypes,o=l.createClass({displayName:'OzTodoIntentList',mixins:[k],propTypes:{repNames:n.instanceOf(m).isRequired,requirements:n.instanceOf(m).isRequired,thread:n.instanceOf(m).isRequired,witIntents:n.instanceOf(m).isRequired},render:function(){var p=h.openIntents(this.props.thread);return (l.createElement(j,{intents:p,repNames:this.props.repNames,requirements:this.props.requirements,threadID:h.threadID(this.props.thread),userEmail:h.userEmail(this.props.thread),witIntents:this.props.witIntents}));}});f.exports=o;},null);
__d('OzInboxShow.react',['Promise','OzStrings','OzAPI','cx','OzHelpers','immutable','OzNotify','OzActions','OzButton.react','OzComposer.react','OzConfig','OzConfirmDialog.react','OzConstants','OzHistoryIntentList.react','OzHumans','OzInboxMessageList.react','OzIntentCreator.react','OzReminders.react','OzStores','OzTabHeader.react','OzThreadLabels.react','OzThreadMeta.react','OzThreadNote.react','OzTimeline.react','OzTodoIntentList.react','OzUpdateDateTime.react','promiseFinally','ReactComponentWithPureRenderMixin','React','Reflux','relativeTimeString.atlas','Tooltip','XUISelector.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na){if(c.__markCompiled)c.__markCompiled();var oa=na.Option,pa=m.List,qa=m.Map,ra=ja.PropTypes,sa=t.AUTHOR_TYPES,ta=z.PendingMessageStateStore,ua=ba.OzLabelList,va=ka.createAction(),wa=ka.createStore({init:function(){this._data=qa();this.listenTo(va,this._onUpdateFetchState);},getInitialState:function(){return this._data;},_onUpdateFetchState:function(lb,mb){this._data=this._data.update(lb,function(nb){return (nb||qa()).merge(mb);});this.trigger(this._data);}}),xa='NO_OWNER',ya='TODO',za='HISTORY',ab=25,bb=25,cb=100,db=10000,eb=ja.createClass({displayName:'OzInboxShow',mixins:[ia,ka.connect(wa,'fetchStates'),ka.connect(ta,'pendingMessageState')],contextTypes:{uid:ra.string.isRequired},propTypes:{thread:ra.instanceOf(qa).isRequired,witIntents:ra.instanceOf(qa).isRequired,requirements:ra.instanceOf(qa).isRequired,merchants:ra.instanceOf(qa).isRequired,reps:ra.instanceOf(qa).isRequired,humans:ra.instanceOf(qa).isRequired},getInitialState:function(){return kb();},componentDidMount:function(){this._init(this.props);var lb=o.scrollThreadToTimestamp.listen(this._scrollToTimestamp);this._unlisten=function(){lb();};},componentWillReceiveProps:function(lb){if(l.threadID(lb.thread)!==l.threadID(this.props.thread)){l.debug('[inboxshow] thread changed');this._init(lb);}},_init:function(lb){var mb=lb.thread;o.updateThreads(pa([mb.set('ui-ping',false)]));o.activateThread(l.threadID(mb));var nb=l.openIntents(mb).sortBy(function(ob){return ob.get('created-at');}).reverse().first();if(nb)o.activateIntent(nb.get('id'));this._sendThreadFocus();this.setState(kb(),function(ob){if(ib(lb.thread).size<ab)this._fetchMessages();}.bind(this));},componentWillUnmount:function(){o.activateThread(null);this._unlisten();},render:function(){var lb=this.state,mb=lb.fetchStates,nb=lb.pendingMessageState,ob=lb.clientLimit,pb=lb.activeMsgID,qb=this.props,rb=qb.reps,sb=qb.thread,tb=qb.merchants,ub=qb.witIntents,vb=ib(sb),wb=l.threadID(sb),xb=nb.get(wb,0)>0,yb=rb.map(function(zb){return zb.get('name');});if(pb)l.debug('[inboxshow] Rendering with active msg id '+pb);return (ja.createElement('div',{className:"_1x8x"+(l.hasTag(sb,'employee')?' '+"_1yyg":'')+(l.hasEngage(sb)?' '+"_1fi":'')},ja.createElement(x,{thread:sb,witIntents:ub}),ja.createElement('div',{className:"_1x8y"},this._renderHistoryHeader(),ja.createElement('div',{className:"_1x96"},ja.createElement(w,{activeMsgID:pb,clientLimit:ob,loading:!!mb.getIn([wb,'loading']),onScrollTop:this._fetchMessages,messages:vb,ref:'messageList',repNames:yb,sending:xb,thread:sb})),ja.createElement('div',{className:"_237y"},ja.createElement(q,{merchants:tb,onResize:this._handleResize,thread:sb}))),r.getInStaticConfig(['GK','timeline'])?ja.createElement(ea,null):ja.createElement(fb,{activeTab:this.state.activeTab,humans:this.props.humans,onOwnerChange:this._handleOwnerChange,onTabChange:this._handleTabChange,repNames:yb,reps:rb,requirements:this.props.requirements,thread:sb,witIntents:this.props.witIntents})));},_sendThreadFocus:function(){var lb=this.props.thread,mb=l.threadID(lb),nb=l.openIntents(lb).getIn([0,'id']);mb&&nb&&j.threadFocus(mb,nb);},_scrollToTimestamp:function(lb){var mb=l.threadID(this.props.thread);l.debug('[inboxshow] received request to scroll to ts '+lb);this.setState({activeMsgID:null});this._backloadHistoryUntil(mb,lb)['catch'](function(nb){return o.doneScrollingToTimestamp(lb,true);}).then(function(nb){o.doneScrollingToTimestamp(lb);if(l.threadID(this.props.thread)!==mb){l.debug('[inboxshow] aborting scroll because thread changed');}else{this.setState({clientLimit:this.state.clientLimit+nb.size});var ob=nb.isEmpty()?ib(this.props.thread):nb,pb=l.msgID(ob.filter(function(qb){return l.authorType(qb)===sa.USER;}).findLast(function(qb){return qb.get('timestamp')<=lb;}));this._activateAndScrollToMsg(pb);}}.bind(this)).done();},_backloadHistoryUntil:function(lb,mb){var nb=function(rb,sb){return (j.history(lb,rb,cb).then(function(tb){var ub=jb(tb,rb);if(ub===rb||tb.isEmpty())throw ub;var vb=sb.merge(tb);l.debug('[inboxshow] got '+vb.size+'; dt='+(ub-mb));var wb=tb.filter(function(xb){return l.authorType(xb)===sa.USER;});return wb.some(function(xb){return xb.get('timestamp')<=mb;})?vb:nb(ub,sb.merge(tb));}));},ob=this.state.fetchStates.getIn([lb,'timestamp']),pb=this._unseenButLoadedMessages(),qb=ib(this.props.thread).filter(function(rb){return l.authorType(rb)===sa.USER;}).some(function(rb){return rb.get('timestamp')<=mb;});if(qb){l.debug('[inboxshow] desired timestamp '+mb+' already loaded');return new h(function(rb){return rb(pb);});}l.debug('[inboxshow] backloading to ts '+mb+' from '+ob);return this._withFetchState(lb,ob,nb(ob,qa())).then(function(rb){return rb.merge(pb).sortBy(function(sb){return sb.get('timestamp');});});},_activateAndScrollToMsg:function(lb){this.setState({activeMsgID:lb},function(mb){window.setTimeout(function(){if(this.state.activeMsgID===lb){l.debug('[inboxshow] CLEARING ACTIVE MSG ID');this.setState({activeMsgID:null});}}.bind(this),db);}.bind(this));},_withFetchState:function(lb,mb,nb){var ob=this.state.fetchStates.get(lb,qa());if(ob.get('loading')||ob.get('fetchedAll')){l.debug('[inboxshow] already loading or at beginning of time');return new h(function(pb){return pb();});}l.debug('[inboxshow] performing load');va(lb,qa({loading:true}));return ha(nb,function(pb){return va(lb,qa({loading:false}));}).then(function(pb){var qb=jb(pb,mb||Infinity);l.debug('[inboxshow] loaded '+pb.size+'; ts='+qb);va(lb,qa({fetchedAll:pb.isEmpty()||qb===mb,timestamp:qb}));return pb;});},_unseenButLoadedMessages:function(){return ib(this.props.thread).skipLast(this.state.clientLimit);},_fetchMessages:function(){var lb=l.threadID(this.props.thread),mb=this.state.fetchStates.getIn([lb,'timestamp']);this.setState({clientLimit:this.state.clientLimit+ab});if(!this._unseenButLoadedMessages().isEmpty()){l.debug('[inboxshow] using client cache instead of fetch');return;}this._withFetchState(lb,mb,j.history(lb,mb,bb)).done();},_handleTabChange:function(lb){var mb=lb[0],nb=lb[1];this.setState({activeTab:nb});},_handleGrab:function(){j.grab(l.threadID(this.props.thread));},_handleResize:function(){this.refs.messageList.resize();},_handleOwnerChange:function(lb){var mb=lb.value;if(mb&&mb!==xa){var nb=this.props.reps.get(mb),ob=this.props.thread,pb=l.threadID(ob);if(nb.get('is-coach')&&!l.isEscalated(ob)){j.escalateTo(pb,mb);}else j.assignTo(pb,mb);if(!nb.get('is-coach')&&l.isEscalated(ob)){var qb='Please remove the "Escalated" tag to prevent the '+'thread from getting reassigned to a coach';n.warn(qb);}}},_renderHistoryHeader:function(){var lb=this.props.thread,mb=l.threadID(lb),nb=l.hasTag(lb,'employee')||l.hasEngage(lb)?'light':'dark',ob=function(sb,tb){return ja.createElement(p,{onClick:tb},sb);},pb=function(sb){return function(tb){l.isOwner(lb,this.context.uid)?sb():o.showDialog(s,{onConfirm:sb,body:'You don\'t own this thread. If you proceed, the user '+'may be forgotten until they message us again.',header:'Are you sure this user doesn\'t need to be engaged?'});}.bind(this);}.bind(this),qb=l.locationLastSeen(lb),rb=qa({hour:'numeric',minute:'numeric'});return (ja.createElement('div',{className:"_1q4l"},ja.createElement('div',{className:"_4l-w"},ja.createElement('h2',{className:"_1q4m"},l.getName(lb)),ja.createElement('div',{className:"_29x1"},lb.getIn(['location','timezone'])?ja.createElement('span',ma.propsFor('at the user\'s last known location, updated '+la(+qb,true),'below'),ja.createElement(ga,{locale:'en-US',options:rb,timezoneOffset:lb.getIn(['location','timezone-offset'],0)}),' ('+lb.getIn(['location','timezone'])+')'):ja.createElement('span',null,'(location unknown)'))),ja.createElement('div',{className:"_1q4n"},ja.createElement(ua,{className:"_1q4o",thread:lb,shade:nb,removable:true,addable:true}),ja.createElement('div',{className:"_1q4p"},l.hasEngage(lb)&&ob('No need to engage',pb(function(sb){return j.notready(mb);}))||lb.get('ready')&&ja.createElement(p,{disabled:'true'},i.READY_BUTTON)||ja.createElement(p,{disabled:'true'},i.IS_NOTREADY)))));}}),fb=ja.createClass({displayName:'OzThreadPanel',mixins:[ia],propTypes:{activeTab:ra.oneOf([ya,za]).isRequired,onTabChange:ra.func.isRequired,repNames:ra.instanceOf(qa).isRequired,reps:ra.instanceOf(qa).isRequired,requirements:ra.instanceOf(qa).isRequired,thread:ra.instanceOf(qa).isRequired,witIntents:ra.instanceOf(qa).isRequired},render:function(){var lb=this.props,mb=lb.thread,nb=lb.activeTab,ob=lb.repNames,pb=lb.reps,qb=lb.humans,rb=lb.onTabChange,sb=lb.onOwnerChange,tb={onOwnerChange:sb,humans:qb,reps:pb,thread:mb};return (ja.createElement('div',{className:"_1x8z"},ja.createElement(gb,tb),ja.createElement(aa,{active:nb,tabs:[['Todo',ya],['History',za]],onChange:rb}),ja.createElement('div',{className:"_ra0"},ja.createElement('div',{className:"_4fj7"},this._renderTab())),ja.createElement(ca,{thread:mb,repNames:ob})));},_renderTab:function(){var lb=this.props,mb=lb.activeTab,nb=lb.repNames,ob=lb.requirements,pb=lb.thread,qb=lb.witIntents,rb={repNames:nb,requirements:ob,thread:pb,witIntents:qb};switch(mb){case ya:return (ja.createElement('span',null,ja.createElement(fa,rb),ja.createElement(y,{repNames:nb,thread:pb}),ja.createElement(da,{key:l.threadID(pb),thread:pb,requirements:ob})));case za:return (ja.createElement('span',null,ja.createElement(u,rb),ja.createElement(y,{isHistory:true,repNames:nb,thread:pb})));}}}),gb=l.pure(function(lb){var mb=lb.onOwnerChange,nb=lb.humans,ob=lb.reps,pb=lb.thread,qb=pb,rb=l.nameOrId(qb.get('last-owner')).split(' ')[0];return (ja.createElement('div',{className:"_1q4e"},ob&&!ob.isEmpty()?ja.createElement(hb,{onChange:mb,value:qb.getIn(['owner','id'])||xa,reps:ob,humans:nb}):null,ja.createElement('span',{className:"_3yre"},rb?'Last owner: '+rb:null)));}),hb=l.pure(function(lb){var mb=lb.reps,nb=lb.humans,ob=lb.value,pb=lb.onChange,qb=mb.toSeq().filter(function(ub){return v.isActive(nb.get(ub.get('fbid')));}).sortBy(function(ub){return ub.get('name');}).map(function(ub){var vb=ub.get('fbid'),wb=ub.get('is-coach',false)?"_4i62":'';return (ja.createElement(oa,{key:vb,value:vb},ja.createElement('span',{className:wb},ub.get('name'))));}),rb=qb.get(ob);qb=qb.valueSeq();if(!rb){var sb=mb.get(ob,qa()),tb=sb.get('is-coach',false)?"_4i62":'';qb=qb.toList().unshift(ja.createElement(oa,{key:'current',value:ob},ja.createElement('span',{className:tb},sb.get('name','None'))));}return (ja.createElement(na,{size:'medium',value:ob,onChange:pb,maxheight:500},qb));}),ib=l.memoize(function(lb){return lb.get('messages').sortBy(function(mb){return mb.get('timestamp');});},function(lb){return lb.get('messages').hashCode();});function jb(lb,mb){return lb.map(function(nb){return nb.get('timestamp');}).reduce(function(nb,ob){return Math.min(nb,ob);},mb);}function kb(){return {activeMsgID:null,activeTab:ya,clientLimit:ab};}f.exports=eb;},null);
__d('OzIntentDashboardUUIDFilter.react',['immutable','ReactComponentWithPureRenderMixin','React','XUISingleSelector.react'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=h.Map,m=j.PropTypes,n=k.Option,o=j.createClass({displayName:'OzIntentDashboardUUIDFilter',mixins:[i],propTypes:{intentMetas:m.instanceOf(l).isRequired,onUUIDChange:m.func.isRequired,uuid:m.string},render:function(){return (j.createElement(k,{maxheight:400,onChange:this._handleUUIDChange,value:this.props.uuid||'__none__'},j.createElement(n,{value:'__none__'},'Select an intent category'),p(this.props.intentMetas).valueSeq().map(function(r){return (j.createElement(n,{key:r.get('id'),value:r.get('id')},r.get('name')));})));},_handleUUIDChange:function(r){this.props.onUUIDChange(q(r.value));}});function p(r){return r.sortBy(function(s){return s.get('name');});}function q(r){return r!=='__none__'?r:undefined;}f.exports=o;},null);
__d('OzIntentDashboardFilters.react',['immutable','InputLabel.react','OzIntentDashboardUUIDFilter.react','OzTriSwitch.react','ReactComponentWithPureRenderMixin','React','XUISingleSelector.react','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=h.Map,q=m.PropTypes,r=n.Option,s=k.fromBoolean,t=k.toBoolean,u=m.createClass({displayName:'OzIntentDashboardFilters',mixins:[l],propTypes:{intentMetas:q.instanceOf(p).isRequired,isEmployee:q.bool,isReversed:q.bool.isRequired,onIsEmployeeChange:q.func.isRequired,onIsReversedChange:q.func.isRequired,onSortByChange:q.func.isRequired,onUUIDChange:q.func.isRequired,sortBy:q.string,sortableFields:q.instanceOf(p).isRequired,uuid:q.string},render:function(){return (m.createElement('ul',{className:"_1bo-"},m.createElement('li',null,this._renderUUIDFilter()),m.createElement('li',null,this._renderSortByFilter()),m.createElement('li',null,this._renderIsReversedFilter()),m.createElement('li',null,this._renderIsEmployeeFilter())));},_renderUUIDFilter:function(){return (m.createElement(j,{intentMetas:this.props.intentMetas,onUUIDChange:this.props.onUUIDChange,uuid:this.props.uuid}));},_renderIsEmployeeFilter:function(){return (m.createElement(k,{animated:true,label:'Employee?',onClick:function(w){this.props.onIsEmployeeChange(t(w));}.bind(this),value:s(this.props.isEmployee)}));},_renderIsReversedFilter:function(){return (m.createElement(i,null,m.createElement('input',{checked:this.props.isReversed,onChange:function(w){this.props.onIsReversedChange(w.target.checked);}.bind(this),type:'checkbox'}),m.createElement('label',null,'Reversed?')));},_renderSortByFilter:function(){return (m.createElement(n,{maxheight:400,onChange:this._handleSortByChange,value:this.props.sortBy||'__none__'},m.createElement(r,{value:'__none__'},'Select a field to sort by'),this.props.sortableFields.map(function(w,x){return (m.createElement(r,{key:x,value:x},w));}).valueSeq()));},_handleSortByChange:function(w){this.props.onSortByChange(v(w.value));}});function v(w){return w!=='__none__'?w:undefined;}f.exports=u;},null);
__d('OzIntentDashboardEventsDialog.react',['DialogFitHeight','immutable','InputLabel.react','ReactComponentWithPureRenderMixin','React','XUIDialog.react','XUIDialogBody.react','XUIDialogFooter.react','XUIDialogOkayButton.react','XUIDialogTitle.react','XUITable.react','cx','formatDate','ozFormatTime'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';if(c.__markCompiled)c.__markCompiled();var v=i.Map,w=l.PropTypes,x=l.createClass({displayName:'OzIntentDashboardEventsDialog',mixins:[k],propTypes:{intent:w.instanceOf(v).isRequired,onToggle:w.func.isRequired,shown:w.bool.isRequired},getInitialState:function(){return {isFiltered:true};},render:function(){return (l.createElement(m,{behaviors:{DialogFitHeight:h},onToggle:this.props.onToggle,shown:this.props.shown,width:900},l.createElement(q,null,l.createElement('span',null,'Events for Intent  ',this.props.intent.get('id'))),l.createElement(n,null,l.createElement(j,null,l.createElement('input',{checked:this.state.isFiltered,onChange:function(ba){this.setState({isFiltered:ba.target.checked});}.bind(this),type:'checkbox'}),l.createElement('label',null,'Filter Non-Message Events?')),this._renderTable()),l.createElement(o,null,l.createElement(p,{use:'confirm',action:'cancel'}))));},_renderTable:function(){return (l.createElement(r,{className:"_4m7c",outerBorder:true},l.createElement('thead',null,l.createElement('tr',null,l.createElement('th',null,'Agent ID'),l.createElement('th',null,'Type'),l.createElement('th',null,'Time'),l.createElement('th',null,'Since Start'),l.createElement('th',null,'Text/Data'),l.createElement('th',null,'Attachment'))),l.createElement('tbody',null,this._getEvents().map(this._renderRow))));},_renderRow:function(event,ba,ca){var da=event.get('type'),ea=event.get('from-m?'),fa=ca.first().get('time'),ga=event.get('time');return (l.createElement('tr',{key:ba},l.createElement('td',null,event.get('agent-id')),l.createElement('td',null,da),l.createElement('td',{className:"_4m7d"},z(ga)),l.createElement('td',null,u((ga-fa)/1000)),l.createElement('td',{className:"_4m7e"+(da==='send'&&ea?' '+"_4m7j":'')},y(event)),l.createElement('td',null,aa(event.get('attachment')))));},_getEvents:function(){var ba=this.props.intent.get('events').toSeq();if(this.state.isFiltered)ba=ba.filter(function(event){var ca=event.get('type');return ca==='send'||ca==='message';});return ba;}});function y(event){var ba=event.get('text'),ca=event.get('data');return ba?ba:ca&&JSON.stringify(ca.toJS());}function z(ba){return t(ba/1000,'M d, Y g:ia');}function aa(ba){if(ba==null)return ba;var ca=JSON.parse(ba);return (l.createElement('a',{href:ca.uri,target:'_blank'},'Source'));}f.exports=x;},null);
__d('OzIntentDashboardRow.react',['immutable','ReactLayeredComponentMixin','OzIntentDashboardEventsDialog.react','ReactComponentWithPureRenderMixin','React','ReactRouter','formatDate','ozFormatTime'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=h.Map,q=m.Link,r=l.PropTypes,s=l.createClass({displayName:'OzIntentDashboardRow',mixins:[i,k],propTypes:{intent:r.instanceOf(p).isRequired,intentMeta:r.instanceOf(p)},getInitialState:function(){return {isDialogOpen:false};},render:function(){var v=this.props,w=v.intent,x=v.intentMeta,y=w.get('user-vcard')||p();return (l.createElement('tr',null,l.createElement('td',null,w.get('id')),l.createElement('td',null,l.createElement(q,{to:'/inbox/'+w.get('user-id')},y.get('name',w.get('user-id')))),l.createElement('td',null,u(y)),l.createElement('td',null,x&&x.get('name')),l.createElement('td',null,w.get('state')),l.createElement('td',null,t(w.get('created-at'))),l.createElement('td',null,o(w.get('total-time'))),l.createElement('td',null,this._renderEventsLink())));},renderLayers:function(){if(!this.state.isDialogOpen)return {};return {dialog:l.createElement(j,{intent:this.props.intent,onToggle:this._handleDialogToggle,shown:this.state.isDialogOpen})};},_renderEventsLink:function(){var v=this.props.intent.get('events');if(!v||v.isEmpty())return l.createElement('span',null,'None');return (l.createElement('a',{href:'#',onClick:this._handleEventsLinkClick},'Click to View'));},_handleDialogToggle:function(v){this.setState({isDialogOpen:v});},_handleEventsLinkClick:function(v){v.preventDefault();this.setState({isDialogOpen:true});}});function t(v){return n(v/1000,'M d, Y g:ia');}function u(v){var w=v.get('is-employee');return w==null?'UNKNOWN':w?'YES':'NO';}f.exports=s;},null);
__d('OzIntentDashboard.react',['immutable','MessengerFlexScrollableArea.react','OzIntentDashboardFilters.react','OzIntentDashboardRow.react','ReactComponentWithPureRenderMixin','React','XUITable.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=h.List,p=h.Map,q=m.PropTypes,r=p({id:'ID',state:'Status','created-at':'Created At','total-time':'Time Spent'}),s=m.createClass({displayName:'OzIntentDashboard',mixins:[l],propTypes:{intentMetas:q.instanceOf(p).isRequired,intents:q.instanceOf(o).isRequired,isEmployee:q.bool,isLoaded:q.bool.isRequired,isLoading:q.bool.isRequired,isReversed:q.bool.isRequired,onFetchRequest:q.func.isRequired,onIsEmployeeChange:q.func.isRequired,onIsReversedChange:q.func.isRequired,onSortByChange:q.func.isRequired,onUUIDChange:q.func.isRequired,sortBy:q.string,uuid:q.string},render:function(){return (m.createElement(i,{onScroll:this._handleScroll,ref:'scrollable'},m.createElement(j,{intentMetas:this.props.intentMetas,isEmployee:this.props.isEmployee,isReversed:this.props.isReversed,onIsEmployeeChange:this.props.onIsEmployeeChange,onIsReversedChange:this.props.onIsReversedChange,onSortByChange:this.props.onSortByChange,onUUIDChange:this.props.onUUIDChange,sortBy:this.props.sortBy,sortableFields:r,uuid:this.props.uuid}),this._renderTable(),this._renderLoadMoreLink()));},_renderTable:function(){var t=this.props.intentMetas;return (m.createElement(n,{outerBorder:false},m.createElement('thead',null,m.createElement('tr',null,m.createElement('th',null,'ID'),m.createElement('th',null,'User Name'),m.createElement('th',null,'Employee?'),m.createElement('th',null,'Intent'),m.createElement('th',null,'Status'),m.createElement('th',null,'Created At'),m.createElement('th',null,'Time Spent'),m.createElement('th',null,'Events'))),m.createElement('tbody',null,this.props.intents.map(function(u){return (m.createElement(k,{intent:u,intentMeta:t.get(u.get('wit-intent-uuid')),key:u.get('id')}));}))));},_renderLoadMoreLink:function(){if(this.props.isLoaded)return null;if(this.props.isLoading)return m.createElement('div',null,'Loading...');return (m.createElement('div',null,m.createElement('a',{href:'#',onClick:function(t){t.preventDefault();this.props.onFetchRequest();}.bind(this)},'Fetch More Intents')));},_handleScroll:function(){if(!this.props.isLoading&&!this.props.isLoaded&&this.refs.scrollable&&this.refs.scrollable.isScrolledToBottom())this.props.onFetchRequest();}});f.exports=s;},null);
__d('OzIntentDashboardContainer.react',['immutable','OzAPI','OzIntentDashboard.react','React'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=h.List,m=h.Map,n=k.PropTypes,o=30,p={intents:l(),isLoaded:false,offset:0},q=k.createClass({displayName:'OzIntentDashboardContainer',propTypes:{witIntents:n.instanceOf(m).isRequired},getInitialState:function(){return babelHelpers['extends']({},p,{isEmployee:undefined,isLoading:false,isReversed:false,sortBy:undefined,uuid:undefined});},componentDidMount:function(){this._handleFetchRequest();},render:function(){return (k.createElement(j,{intentMetas:this.props.witIntents,intents:this.state.intents,isEmployee:this.state.isEmployee,isLoaded:this.state.isLoaded,isLoading:this.state.isLoading,isReversed:this.state.isReversed,onFetchRequest:this._handleFetchRequest,onIsEmployeeChange:this._handleIsEmployeeChange,onIsReversedChange:this._handleIsReversedChange,onSortByChange:this._handleSortByChange,onUUIDChange:this._handleUUIDChange,sortBy:this.state.sortBy,uuid:this.state.uuid}));},_handleFetchRequest:function(){if(this.state.isLoading||this.state.isLoaded)return;this.setState({isLoading:true});i.intentsDashboard({offset:this.state.offset,limit:o,uuid:this.state.uuid,reverse:this.state.isReversed||undefined,'sort-by':this.state.sortBy||undefined,'is-employee':this.state.isEmployee}).done(function(r){this.setState({intents:this.state.intents.concat(r),isLoaded:r.size<o,isLoading:false,offset:this.state.offset+r.size});}.bind(this));},_handleUUIDChange:function(r){this._setFilter({uuid:r});},_handleIsEmployeeChange:function(r){this._setFilter({isEmployee:r});},_handleIsReversedChange:function(r){this._setFilter({isReversed:r});},_handleSortByChange:function(r){this._setFilter({sortBy:r});},_setFilter:function(r){this.setState(babelHelpers['extends']({},p,r),this._handleFetchRequest);}});f.exports=q;},null);
__d('OzMerchantStatus.react',['immutable','React','cx'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=h.Map,l=i.PropTypes,m=i.createClass({displayName:'OzMerchantStatus',propTypes:{merchant:l.instanceOf(k).isRequired},render:function(){var n=this.props.merchant,o=n.get('approved'),p=n.get('blacklisted');return (i.createElement('i',{className:"_4wc0"+(o?' '+"_4wbz":'')+(p?' '+"_4wb-":''),title:o&&'approved'||p&&'blacklisted'}));}});f.exports=m;},null);
__d('OzMerchantRow.react',['OzAPI','OzHelpers','immutable','Layout.react','LeftRight.react','MessengerDialogHeader.react','MessengerDialogTitle.react','Notice.atlas','OzActions','OzButton.react','OzMerchantDialog.react','OzMerchantStatus.react','ReactComponentWithPureRenderMixin','React','XUIDialog.react','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){if(c.__markCompiled)c.__markCompiled();var x=j.Map,y=k.Column,z=k.FillColumn,aa=u.PropTypes,ba=u.createClass({displayName:'DeleteMerchantDialog',propTypes:{merchant:aa.object.isRequired,onConfirm:aa.func.isRequired},render:function(){return (u.createElement(v,{width:544,shown:true,layerHideOnBlur:false,className:"_4ebx"},u.createElement('div',{className:"_4eby _2c9g"},u.createElement(m,null,u.createElement(n,null,'Delete merchant "'+this.props.merchant.get('name-dba')+'\"?')),u.createElement(o,{type:'error'},u.createElement('div',{className:"_4wby"},'This action is irreversible. Are you sure?'),u.createElement(l,null,u.createElement(q,{onClick:p.hideDialog},'Cancel'),u.createElement(q,{onClick:this.props.onConfirm},'Yes, permanently delete this merchant'))))));},_handleToggle:function(da){i.debug('[merchantdialog] toggle',arguments);if(!da)p.hideDialog();}}),ca=u.createClass({displayName:'OzMerchantRow',mixins:[t],propTypes:{merchant:aa.instanceOf(x).isRequired},render:function(){var da=this.props.merchant,ea=da.get('website'),fa=function(ha){return '$'+(ha?(ha/100).toFixed(2):0);},ga=function(ha){return ha||0;};return (u.createElement(k,{className:"_59hd"},u.createElement(y,{className:"mrm _728"},u.createElement(s,{merchant:da})),this._renderMerchantInfo('name-dba'),this._renderMerchantInfo('name-legal'),this._renderMerchantInfo('phone'),this._renderMerchantInfo('cumulative-transaction-amount',fa),this._renderMerchantInfo('cumulative-transaction-count',ga),u.createElement(z,{className:"mrm _4wc2 _4wc3"},u.createElement('a',{target:'_blank',href:ea},ea)),this._renderActions()));},_renderMerchantInfo:function(da,ea){var fa=this.props.merchant,ga=fa.get(da);if(ea)ga=ea(ga);return (u.createElement(y,{className:"mrm _4wc2 _72a"},ga));},_renderActions:function(){var da=this._getActions();if(!da)return null;var ea=da.map(function(fa){var ga=fa.f,ha=fa.body;return u.createElement(q,{key:ha,onClick:ga},ha);});return (u.createElement(y,{className:"mrm _6w4"},ea));},_getActions:function(){var da=[],ea=this.props.merchant;da.push({body:'Edit',f:this._handleMerchantEdit()});da.push({body:'Delete',f:this._handleMerchantDelete()});if(ea.get('blacklisted')===true){da.push({body:'Whitelist',f:this._handleMerchantBlacklist(false)});}else da.push({body:'Blacklist',f:this._handleMerchantBlacklist(true)});return da;},_handleMerchantEdit:function(){return function(da,ea){var fa=this.props.merchant;p.showDialog(r,{initialMerchant:fa,title:'Edit merchant '+fa.get('name-dba'),onMerchant:function(ga){h.editMerchant(ga);p.hideDialog();}});ea();}.bind(this);},_handleMerchantBlacklist:function(da){return function(ea,fa){var ga=this.props.merchant;h.editMerchant(x({id:ga.get('id'),blacklisted:da}));fa();}.bind(this);},_handleMerchantDelete:function(){return function(da,ea){var fa=this.props.merchant;p.showDialog(ba,{merchant:this.props.merchant,onConfirm:function(){h.deleteMerchant(x({id:fa.get('id')})).then(p.hideDialog);}});ea();}.bind(this);}});f.exports=ca;},null);
__d('OzMerchants.react',['OzAPI','immutable','Layout.react','MessengerFlexScrollableArea.react','OzActions','OzButton.react','OzMerchantDialog.react','OzMerchantRow.react','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r=j.Column,s=j.FillColumn,t=i.Map,u=p.PropTypes,v=p.createClass({displayName:'OzMerchants',propTypes:{merchants:u.instanceOf(t).isRequired},getInitialState:function(){return {slice:25};},render:function(){if(this.props.merchants.isEmpty())return this._renderEmpty();return (p.createElement(j,null,p.createElement(s,null,this._renderToolbar(),this._renderMerchants())));},_createMerchant:function(){l.showDialog(n,{onMerchant:function(w){h.createMerchant(w);l.hideDialog();}});},_renderToolbar:function(){return (p.createElement(j,{className:"_726"},p.createElement(r,{className:"mrm _727 _728"},'Status'),this._renderToolbarCell('Name'),this._renderToolbarCell('Legal Name'),this._renderToolbarCell('Phone'),this._renderToolbarCell('Transaction total'),this._renderToolbarCell('Transaction count'),p.createElement(s,{className:"mrm _727"},'Website'),p.createElement(r,{className:"mrm _729"},p.createElement(m,{onClick:this._createMerchant},'New merchant'))));},_renderToolbarCell:function(w){return (p.createElement(r,{className:"mrm _727 _72a"},w));},_renderMerchants:function(){var w=this.props.merchants.sortBy(function(x){return x.get('name-dba','').toLowerCase();}).toSeq().take(this.state.slice).map(function(x){return (p.createElement(o,{key:x.get('name-dba'),merchant:x}));}).valueSeq();return (p.createElement(k,{className:"_72b",onScroll:this._handleScroll,ref:'scrollable'},w));},_renderEmpty:function(){return p.createElement('div',null,'No merchants to show');},_handleScroll:function(){if(this.refs.scrollable.isScrolledToBottom())this.setState(function(w){return {slice:w.slice+25};});}});f.exports=v;},null);
__d('OzStatsDashboardFilters.react',['Promise','immutable','OzSearchSource','OzSwitch.react','ReactComponentWithPureRenderMixin','React','SearchableDropdownInput.contrib','SearchableEntry','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=i.Map,r=m.PropTypes,s=m.createClass({displayName:'OzStatsDashboardFilters',mixins:[l],propTypes:{onTeamViewChange:r.func.isRequired,onTrainerIDChange:r.func.isRequired,reps:r.instanceOf(q).isRequired,teamView:r.bool.isRequired,trainerID:r.string.isRequired},getInitialState:function(){return {searchSource:t(this.props.reps)};},componentWillReceiveProps:function(v){if(!i.is(v.reps,this.props.reps))this.setState({searchSource:t(v.reps)});},render:function(){var v=this.props,w=v.onTeamViewChange,x=v.onTrainerIDChange,y=v.reps,z=v.teamView,aa=v.trainerID;return (m.createElement('div',{className:"_5p66"},m.createElement(k,{className:"_4vlt",isAnimated:true,isOn:z,label:'Team View',onToggle:w}),!z?m.createElement('div',{className:"_4vlu"},m.createElement(n,{value:u(y.get(aa)),onSelect:function(ba){return x(ba.getUniqueID());},placeholder:'Select a trainer...',emptySearchResultsText:'No trainers found',searchSource:this.state.searchSource})):null));}});function t(v){return new j(function(w){var x=(w.query||'').toLowerCase();return h.resolve(v.valueSeq().map(u).sortBy(function(y){return y.getTitle();}).filter(function(y){return (y.getTitle()||'').toLowerCase().indexOf(x)>-1;}).toJS());});}function u(v){return v&&new o({title:v.get('name'),uniqueID:v.get('fbid')});}f.exports=s;},null);
__d('OzStatsDashboard.react',['CandelaGroupScaleBuilder','immutable','BUIInsightsLegendChart.react','BUIInsightsLineAreaChart.react','MessengerFlexScrollableArea.react','OzButton.react','OzConfig','OzStatsDashboardFilters.react','ReactComponentWithPureRenderMixin','React','XUISingleSelector.react','cx','formatDate','OzHelpers','ozFormatTime','Reflux','Timezone','XUITable.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){'use strict';if(c.__markCompiled)c.__markCompiled();var z=r.Option,aa=h.group,ba=i.List,ca=i.Map,da=i.OrderedSet,ea=i.Range,fa=q.PropTypes,ga=604800,ha=q.createClass({displayName:'OzStatsDashboard',mixins:[p,w.connect(n.ConfigStore,'config')],propTypes:{displayTime:fa.number.isRequired,finalWeek:fa.number.isRequired,isLoading:fa.bool.isRequired,onDateChange:fa.func.isRequired,onThreadSelect:fa.func.isRequired,onTeamViewChange:fa.func.isRequired,onTrainerIDChange:fa.func.isRequired,reps:fa.instanceOf(ca).isRequired,stats:fa.oneOfType([fa.instanceOf(ba),fa.instanceOf(ca)]).isRequired,teamView:fa.bool.isRequired,trainerID:fa.string.isRequired},render:function(){var ta=this.props,ua=ta.displayTime,va=ta.finalWeek,wa=ta.onDateChange,xa=ta.onThreadSelect,ya=ta.onTeamViewChange,za=ta.onTrainerIDChange,ab=ta.reps,bb=ta.stats,cb=ta.teamView,db=ta.trainerID;return (q.createElement('div',{className:"_16u3"},this.state.config.getIn(['GK','supervisor'])?q.createElement(o,{onTeamViewChange:ya,onTrainerIDChange:za,reps:ab,teamView:cb,trainerID:db}):null,q.createElement(ia,{currentWeek:ua,finalWeek:va,onDateSelect:wa}),q.createElement('div',{className:"_16u4"},cb?q.createElement(ja,{stats:bb,displayTime:ua}):q.createElement(ka,{displayTime:ua,onThreadSelect:xa,stats:bb,reps:ab,trainerID:db}))));}}),ia=u.pure(function(ta){var ua=ta.currentWeek,va=ta.finalWeek,wa=ta.onDateSelect,xa=13,ya=ea(va,va-xa*ga,ga).map(function(za){var ab=t(za,'M j');return (q.createElement(z,{key:ab,value:za},ab));});return (q.createElement('div',{className:"_16-n"},'Stats for week starting ',q.createElement(r,{name:'OzStatsSelector',maxheight:240,onChange:wa,value:ua},ya)));}),ja=u.pure(function(ta){var ua=ta.displayTime,va=ta.stats;return (q.createElement('div',null,q.createElement(la,{chartType:'CR',teamStats:va,weekStart:ua}),q.createElement(la,{chartType:'ER',teamStats:va,weekStart:ua})));}),ka=u.pure(function(ta){var ua=ta.displayTime,va=ta.onThreadSelect,wa=ta.stats,xa=ta.reps,ya=ta.trainerID;return (q.createElement('div',null,!wa.isEmpty()?q.createElement('div',null,q.createElement(qa,{chartType:'CR',stats:wa,weekStart:ua}),q.createElement(qa,{chartType:'ER',stats:wa,weekStart:ua})):q.createElement('div',null,'Stats loading...'),q.createElement('div',{style:{padding:'10px'}},wa.map(function(za,ab){return (q.createElement(ra,{key:ab,onThreadSelect:va,section:za,reps:xa,trainerID:ya}));}))));}),la=u.pure(function(ta){var ua=ta.chartType,va=ta.displayTime,wa=ta.teamStats,xa=ua.toLowerCase(),ya=wa.map(function(za,ab){return ca({time:parseInt(ab,10),team1:za.getIn(['1',xa])/za.getIn(['1','n']),team2:za.getIn(['2',xa])/za.getIn(['2','n'])});}).toList().sortBy(function(za){return za.get('time');});return (wa.size?q.createElement(oa,{data:ya,graphSchema:ma,legendItems:na,yAxisTitle:ua+' (mins)'}):null);}),ma={time:{timezoneID:x.PST8PDT,type:'time'},team1:{renderAs:'line',type:'number'},team2:{renderAs:'line',type:'number'}},na=da([{key:'team1',label:'Team 1'},{key:'team2',label:'Team 2'}]),oa=u.pure(function(ta){var ua=ta.data,va=ta.graphSchema,wa=ta.legendItems,xa=ta.yAxisTitle,ya=[aa.apply(null,wa.map(function(za){return za.key;}).toJS())];return (q.createElement('div',{className:"_16-o"},q.createElement('div',{className:"_3aw3"},xa),q.createElement(j,{items:wa,layoutInterval:200,minItemWidthPercentage:.67},q.createElement(k,{axisMarkFormatterFactory:pa,data:ua.toJS(),height:300,width:800,schema:va,plotX:aa('time').from(ua.first().get('time')).to(ua.last().get('time')+1000),plotY:ya}))));}),pa=function(ta,ua){if(ua==='vertical'){return function(va){var wa=Math.floor(va/60)+':';if(Math.floor(va%60)<10)wa+='0';return wa+Math.floor(va%60);};}else return function(va){return t(va.instant,'M j');};},qa=u.pure(function(ta){var ua=ta.chartType,va=ta.stats,wa=ta.weekStart,xa=va.sortBy(function(cb){return cb.get('start-time');}).map(function(cb){var db=cb.get('start-time'),eb=cb.getIn(['summary','n']),fb=eb?cb.getIn(['summary','er'])/eb:null,gb=eb?cb.getIn(['summary','cr'])/eb:null,hb=cb.getIn(['all-agents','er'])/cb.getIn(['all-agents','n']),ib=cb.getIn(['all-agents','cr'])/cb.getIn(['all-agents','n']);return ca({er:fb,cr:gb,time:db,avg_er:hb,avg_cr:ib});}),ya={time:{timezoneID:x.PST8PDT,type:'time'}},za=ua.toLowerCase(),ab='avg_'+za;ya[za]={renderAs:'area',type:'number'};ya[ab]={renderAs:'line',type:'number'};var bb=da([{key:za,label:ua==='ER'?'Execution Responsiveness':'Conversational Responsiveness'},{key:ab,label:ua==='ER'?'Avg. ER':'Avg. CR'}]);return (q.createElement(oa,{data:xa,graphSchema:ya,legendItems:bb,yAxisTitle:ua+' (mins)'}));}),ra=u.pure(function(ta){var ua=ta.onThreadSelect,va=ta.section,wa=ta.reps,xa=ta.trainerID,ya=va.get('summary'),za=t(va.get('start-time'),'M j');if(!ya.get('n'))return q.createElement('div',null);return (q.createElement('div',{className:"_16-v"},q.createElement('div',{className:"_16-w"},'Stats for ',q.createElement('strong',null,za)),q.createElement('div',{className:"_16-y"},'Average ER: ',v(ya.get('er')/ya.get('n')),', Average CR: ',v(ya.get('cr')/ya.get('n'))),q.createElement(sa,{threads:va.get('threads',ba()),onThreadSelect:ua,reps:wa,trainerID:xa})));}),sa=u.pure(function(ta){var ua=ta.threads,va=ta.onThreadSelect,wa=ta.reps,xa=ta.trainerID;return (q.createElement(y,{outerBorder:true},q.createElement('thead',null,q.createElement('tr',null,q.createElement('th',{className:"_1ruu"},'User ID'),q.createElement('th',{className:"_1ruw"},'Intent'),q.createElement('th',{className:"_1rux"},'ER'),q.createElement('th',{className:"_1ruz"},'CR'),q.createElement('th',{className:"_1ru-"},'Start Time'),q.createElement('th',{className:"_1ru_"},'End Time'),q.createElement('th',{className:"_1rv0"},'Survey'),q.createElement('th',{className:"_1rv1"},'See Thread'))),q.createElement('tbody',null,ua.map(function(ya,za){return (q.createElement('tr',{key:za},q.createElement('td',null,ya.get('user-id')),q.createElement('td',null,ya.get('intent-name')),q.createElement('td',null,v(ya.get('er'))),q.createElement('td',null,v(ya.get('cr'))),q.createElement('td',null,u.toLocaleTime(ya.get('start-time')*1000)),q.createElement('td',null,u.toLocaleTime(ya.get('end-time')*1000)),q.createElement('td',null,ya.get('survey')),q.createElement('td',null,q.createElement(m,{onClick:function(ab){return va(u.threadID(ya));}},'See Thread'))));}))));});f.exports=ha;},null);
__d('OzStatsDashboardContainer.react',['immutable','OzAPI','OzStatsDashboard.react','React'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=h.List,m=h.Map,n=k.PropTypes,o=7,p=k.createClass({displayName:'OzStatsDashboardContainer',contextTypes:{uid:n.string.isRequired,router:n.object.isRequired},propTypes:{reps:n.instanceOf(m).isRequired},getInitialState:function(){var q=new Date();q.setDate(q.getDate()-q.getDay());q.setHours(0);q.setMinutes(0);q.setSeconds(0);q.setMilliseconds(0);return {displayTime:q.getTime()/1000,finalWeek:q.getTime()/1000,isLoading:false,stats:l(),summary:l(),teamView:false,trainerID:this.context.uid};},componentDidMount:function(){this._handleFetchRequest();},render:function(){return (k.createElement(j,{displayTime:this.state.displayTime,finalWeek:this.state.finalWeek,isLoading:this.state.isLoading,onDateChange:this._handleDateChange,onTeamViewChange:this._handleTeamViewChange,onThreadSelect:this._handleThreadSelect,onTrainerIDChange:this._handleTrainerIDChange,reps:this.props.reps,stats:this.state.stats,teamView:this.state.teamView,trainerID:this.state.trainerID}));},_handleFetchRequest:function(){if(this.state.isLoading)return;this.setState({isLoading:true});if(this.state.teamView){i.teamStatsDashboard({start:this.state.displayTime,days:o}).done(function(q){this.setState({isLoading:false,stats:q});}.bind(this));}else i.statsDashboard({start:this.state.displayTime,days:o,'trainer-id':this.state.trainerID}).done(function(q){this.setState({isLoading:false,stats:q});}.bind(this));},_handleTeamViewChange:function(q){this.setState({stats:l(),teamView:q},this._handleFetchRequest);},_handleThreadSelect:function(q){this.context.router.push('inbox/'+q);},_handleTrainerIDChange:function(q){this.setState({stats:l(),trainerID:q},this._handleFetchRequest);},_handleDateChange:function(q){this.setState({displayTime:q.value,stats:l()},this._handleFetchRequest);}});f.exports=p;},null);
__d('OzTop.react',['OzAPI','cx','OzHelpers','immutable','OzUserImage.react','React','relativeTimeString.atlas'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=k.List,p=k.Map,q=m.PropTypes,r=m.createClass({displayName:'OzTop',propTypes:{witIntents:q.instanceOf(p).isRequired},contextTypes:{router:q.object.isRequired},componentWillMount:function(){var s=function(){return h.topIntents().then(function(t){return (this.setState({items:t.sortBy(function(u){return -u.get('duration-ms');})}));}.bind(this));}.bind(this);s();this._interval=setInterval(s,60*1000);},componentWillUnmount:function(){clearInterval(this._interval);},getInitialState:function(){return {items:o()};},render:function(){if(this.state.items.isEmpty())return m.createElement('div',{key:'n'},'No data!');var s=this.props.witIntents;return (m.createElement('div',{className:"_p3s"},m.createElement('table',{className:"_5env"},m.createElement('tbody',null,this.state.items.map(function(t){return this._renderTopItem(t,s);}.bind(this))))));},_handleView:function(s){return function(t){var u=j.threadID(s),v=j.hasCmdOrCtrl(t);h.view(u).done(function(){v||this.context.router.push('inbox/'+u);}.bind(this));}.bind(this);},_renderTopItem:function(s,t){var u=s.get('thread'),v=s.getIn(['intent','id']);if(!u||!v)return null;var w=Date.now()+s.get('duration-ms'),x=s.getIn(['intent','wit-intent-uuid']),y=t.getIn([x,'name'],x),z=j.photo(u),aa=u.getIn(['owner','name'],'No trainer');return (m.createElement('tr',{className:"_p3t",key:v},m.createElement('td',{className:"_p3u"},n(w)),m.createElement('td',{className:"_p3v"},y),m.createElement('td',{className:"_p3x"},m.createElement(l,{className:"_p3y",photo:z}),j.getName(u)),m.createElement('td',null,aa),m.createElement('td',{className:"_p3z _30yy",onClick:this._handleView(u)},'View')));}});f.exports=r;},null);
__d('OzTrainerDashboard.react',['cx','OzHelpers','relativeTimeString.atlas','immutable','OzButton.react','OzHumans','OzStores','ReactComponentWithPureRenderMixin','React','Reflux','XUITable.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=k.Map,t=n.HumanStore,u=p.PropTypes,v=p.createClass({displayName:'OzTrainerDashboard',mixins:[q.connect(t,'humans')],propTypes:{reps:u.instanceOf(s).isRequired},contextTypes:{router:u.object.isRequired},render:function(){return (p.createElement(w,{onThreadSelect:this._handleThreadSelect,humans:this.state.humans,reps:this.props.reps}));},_handleThreadSelect:function(aa){this.context.router.push('inbox/'+aa);}}),w=p.createClass({displayName:'Main',mixins:[o],propTypes:{onThreadSelect:u.func.isRequired,humans:u.instanceOf(s).isRequired,reps:u.instanceOf(s).isRequired},render:function(){return (p.createElement('div',{className:"_10cd"},p.createElement(r,null,p.createElement('thead',null,p.createElement('tr',null,p.createElement('th',null,'Trainer'),p.createElement('th',null,'Load'),p.createElement('th',null,'Status'),p.createElement('th',null,'Team'),p.createElement('th',null,'Link to Thread'))),p.createElement('tbody',null,this._getHumans().map(function(aa){return (p.createElement(x,{key:aa.get('id'),onSelect:this._handleThreadSelect,human:aa,rep:this.props.reps.get(aa.get('id'))}));}.bind(this))))));},_getHumans:function(){var aa=this.props,ba=aa.humans,ca=aa.reps;return ba.sortBy(function(da){return ca.getIn([da.get('id'),'name']);}).valueSeq();},_handleThreadSelect:function(aa){this.props.onThreadSelect(aa.get('tid'));}}),x=p.createClass({displayName:'DashboardRow',mixins:[o],propTypes:{onSelect:u.func.isRequired,human:u.instanceOf(s).isRequired,rep:u.instanceOf(s)},render:function(){var aa=this.props,ba=aa.onSelect,ca=aa.human,da=aa.rep;return (p.createElement('tr',null,p.createElement('td',null,y(da,ca)),p.createElement('td',null,ca.get('load')),p.createElement('td',null,z(ca)),p.createElement('td',null,ca.get('team')),p.createElement('td',null,ca.get('tid')?p.createElement(l,{onClick:function(){return ba(ca);}},'See Thread'):null)));}});function y(aa,ba){var ca=aa&&aa.get('name')||'Unknown name';return ''+ca+(m.isCoach(ba)?' (Coach)':'');}function z(aa){var ba=j(+i.serverNow()-aa.get('inactive-ms',0),true),ca=m.isActive(aa)?'Active':'Away ('+ba+')';return m.inCoachMode(aa)?ca+' | In Coach Mode':ca;}f.exports=v;},null);
__d('OzMount',['OzAPI','OzHelpers','invariant','immutable','Oz.react','OzAIDashboardContainer.react','OzAll.react','OzConfig','OzFeedbackDashboard.react','OzInbox.react','OzInboxShow.react','OzIntentDashboardContainer.react','OzLoading.react','OzMerchants.react','OzStatsDashboardContainer.react','OzTop.react','OzTrainerDashboard.react','React','ReactDOM','ReloadPage','ReactRouter','URI','OzTwilio','OzServerTime'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea){if(c.__markCompiled)c.__markCompiled();da;var fa=ba.Route,ga=ba.browserHistory,ha=ba.match,ia=ba.Router,ja=ba.Redirect,ka={mount:function(qa,ra){ra=babelHelpers['extends']({},ra,oa());o.setConfig(k.fromJS(ra));i.info('[config]',ra);h.witIntents();h.merchants();h.humans();h.requirements();h.init();ea.setup();var sa=undefined,ta=pa(l,{rev:ra.rev,uid:ra.uid,version:ra.API_VERSION,skipToto:ra.skipToto==='true',onUnmount:function(){sa&&sa();}}),ua=y.createElement(fa,{component:ta},y.createElement(fa,{path:'/',component:q},y.createElement(fa,{path:'/inbox/:threadid',component:r})),y.createElement(fa,{path:'/all',component:n}),y.createElement(fa,{path:'/merchants',component:u}),y.createElement(fa,{path:'/top',component:w}),y.createElement(fa,{path:'/intents',component:s}),y.createElement(fa,{path:'/ai',component:m}),y.createElement(fa,{path:'/feedback',component:p}),y.createElement(fa,{path:'/trainers',component:x}),y.createElement(fa,{path:'/stats',component:v}),y.createElement(ja,{from:'/inbox',to:'/'})),va=function(){h.repsSync();ha({history:ga,routes:ua},function(za,ab,bb){z.render(y.createElement(ia,bb),qa);});},wa='Hello '+ra.publicName+'! Oz is connecting...';z.render(y.createElement(t,{message:wa}),qa);var xa=o.getStaticConfig('skipSky')==='true';if(xa)va();i.info('[sky] connecting to '+ra.skyTopic);var ya=function(za){if(za<0){alert('Something is very wrong! Could not connect to Skywalker');aa.now();return;}if(typeof sa==='function')sa();sa=h.realTime(ra.skyTopic,function(ab,bb,cb){if(ab){i.warn('[sky] could not connect: '+ab);return ya(za-1);}else i.info('[sky] connected to '+ra.skyTopic+': '+bb.t,bb);if(!xa)va();});};ya(3);}},la=/^ozcfg(.+)/;function ma(){var qa=new ca(window.location.href).getQueryData();Object.keys(qa).forEach(function(ra){if(la.test(ra))localStorage.setItem(ra,qa[ra]);});}function na(){var qa,ra,sa,ta={};for(qa=0;qa<localStorage.length;qa++){ra=localStorage.key(qa);sa=ra.match(la);if(sa&&sa.length)ta[sa[1]]=localStorage.getItem(ra);}return ta;}function oa(){ma();var qa=na(),ra,sa=document.location.hostname;if(sa==='www.oz.wit.ai'){ra={skyTopic:'oz/all',env:'prod',scubaCategory:'oz_console',PAGE_ID:'881263441913087',API_PATH:'https://www.oz.wit.ai/api'};}else if(sa==='intern.oz.wit.ai'||!qa.API_PATH){ra={skyTopic:'oz-staging/all',env:'staging',scubaCategory:'oz_console_dev',PAGE_ID:'506060876211905',API_PATH:'https://intern.oz.wit.ai/api'};}else{var ta=sa.split('.')[1];ra={skyTopic:'oz-dev/'+ta,env:'dev',scubaCategory:'oz_console_dev',PAGE_ID:'1579802578966277'};}ra=babelHelpers['extends']({},ra,qa,{API_VERSION:'20151027'});!ra.API_PATH?j(0):undefined;return ra;}function pa(qa,ra){return y.createClass({displayName:'Curried'+qa.displayName,render:function(){return y.createElement(qa,babelHelpers['extends']({},ra,this.props));}});}f.exports=ka;},null);